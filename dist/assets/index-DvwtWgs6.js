var _x=Object.defineProperty;var yx=(u,a,f)=>a in u?_x(u,a,{enumerable:!0,configurable:!0,writable:!0,value:f}):u[a]=f;var Kt=(u,a,f)=>yx(u,typeof a!="symbol"?a+"":a,f);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const T of document.querySelectorAll('link[rel="modulepreload"]'))y(T);new MutationObserver(T=>{for(const I of T)if(I.type==="childList")for(const S of I.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&y(S)}).observe(document,{childList:!0,subtree:!0});function f(T){const I={};return T.integrity&&(I.integrity=T.integrity),T.referrerPolicy&&(I.referrerPolicy=T.referrerPolicy),T.crossOrigin==="use-credentials"?I.credentials="include":T.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function y(T){if(T.ep)return;T.ep=!0;const I=f(T);fetch(T.href,I)}})();function ov(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var m_={exports:{}},wm={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hy;function vx(){if(hy)return wm;hy=1;var u=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function f(y,T,I){var S=null;if(I!==void 0&&(S=""+I),T.key!==void 0&&(S=""+T.key),"key"in T){I={};for(var c in T)c!=="key"&&(I[c]=T[c])}else I=T;return T=I.ref,{$$typeof:u,type:y,key:S,ref:T!==void 0?T:null,props:I}}return wm.Fragment=a,wm.jsx=f,wm.jsxs=f,wm}var dy;function xx(){return dy||(dy=1,m_.exports=vx()),m_.exports}var _e=xx(),g_={exports:{}},fn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fy;function bx(){if(fy)return fn;fy=1;var u=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),I=Symbol.for("react.consumer"),S=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),k=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),ee=Symbol.iterator;function ye(Me){return Me===null||typeof Me!="object"?null:(Me=ee&&Me[ee]||Me["@@iterator"],typeof Me=="function"?Me:null)}var Le={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ne=Object.assign,se={};function Ye(Me,at,Et){this.props=Me,this.context=at,this.refs=se,this.updater=Et||Le}Ye.prototype.isReactComponent={},Ye.prototype.setState=function(Me,at){if(typeof Me!="object"&&typeof Me!="function"&&Me!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Me,at,"setState")},Ye.prototype.forceUpdate=function(Me){this.updater.enqueueForceUpdate(this,Me,"forceUpdate")};function st(){}st.prototype=Ye.prototype;function We(Me,at,Et){this.props=Me,this.context=at,this.refs=se,this.updater=Et||Le}var gt=We.prototype=new st;gt.constructor=We,Ne(gt,Ye.prototype),gt.isPureReactComponent=!0;var nt=Array.isArray;function zt(){}var _t={H:null,A:null,T:null,S:null},Ut=Object.prototype.hasOwnProperty;function At(Me,at,Et){var Rt=Et.ref;return{$$typeof:u,type:Me,key:at,ref:Rt!==void 0?Rt:null,props:Et}}function Xt(Me,at){return At(Me.type,at,Me.props)}function tn(Me){return typeof Me=="object"&&Me!==null&&Me.$$typeof===u}function an(Me){var at={"=":"=0",":":"=2"};return"$"+Me.replace(/[=:]/g,function(Et){return at[Et]})}var An=/\/+/g;function kn(Me,at){return typeof Me=="object"&&Me!==null&&Me.key!=null?an(""+Me.key):at.toString(36)}function si(Me){switch(Me.status){case"fulfilled":return Me.value;case"rejected":throw Me.reason;default:switch(typeof Me.status=="string"?Me.then(zt,zt):(Me.status="pending",Me.then(function(at){Me.status==="pending"&&(Me.status="fulfilled",Me.value=at)},function(at){Me.status==="pending"&&(Me.status="rejected",Me.reason=at)})),Me.status){case"fulfilled":return Me.value;case"rejected":throw Me.reason}}throw Me}function Qe(Me,at,Et,Rt,$t){var Vt=typeof Me;(Vt==="undefined"||Vt==="boolean")&&(Me=null);var mn=!1;if(Me===null)mn=!0;else switch(Vt){case"bigint":case"string":case"number":mn=!0;break;case"object":switch(Me.$$typeof){case u:case a:mn=!0;break;case G:return mn=Me._init,Qe(mn(Me._payload),at,Et,Rt,$t)}}if(mn)return $t=$t(Me),mn=Rt===""?"."+kn(Me,0):Rt,nt($t)?(Et="",mn!=null&&(Et=mn.replace(An,"$&/")+"/"),Qe($t,at,Et,"",function(ei){return ei})):$t!=null&&(tn($t)&&($t=Xt($t,Et+($t.key==null||Me&&Me.key===$t.key?"":(""+$t.key).replace(An,"$&/")+"/")+mn)),at.push($t)),1;mn=0;var Nt=Rt===""?".":Rt+":";if(nt(Me))for(var gn=0;gn<Me.length;gn++)Rt=Me[gn],Vt=Nt+kn(Rt,gn),mn+=Qe(Rt,at,Et,Vt,$t);else if(gn=ye(Me),typeof gn=="function")for(Me=gn.call(Me),gn=0;!(Rt=Me.next()).done;)Rt=Rt.value,Vt=Nt+kn(Rt,gn++),mn+=Qe(Rt,at,Et,Vt,$t);else if(Vt==="object"){if(typeof Me.then=="function")return Qe(si(Me),at,Et,Rt,$t);throw at=String(Me),Error("Objects are not valid as a React child (found: "+(at==="[object Object]"?"object with keys {"+Object.keys(Me).join(", ")+"}":at)+"). If you meant to render a collection of children, use an array instead.")}return mn}function ft(Me,at,Et){if(Me==null)return Me;var Rt=[],$t=0;return Qe(Me,Rt,"","",function(Vt){return at.call(Et,Vt,$t++)}),Rt}function Dt(Me){if(Me._status===-1){var at=Me._result;at=at(),at.then(function(Et){(Me._status===0||Me._status===-1)&&(Me._status=1,Me._result=Et)},function(Et){(Me._status===0||Me._status===-1)&&(Me._status=2,Me._result=Et)}),Me._status===-1&&(Me._status=0,Me._result=at)}if(Me._status===1)return Me._result.default;throw Me._result}var Lt=typeof reportError=="function"?reportError:function(Me){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var at=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Me=="object"&&Me!==null&&typeof Me.message=="string"?String(Me.message):String(Me),error:Me});if(!window.dispatchEvent(at))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Me);return}console.error(Me)},yn={map:ft,forEach:function(Me,at,Et){ft(Me,function(){at.apply(this,arguments)},Et)},count:function(Me){var at=0;return ft(Me,function(){at++}),at},toArray:function(Me){return ft(Me,function(at){return at})||[]},only:function(Me){if(!tn(Me))throw Error("React.Children.only expected to receive a single React element child.");return Me}};return fn.Activity=K,fn.Children=yn,fn.Component=Ye,fn.Fragment=f,fn.Profiler=T,fn.PureComponent=We,fn.StrictMode=y,fn.Suspense=F,fn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=_t,fn.__COMPILER_RUNTIME={__proto__:null,c:function(Me){return _t.H.useMemoCache(Me)}},fn.cache=function(Me){return function(){return Me.apply(null,arguments)}},fn.cacheSignal=function(){return null},fn.cloneElement=function(Me,at,Et){if(Me==null)throw Error("The argument must be a React element, but you passed "+Me+".");var Rt=Ne({},Me.props),$t=Me.key;if(at!=null)for(Vt in at.key!==void 0&&($t=""+at.key),at)!Ut.call(at,Vt)||Vt==="key"||Vt==="__self"||Vt==="__source"||Vt==="ref"&&at.ref===void 0||(Rt[Vt]=at[Vt]);var Vt=arguments.length-2;if(Vt===1)Rt.children=Et;else if(1<Vt){for(var mn=Array(Vt),Nt=0;Nt<Vt;Nt++)mn[Nt]=arguments[Nt+2];Rt.children=mn}return At(Me.type,$t,Rt)},fn.createContext=function(Me){return Me={$$typeof:S,_currentValue:Me,_currentValue2:Me,_threadCount:0,Provider:null,Consumer:null},Me.Provider=Me,Me.Consumer={$$typeof:I,_context:Me},Me},fn.createElement=function(Me,at,Et){var Rt,$t={},Vt=null;if(at!=null)for(Rt in at.key!==void 0&&(Vt=""+at.key),at)Ut.call(at,Rt)&&Rt!=="key"&&Rt!=="__self"&&Rt!=="__source"&&($t[Rt]=at[Rt]);var mn=arguments.length-2;if(mn===1)$t.children=Et;else if(1<mn){for(var Nt=Array(mn),gn=0;gn<mn;gn++)Nt[gn]=arguments[gn+2];$t.children=Nt}if(Me&&Me.defaultProps)for(Rt in mn=Me.defaultProps,mn)$t[Rt]===void 0&&($t[Rt]=mn[Rt]);return At(Me,Vt,$t)},fn.createRef=function(){return{current:null}},fn.forwardRef=function(Me){return{$$typeof:c,render:Me}},fn.isValidElement=tn,fn.lazy=function(Me){return{$$typeof:G,_payload:{_status:-1,_result:Me},_init:Dt}},fn.memo=function(Me,at){return{$$typeof:k,type:Me,compare:at===void 0?null:at}},fn.startTransition=function(Me){var at=_t.T,Et={};_t.T=Et;try{var Rt=Me(),$t=_t.S;$t!==null&&$t(Et,Rt),typeof Rt=="object"&&Rt!==null&&typeof Rt.then=="function"&&Rt.then(zt,Lt)}catch(Vt){Lt(Vt)}finally{at!==null&&Et.types!==null&&(at.types=Et.types),_t.T=at}},fn.unstable_useCacheRefresh=function(){return _t.H.useCacheRefresh()},fn.use=function(Me){return _t.H.use(Me)},fn.useActionState=function(Me,at,Et){return _t.H.useActionState(Me,at,Et)},fn.useCallback=function(Me,at){return _t.H.useCallback(Me,at)},fn.useContext=function(Me){return _t.H.useContext(Me)},fn.useDebugValue=function(){},fn.useDeferredValue=function(Me,at){return _t.H.useDeferredValue(Me,at)},fn.useEffect=function(Me,at){return _t.H.useEffect(Me,at)},fn.useEffectEvent=function(Me){return _t.H.useEffectEvent(Me)},fn.useId=function(){return _t.H.useId()},fn.useImperativeHandle=function(Me,at,Et){return _t.H.useImperativeHandle(Me,at,Et)},fn.useInsertionEffect=function(Me,at){return _t.H.useInsertionEffect(Me,at)},fn.useLayoutEffect=function(Me,at){return _t.H.useLayoutEffect(Me,at)},fn.useMemo=function(Me,at){return _t.H.useMemo(Me,at)},fn.useOptimistic=function(Me,at){return _t.H.useOptimistic(Me,at)},fn.useReducer=function(Me,at,Et){return _t.H.useReducer(Me,at,Et)},fn.useRef=function(Me){return _t.H.useRef(Me)},fn.useState=function(Me){return _t.H.useState(Me)},fn.useSyncExternalStore=function(Me,at,Et){return _t.H.useSyncExternalStore(Me,at,Et)},fn.useTransition=function(){return _t.H.useTransition()},fn.version="19.2.4",fn}var py;function G_(){return py||(py=1,g_.exports=bx()),g_.exports}var Tn=G_();const wx=ov(Tn);var __={exports:{}},Tm={},y_={exports:{}},v_={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var my;function Tx(){return my||(my=1,(function(u){function a(Qe,ft){var Dt=Qe.length;Qe.push(ft);e:for(;0<Dt;){var Lt=Dt-1>>>1,yn=Qe[Lt];if(0<T(yn,ft))Qe[Lt]=ft,Qe[Dt]=yn,Dt=Lt;else break e}}function f(Qe){return Qe.length===0?null:Qe[0]}function y(Qe){if(Qe.length===0)return null;var ft=Qe[0],Dt=Qe.pop();if(Dt!==ft){Qe[0]=Dt;e:for(var Lt=0,yn=Qe.length,Me=yn>>>1;Lt<Me;){var at=2*(Lt+1)-1,Et=Qe[at],Rt=at+1,$t=Qe[Rt];if(0>T(Et,Dt))Rt<yn&&0>T($t,Et)?(Qe[Lt]=$t,Qe[Rt]=Dt,Lt=Rt):(Qe[Lt]=Et,Qe[at]=Dt,Lt=at);else if(Rt<yn&&0>T($t,Dt))Qe[Lt]=$t,Qe[Rt]=Dt,Lt=Rt;else break e}}return ft}function T(Qe,ft){var Dt=Qe.sortIndex-ft.sortIndex;return Dt!==0?Dt:Qe.id-ft.id}if(u.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var I=performance;u.unstable_now=function(){return I.now()}}else{var S=Date,c=S.now();u.unstable_now=function(){return S.now()-c}}var F=[],k=[],G=1,K=null,ee=3,ye=!1,Le=!1,Ne=!1,se=!1,Ye=typeof setTimeout=="function"?setTimeout:null,st=typeof clearTimeout=="function"?clearTimeout:null,We=typeof setImmediate<"u"?setImmediate:null;function gt(Qe){for(var ft=f(k);ft!==null;){if(ft.callback===null)y(k);else if(ft.startTime<=Qe)y(k),ft.sortIndex=ft.expirationTime,a(F,ft);else break;ft=f(k)}}function nt(Qe){if(Ne=!1,gt(Qe),!Le)if(f(F)!==null)Le=!0,zt||(zt=!0,an());else{var ft=f(k);ft!==null&&si(nt,ft.startTime-Qe)}}var zt=!1,_t=-1,Ut=5,At=-1;function Xt(){return se?!0:!(u.unstable_now()-At<Ut)}function tn(){if(se=!1,zt){var Qe=u.unstable_now();At=Qe;var ft=!0;try{e:{Le=!1,Ne&&(Ne=!1,st(_t),_t=-1),ye=!0;var Dt=ee;try{t:{for(gt(Qe),K=f(F);K!==null&&!(K.expirationTime>Qe&&Xt());){var Lt=K.callback;if(typeof Lt=="function"){K.callback=null,ee=K.priorityLevel;var yn=Lt(K.expirationTime<=Qe);if(Qe=u.unstable_now(),typeof yn=="function"){K.callback=yn,gt(Qe),ft=!0;break t}K===f(F)&&y(F),gt(Qe)}else y(F);K=f(F)}if(K!==null)ft=!0;else{var Me=f(k);Me!==null&&si(nt,Me.startTime-Qe),ft=!1}}break e}finally{K=null,ee=Dt,ye=!1}ft=void 0}}finally{ft?an():zt=!1}}}var an;if(typeof We=="function")an=function(){We(tn)};else if(typeof MessageChannel<"u"){var An=new MessageChannel,kn=An.port2;An.port1.onmessage=tn,an=function(){kn.postMessage(null)}}else an=function(){Ye(tn,0)};function si(Qe,ft){_t=Ye(function(){Qe(u.unstable_now())},ft)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(Qe){Qe.callback=null},u.unstable_forceFrameRate=function(Qe){0>Qe||125<Qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ut=0<Qe?Math.floor(1e3/Qe):5},u.unstable_getCurrentPriorityLevel=function(){return ee},u.unstable_next=function(Qe){switch(ee){case 1:case 2:case 3:var ft=3;break;default:ft=ee}var Dt=ee;ee=ft;try{return Qe()}finally{ee=Dt}},u.unstable_requestPaint=function(){se=!0},u.unstable_runWithPriority=function(Qe,ft){switch(Qe){case 1:case 2:case 3:case 4:case 5:break;default:Qe=3}var Dt=ee;ee=Qe;try{return ft()}finally{ee=Dt}},u.unstable_scheduleCallback=function(Qe,ft,Dt){var Lt=u.unstable_now();switch(typeof Dt=="object"&&Dt!==null?(Dt=Dt.delay,Dt=typeof Dt=="number"&&0<Dt?Lt+Dt:Lt):Dt=Lt,Qe){case 1:var yn=-1;break;case 2:yn=250;break;case 5:yn=1073741823;break;case 4:yn=1e4;break;default:yn=5e3}return yn=Dt+yn,Qe={id:G++,callback:ft,priorityLevel:Qe,startTime:Dt,expirationTime:yn,sortIndex:-1},Dt>Lt?(Qe.sortIndex=Dt,a(k,Qe),f(F)===null&&Qe===f(k)&&(Ne?(st(_t),_t=-1):Ne=!0,si(nt,Dt-Lt))):(Qe.sortIndex=yn,a(F,Qe),Le||ye||(Le=!0,zt||(zt=!0,an()))),Qe},u.unstable_shouldYield=Xt,u.unstable_wrapCallback=function(Qe){var ft=ee;return function(){var Dt=ee;ee=ft;try{return Qe.apply(this,arguments)}finally{ee=Dt}}}})(v_)),v_}var gy;function Sx(){return gy||(gy=1,y_.exports=Tx()),y_.exports}var x_={exports:{}},Go={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _y;function Ex(){if(_y)return Go;_y=1;var u=G_();function a(F){var k="https://react.dev/errors/"+F;if(1<arguments.length){k+="?args[]="+encodeURIComponent(arguments[1]);for(var G=2;G<arguments.length;G++)k+="&args[]="+encodeURIComponent(arguments[G])}return"Minified React error #"+F+"; visit "+k+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function f(){}var y={d:{f,r:function(){throw Error(a(522))},D:f,C:f,L:f,m:f,X:f,S:f,M:f},p:0,findDOMNode:null},T=Symbol.for("react.portal");function I(F,k,G){var K=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:T,key:K==null?null:""+K,children:F,containerInfo:k,implementation:G}}var S=u.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(F,k){if(F==="font")return"";if(typeof k=="string")return k==="use-credentials"?k:""}return Go.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=y,Go.createPortal=function(F,k){var G=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!k||k.nodeType!==1&&k.nodeType!==9&&k.nodeType!==11)throw Error(a(299));return I(F,k,null,G)},Go.flushSync=function(F){var k=S.T,G=y.p;try{if(S.T=null,y.p=2,F)return F()}finally{S.T=k,y.p=G,y.d.f()}},Go.preconnect=function(F,k){typeof F=="string"&&(k?(k=k.crossOrigin,k=typeof k=="string"?k==="use-credentials"?k:"":void 0):k=null,y.d.C(F,k))},Go.prefetchDNS=function(F){typeof F=="string"&&y.d.D(F)},Go.preinit=function(F,k){if(typeof F=="string"&&k&&typeof k.as=="string"){var G=k.as,K=c(G,k.crossOrigin),ee=typeof k.integrity=="string"?k.integrity:void 0,ye=typeof k.fetchPriority=="string"?k.fetchPriority:void 0;G==="style"?y.d.S(F,typeof k.precedence=="string"?k.precedence:void 0,{crossOrigin:K,integrity:ee,fetchPriority:ye}):G==="script"&&y.d.X(F,{crossOrigin:K,integrity:ee,fetchPriority:ye,nonce:typeof k.nonce=="string"?k.nonce:void 0})}},Go.preinitModule=function(F,k){if(typeof F=="string")if(typeof k=="object"&&k!==null){if(k.as==null||k.as==="script"){var G=c(k.as,k.crossOrigin);y.d.M(F,{crossOrigin:G,integrity:typeof k.integrity=="string"?k.integrity:void 0,nonce:typeof k.nonce=="string"?k.nonce:void 0})}}else k==null&&y.d.M(F)},Go.preload=function(F,k){if(typeof F=="string"&&typeof k=="object"&&k!==null&&typeof k.as=="string"){var G=k.as,K=c(G,k.crossOrigin);y.d.L(F,G,{crossOrigin:K,integrity:typeof k.integrity=="string"?k.integrity:void 0,nonce:typeof k.nonce=="string"?k.nonce:void 0,type:typeof k.type=="string"?k.type:void 0,fetchPriority:typeof k.fetchPriority=="string"?k.fetchPriority:void 0,referrerPolicy:typeof k.referrerPolicy=="string"?k.referrerPolicy:void 0,imageSrcSet:typeof k.imageSrcSet=="string"?k.imageSrcSet:void 0,imageSizes:typeof k.imageSizes=="string"?k.imageSizes:void 0,media:typeof k.media=="string"?k.media:void 0})}},Go.preloadModule=function(F,k){if(typeof F=="string")if(k){var G=c(k.as,k.crossOrigin);y.d.m(F,{as:typeof k.as=="string"&&k.as!=="script"?k.as:void 0,crossOrigin:G,integrity:typeof k.integrity=="string"?k.integrity:void 0})}else y.d.m(F)},Go.requestFormReset=function(F){y.d.r(F)},Go.unstable_batchedUpdates=function(F,k){return F(k)},Go.useFormState=function(F,k,G){return S.H.useFormState(F,k,G)},Go.useFormStatus=function(){return S.H.useHostTransitionStatus()},Go.version="19.2.4",Go}var yy;function Cx(){if(yy)return x_.exports;yy=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(a){console.error(a)}}return u(),x_.exports=Ex(),x_.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vy;function Ax(){if(vy)return Tm;vy=1;var u=Sx(),a=G_(),f=Cx();function y(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)s+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function T(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function I(r){var s=r,p=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(p=s.return),r=s.return;while(r)}return s.tag===3?p:null}function S(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function c(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function F(r){if(I(r)!==r)throw Error(y(188))}function k(r){var s=r.alternate;if(!s){if(s=I(r),s===null)throw Error(y(188));return s!==r?null:r}for(var p=r,x=s;;){var P=p.return;if(P===null)break;var L=P.alternate;if(L===null){if(x=P.return,x!==null){p=x;continue}break}if(P.child===L.child){for(L=P.child;L;){if(L===p)return F(P),r;if(L===x)return F(P),s;L=L.sibling}throw Error(y(188))}if(p.return!==x.return)p=P,x=L;else{for(var $=!1,oe=P.child;oe;){if(oe===p){$=!0,p=P,x=L;break}if(oe===x){$=!0,x=P,p=L;break}oe=oe.sibling}if(!$){for(oe=L.child;oe;){if(oe===p){$=!0,p=L,x=P;break}if(oe===x){$=!0,x=L,p=P;break}oe=oe.sibling}if(!$)throw Error(y(189))}}if(p.alternate!==x)throw Error(y(190))}if(p.tag!==3)throw Error(y(188));return p.stateNode.current===p?r:s}function G(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=G(r),s!==null)return s;r=r.sibling}return null}var K=Object.assign,ee=Symbol.for("react.element"),ye=Symbol.for("react.transitional.element"),Le=Symbol.for("react.portal"),Ne=Symbol.for("react.fragment"),se=Symbol.for("react.strict_mode"),Ye=Symbol.for("react.profiler"),st=Symbol.for("react.consumer"),We=Symbol.for("react.context"),gt=Symbol.for("react.forward_ref"),nt=Symbol.for("react.suspense"),zt=Symbol.for("react.suspense_list"),_t=Symbol.for("react.memo"),Ut=Symbol.for("react.lazy"),At=Symbol.for("react.activity"),Xt=Symbol.for("react.memo_cache_sentinel"),tn=Symbol.iterator;function an(r){return r===null||typeof r!="object"?null:(r=tn&&r[tn]||r["@@iterator"],typeof r=="function"?r:null)}var An=Symbol.for("react.client.reference");function kn(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===An?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Ne:return"Fragment";case Ye:return"Profiler";case se:return"StrictMode";case nt:return"Suspense";case zt:return"SuspenseList";case At:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case Le:return"Portal";case We:return r.displayName||"Context";case st:return(r._context.displayName||"Context")+".Consumer";case gt:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case _t:return s=r.displayName||null,s!==null?s:kn(r.type)||"Memo";case Ut:s=r._payload,r=r._init;try{return kn(r(s))}catch{}}return null}var si=Array.isArray,Qe=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ft=f.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Dt={pending:!1,data:null,method:null,action:null},Lt=[],yn=-1;function Me(r){return{current:r}}function at(r){0>yn||(r.current=Lt[yn],Lt[yn]=null,yn--)}function Et(r,s){yn++,Lt[yn]=r.current,r.current=s}var Rt=Me(null),$t=Me(null),Vt=Me(null),mn=Me(null);function Nt(r,s){switch(Et(Vt,s),Et($t,r),Et(Rt,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?pu(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=pu(s),r=Kp(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}at(Rt),Et(Rt,r)}function gn(){at(Rt),at($t),at(Vt)}function ei(r){r.memoizedState!==null&&Et(mn,r);var s=Rt.current,p=Kp(s,r.type);s!==p&&(Et($t,r),Et(Rt,p))}function bn(r){$t.current===r&&(at(Rt),at($t)),mn.current===r&&(at(mn),bh._currentValue=Dt)}var Pi,er;function wn(r){if(Pi===void 0)try{throw Error()}catch(p){var s=p.stack.trim().match(/\n( *(at )?)/);Pi=s&&s[1]||"",er=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Pi+r+er}var ji=!1;function sr(r,s){if(!r||ji)return"";ji=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(s){var ct=function(){throw Error()};if(Object.defineProperty(ct.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ct,[])}catch(Je){var Ze=Je}Reflect.construct(r,[],ct)}else{try{ct.call()}catch(Je){Ze=Je}r.call(ct.prototype)}}else{try{throw Error()}catch(Je){Ze=Je}(ct=r())&&typeof ct.catch=="function"&&ct.catch(function(){})}}catch(Je){if(Je&&Ze&&typeof Je.stack=="string")return[Je.stack,Ze.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var P=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");P&&P.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var L=x.DetermineComponentFrameRoot(),$=L[0],oe=L[1];if($&&oe){var Se=$.split(`
`),qe=oe.split(`
`);for(P=x=0;x<Se.length&&!Se[x].includes("DetermineComponentFrameRoot");)x++;for(;P<qe.length&&!qe[P].includes("DetermineComponentFrameRoot");)P++;if(x===Se.length||P===qe.length)for(x=Se.length-1,P=qe.length-1;1<=x&&0<=P&&Se[x]!==qe[P];)P--;for(;1<=x&&0<=P;x--,P--)if(Se[x]!==qe[P]){if(x!==1||P!==1)do if(x--,P--,0>P||Se[x]!==qe[P]){var tt=`
`+Se[x].replace(" at new "," at ");return r.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",r.displayName)),tt}while(1<=x&&0<=P);break}}}finally{ji=!1,Error.prepareStackTrace=p}return(p=r?r.displayName||r.name:"")?wn(p):""}function un(r,s){switch(r.tag){case 26:case 27:case 5:return wn(r.type);case 16:return wn("Lazy");case 13:return r.child!==s&&s!==null?wn("Suspense Fallback"):wn("Suspense");case 19:return wn("SuspenseList");case 0:case 15:return sr(r.type,!1);case 11:return sr(r.type.render,!1);case 1:return sr(r.type,!0);case 31:return wn("Activity");default:return""}}function ar(r){try{var s="",p=null;do s+=un(r,p),p=r,r=r.return;while(r);return s}catch(x){return`
Error generating stack: `+x.message+`
`+x.stack}}var wo=Object.prototype.hasOwnProperty,Ho=u.unstable_scheduleCallback,Dr=u.unstable_cancelCallback,io=u.unstable_shouldYield,Bs=u.unstable_requestPaint,Di=u.unstable_now,Sr=u.unstable_getCurrentPriorityLevel,Os=u.unstable_ImmediatePriority,Ll=u.unstable_UserBlockingPriority,Us=u.unstable_NormalPriority,Nl=u.unstable_LowPriority,Re=u.unstable_IdlePriority,W=u.log,Q=u.unstable_setDisableYieldValue,ne=null,me=null;function we(r){if(typeof W=="function"&&Q(r),me&&typeof me.setStrictMode=="function")try{me.setStrictMode(ne,r)}catch{}}var Pe=Math.clz32?Math.clz32:De,Be=Math.log,Ee=Math.LN2;function De(r){return r>>>=0,r===0?32:31-(Be(r)/Ee|0)|0}var et=256,$e=262144,ut=4194304;function Ce(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Ht(r,s,p){var x=r.pendingLanes;if(x===0)return 0;var P=0,L=r.suspendedLanes,$=r.pingedLanes;r=r.warmLanes;var oe=x&134217727;return oe!==0?(x=oe&~L,x!==0?P=Ce(x):($&=oe,$!==0?P=Ce($):p||(p=oe&~r,p!==0&&(P=Ce(p))))):(oe=x&~L,oe!==0?P=Ce(oe):$!==0?P=Ce($):p||(p=x&~r,p!==0&&(P=Ce(p)))),P===0?0:s!==0&&s!==P&&(s&L)===0&&(L=P&-P,p=s&-s,L>=p||L===32&&(p&4194048)!==0)?s:P}function Fn(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function Mt(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ot(){var r=ut;return ut<<=1,(ut&62914560)===0&&(ut=4194304),r}function Jt(r){for(var s=[],p=0;31>p;p++)s.push(r);return s}function Nn(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function ii(r,s,p,x,P,L){var $=r.pendingLanes;r.pendingLanes=p,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=p,r.entangledLanes&=p,r.errorRecoveryDisabledLanes&=p,r.shellSuspendCounter=0;var oe=r.entanglements,Se=r.expirationTimes,qe=r.hiddenUpdates;for(p=$&~p;0<p;){var tt=31-Pe(p),ct=1<<tt;oe[tt]=0,Se[tt]=-1;var Ze=qe[tt];if(Ze!==null)for(qe[tt]=null,tt=0;tt<Ze.length;tt++){var Je=Ze[tt];Je!==null&&(Je.lane&=-536870913)}p&=~ct}x!==0&&Yi(r,x,0),L!==0&&P===0&&r.tag!==0&&(r.suspendedLanes|=L&~($&~s))}function Yi(r,s,p){r.pendingLanes|=s,r.suspendedLanes&=~s;var x=31-Pe(s);r.entangledLanes|=s,r.entanglements[x]=r.entanglements[x]|1073741824|p&261930}function Xi(r,s){var p=r.entangledLanes|=s;for(r=r.entanglements;p;){var x=31-Pe(p),P=1<<x;P&s|r[x]&s&&(r[x]|=s),p&=~P}}function _i(r,s){var p=s&-s;return p=(p&42)!==0?1:Oi(p),(p&(r.suspendedLanes|s))!==0?0:p}function Oi(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function it(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function zi(){var r=ft.p;return r!==0?r:(r=window.event,r===void 0?32:xc(r.type))}function zr(r,s){var p=ft.p;try{return ft.p=r,s()}finally{ft.p=p}}var Gr=Math.random().toString(36).slice(2),vn="__reactFiber$"+Gr,dt="__reactProps$"+Gr,jt="__reactContainer$"+Gr,on="__reactEvents$"+Gr,ro="__reactListeners$"+Gr,Cc="__reactHandles$"+Gr,cs="__reactResources$"+Gr,Qt="__reactMarker$"+Gr;function Ga(r){delete r[vn],delete r[dt],delete r[on],delete r[ro],delete r[Cc]}function hs(r){var s=r[vn];if(s)return s;for(var p=r.parentNode;p;){if(s=p[jt]||p[vn]){if(p=s.alternate,s.child!==null||p!==null&&p.child!==null)for(r=vd(r);r!==null;){if(p=r[vn])return p;r=vd(r)}return s}r=p,p=r.parentNode}return null}function Vs(r){if(r=r[vn]||r[jt]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function ds(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(y(33))}function fs(r){var s=r[cs];return s||(s=r[cs]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function wi(r){r[Qt]=!0}var kl=new Set,Er={};function Sn(r,s){Gs(r,s),Gs(r+"Capture",s)}function Gs(r,s){for(Er[r]=s,r=0;r<s.length;r++)kl.add(s[r])}var Fl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Bl={},ha={};function Zo(r){return wo.call(ha,r)?!0:wo.call(Bl,r)?!1:Fl.test(r)?ha[r]=!0:(Bl[r]=!0,!1)}function Eu(r,s,p){if(Zo(s))if(p===null)r.removeAttribute(s);else{switch(typeof p){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var x=s.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+p)}}function ps(r,s,p){if(p===null)r.removeAttribute(s);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+p)}}function To(r,s,p,x){if(x===null)r.removeAttribute(p);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(p);return}r.setAttributeNS(s,p,""+x)}}function Pn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Ah(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Ud(r,s,p){var x=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var P=x.get,L=x.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return P.call(this)},set:function($){p=""+$,L.call(this,$)}}),Object.defineProperty(r,s,{enumerable:x.enumerable}),{getValue:function(){return p},setValue:function($){p=""+$},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function qa(r){if(!r._valueTracker){var s=Ah(r)?"checked":"value";r._valueTracker=Ud(r,s,""+r[s])}}function Mh(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var p=s.getValue(),x="";return r&&(x=Ah(r)?r.checked?"true":"false":r.value),r=x,r!==p?(s.setValue(r),!0):!1}function Cu(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Vd=/[\n"\\]/g;function Lr(r){return r.replace(Vd,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Au(r,s,p,x,P,L,$,oe){r.name="",$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"?r.type=$:r.removeAttribute("type"),s!=null?$==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+Pn(s)):r.value!==""+Pn(s)&&(r.value=""+Pn(s)):$!=="submit"&&$!=="reset"||r.removeAttribute("value"),s!=null?Mu(r,$,Pn(s)):p!=null?Mu(r,$,Pn(p)):x!=null&&r.removeAttribute("value"),P==null&&L!=null&&(r.defaultChecked=!!L),P!=null&&(r.checked=P&&typeof P!="function"&&typeof P!="symbol"),oe!=null&&typeof oe!="function"&&typeof oe!="symbol"&&typeof oe!="boolean"?r.name=""+Pn(oe):r.removeAttribute("name")}function Ac(r,s,p,x,P,L,$,oe){if(L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(r.type=L),s!=null||p!=null){if(!(L!=="submit"&&L!=="reset"||s!=null)){qa(r);return}p=p!=null?""+Pn(p):"",s=s!=null?""+Pn(s):p,oe||s===r.value||(r.value=s),r.defaultValue=s}x=x??P,x=typeof x!="function"&&typeof x!="symbol"&&!!x,r.checked=oe?r.checked:!!x,r.defaultChecked=!!x,$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(r.name=$),qa(r)}function Mu(r,s,p){s==="number"&&Cu(r.ownerDocument)===r||r.defaultValue===""+p||(r.defaultValue=""+p)}function da(r,s,p,x){if(r=r.options,s){s={};for(var P=0;P<p.length;P++)s["$"+p[P]]=!0;for(p=0;p<r.length;p++)P=s.hasOwnProperty("$"+r[p].value),r[p].selected!==P&&(r[p].selected=P),P&&x&&(r[p].defaultSelected=!0)}else{for(p=""+Pn(p),s=null,P=0;P<r.length;P++){if(r[P].value===p){r[P].selected=!0,x&&(r[P].defaultSelected=!0);return}s!==null||r[P].disabled||(s=r[P])}s!==null&&(s.selected=!0)}}function Gd(r,s,p){if(s!=null&&(s=""+Pn(s),s!==r.value&&(r.value=s),p==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=p!=null?""+Pn(p):""}function Ol(r,s,p,x){if(s==null){if(x!=null){if(p!=null)throw Error(y(92));if(si(x)){if(1<x.length)throw Error(y(93));x=x[0]}p=x}p==null&&(p=""),s=p}p=Pn(s),r.defaultValue=p,x=r.textContent,x===p&&x!==""&&x!==null&&(r.value=x),qa(r)}function qs(r,s){if(s){var p=r.firstChild;if(p&&p===r.lastChild&&p.nodeType===3){p.nodeValue=s;return}}r.textContent=s}var qd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ha(r,s,p){var x=s.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?x?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":x?r.setProperty(s,p):typeof p!="number"||p===0||qd.has(s)?s==="float"?r.cssFloat=p:r[s]=(""+p).trim():r[s]=p+"px"}function Mc(r,s,p){if(s!=null&&typeof s!="object")throw Error(y(62));if(r=r.style,p!=null){for(var x in p)!p.hasOwnProperty(x)||s!=null&&s.hasOwnProperty(x)||(x.indexOf("--")===0?r.setProperty(x,""):x==="float"?r.cssFloat="":r[x]="");for(var P in s)x=s[P],s.hasOwnProperty(P)&&p[P]!==x&&Ha(r,P,x)}else for(var L in s)s.hasOwnProperty(L)&&Ha(r,L,s[L])}function Za(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fa=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ul=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function rn(r){return Ul.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function $o(){}var Ih=null;function Iu(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var tr=null,Ui=null;function ci(r){var s=Vs(r);if(s&&(r=s.stateNode)){var p=r[dt]||null;e:switch(r=s.stateNode,s.type){case"input":if(Au(r,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),s=p.name,p.type==="radio"&&s!=null){for(p=r;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+Lr(""+s)+'"][type="radio"]'),s=0;s<p.length;s++){var x=p[s];if(x!==r&&x.form===r.form){var P=x[dt]||null;if(!P)throw Error(y(90));Au(x,P.value,P.defaultValue,P.defaultValue,P.checked,P.defaultChecked,P.type,P.name)}}for(s=0;s<p.length;s++)x=p[s],x.form===r.form&&Mh(x)}break e;case"textarea":Gd(r,p.value,p.defaultValue);break e;case"select":s=p.value,s!=null&&da(r,!!p.multiple,s,!1)}}}var qt=!1;function Yn(r,s,p){if(qt)return r(s,p);qt=!0;try{var x=r(s);return x}finally{if(qt=!1,(tr!==null||Ui!==null)&&(hd(),tr&&(s=tr,r=Ui,Ui=tr=null,ci(s),r)))for(s=0;s<r.length;s++)ci(r[s])}}function So(r,s){var p=r.stateNode;if(p===null)return null;var x=p[dt]||null;if(x===null)return null;p=x[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(r=r.type,x=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!x;break e;default:r=!1}if(r)return null;if(p&&typeof p!="function")throw Error(y(231,s,typeof p));return p}var Ti=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Nr=!1;if(Ti)try{var nr={};Object.defineProperty(nr,"passive",{get:function(){Nr=!0}}),window.addEventListener("test",nr,nr),window.removeEventListener("test",nr,nr)}catch{Nr=!1}var oo=null,ms=null,hi=null;function pa(){if(hi)return hi;var r,s=ms,p=s.length,x,P="value"in oo?oo.value:oo.textContent,L=P.length;for(r=0;r<p&&s[r]===P[r];r++);var $=p-r;for(x=1;x<=$&&s[p-x]===P[L-x];x++);return hi=P.slice(r,1<x?1-x:void 0)}function so(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function $a(){return!0}function kr(){return!1}function Ji(r){function s(p,x,P,L,$){this._reactName=p,this._targetInst=P,this.type=x,this.nativeEvent=L,this.target=$,this.currentTarget=null;for(var oe in r)r.hasOwnProperty(oe)&&(p=r[oe],this[oe]=p?p(L):L[oe]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?$a:kr,this.isPropagationStopped=kr,this}return K(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=$a)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=$a)},persist:function(){},isPersistent:$a}),s}var Fr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ru=Ji(Fr),ja=K({},Fr,{view:0,detail:0}),Ya=Ji(ja),qn,ma,cn,en=K({},ja,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zu,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==cn&&(cn&&r.type==="mousemove"?(qn=r.screenX-cn.screenX,ma=r.screenY-cn.screenY):ma=qn=0,cn=r),qn)},movementY:function(r){return"movementY"in r?r.movementY:ma}}),Xa=Ji(en),En=K({},en,{dataTransfer:0}),Pu=Ji(En),Eo=K({},ja,{relatedTarget:0}),ga=Ji(Eo),_a=K({},Fr,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=Ji(_a),Du=K({},Fr,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Rh=Ji(Du),gp=K({},Fr,{data:0}),Ph=Ji(gp),Br={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},di={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ja(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=di[r])?!!s[r]:!1}function zu(){return Ja}var Lu=K({},ja,{key:function(r){if(r.key){var s=Br[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=so(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?gs[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zu,charCode:function(r){return r.type==="keypress"?so(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?so(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Si=Ji(Lu),Zd=K({},en,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ic=Ji(Zd),$d=K({},ja,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zu}),_p=Ji($d),Vl=K({},Fr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Rc=Ji(Vl),Gl=K({},en,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Dh=Ji(Gl),Nu=K({},Fr,{newState:0,oldState:0}),ql=Ji(Nu),Hl=[9,13,27,32],Li=Ti&&"CompositionEvent"in window,Zl=null;Ti&&"documentMode"in document&&(Zl=document.documentMode);var $l=Ti&&"TextEvent"in window&&!Zl,jl=Ti&&(!Li||Zl&&8<Zl&&11>=Zl),ya=" ",jd=!1;function ku(r,s){switch(r){case"keyup":return Hl.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yd(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var jo=!1;function Pc(r,s){switch(r){case"compositionend":return Yd(s);case"keypress":return s.which!==32?null:(jd=!0,ya);case"textInput":return r=s.data,r===ya&&jd?null:r;default:return null}}function Xd(r,s){if(jo)return r==="compositionend"||!Li&&ku(r,s)?(r=pa(),hi=ms=oo=null,jo=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return jl&&s.locale!=="ko"?null:s.data;default:return null}}var Jd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dc(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Jd[r.type]:s==="textarea"}function zc(r,s,p,x){tr?Ui?Ui.push(x):Ui=[x]:tr=x,s=md(s,"onChange"),0<s.length&&(p=new Ru("onChange","change",null,p,x),r.push({event:p,listeners:s}))}var Wa=null,Yl=null;function Wd(r){sg(r,0)}function Fu(r){var s=ds(r);if(Mh(s))return r}function va(r,s){if(r==="change")return s}var zh=!1;if(Ti){var Bu;if(Ti){var xa="oninput"in document;if(!xa){var Lh=document.createElement("div");Lh.setAttribute("oninput","return;"),xa=typeof Lh.oninput=="function"}Bu=xa}else Bu=!1;zh=Bu&&(!document.documentMode||9<document.documentMode)}function Ou(){Wa&&(Wa.detachEvent("onpropertychange",Kd),Yl=Wa=null)}function Kd(r){if(r.propertyName==="value"&&Fu(Yl)){var s=[];zc(s,Yl,r,Iu(r)),Yn(Wd,s)}}function yp(r,s,p){r==="focusin"?(Ou(),Wa=s,Yl=p,Wa.attachEvent("onpropertychange",Kd)):r==="focusout"&&Ou()}function Qd(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Fu(Yl)}function Uu(r,s){if(r==="click")return Fu(s)}function ef(r,s){if(r==="input"||r==="change")return Fu(s)}function Nh(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var qr=typeof Object.is=="function"?Object.is:Nh;function ba(r,s){if(qr(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var p=Object.keys(r),x=Object.keys(s);if(p.length!==x.length)return!1;for(x=0;x<p.length;x++){var P=p[x];if(!wo.call(s,P)||!qr(r[P],s[P]))return!1}return!0}function Co(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Vu(r,s){var p=Co(r);r=0;for(var x;p;){if(p.nodeType===3){if(x=r+p.textContent.length,r<=s&&x>=s)return{node:p,offset:s-r};r=x}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=Co(p)}}function Lc(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?Lc(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function Nc(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=Cu(r.document);s instanceof r.HTMLIFrameElement;){try{var p=typeof s.contentWindow.location.href=="string"}catch{p=!1}if(p)r=s.contentWindow;else break;s=Cu(r.document)}return s}function Gu(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var kc=Ti&&"documentMode"in document&&11>=document.documentMode,Ao=null,qu=null,Hu=null,Fc=!1;function tf(r,s,p){var x=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;Fc||Ao==null||Ao!==Cu(x)||(x=Ao,"selectionStart"in x&&Gu(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),Hu&&ba(Hu,x)||(Hu=x,x=md(qu,"onSelect"),0<x.length&&(s=new Ru("onSelect","select",null,s,p),r.push({event:s,listeners:x}),s.target=Ao)))}function Ka(r,s){var p={};return p[r.toLowerCase()]=s.toLowerCase(),p["Webkit"+r]="webkit"+s,p["Moz"+r]="moz"+s,p}var Qa={animationend:Ka("Animation","AnimationEnd"),animationiteration:Ka("Animation","AnimationIteration"),animationstart:Ka("Animation","AnimationStart"),transitionrun:Ka("Transition","TransitionRun"),transitionstart:Ka("Transition","TransitionStart"),transitioncancel:Ka("Transition","TransitionCancel"),transitionend:Ka("Transition","TransitionEnd")},kh={},Dn={};Ti&&(Dn=document.createElement("div").style,"AnimationEvent"in window||(delete Qa.animationend.animation,delete Qa.animationiteration.animation,delete Qa.animationstart.animation),"TransitionEvent"in window||delete Qa.transitionend.transition);function _s(r){if(kh[r])return kh[r];if(!Qa[r])return r;var s=Qa[r],p;for(p in s)if(s.hasOwnProperty(p)&&p in Dn)return kh[r]=s[p];return r}var Zu=_s("animationend"),$u=_s("animationiteration"),Bc=_s("animationstart"),el=_s("transitionrun"),ju=_s("transitionstart"),Xl=_s("transitioncancel"),ao=_s("transitionend"),Fh=new Map,Oc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Oc.push("scrollEnd");function lo(r,s){Fh.set(r,s),Sn(s,[r])}var ys=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Or=[],Hs=0,tl=0;function nl(){for(var r=Hs,s=tl=Hs=0;s<r;){var p=Or[s];Or[s++]=null;var x=Or[s];Or[s++]=null;var P=Or[s];Or[s++]=null;var L=Or[s];if(Or[s++]=null,x!==null&&P!==null){var $=x.pending;$===null?P.next=P:(P.next=$.next,$.next=P),x.pending=P}L!==0&&Bh(p,P,L)}}function Yu(r,s,p,x){Or[Hs++]=r,Or[Hs++]=s,Or[Hs++]=p,Or[Hs++]=x,tl|=x,r.lanes|=x,r=r.alternate,r!==null&&(r.lanes|=x)}function wa(r,s,p,x){return Yu(r,s,p,x),Jl(r)}function Mo(r,s){return Yu(r,null,null,s),Jl(r)}function Bh(r,s,p){r.lanes|=p;var x=r.alternate;x!==null&&(x.lanes|=p);for(var P=!1,L=r.return;L!==null;)L.childLanes|=p,x=L.alternate,x!==null&&(x.childLanes|=p),L.tag===22&&(r=L.stateNode,r===null||r._visibility&1||(P=!0)),r=L,L=L.return;return r.tag===3?(L=r.stateNode,P&&s!==null&&(P=31-Pe(p),r=L.hiddenUpdates,x=r[P],x===null?r[P]=[s]:x.push(s),s.lane=p|536870912),L):null}function Jl(r){if(50<cd)throw cd=0,kp=null,Error(y(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var nn={};function Uc(r,s,p,x){this.tag=r,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function uo(r,s,p,x){return new Uc(r,s,p,x)}function Vc(r){return r=r.prototype,!(!r||!r.isReactComponent)}function co(r,s){var p=r.alternate;return p===null?(p=uo(r.tag,s,r.key,r.mode),p.elementType=r.elementType,p.type=r.type,p.stateNode=r.stateNode,p.alternate=r,r.alternate=p):(p.pendingProps=s,p.type=r.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=r.flags&65011712,p.childLanes=r.childLanes,p.lanes=r.lanes,p.child=r.child,p.memoizedProps=r.memoizedProps,p.memoizedState=r.memoizedState,p.updateQueue=r.updateQueue,s=r.dependencies,p.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},p.sibling=r.sibling,p.index=r.index,p.ref=r.ref,p.refCleanup=r.refCleanup,p}function nf(r,s){r.flags&=65011714;var p=r.alternate;return p===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=p.childLanes,r.lanes=p.lanes,r.child=p.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=p.memoizedProps,r.memoizedState=p.memoizedState,r.updateQueue=p.updateQueue,r.type=p.type,s=p.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function Gc(r,s,p,x,P,L){var $=0;if(x=r,typeof r=="function")Vc(r)&&($=1);else if(typeof r=="string")$=Jf(r,p,Rt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case At:return r=uo(31,p,s,P),r.elementType=At,r.lanes=L,r;case Ne:return Ta(p.children,P,L,s);case se:$=8,P|=24;break;case Ye:return r=uo(12,p,s,P|2),r.elementType=Ye,r.lanes=L,r;case nt:return r=uo(13,p,s,P),r.elementType=nt,r.lanes=L,r;case zt:return r=uo(19,p,s,P),r.elementType=zt,r.lanes=L,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case We:$=10;break e;case st:$=9;break e;case gt:$=11;break e;case _t:$=14;break e;case Ut:$=16,x=null;break e}$=29,p=Error(y(130,r===null?"null":typeof r,"")),x=null}return s=uo($,p,s,P),s.elementType=r,s.type=x,s.lanes=L,s}function Ta(r,s,p,x){return r=uo(7,r,x,s),r.lanes=p,r}function Oh(r,s,p){return r=uo(6,r,null,s),r.lanes=p,r}function qc(r){var s=uo(18,null,null,0);return s.stateNode=r,s}function Sa(r,s,p){return s=uo(4,r.children!==null?r.children:[],r.key,s),s.lanes=p,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var Wl=new WeakMap;function Ur(r,s){if(typeof r=="object"&&r!==null){var p=Wl.get(r);return p!==void 0?p:(s={value:r,source:s,stack:ar(s)},Wl.set(r,s),s)}return{value:r,source:s,stack:ar(s)}}var Ea=[],Ca=0,il=null,Aa=0,ir=[],lr=0,vs=null,xs=1,Hr="";function Zs(r,s){Ea[Ca++]=Aa,Ea[Ca++]=il,il=r,Aa=s}function Uh(r,s,p){ir[lr++]=xs,ir[lr++]=Hr,ir[lr++]=vs,vs=r;var x=xs;r=Hr;var P=32-Pe(x)-1;x&=~(1<<P),p+=1;var L=32-Pe(s)+P;if(30<L){var $=P-P%5;L=(x&(1<<$)-1).toString(32),x>>=$,P-=$,xs=1<<32-Pe(s)+P|p<<P|x,Hr=L+r}else xs=1<<L|p<<P|x,Hr=r}function rl(r){r.return!==null&&(Zs(r,1),Uh(r,1,0))}function Kl(r){for(;r===il;)il=Ea[--Ca],Ea[Ca]=null,Aa=Ea[--Ca],Ea[Ca]=null;for(;r===vs;)vs=ir[--lr],ir[lr]=null,Hr=ir[--lr],ir[lr]=null,xs=ir[--lr],ir[lr]=null}function Vh(r,s){ir[lr++]=xs,ir[lr++]=Hr,ir[lr++]=vs,xs=s.id,Hr=s.overflow,vs=r}var ur=null,Xn=null,xn=!1,$s=null,ho=!1,yi=Error(y(519));function Zr(r){var s=Error(y(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw js(Ur(s,r)),yi}function $r(r){var s=r.stateNode,p=r.type,x=r.memoizedProps;switch(s[vn]=r,s[dt]=x,p){case"dialog":Rn("cancel",s),Rn("close",s);break;case"iframe":case"object":case"embed":Rn("load",s);break;case"video":case"audio":for(p=0;p<fu.length;p++)Rn(fu[p],s);break;case"source":Rn("error",s);break;case"img":case"image":case"link":Rn("error",s),Rn("load",s);break;case"details":Rn("toggle",s);break;case"input":Rn("invalid",s),Ac(s,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0);break;case"select":Rn("invalid",s);break;case"textarea":Rn("invalid",s),Ol(s,x.value,x.defaultValue,x.children)}p=x.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||s.textContent===""+p||x.suppressHydrationWarning===!0||Jp(s.textContent,p)?(x.popover!=null&&(Rn("beforetoggle",s),Rn("toggle",s)),x.onScroll!=null&&Rn("scroll",s),x.onScrollEnd!=null&&Rn("scrollend",s),x.onClick!=null&&(s.onclick=$o),s=!0):s=!1,s||Zr(r,!0)}function Xu(r){for(ur=r.return;ur;)switch(ur.tag){case 5:case 31:case 13:ho=!1;return;case 27:case 3:ho=!0;return;default:ur=ur.return}}function bs(r){if(r!==ur)return!1;if(!xn)return Xu(r),xn=!0,!1;var s=r.tag,p;if((p=s!==3&&s!==27)&&((p=s===5)&&(p=r.type,p=!(p!=="form"&&p!=="button")||qf(r.type,r.memoizedProps)),p=!p),p&&Xn&&Zr(r),Xu(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(y(317));Xn=_r(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(y(317));Xn=_r(r)}else s===27?(s=Xn,gu(r.type)?(r=xo,xo=null,Xn=r):Xn=s):Xn=ur?os(r.stateNode.nextSibling):null;return!0}function ws(){Xn=ur=null,xn=!1}function Ts(){var r=$s;return r!==null&&(Bo===null?Bo=r:Bo.push.apply(Bo,r),$s=null),r}function js(r){$s===null?$s=[r]:$s.push(r)}var Ys=Me(null),Io=null,Ss=null;function Xs(r,s,p){Et(Ys,s._currentValue),s._currentValue=p}function Es(r){r._currentValue=Ys.current,at(Ys)}function Hc(r,s,p){for(;r!==null;){var x=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,x!==null&&(x.childLanes|=s)):x!==null&&(x.childLanes&s)!==s&&(x.childLanes|=s),r===p)break;r=r.return}}function Zc(r,s,p,x){var P=r.child;for(P!==null&&(P.return=r);P!==null;){var L=P.dependencies;if(L!==null){var $=P.child;L=L.firstContext;e:for(;L!==null;){var oe=L;L=P;for(var Se=0;Se<s.length;Se++)if(oe.context===s[Se]){L.lanes|=p,oe=L.alternate,oe!==null&&(oe.lanes|=p),Hc(L.return,p,r),x||($=null);break e}L=oe.next}}else if(P.tag===18){if($=P.return,$===null)throw Error(y(341));$.lanes|=p,L=$.alternate,L!==null&&(L.lanes|=p),Hc($,p,r),$=null}else $=P.child;if($!==null)$.return=P;else for($=P;$!==null;){if($===r){$=null;break}if(P=$.sibling,P!==null){P.return=$.return,$=P;break}$=$.return}P=$}}function fo(r,s,p,x){r=null;for(var P=s,L=!1;P!==null;){if(!L){if((P.flags&524288)!==0)L=!0;else if((P.flags&262144)!==0)break}if(P.tag===10){var $=P.alternate;if($===null)throw Error(y(387));if($=$.memoizedProps,$!==null){var oe=P.type;qr(P.pendingProps.value,$.value)||(r!==null?r.push(oe):r=[oe])}}else if(P===mn.current){if($=P.alternate,$===null)throw Error(y(387));$.memoizedState.memoizedState!==P.memoizedState.memoizedState&&(r!==null?r.push(bh):r=[bh])}P=P.return}r!==null&&Zc(s,r,p,x),s.flags|=262144}function Ql(r){for(r=r.firstContext;r!==null;){if(!qr(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Js(r){Io=r,Ss=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Vi(r){return $c(Io,r)}function Ju(r,s){return Io===null&&Js(r),$c(r,s)}function $c(r,s){var p=s._currentValue;if(s={context:s,memoizedValue:p,next:null},Ss===null){if(r===null)throw Error(y(308));Ss=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else Ss=Ss.next=s;return p}var Gh=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(p,x){r.push(x)}};this.abort=function(){s.aborted=!0,r.forEach(function(p){return p()})}},rf=u.unstable_scheduleCallback,qh=u.unstable_NormalPriority,Ni={$$typeof:We,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Cs(){return{controller:new Gh,data:new Map,refCount:0}}function eu(r){r.refCount--,r.refCount===0&&rf(qh,function(){r.controller.abort()})}var Cr=null,po=0,ol=0,Ar=null;function vp(r,s){if(Cr===null){var p=Cr=[];po=0,ol=Zp(),Ar={status:"pending",value:void 0,then:function(x){p.push(x)}}}return po++,s.then(tu,tu),s}function tu(){if(--po===0&&Cr!==null){Ar!==null&&(Ar.status="fulfilled");var r=Cr;Cr=null,ol=0,Ar=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function Wu(r,s){var p=[],x={status:"pending",value:null,reason:null,then:function(P){p.push(P)}};return r.then(function(){x.status="fulfilled",x.value=s;for(var P=0;P<p.length;P++)(0,p[P])(s)},function(P){for(x.status="rejected",x.reason=P,P=0;P<p.length;P++)(0,p[P])(void 0)}),x}var rr=Qe.S;Qe.S=function(r,s){qm=Di(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&vp(r,s),rr!==null&&rr(r,s)};var Yo=Me(null);function jc(){var r=Yo.current;return r!==null?r:mi.pooledCache}function Yc(r,s){s===null?Et(Yo,Yo.current):Et(Yo,s.pool)}function of(){var r=jc();return r===null?null:{parent:Ni._currentValue,pool:r}}var Xo=Error(y(460)),Ma=Error(y(474)),jr=Error(y(542)),Tt={then:function(){}};function Ku(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Xc(r,s,p){switch(p=r[p],p===void 0?r.push(s):p!==s&&(s.then($o,$o),s=p),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,Jc(r),r;default:if(typeof s.status=="string")s.then($o,$o);else{if(r=mi,r!==null&&100<r.shellSuspendCounter)throw Error(y(482));r=s,r.status="pending",r.then(function(x){if(s.status==="pending"){var P=s;P.status="fulfilled",P.value=x}},function(x){if(s.status==="pending"){var P=s;P.status="rejected",P.reason=x}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,Jc(r),r}throw Jo=s,Xo}}function Ro(r){try{var s=r._init;return s(r._payload)}catch(p){throw p!==null&&typeof p=="object"&&typeof p.then=="function"?(Jo=p,Xo):p}}var Jo=null;function nu(){if(Jo===null)throw Error(y(459));var r=Jo;return Jo=null,r}function Jc(r){if(r===Xo||r===jr)throw Error(y(483))}var As=null,sl=0;function Qu(r){var s=sl;return sl+=1,As===null&&(As=[]),Xc(As,r,s)}function Ms(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function Wc(r,s){throw s.$$typeof===ee?Error(y(525)):(r=Object.prototype.toString.call(s),Error(y(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function ec(r){function s(ze,Ie){if(r){var Ge=ze.deletions;Ge===null?(ze.deletions=[Ie],ze.flags|=16):Ge.push(Ie)}}function p(ze,Ie){if(!r)return null;for(;Ie!==null;)s(ze,Ie),Ie=Ie.sibling;return null}function x(ze){for(var Ie=new Map;ze!==null;)ze.key!==null?Ie.set(ze.key,ze):Ie.set(ze.index,ze),ze=ze.sibling;return Ie}function P(ze,Ie){return ze=co(ze,Ie),ze.index=0,ze.sibling=null,ze}function L(ze,Ie,Ge){return ze.index=Ge,r?(Ge=ze.alternate,Ge!==null?(Ge=Ge.index,Ge<Ie?(ze.flags|=67108866,Ie):Ge):(ze.flags|=67108866,Ie)):(ze.flags|=1048576,Ie)}function $(ze){return r&&ze.alternate===null&&(ze.flags|=67108866),ze}function oe(ze,Ie,Ge,lt){return Ie===null||Ie.tag!==6?(Ie=Oh(Ge,ze.mode,lt),Ie.return=ze,Ie):(Ie=P(Ie,Ge),Ie.return=ze,Ie)}function Se(ze,Ie,Ge,lt){var Zt=Ge.type;return Zt===Ne?tt(ze,Ie,Ge.props.children,lt,Ge.key):Ie!==null&&(Ie.elementType===Zt||typeof Zt=="object"&&Zt!==null&&Zt.$$typeof===Ut&&Ro(Zt)===Ie.type)?(Ie=P(Ie,Ge.props),Ms(Ie,Ge),Ie.return=ze,Ie):(Ie=Gc(Ge.type,Ge.key,Ge.props,null,ze.mode,lt),Ms(Ie,Ge),Ie.return=ze,Ie)}function qe(ze,Ie,Ge,lt){return Ie===null||Ie.tag!==4||Ie.stateNode.containerInfo!==Ge.containerInfo||Ie.stateNode.implementation!==Ge.implementation?(Ie=Sa(Ge,ze.mode,lt),Ie.return=ze,Ie):(Ie=P(Ie,Ge.children||[]),Ie.return=ze,Ie)}function tt(ze,Ie,Ge,lt,Zt){return Ie===null||Ie.tag!==7?(Ie=Ta(Ge,ze.mode,lt,Zt),Ie.return=ze,Ie):(Ie=P(Ie,Ge),Ie.return=ze,Ie)}function ct(ze,Ie,Ge){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return Ie=Oh(""+Ie,ze.mode,Ge),Ie.return=ze,Ie;if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case ye:return Ge=Gc(Ie.type,Ie.key,Ie.props,null,ze.mode,Ge),Ms(Ge,Ie),Ge.return=ze,Ge;case Le:return Ie=Sa(Ie,ze.mode,Ge),Ie.return=ze,Ie;case Ut:return Ie=Ro(Ie),ct(ze,Ie,Ge)}if(si(Ie)||an(Ie))return Ie=Ta(Ie,ze.mode,Ge,null),Ie.return=ze,Ie;if(typeof Ie.then=="function")return ct(ze,Qu(Ie),Ge);if(Ie.$$typeof===We)return ct(ze,Ju(ze,Ie),Ge);Wc(ze,Ie)}return null}function Ze(ze,Ie,Ge,lt){var Zt=Ie!==null?Ie.key:null;if(typeof Ge=="string"&&Ge!==""||typeof Ge=="number"||typeof Ge=="bigint")return Zt!==null?null:oe(ze,Ie,""+Ge,lt);if(typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case ye:return Ge.key===Zt?Se(ze,Ie,Ge,lt):null;case Le:return Ge.key===Zt?qe(ze,Ie,Ge,lt):null;case Ut:return Ge=Ro(Ge),Ze(ze,Ie,Ge,lt)}if(si(Ge)||an(Ge))return Zt!==null?null:tt(ze,Ie,Ge,lt,null);if(typeof Ge.then=="function")return Ze(ze,Ie,Qu(Ge),lt);if(Ge.$$typeof===We)return Ze(ze,Ie,Ju(ze,Ge),lt);Wc(ze,Ge)}return null}function Je(ze,Ie,Ge,lt,Zt){if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return ze=ze.get(Ge)||null,oe(Ie,ze,""+lt,Zt);if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case ye:return ze=ze.get(lt.key===null?Ge:lt.key)||null,Se(Ie,ze,lt,Zt);case Le:return ze=ze.get(lt.key===null?Ge:lt.key)||null,qe(Ie,ze,lt,Zt);case Ut:return lt=Ro(lt),Je(ze,Ie,Ge,lt,Zt)}if(si(lt)||an(lt))return ze=ze.get(Ge)||null,tt(Ie,ze,lt,Zt,null);if(typeof lt.then=="function")return Je(ze,Ie,Ge,Qu(lt),Zt);if(lt.$$typeof===We)return Je(ze,Ie,Ge,Ju(Ie,lt),Zt);Wc(Ie,lt)}return null}function kt(ze,Ie,Ge,lt){for(var Zt=null,$n=null,Ft=Ie,Gt=Ie=0,Cn=null;Ft!==null&&Gt<Ge.length;Gt++){Ft.index>Gt?(Cn=Ft,Ft=null):Cn=Ft.sibling;var Gn=Ze(ze,Ft,Ge[Gt],lt);if(Gn===null){Ft===null&&(Ft=Cn);break}r&&Ft&&Gn.alternate===null&&s(ze,Ft),Ie=L(Gn,Ie,Gt),$n===null?Zt=Gn:$n.sibling=Gn,$n=Gn,Ft=Cn}if(Gt===Ge.length)return p(ze,Ft),xn&&Zs(ze,Gt),Zt;if(Ft===null){for(;Gt<Ge.length;Gt++)Ft=ct(ze,Ge[Gt],lt),Ft!==null&&(Ie=L(Ft,Ie,Gt),$n===null?Zt=Ft:$n.sibling=Ft,$n=Ft);return xn&&Zs(ze,Gt),Zt}for(Ft=x(Ft);Gt<Ge.length;Gt++)Cn=Je(Ft,ze,Gt,Ge[Gt],lt),Cn!==null&&(r&&Cn.alternate!==null&&Ft.delete(Cn.key===null?Gt:Cn.key),Ie=L(Cn,Ie,Gt),$n===null?Zt=Cn:$n.sibling=Cn,$n=Cn);return r&&Ft.forEach(function(Al){return s(ze,Al)}),xn&&Zs(ze,Gt),Zt}function Yt(ze,Ie,Ge,lt){if(Ge==null)throw Error(y(151));for(var Zt=null,$n=null,Ft=Ie,Gt=Ie=0,Cn=null,Gn=Ge.next();Ft!==null&&!Gn.done;Gt++,Gn=Ge.next()){Ft.index>Gt?(Cn=Ft,Ft=null):Cn=Ft.sibling;var Al=Ze(ze,Ft,Gn.value,lt);if(Al===null){Ft===null&&(Ft=Cn);break}r&&Ft&&Al.alternate===null&&s(ze,Ft),Ie=L(Al,Ie,Gt),$n===null?Zt=Al:$n.sibling=Al,$n=Al,Ft=Cn}if(Gn.done)return p(ze,Ft),xn&&Zs(ze,Gt),Zt;if(Ft===null){for(;!Gn.done;Gt++,Gn=Ge.next())Gn=ct(ze,Gn.value,lt),Gn!==null&&(Ie=L(Gn,Ie,Gt),$n===null?Zt=Gn:$n.sibling=Gn,$n=Gn);return xn&&Zs(ze,Gt),Zt}for(Ft=x(Ft);!Gn.done;Gt++,Gn=Ge.next())Gn=Je(Ft,ze,Gt,Gn.value,lt),Gn!==null&&(r&&Gn.alternate!==null&&Ft.delete(Gn.key===null?Gt:Gn.key),Ie=L(Gn,Ie,Gt),$n===null?Zt=Gn:$n.sibling=Gn,$n=Gn);return r&&Ft.forEach(function(ym){return s(ze,ym)}),xn&&Zs(ze,Gt),Zt}function oi(ze,Ie,Ge,lt){if(typeof Ge=="object"&&Ge!==null&&Ge.type===Ne&&Ge.key===null&&(Ge=Ge.props.children),typeof Ge=="object"&&Ge!==null){switch(Ge.$$typeof){case ye:e:{for(var Zt=Ge.key;Ie!==null;){if(Ie.key===Zt){if(Zt=Ge.type,Zt===Ne){if(Ie.tag===7){p(ze,Ie.sibling),lt=P(Ie,Ge.props.children),lt.return=ze,ze=lt;break e}}else if(Ie.elementType===Zt||typeof Zt=="object"&&Zt!==null&&Zt.$$typeof===Ut&&Ro(Zt)===Ie.type){p(ze,Ie.sibling),lt=P(Ie,Ge.props),Ms(lt,Ge),lt.return=ze,ze=lt;break e}p(ze,Ie);break}else s(ze,Ie);Ie=Ie.sibling}Ge.type===Ne?(lt=Ta(Ge.props.children,ze.mode,lt,Ge.key),lt.return=ze,ze=lt):(lt=Gc(Ge.type,Ge.key,Ge.props,null,ze.mode,lt),Ms(lt,Ge),lt.return=ze,ze=lt)}return $(ze);case Le:e:{for(Zt=Ge.key;Ie!==null;){if(Ie.key===Zt)if(Ie.tag===4&&Ie.stateNode.containerInfo===Ge.containerInfo&&Ie.stateNode.implementation===Ge.implementation){p(ze,Ie.sibling),lt=P(Ie,Ge.children||[]),lt.return=ze,ze=lt;break e}else{p(ze,Ie);break}else s(ze,Ie);Ie=Ie.sibling}lt=Sa(Ge,ze.mode,lt),lt.return=ze,ze=lt}return $(ze);case Ut:return Ge=Ro(Ge),oi(ze,Ie,Ge,lt)}if(si(Ge))return kt(ze,Ie,Ge,lt);if(an(Ge)){if(Zt=an(Ge),typeof Zt!="function")throw Error(y(150));return Ge=Zt.call(Ge),Yt(ze,Ie,Ge,lt)}if(typeof Ge.then=="function")return oi(ze,Ie,Qu(Ge),lt);if(Ge.$$typeof===We)return oi(ze,Ie,Ju(ze,Ge),lt);Wc(ze,Ge)}return typeof Ge=="string"&&Ge!==""||typeof Ge=="number"||typeof Ge=="bigint"?(Ge=""+Ge,Ie!==null&&Ie.tag===6?(p(ze,Ie.sibling),lt=P(Ie,Ge),lt.return=ze,ze=lt):(p(ze,Ie),lt=Oh(Ge,ze.mode,lt),lt.return=ze,ze=lt),$(ze)):p(ze,Ie)}return function(ze,Ie,Ge,lt){try{sl=0;var Zt=oi(ze,Ie,Ge,lt);return As=null,Zt}catch(Ft){if(Ft===Xo||Ft===jr)throw Ft;var $n=uo(29,Ft,null,ze.mode);return $n.lanes=lt,$n.return=ze,$n}finally{}}}var Is=ec(!0),Hh=ec(!1),Rs=!1;function Kc(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function tc(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Ps(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ws(r,s,p){var x=r.updateQueue;if(x===null)return null;if(x=x.shared,(Kn&2)!==0){var P=x.pending;return P===null?s.next=s:(s.next=P.next,P.next=s),x.pending=s,s=Jl(r),Bh(r,null,p),s}return Yu(r,x,s,p),Jl(r)}function Po(r,s,p){if(s=s.updateQueue,s!==null&&(s=s.shared,(p&4194048)!==0)){var x=s.lanes;x&=r.pendingLanes,p|=x,s.lanes=p,Xi(r,p)}}function Un(r,s){var p=r.updateQueue,x=r.alternate;if(x!==null&&(x=x.updateQueue,p===x)){var P=null,L=null;if(p=p.firstBaseUpdate,p!==null){do{var $={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};L===null?P=L=$:L=L.next=$,p=p.next}while(p!==null);L===null?P=L=s:L=L.next=s}else P=L=s;p={baseState:x.baseState,firstBaseUpdate:P,lastBaseUpdate:L,shared:x.shared,callbacks:x.callbacks},r.updateQueue=p;return}r=p.lastBaseUpdate,r===null?p.firstBaseUpdate=s:r.next=s,p.lastBaseUpdate=s}var Zh=!1;function Ks(){if(Zh){var r=Ar;if(r!==null)throw r}}function Ia(r,s,p,x){Zh=!1;var P=r.updateQueue;Rs=!1;var L=P.firstBaseUpdate,$=P.lastBaseUpdate,oe=P.shared.pending;if(oe!==null){P.shared.pending=null;var Se=oe,qe=Se.next;Se.next=null,$===null?L=qe:$.next=qe,$=Se;var tt=r.alternate;tt!==null&&(tt=tt.updateQueue,oe=tt.lastBaseUpdate,oe!==$&&(oe===null?tt.firstBaseUpdate=qe:oe.next=qe,tt.lastBaseUpdate=Se))}if(L!==null){var ct=P.baseState;$=0,tt=qe=Se=null,oe=L;do{var Ze=oe.lane&-536870913,Je=Ze!==oe.lane;if(Je?(In&Ze)===Ze:(x&Ze)===Ze){Ze!==0&&Ze===ol&&(Zh=!0),tt!==null&&(tt=tt.next={lane:0,tag:oe.tag,payload:oe.payload,callback:null,next:null});e:{var kt=r,Yt=oe;Ze=s;var oi=p;switch(Yt.tag){case 1:if(kt=Yt.payload,typeof kt=="function"){ct=kt.call(oi,ct,Ze);break e}ct=kt;break e;case 3:kt.flags=kt.flags&-65537|128;case 0:if(kt=Yt.payload,Ze=typeof kt=="function"?kt.call(oi,ct,Ze):kt,Ze==null)break e;ct=K({},ct,Ze);break e;case 2:Rs=!0}}Ze=oe.callback,Ze!==null&&(r.flags|=64,Je&&(r.flags|=8192),Je=P.callbacks,Je===null?P.callbacks=[Ze]:Je.push(Ze))}else Je={lane:Ze,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null},tt===null?(qe=tt=Je,Se=ct):tt=tt.next=Je,$|=Ze;if(oe=oe.next,oe===null){if(oe=P.shared.pending,oe===null)break;Je=oe,oe=Je.next,Je.next=null,P.lastBaseUpdate=Je,P.shared.pending=null}}while(!0);tt===null&&(Se=ct),P.baseState=Se,P.firstBaseUpdate=qe,P.lastBaseUpdate=tt,L===null&&(P.shared.lanes=0),xl|=$,r.lanes=$,r.memoizedState=ct}}function nc(r,s){if(typeof r!="function")throw Error(y(191,r));r.call(s)}function Qc(r,s){var p=r.callbacks;if(p!==null)for(r.callbacks=null,r=0;r<p.length;r++)nc(p[r],s)}var al=Me(null),ic=Me(0);function $h(r,s){r=vl,Et(ic,r),Et(al,s),vl=r|s.baseLanes}function mo(){Et(ic,vl),Et(al,al.current)}function ll(){vl=ic.current,at(al),at(ic)}var St=Me(null),It=null;function Do(r){var s=r.alternate;Et(Ei,Ei.current&1),Et(St,r),It===null&&(s===null||al.current!==null||s.memoizedState!==null)&&(It=r)}function iu(r){Et(Ei,Ei.current),Et(St,r),It===null&&(It=r)}function rc(r){r.tag===22?(Et(Ei,Ei.current),Et(St,r),It===null&&(It=r)):ki()}function ki(){Et(Ei,Ei.current),Et(St,St.current)}function vi(r){at(St),It===r&&(It=null),at(Ei)}var Ei=Me(0);function oc(r){for(var s=r;s!==null;){if(s.tag===13){var p=s.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||Wr(p)||Ki(p)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Qs=0,ln=null,Bn=null,sn=null,fi=!1,zo=!1,Wo=!1,ul=0,cl=0,ea=null,jh=0;function ai(){throw Error(y(321))}function Ko(r,s){if(s===null)return!1;for(var p=0;p<s.length&&p<r.length;p++)if(!qr(r[p],s[p]))return!1;return!0}function ru(r,s,p,x,P,L){return Qs=L,ln=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Qe.H=r===null||r.memoizedState===null?Wn:Gi,Wo=!1,L=p(x,P),Wo=!1,zo&&(L=sc(s,p,x,P)),ou(r),L}function ou(r){Qe.H=Vn;var s=Bn!==null&&Bn.next!==null;if(Qs=0,sn=Bn=ln=null,fi=!1,cl=0,ea=null,s)throw Error(y(300));r===null||dr||(r=r.dependencies,r!==null&&Ql(r)&&(dr=!0))}function sc(r,s,p,x){ln=r;var P=0;do{if(zo&&(ea=null),cl=0,zo=!1,25<=P)throw Error(y(301));if(P+=1,sn=Bn=null,r.updateQueue!=null){var L=r.updateQueue;L.lastEffect=null,L.events=null,L.stores=null,L.memoCache!=null&&(L.memoCache.index=0)}Qe.H=Wi,L=s(p,x)}while(zo);return L}function ac(){var r=Qe.H,s=r.useState()[0];return s=typeof s.then=="function"?hl(s):s,r=r.useState()[0],(Bn!==null?Bn.memoizedState:null)!==r&&(ln.flags|=1024),s}function lc(){var r=ul!==0;return ul=0,r}function Ra(r,s,p){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~p}function ta(r){if(fi){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}fi=!1}Qs=0,sn=Bn=ln=null,zo=!1,cl=ul=0,ea=null}function xr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sn===null?ln.memoizedState=sn=r:sn=sn.next=r,sn}function pi(){if(Bn===null){var r=ln.alternate;r=r!==null?r.memoizedState:null}else r=Bn.next;var s=sn===null?ln.memoizedState:sn.next;if(s!==null)sn=s,Bn=r;else{if(r===null)throw ln.alternate===null?Error(y(467)):Error(y(310));Bn=r,r={memoizedState:Bn.memoizedState,baseState:Bn.baseState,baseQueue:Bn.baseQueue,queue:Bn.queue,next:null},sn===null?ln.memoizedState=sn=r:sn=sn.next=r}return sn}function Ds(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function hl(r){var s=cl;return cl+=1,ea===null&&(ea=[]),r=Xc(ea,r,s),s=ln,(sn===null?s.memoizedState:sn.next)===null&&(s=s.alternate,Qe.H=s===null||s.memoizedState===null?Wn:Gi),r}function dl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return hl(r);if(r.$$typeof===We)return Vi(r)}throw Error(y(438,String(r)))}function su(r){var s=null,p=ln.updateQueue;if(p!==null&&(s=p.memoCache),s==null){var x=ln.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(s={data:x.data.map(function(P){return P.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),p===null&&(p=Ds(),ln.updateQueue=p),p.memoCache=s,p=s.data[s.index],p===void 0)for(p=s.data[s.index]=Array(r),x=0;x<r;x++)p[x]=Xt;return s.index++,p}function Qo(r,s){return typeof s=="function"?s(r):s}function v(r){var s=pi();return e(s,Bn,r)}function e(r,s,p){var x=r.queue;if(x===null)throw Error(y(311));x.lastRenderedReducer=p;var P=r.baseQueue,L=x.pending;if(L!==null){if(P!==null){var $=P.next;P.next=L.next,L.next=$}s.baseQueue=P=L,x.pending=null}if(L=r.baseState,P===null)r.memoizedState=L;else{s=P.next;var oe=$=null,Se=null,qe=s,tt=!1;do{var ct=qe.lane&-536870913;if(ct!==qe.lane?(In&ct)===ct:(Qs&ct)===ct){var Ze=qe.revertLane;if(Ze===0)Se!==null&&(Se=Se.next={lane:0,revertLane:0,gesture:null,action:qe.action,hasEagerState:qe.hasEagerState,eagerState:qe.eagerState,next:null}),ct===ol&&(tt=!0);else if((Qs&Ze)===Ze){qe=qe.next,Ze===ol&&(tt=!0);continue}else ct={lane:0,revertLane:qe.revertLane,gesture:null,action:qe.action,hasEagerState:qe.hasEagerState,eagerState:qe.eagerState,next:null},Se===null?(oe=Se=ct,$=L):Se=Se.next=ct,ln.lanes|=Ze,xl|=Ze;ct=qe.action,Wo&&p(L,ct),L=qe.hasEagerState?qe.eagerState:p(L,ct)}else Ze={lane:ct,revertLane:qe.revertLane,gesture:qe.gesture,action:qe.action,hasEagerState:qe.hasEagerState,eagerState:qe.eagerState,next:null},Se===null?(oe=Se=Ze,$=L):Se=Se.next=Ze,ln.lanes|=ct,xl|=ct;qe=qe.next}while(qe!==null&&qe!==s);if(Se===null?$=L:Se.next=oe,!qr(L,r.memoizedState)&&(dr=!0,tt&&(p=Ar,p!==null)))throw p;r.memoizedState=L,r.baseState=$,r.baseQueue=Se,x.lastRenderedState=L}return P===null&&(x.lanes=0),[r.memoizedState,x.dispatch]}function o(r){var s=pi(),p=s.queue;if(p===null)throw Error(y(311));p.lastRenderedReducer=r;var x=p.dispatch,P=p.pending,L=s.memoizedState;if(P!==null){p.pending=null;var $=P=P.next;do L=r(L,$.action),$=$.next;while($!==P);qr(L,s.memoizedState)||(dr=!0),s.memoizedState=L,s.baseQueue===null&&(s.baseState=L),p.lastRenderedState=L}return[L,x]}function h(r,s,p){var x=ln,P=pi(),L=xn;if(L){if(p===void 0)throw Error(y(407));p=p()}else p=s();var $=!qr((Bn||P).memoizedState,p);if($&&(P.memoizedState=p,dr=!0),P=P.queue,Ue(C.bind(null,x,P,r),[r]),P.getSnapshot!==s||$||sn!==null&&sn.memoizedState.tag&1){if(x.flags|=2048,ge(9,{destroy:void 0},b.bind(null,x,P,p,s),null),mi===null)throw Error(y(349));L||(Qs&127)!==0||m(x,s,p)}return p}function m(r,s,p){r.flags|=16384,r={getSnapshot:s,value:p},s=ln.updateQueue,s===null?(s=Ds(),ln.updateQueue=s,s.stores=[r]):(p=s.stores,p===null?s.stores=[r]:p.push(r))}function b(r,s,p,x){s.value=p,s.getSnapshot=x,R(s)&&z(r)}function C(r,s,p){return p(function(){R(s)&&z(r)})}function R(r){var s=r.getSnapshot;r=r.value;try{var p=s();return!qr(r,p)}catch{return!0}}function z(r){var s=Mo(r,2);s!==null&&Uo(s,r,2)}function B(r){var s=xr();if(typeof r=="function"){var p=r;if(r=p(),Wo){we(!0);try{p()}finally{we(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qo,lastRenderedState:r},s}function U(r,s,p,x){return r.baseState=p,e(r,Bn,typeof x=="function"?x:Qo)}function Z(r,s,p,x,P){if(go(r))throw Error(y(485));if(r=s.action,r!==null){var L={payload:P,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function($){L.listeners.push($)}};Qe.T!==null?p(!0):L.isTransition=!1,x(L),p=s.pending,p===null?(L.next=s.pending=L,H(s,L)):(L.next=p.next,s.pending=p.next=L)}}function H(r,s){var p=s.action,x=s.payload,P=r.state;if(s.isTransition){var L=Qe.T,$={};Qe.T=$;try{var oe=p(P,x),Se=Qe.S;Se!==null&&Se($,oe),X(r,s,oe)}catch(qe){le(r,s,qe)}finally{L!==null&&$.types!==null&&(L.types=$.types),Qe.T=L}}else try{L=p(P,x),X(r,s,L)}catch(qe){le(r,s,qe)}}function X(r,s,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(x){te(r,s,x)},function(x){return le(r,s,x)}):te(r,s,p)}function te(r,s,p){s.status="fulfilled",s.value=p,ce(s),r.state=p,s=r.pending,s!==null&&(p=s.next,p===s?r.pending=null:(p=p.next,s.next=p,H(r,p)))}function le(r,s,p){var x=r.pending;if(r.pending=null,x!==null){x=x.next;do s.status="rejected",s.reason=p,ce(s),s=s.next;while(s!==x)}r.action=null}function ce(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function ue(r,s){return s}function fe(r,s){if(xn){var p=mi.formState;if(p!==null){e:{var x=ln;if(xn){if(Xn){t:{for(var P=Xn,L=ho;P.nodeType!==8;){if(!L){P=null;break t}if(P=os(P.nextSibling),P===null){P=null;break t}}L=P.data,P=L==="F!"||L==="F"?P:null}if(P){Xn=os(P.nextSibling),x=P.data==="F!";break e}}Zr(x)}x=!1}x&&(s=p[0])}}return p=xr(),p.memoizedState=p.baseState=s,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ue,lastRenderedState:s},p.queue=x,p=au.bind(null,ln,x),x.dispatch=p,x=B(!1),L=Xr.bind(null,ln,!1,x.queue),x=xr(),P={state:s,dispatch:null,action:r,pending:null},x.queue=P,p=Z.bind(null,ln,P,L,p),P.dispatch=p,x.memoizedState=r,[s,p,!1]}function xe(r){var s=pi();return he(s,Bn,r)}function he(r,s,p){if(s=e(r,s,ue)[0],r=v(Qo)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var x=hl(s)}catch($){throw $===Xo?jr:$}else x=s;s=pi();var P=s.queue,L=P.dispatch;return p!==s.memoizedState&&(ln.flags|=2048,ge(9,{destroy:void 0},ve.bind(null,P,p),null)),[x,L,r]}function ve(r,s){r.action=s}function Te(r){var s=pi(),p=Bn;if(p!==null)return he(s,p,r);pi(),s=s.memoizedState,p=pi();var x=p.queue.dispatch;return p.memoizedState=r,[s,x,!1]}function ge(r,s,p,x){return r={tag:r,create:p,deps:x,inst:s,next:null},s=ln.updateQueue,s===null&&(s=Ds(),ln.updateQueue=s),p=s.lastEffect,p===null?s.lastEffect=r.next=r:(x=p.next,p.next=r,r.next=x,s.lastEffect=r),r}function Ae(){return pi().memoizedState}function Ve(r,s,p,x){var P=xr();ln.flags|=r,P.memoizedState=ge(1|s,{destroy:void 0},p,x===void 0?null:x)}function ke(r,s,p,x){var P=pi();x=x===void 0?null:x;var L=P.memoizedState.inst;Bn!==null&&x!==null&&Ko(x,Bn.memoizedState.deps)?P.memoizedState=ge(s,L,p,x):(ln.flags|=r,P.memoizedState=ge(1|s,L,p,x))}function Oe(r,s){Ve(8390656,8,r,s)}function Ue(r,s){ke(2048,8,r,s)}function pt(r){ln.flags|=4;var s=ln.updateQueue;if(s===null)s=Ds(),ln.updateQueue=s,s.events=[r];else{var p=s.events;p===null?s.events=[r]:p.push(r)}}function mt(r){var s=pi().memoizedState;return pt({ref:s,nextImpl:r}),function(){if((Kn&2)!==0)throw Error(y(440));return s.impl.apply(void 0,arguments)}}function ot(r,s){return ke(4,2,r,s)}function vt(r,s){return ke(4,4,r,s)}function Wt(r,s){if(typeof s=="function"){r=r();var p=s(r);return function(){typeof p=="function"?p():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function On(r,s,p){p=p!=null?p.concat([r]):null,ke(4,4,Wt.bind(null,s,r),p)}function ti(){}function Jn(r,s){var p=pi();s=s===void 0?null:s;var x=p.memoizedState;return s!==null&&Ko(s,x[1])?x[0]:(p.memoizedState=[r,s],r)}function li(r,s){var p=pi();s=s===void 0?null:s;var x=p.memoizedState;if(s!==null&&Ko(s,x[1]))return x[0];if(x=r(),Wo){we(!0);try{r()}finally{we(!1)}}return p.memoizedState=[x,s],x}function Hn(r,s,p){return p===void 0||(Qs&1073741824)!==0&&(In&261930)===0?r.memoizedState=s:(r.memoizedState=p,r=Zm(),ln.lanes|=r,xl|=r,p)}function xi(r,s,p,x){return qr(p,s)?p:al.current!==null?(r=Hn(r,p,x),qr(r,s)||(dr=!0),r):(Qs&42)===0||(Qs&1073741824)!==0&&(In&261930)===0?(dr=!0,r.memoizedState=p):(r=Zm(),ln.lanes|=r,xl|=r,s)}function ui(r,s,p,x,P){var L=ft.p;ft.p=L!==0&&8>L?L:8;var $=Qe.T,oe={};Qe.T=oe,Xr(r,!1,s,p);try{var Se=P(),qe=Qe.S;if(qe!==null&&qe(oe,Se),Se!==null&&typeof Se=="object"&&typeof Se.then=="function"){var tt=Wu(Se,x);ts(r,s,tt,Oo(r))}else ts(r,s,x,Oo(r))}catch(ct){ts(r,s,{then:function(){},status:"rejected",reason:ct},Oo())}finally{ft.p=L,$!==null&&oe.types!==null&&($.types=oe.types),Qe.T=$}}function cr(){}function Ci(r,s,p,x){if(r.tag!==5)throw Error(y(476));var P=Ai(r).queue;ui(r,P,s,Dt,p===null?cr:function(){return hr(r),p(x)})}function Ai(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:Dt,baseState:Dt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qo,lastRenderedState:Dt},next:null};var p={};return s.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qo,lastRenderedState:p},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function hr(r){var s=Ai(r);s.next===null&&(s=r.alternate.memoizedState),ts(r,s.next.queue,{},Oo())}function zs(){return Vi(bh)}function Ls(){return pi().memoizedState}function es(){return pi().memoizedState}function Yr(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var p=Oo();r=Ps(p);var x=Ws(s,r,p);x!==null&&(Uo(x,s,p),Po(x,s,p)),s={cache:Cs()},r.payload=s;return}s=s.return}}function fl(r,s,p){var x=Oo();p={lane:x,revertLane:0,gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},go(r)?Lo(s,p):(p=wa(r,s,p,x),p!==null&&(Uo(p,r,x),No(p,s,x)))}function au(r,s,p){var x=Oo();ts(r,s,p,x)}function ts(r,s,p,x){var P={lane:x,revertLane:0,gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null};if(go(r))Lo(s,P);else{var L=r.alternate;if(r.lanes===0&&(L===null||L.lanes===0)&&(L=s.lastRenderedReducer,L!==null))try{var $=s.lastRenderedState,oe=L($,p);if(P.hasEagerState=!0,P.eagerState=oe,qr(oe,$))return Yu(r,s,P,0),mi===null&&nl(),!1}catch{}finally{}if(p=wa(r,s,P,x),p!==null)return Uo(p,r,x),No(p,s,x),!0}return!1}function Xr(r,s,p,x){if(x={lane:2,revertLane:Zp(),gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null},go(r)){if(s)throw Error(y(479))}else s=wa(r,p,x,2),s!==null&&Uo(s,r,2)}function go(r){var s=r.alternate;return r===ln||s!==null&&s===ln}function Lo(r,s){zo=fi=!0;var p=r.pending;p===null?s.next=s:(s.next=p.next,p.next=s),r.pending=s}function No(r,s,p){if((p&4194048)!==0){var x=s.lanes;x&=r.pendingLanes,p|=x,s.lanes=p,Xi(r,p)}}var Vn={readContext:Vi,use:dl,useCallback:ai,useContext:ai,useEffect:ai,useImperativeHandle:ai,useLayoutEffect:ai,useInsertionEffect:ai,useMemo:ai,useReducer:ai,useRef:ai,useState:ai,useDebugValue:ai,useDeferredValue:ai,useTransition:ai,useSyncExternalStore:ai,useId:ai,useHostTransitionStatus:ai,useFormState:ai,useActionState:ai,useOptimistic:ai,useMemoCache:ai,useCacheRefresh:ai};Vn.useEffectEvent=ai;var Wn={readContext:Vi,use:dl,useCallback:function(r,s){return xr().memoizedState=[r,s===void 0?null:s],r},useContext:Vi,useEffect:Oe,useImperativeHandle:function(r,s,p){p=p!=null?p.concat([r]):null,Ve(4194308,4,Wt.bind(null,s,r),p)},useLayoutEffect:function(r,s){return Ve(4194308,4,r,s)},useInsertionEffect:function(r,s){Ve(4,2,r,s)},useMemo:function(r,s){var p=xr();s=s===void 0?null:s;var x=r();if(Wo){we(!0);try{r()}finally{we(!1)}}return p.memoizedState=[x,s],x},useReducer:function(r,s,p){var x=xr();if(p!==void 0){var P=p(s);if(Wo){we(!0);try{p(s)}finally{we(!1)}}}else P=s;return x.memoizedState=x.baseState=P,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:P},x.queue=r,r=r.dispatch=fl.bind(null,ln,r),[x.memoizedState,r]},useRef:function(r){var s=xr();return r={current:r},s.memoizedState=r},useState:function(r){r=B(r);var s=r.queue,p=au.bind(null,ln,s);return s.dispatch=p,[r.memoizedState,p]},useDebugValue:ti,useDeferredValue:function(r,s){var p=xr();return Hn(p,r,s)},useTransition:function(){var r=B(!1);return r=ui.bind(null,ln,r.queue,!0,!1),xr().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,p){var x=ln,P=xr();if(xn){if(p===void 0)throw Error(y(407));p=p()}else{if(p=s(),mi===null)throw Error(y(349));(In&127)!==0||m(x,s,p)}P.memoizedState=p;var L={value:p,getSnapshot:s};return P.queue=L,Oe(C.bind(null,x,L,r),[r]),x.flags|=2048,ge(9,{destroy:void 0},b.bind(null,x,L,p,s),null),p},useId:function(){var r=xr(),s=mi.identifierPrefix;if(xn){var p=Hr,x=xs;p=(x&~(1<<32-Pe(x)-1)).toString(32)+p,s="_"+s+"R_"+p,p=ul++,0<p&&(s+="H"+p.toString(32)),s+="_"}else p=jh++,s="_"+s+"r_"+p.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:zs,useFormState:fe,useActionState:fe,useOptimistic:function(r){var s=xr();s.memoizedState=s.baseState=r;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=p,s=Xr.bind(null,ln,!0,p),p.dispatch=s,[r,s]},useMemoCache:su,useCacheRefresh:function(){return xr().memoizedState=Yr.bind(null,ln)},useEffectEvent:function(r){var s=xr(),p={impl:r};return s.memoizedState=p,function(){if((Kn&2)!==0)throw Error(y(440));return p.impl.apply(void 0,arguments)}}},Gi={readContext:Vi,use:dl,useCallback:Jn,useContext:Vi,useEffect:Ue,useImperativeHandle:On,useInsertionEffect:ot,useLayoutEffect:vt,useMemo:li,useReducer:v,useRef:Ae,useState:function(){return v(Qo)},useDebugValue:ti,useDeferredValue:function(r,s){var p=pi();return xi(p,Bn.memoizedState,r,s)},useTransition:function(){var r=v(Qo)[0],s=pi().memoizedState;return[typeof r=="boolean"?r:hl(r),s]},useSyncExternalStore:h,useId:Ls,useHostTransitionStatus:zs,useFormState:xe,useActionState:xe,useOptimistic:function(r,s){var p=pi();return U(p,Bn,r,s)},useMemoCache:su,useCacheRefresh:es};Gi.useEffectEvent=mt;var Wi={readContext:Vi,use:dl,useCallback:Jn,useContext:Vi,useEffect:Ue,useImperativeHandle:On,useInsertionEffect:ot,useLayoutEffect:vt,useMemo:li,useReducer:o,useRef:Ae,useState:function(){return o(Qo)},useDebugValue:ti,useDeferredValue:function(r,s){var p=pi();return Bn===null?Hn(p,r,s):xi(p,Bn.memoizedState,r,s)},useTransition:function(){var r=o(Qo)[0],s=pi().memoizedState;return[typeof r=="boolean"?r:hl(r),s]},useSyncExternalStore:h,useId:Ls,useHostTransitionStatus:zs,useFormState:Te,useActionState:Te,useOptimistic:function(r,s){var p=pi();return Bn!==null?U(p,Bn,r,s):(p.baseState=r,[r,p.queue.dispatch])},useMemoCache:su,useCacheRefresh:es};Wi.useEffectEvent=mt;function eh(r,s,p,x){s=r.memoizedState,p=p(x,s),p=p==null?s:K({},s,p),r.memoizedState=p,r.lanes===0&&(r.updateQueue.baseState=p)}var th={enqueueSetState:function(r,s,p){r=r._reactInternals;var x=Oo(),P=Ps(x);P.payload=s,p!=null&&(P.callback=p),s=Ws(r,P,x),s!==null&&(Uo(s,r,x),Po(s,r,x))},enqueueReplaceState:function(r,s,p){r=r._reactInternals;var x=Oo(),P=Ps(x);P.tag=1,P.payload=s,p!=null&&(P.callback=p),s=Ws(r,P,x),s!==null&&(Uo(s,r,x),Po(s,r,x))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var p=Oo(),x=Ps(p);x.tag=2,s!=null&&(x.callback=s),s=Ws(r,x,p),s!==null&&(Uo(s,r,p),Po(s,r,p))}};function Pa(r,s,p,x,P,L,$){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(x,L,$):s.prototype&&s.prototype.isPureReactComponent?!ba(p,x)||!ba(P,L):!0}function sf(r,s,p,x){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(p,x),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(p,x),s.state!==r&&th.enqueueReplaceState(s,s.state,null)}function Da(r,s){var p=s;if("ref"in s){p={};for(var x in s)x!=="ref"&&(p[x]=s[x])}if(r=r.defaultProps){p===s&&(p=K({},p));for(var P in r)p[P]===void 0&&(p[P]=r[P])}return p}function nh(r){ys(r)}function na(r){console.error(r)}function ia(r){ys(r)}function ns(r,s){try{var p=r.onUncaughtError;p(s.value,{componentStack:s.stack})}catch(x){setTimeout(function(){throw x})}}function ih(r,s,p){try{var x=r.onCaughtError;x(p.value,{componentStack:p.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(P){setTimeout(function(){throw P})}}function uc(r,s,p){return p=Ps(p),p.tag=3,p.payload={element:null},p.callback=function(){ns(r,s)},p}function cc(r){return r=Ps(r),r.tag=3,r}function hc(r,s,p,x){var P=p.type.getDerivedStateFromError;if(typeof P=="function"){var L=x.value;r.payload=function(){return P(L)},r.callback=function(){ih(s,p,x)}}var $=p.stateNode;$!==null&&typeof $.componentDidCatch=="function"&&(r.callback=function(){ih(s,p,x),typeof P!="function"&&(bl===null?bl=new Set([this]):bl.add(this));var oe=x.stack;this.componentDidCatch(x.value,{componentStack:oe!==null?oe:""})})}function af(r,s,p,x,P){if(p.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(s=p.alternate,s!==null&&fo(s,p,P,!0),p=St.current,p!==null){switch(p.tag){case 31:case 13:return It===null?dd():p.alternate===null&&qi===0&&(qi=3),p.flags&=-257,p.flags|=65536,p.lanes=P,x===Tt?p.flags|=16384:(s=p.updateQueue,s===null?p.updateQueue=new Set([x]):s.add(x),Df(r,x,P)),!1;case 22:return p.flags|=65536,x===Tt?p.flags|=16384:(s=p.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([x])},p.updateQueue=s):(p=s.retryQueue,p===null?s.retryQueue=new Set([x]):p.add(x)),Df(r,x,P)),!1}throw Error(y(435,p.tag))}return Df(r,x,P),dd(),!1}if(xn)return s=St.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=P,x!==yi&&(r=Error(y(422),{cause:x}),js(Ur(r,p)))):(x!==yi&&(s=Error(y(423),{cause:x}),js(Ur(s,p))),r=r.current.alternate,r.flags|=65536,P&=-P,r.lanes|=P,x=Ur(x,p),P=uc(r.stateNode,x,P),Un(r,P),qi!==4&&(qi=2)),!1;var L=Error(y(520),{cause:x});if(L=Ur(L,p),ld===null?ld=[L]:ld.push(L),qi!==4&&(qi=2),s===null)return!0;x=Ur(x,p),p=s;do{switch(p.tag){case 3:return p.flags|=65536,r=P&-P,p.lanes|=r,r=uc(p.stateNode,x,r),Un(p,r),!1;case 1:if(s=p.type,L=p.stateNode,(p.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(bl===null||!bl.has(L))))return p.flags|=65536,P&=-P,p.lanes|=P,P=cc(P),hc(P,r,p,x),Un(p,P),!1}p=p.return}while(p!==null);return!1}var lf=Error(y(461)),dr=!1;function br(r,s,p,x){s.child=r===null?Hh(s,null,p,x):Is(s,r.child,p,x)}function Mm(r,s,p,x,P){p=p.render;var L=s.ref;if("ref"in x){var $={};for(var oe in x)oe!=="ref"&&($[oe]=x[oe])}else $=x;return Js(s),x=ru(r,s,p,$,L,P),oe=lc(),r!==null&&!dr?(Ra(r,s,P),La(r,s,P)):(xn&&oe&&rl(s),s.flags|=1,br(r,s,x,P),s.child)}function uf(r,s,p,x,P){if(r===null){var L=p.type;return typeof L=="function"&&!Vc(L)&&L.defaultProps===void 0&&p.compare===null?(s.tag=15,s.type=L,xp(r,s,L,x,P)):(r=Gc(p.type,null,x,s,s.mode,P),r.ref=s.ref,r.return=s,s.child=r)}if(L=r.child,!Jh(r,P)){var $=L.memoizedProps;if(p=p.compare,p=p!==null?p:ba,p($,x)&&r.ref===s.ref)return La(r,s,P)}return s.flags|=1,r=co(L,x),r.ref=s.ref,r.return=s,s.child=r}function xp(r,s,p,x,P){if(r!==null){var L=r.memoizedProps;if(ba(L,x)&&r.ref===s.ref)if(dr=!1,s.pendingProps=x=L,Jh(r,P))(r.flags&131072)!==0&&(dr=!0);else return s.lanes=r.lanes,La(r,s,P)}return wp(r,s,p,x,P)}function bp(r,s,p,x){var P=x.children,L=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),x.mode==="hidden"){if((s.flags&128)!==0){if(L=L!==null?L.baseLanes|p:p,r!==null){for(x=s.child=r.child,P=0;x!==null;)P=P|x.lanes|x.childLanes,x=x.sibling;x=P&~L}else x=0,s.child=null;return Im(r,s,L,p,x)}if((p&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&Yc(s,L!==null?L.cachePool:null),L!==null?$h(s,L):mo(),rc(s);else return x=s.lanes=536870912,Im(r,s,L!==null?L.baseLanes|p:p,p,x)}else L!==null?(Yc(s,L.cachePool),$h(s,L),ki(),s.memoizedState=null):(r!==null&&Yc(s,null),mo(),ki());return br(r,s,P,p),s.child}function za(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Im(r,s,p,x,P){var L=jc();return L=L===null?null:{parent:Ni._currentValue,pool:L},s.memoizedState={baseLanes:p,cachePool:L},r!==null&&Yc(s,null),mo(),rc(s),r!==null&&fo(r,s,x,!0),s.childLanes=P,null}function pl(r,s){return s=pf({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function Yh(r,s,p){return Is(s,r.child,null,p),r=pl(s,s.pendingProps),r.flags|=2,vi(s),s.memoizedState=null,r}function cf(r,s,p){var x=s.pendingProps,P=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(xn){if(x.mode==="hidden")return r=pl(s,x),s.lanes=536870912,za(null,r);if(iu(s),(r=Xn)?(r=_u(r,ho),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:vs!==null?{id:xs,overflow:Hr}:null,retryLane:536870912,hydrationErrors:null},p=qc(r),p.return=s,s.child=p,ur=s,Xn=null)):r=null,r===null)throw Zr(s);return s.lanes=536870912,null}return pl(s,x)}var L=r.memoizedState;if(L!==null){var $=L.dehydrated;if(iu(s),P)if(s.flags&256)s.flags&=-257,s=Yh(r,s,p);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(y(558));else if(dr||fo(r,s,p,!1),P=(p&r.childLanes)!==0,dr||P){if(x=mi,x!==null&&($=_i(x,p),$!==0&&$!==L.retryLane))throw L.retryLane=$,Mo(r,$),Uo(x,r,$),lf;dd(),s=Yh(r,s,p)}else r=L.treeContext,Xn=os($.nextSibling),ur=s,xn=!0,$s=null,ho=!1,r!==null&&Vh(s,r),s=pl(s,x),s.flags|=4096;return s}return r=co(r.child,{mode:x.mode,children:x.children}),r.ref=s.ref,s.child=r,r.return=s,r}function hf(r,s){var p=s.ref;if(p===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error(y(284));(r===null||r.ref!==p)&&(s.flags|=4194816)}}function wp(r,s,p,x,P){return Js(s),p=ru(r,s,p,x,void 0,P),x=lc(),r!==null&&!dr?(Ra(r,s,P),La(r,s,P)):(xn&&x&&rl(s),s.flags|=1,br(r,s,p,P),s.child)}function Rm(r,s,p,x,P,L){return Js(s),s.updateQueue=null,p=sc(s,x,p,P),ou(r),x=lc(),r!==null&&!dr?(Ra(r,s,L),La(r,s,L)):(xn&&x&&rl(s),s.flags|=1,br(r,s,p,L),s.child)}function Pm(r,s,p,x,P){if(Js(s),s.stateNode===null){var L=nn,$=p.contextType;typeof $=="object"&&$!==null&&(L=Vi($)),L=new p(x,L),s.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,L.updater=th,s.stateNode=L,L._reactInternals=s,L=s.stateNode,L.props=x,L.state=s.memoizedState,L.refs={},Kc(s),$=p.contextType,L.context=typeof $=="object"&&$!==null?Vi($):nn,L.state=s.memoizedState,$=p.getDerivedStateFromProps,typeof $=="function"&&(eh(s,p,$,x),L.state=s.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||($=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),$!==L.state&&th.enqueueReplaceState(L,L.state,null),Ia(s,x,L,P),Ks(),L.state=s.memoizedState),typeof L.componentDidMount=="function"&&(s.flags|=4194308),x=!0}else if(r===null){L=s.stateNode;var oe=s.memoizedProps,Se=Da(p,oe);L.props=Se;var qe=L.context,tt=p.contextType;$=nn,typeof tt=="object"&&tt!==null&&($=Vi(tt));var ct=p.getDerivedStateFromProps;tt=typeof ct=="function"||typeof L.getSnapshotBeforeUpdate=="function",oe=s.pendingProps!==oe,tt||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(oe||qe!==$)&&sf(s,L,x,$),Rs=!1;var Ze=s.memoizedState;L.state=Ze,Ia(s,x,L,P),Ks(),qe=s.memoizedState,oe||Ze!==qe||Rs?(typeof ct=="function"&&(eh(s,p,ct,x),qe=s.memoizedState),(Se=Rs||Pa(s,p,Se,x,Ze,qe,$))?(tt||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(s.flags|=4194308)):(typeof L.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=x,s.memoizedState=qe),L.props=x,L.state=qe,L.context=$,x=Se):(typeof L.componentDidMount=="function"&&(s.flags|=4194308),x=!1)}else{L=s.stateNode,tc(r,s),$=s.memoizedProps,tt=Da(p,$),L.props=tt,ct=s.pendingProps,Ze=L.context,qe=p.contextType,Se=nn,typeof qe=="object"&&qe!==null&&(Se=Vi(qe)),oe=p.getDerivedStateFromProps,(qe=typeof oe=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||($!==ct||Ze!==Se)&&sf(s,L,x,Se),Rs=!1,Ze=s.memoizedState,L.state=Ze,Ia(s,x,L,P),Ks();var Je=s.memoizedState;$!==ct||Ze!==Je||Rs||r!==null&&r.dependencies!==null&&Ql(r.dependencies)?(typeof oe=="function"&&(eh(s,p,oe,x),Je=s.memoizedState),(tt=Rs||Pa(s,p,tt,x,Ze,Je,Se)||r!==null&&r.dependencies!==null&&Ql(r.dependencies))?(qe||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(x,Je,Se),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(x,Je,Se)),typeof L.componentDidUpdate=="function"&&(s.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof L.componentDidUpdate!="function"||$===r.memoizedProps&&Ze===r.memoizedState||(s.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||$===r.memoizedProps&&Ze===r.memoizedState||(s.flags|=1024),s.memoizedProps=x,s.memoizedState=Je),L.props=x,L.state=Je,L.context=Se,x=tt):(typeof L.componentDidUpdate!="function"||$===r.memoizedProps&&Ze===r.memoizedState||(s.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||$===r.memoizedProps&&Ze===r.memoizedState||(s.flags|=1024),x=!1)}return L=x,hf(r,s),x=(s.flags&128)!==0,L||x?(L=s.stateNode,p=x&&typeof p.getDerivedStateFromError!="function"?null:L.render(),s.flags|=1,r!==null&&x?(s.child=Is(s,r.child,null,P),s.child=Is(s,null,p,P)):br(r,s,p,P),s.memoizedState=L.state,r=s.child):r=La(r,s,P),r}function Dm(r,s,p,x){return ws(),s.flags|=256,br(r,s,p,x),s.child}var df={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Xh(r){return{baseLanes:r,cachePool:of()}}function ff(r,s,p){return r=r!==null?r.childLanes&~p:0,s&&(r|=Vr),r}function Tp(r,s,p){var x=s.pendingProps,P=!1,L=(s.flags&128)!==0,$;if(($=L)||($=r!==null&&r.memoizedState===null?!1:(Ei.current&2)!==0),$&&(P=!0,s.flags&=-129),$=(s.flags&32)!==0,s.flags&=-33,r===null){if(xn){if(P?Do(s):ki(),(r=Xn)?(r=_u(r,ho),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:vs!==null?{id:xs,overflow:Hr}:null,retryLane:536870912,hydrationErrors:null},p=qc(r),p.return=s,s.child=p,ur=s,Xn=null)):r=null,r===null)throw Zr(s);return Ki(r)?s.lanes=32:s.lanes=536870912,null}var oe=x.children;return x=x.fallback,P?(ki(),P=s.mode,oe=pf({mode:"hidden",children:oe},P),x=Ta(x,P,p,null),oe.return=s,x.return=s,oe.sibling=x,s.child=oe,x=s.child,x.memoizedState=Xh(p),x.childLanes=ff(r,$,p),s.memoizedState=df,za(null,x)):(Do(s),Sp(s,oe))}var Se=r.memoizedState;if(Se!==null&&(oe=Se.dehydrated,oe!==null)){if(L)s.flags&256?(Do(s),s.flags&=-257,s=mf(r,s,p)):s.memoizedState!==null?(ki(),s.child=r.child,s.flags|=128,s=null):(ki(),oe=x.fallback,P=s.mode,x=pf({mode:"visible",children:x.children},P),oe=Ta(oe,P,p,null),oe.flags|=2,x.return=s,oe.return=s,x.sibling=oe,s.child=x,Is(s,r.child,null,p),x=s.child,x.memoizedState=Xh(p),x.childLanes=ff(r,$,p),s.memoizedState=df,s=za(null,x));else if(Do(s),Ki(oe)){if($=oe.nextSibling&&oe.nextSibling.dataset,$)var qe=$.dgst;$=qe,x=Error(y(419)),x.stack="",x.digest=$,js({value:x,source:null,stack:null}),s=mf(r,s,p)}else if(dr||fo(r,s,p,!1),$=(p&r.childLanes)!==0,dr||$){if($=mi,$!==null&&(x=_i($,p),x!==0&&x!==Se.retryLane))throw Se.retryLane=x,Mo(r,x),Uo($,r,x),lf;Wr(oe)||dd(),s=mf(r,s,p)}else Wr(oe)?(s.flags|=192,s.child=r.child,s=null):(r=Se.treeContext,Xn=os(oe.nextSibling),ur=s,xn=!0,$s=null,ho=!1,r!==null&&Vh(s,r),s=Sp(s,x.children),s.flags|=4096);return s}return P?(ki(),oe=x.fallback,P=s.mode,Se=r.child,qe=Se.sibling,x=co(Se,{mode:"hidden",children:x.children}),x.subtreeFlags=Se.subtreeFlags&65011712,qe!==null?oe=co(qe,oe):(oe=Ta(oe,P,p,null),oe.flags|=2),oe.return=s,x.return=s,x.sibling=oe,s.child=x,za(null,x),x=s.child,oe=r.child.memoizedState,oe===null?oe=Xh(p):(P=oe.cachePool,P!==null?(Se=Ni._currentValue,P=P.parent!==Se?{parent:Se,pool:Se}:P):P=of(),oe={baseLanes:oe.baseLanes|p,cachePool:P}),x.memoizedState=oe,x.childLanes=ff(r,$,p),s.memoizedState=df,za(r.child,x)):(Do(s),p=r.child,r=p.sibling,p=co(p,{mode:"visible",children:x.children}),p.return=s,p.sibling=null,r!==null&&($=s.deletions,$===null?(s.deletions=[r],s.flags|=16):$.push(r)),s.child=p,s.memoizedState=null,p)}function Sp(r,s){return s=pf({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function pf(r,s){return r=uo(22,r,null,s),r.lanes=0,r}function mf(r,s,p){return Is(s,r.child,null,p),r=Sp(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function Ep(r,s,p){r.lanes|=s;var x=r.alternate;x!==null&&(x.lanes|=s),Hc(r.return,s,p)}function Cp(r,s,p,x,P,L){var $=r.memoizedState;$===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:x,tail:p,tailMode:P,treeForkCount:L}:($.isBackwards=s,$.rendering=null,$.renderingStartTime=0,$.last=x,$.tail=p,$.tailMode=P,$.treeForkCount=L)}function gf(r,s,p){var x=s.pendingProps,P=x.revealOrder,L=x.tail;x=x.children;var $=Ei.current,oe=($&2)!==0;if(oe?($=$&1|2,s.flags|=128):$&=1,Et(Ei,$),br(r,s,x,p),x=xn?Aa:0,!oe&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Ep(r,p,s);else if(r.tag===19)Ep(r,p,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(P){case"forwards":for(p=s.child,P=null;p!==null;)r=p.alternate,r!==null&&oc(r)===null&&(P=p),p=p.sibling;p=P,p===null?(P=s.child,s.child=null):(P=p.sibling,p.sibling=null),Cp(s,!1,P,p,L,x);break;case"backwards":case"unstable_legacy-backwards":for(p=null,P=s.child,s.child=null;P!==null;){if(r=P.alternate,r!==null&&oc(r)===null){s.child=P;break}r=P.sibling,P.sibling=p,p=P,P=r}Cp(s,!0,p,null,L,x);break;case"together":Cp(s,!1,null,null,void 0,x);break;default:s.memoizedState=null}return s.child}function La(r,s,p){if(r!==null&&(s.dependencies=r.dependencies),xl|=s.lanes,(p&s.childLanes)===0)if(r!==null){if(fo(r,s,p,!1),(p&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(y(153));if(s.child!==null){for(r=s.child,p=co(r,r.pendingProps),s.child=p,p.return=s;r.sibling!==null;)r=r.sibling,p=p.sibling=co(r,r.pendingProps),p.return=s;p.sibling=null}return s.child}function Jh(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&Ql(r)))}function Wh(r,s,p){switch(s.tag){case 3:Nt(s,s.stateNode.containerInfo),Xs(s,Ni,r.memoizedState.cache),ws();break;case 27:case 5:ei(s);break;case 4:Nt(s,s.stateNode.containerInfo);break;case 10:Xs(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,iu(s),null;break;case 13:var x=s.memoizedState;if(x!==null)return x.dehydrated!==null?(Do(s),s.flags|=128,null):(p&s.child.childLanes)!==0?Tp(r,s,p):(Do(s),r=La(r,s,p),r!==null?r.sibling:null);Do(s);break;case 19:var P=(r.flags&128)!==0;if(x=(p&s.childLanes)!==0,x||(fo(r,s,p,!1),x=(p&s.childLanes)!==0),P){if(x)return gf(r,s,p);s.flags|=128}if(P=s.memoizedState,P!==null&&(P.rendering=null,P.tail=null,P.lastEffect=null),Et(Ei,Ei.current),x)break;return null;case 22:return s.lanes=0,bp(r,s,p,s.pendingProps);case 24:Xs(s,Ni,r.memoizedState.cache)}return La(r,s,p)}function Jr(r,s,p){if(r!==null)if(r.memoizedProps!==s.pendingProps)dr=!0;else{if(!Jh(r,p)&&(s.flags&128)===0)return dr=!1,Wh(r,s,p);dr=(r.flags&131072)!==0}else dr=!1,xn&&(s.flags&1048576)!==0&&Uh(s,Aa,s.index);switch(s.lanes=0,s.tag){case 16:e:{var x=s.pendingProps;if(r=Ro(s.elementType),s.type=r,typeof r=="function")Vc(r)?(x=Da(r,x),s.tag=1,s=Pm(null,s,r,x,p)):(s.tag=0,s=wp(null,s,r,x,p));else{if(r!=null){var P=r.$$typeof;if(P===gt){s.tag=11,s=Mm(null,s,r,x,p);break e}else if(P===_t){s.tag=14,s=uf(null,s,r,x,p);break e}}throw s=kn(r)||r,Error(y(306,s,""))}}return s;case 0:return wp(r,s,s.type,s.pendingProps,p);case 1:return x=s.type,P=Da(x,s.pendingProps),Pm(r,s,x,P,p);case 3:e:{if(Nt(s,s.stateNode.containerInfo),r===null)throw Error(y(387));x=s.pendingProps;var L=s.memoizedState;P=L.element,tc(r,s),Ia(s,x,null,p);var $=s.memoizedState;if(x=$.cache,Xs(s,Ni,x),x!==L.cache&&Zc(s,[Ni],p,!0),Ks(),x=$.element,L.isDehydrated)if(L={element:x,isDehydrated:!1,cache:$.cache},s.updateQueue.baseState=L,s.memoizedState=L,s.flags&256){s=Dm(r,s,x,p);break e}else if(x!==P){P=Ur(Error(y(424)),s),js(P),s=Dm(r,s,x,p);break e}else{switch(r=s.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(Xn=os(r.firstChild),ur=s,xn=!0,$s=null,ho=!0,p=Hh(s,null,x,p),s.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling}else{if(ws(),x===P){s=La(r,s,p);break e}br(r,s,x,p)}s=s.child}return s;case 26:return hf(r,s),r===null?(p=sm(s.type,null,s.pendingProps,null))?s.memoizedState=p:xn||(p=s.type,r=s.pendingProps,x=yd(Vt.current).createElement(p),x[vn]=s,x[dt]=r,Tr(x,p,r),wi(x),s.stateNode=x):s.memoizedState=sm(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return ei(s),r===null&&xn&&(x=s.stateNode=dg(s.type,s.pendingProps,Vt.current),ur=s,ho=!0,P=Xn,gu(s.type)?(xo=P,Xn=os(x.firstChild)):Xn=P),br(r,s,s.pendingProps.children,p),hf(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&xn&&((P=x=Xn)&&(x=Mr(x,s.type,s.pendingProps,ho),x!==null?(s.stateNode=x,ur=s,Xn=os(x.firstChild),ho=!1,P=!0):P=!1),P||Zr(s)),ei(s),P=s.type,L=s.pendingProps,$=r!==null?r.memoizedProps:null,x=L.children,qf(P,L)?x=null:$!==null&&qf(P,$)&&(s.flags|=32),s.memoizedState!==null&&(P=ru(r,s,ac,null,null,p),bh._currentValue=P),hf(r,s),br(r,s,x,p),s.child;case 6:return r===null&&xn&&((r=p=Xn)&&(p=la(p,s.pendingProps,ho),p!==null?(s.stateNode=p,ur=s,Xn=null,r=!0):r=!1),r||Zr(s)),null;case 13:return Tp(r,s,p);case 4:return Nt(s,s.stateNode.containerInfo),x=s.pendingProps,r===null?s.child=Is(s,null,x,p):br(r,s,x,p),s.child;case 11:return Mm(r,s,s.type,s.pendingProps,p);case 7:return br(r,s,s.pendingProps,p),s.child;case 8:return br(r,s,s.pendingProps.children,p),s.child;case 12:return br(r,s,s.pendingProps.children,p),s.child;case 10:return x=s.pendingProps,Xs(s,s.type,x.value),br(r,s,x.children,p),s.child;case 9:return P=s.type._context,x=s.pendingProps.children,Js(s),P=Vi(P),x=x(P),s.flags|=1,br(r,s,x,p),s.child;case 14:return uf(r,s,s.type,s.pendingProps,p);case 15:return xp(r,s,s.type,s.pendingProps,p);case 19:return gf(r,s,p);case 31:return cf(r,s,p);case 22:return bp(r,s,p,s.pendingProps);case 24:return Js(s),x=Vi(Ni),r===null?(P=jc(),P===null&&(P=mi,L=Cs(),P.pooledCache=L,L.refCount++,L!==null&&(P.pooledCacheLanes|=p),P=L),s.memoizedState={parent:x,cache:P},Kc(s),Xs(s,Ni,P)):((r.lanes&p)!==0&&(tc(r,s),Ia(s,null,null,p),Ks()),P=r.memoizedState,L=s.memoizedState,P.parent!==x?(P={parent:x,cache:x},s.memoizedState=P,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=P),Xs(s,Ni,x)):(x=L.cache,Xs(s,Ni,x),x!==P.cache&&Zc(s,[Ni],p,!0))),br(r,s,s.pendingProps.children,p),s.child;case 29:throw s.pendingProps}throw Error(y(156,s.tag))}function Na(r){r.flags|=4}function Kh(r,s,p,x,P){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(P&335544128)===P)if(r.stateNode.complete)r.flags|=8192;else if(Bp())r.flags|=8192;else throw Jo=Tt,Ma}else r.flags&=-16777217}function zm(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!wd(s))if(Bp())r.flags|=8192;else throw Jo=Tt,Ma}function Qh(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?Ot():536870912,r.lanes|=s,gc|=s)}function ed(r,s){if(!xn)switch(r.tailMode){case"hidden":s=r.tail;for(var p=null;s!==null;)s.alternate!==null&&(p=s),s=s.sibling;p===null?r.tail=null:p.sibling=null;break;case"collapsed":p=r.tail;for(var x=null;p!==null;)p.alternate!==null&&(x=p),p=p.sibling;x===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:x.sibling=null}}function Mi(r){var s=r.alternate!==null&&r.alternate.child===r.child,p=0,x=0;if(s)for(var P=r.child;P!==null;)p|=P.lanes|P.childLanes,x|=P.subtreeFlags&65011712,x|=P.flags&65011712,P.return=r,P=P.sibling;else for(P=r.child;P!==null;)p|=P.lanes|P.childLanes,x|=P.subtreeFlags,x|=P.flags,P.return=r,P=P.sibling;return r.subtreeFlags|=x,r.childLanes=p,s}function Lm(r,s,p){var x=s.pendingProps;switch(Kl(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mi(s),null;case 1:return Mi(s),null;case 3:return p=s.stateNode,x=null,r!==null&&(x=r.memoizedState.cache),s.memoizedState.cache!==x&&(s.flags|=2048),Es(Ni),gn(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(r===null||r.child===null)&&(bs(s)?Na(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Ts())),Mi(s),null;case 26:var P=s.type,L=s.memoizedState;return r===null?(Na(s),L!==null?(Mi(s),zm(s,L)):(Mi(s),Kh(s,P,null,x,p))):L?L!==r.memoizedState?(Na(s),Mi(s),zm(s,L)):(Mi(s),s.flags&=-16777217):(r=r.memoizedProps,r!==x&&Na(s),Mi(s),Kh(s,P,r,x,p)),null;case 27:if(bn(s),p=Vt.current,P=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==x&&Na(s);else{if(!x){if(s.stateNode===null)throw Error(y(166));return Mi(s),null}r=Rt.current,bs(s)?$r(s):(r=dg(P,x,p),s.stateNode=r,Na(s))}return Mi(s),null;case 5:if(bn(s),P=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==x&&Na(s);else{if(!x){if(s.stateNode===null)throw Error(y(166));return Mi(s),null}if(L=Rt.current,bs(s))$r(s);else{var $=yd(Vt.current);switch(L){case 1:L=$.createElementNS("http://www.w3.org/2000/svg",P);break;case 2:L=$.createElementNS("http://www.w3.org/1998/Math/MathML",P);break;default:switch(P){case"svg":L=$.createElementNS("http://www.w3.org/2000/svg",P);break;case"math":L=$.createElementNS("http://www.w3.org/1998/Math/MathML",P);break;case"script":L=$.createElement("div"),L.innerHTML="<script><\/script>",L=L.removeChild(L.firstChild);break;case"select":L=typeof x.is=="string"?$.createElement("select",{is:x.is}):$.createElement("select"),x.multiple?L.multiple=!0:x.size&&(L.size=x.size);break;default:L=typeof x.is=="string"?$.createElement(P,{is:x.is}):$.createElement(P)}}L[vn]=s,L[dt]=x;e:for($=s.child;$!==null;){if($.tag===5||$.tag===6)L.appendChild($.stateNode);else if($.tag!==4&&$.tag!==27&&$.child!==null){$.child.return=$,$=$.child;continue}if($===s)break e;for(;$.sibling===null;){if($.return===null||$.return===s)break e;$=$.return}$.sibling.return=$.return,$=$.sibling}s.stateNode=L;e:switch(Tr(L,P,x),P){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}x&&Na(s)}}return Mi(s),Kh(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,p),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==x&&Na(s);else{if(typeof x!="string"&&s.stateNode===null)throw Error(y(166));if(r=Vt.current,bs(s)){if(r=s.stateNode,p=s.memoizedProps,x=null,P=ur,P!==null)switch(P.tag){case 27:case 5:x=P.memoizedProps}r[vn]=s,r=!!(r.nodeValue===p||x!==null&&x.suppressHydrationWarning===!0||Jp(r.nodeValue,p)),r||Zr(s,!0)}else r=yd(r).createTextNode(x),r[vn]=s,s.stateNode=r}return Mi(s),null;case 31:if(p=s.memoizedState,r===null||r.memoizedState!==null){if(x=bs(s),p!==null){if(r===null){if(!x)throw Error(y(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(y(557));r[vn]=s}else ws(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Mi(s),r=!1}else p=Ts(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=p),r=!0;if(!r)return s.flags&256?(vi(s),s):(vi(s),null);if((s.flags&128)!==0)throw Error(y(558))}return Mi(s),null;case 13:if(x=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(P=bs(s),x!==null&&x.dehydrated!==null){if(r===null){if(!P)throw Error(y(318));if(P=s.memoizedState,P=P!==null?P.dehydrated:null,!P)throw Error(y(317));P[vn]=s}else ws(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Mi(s),P=!1}else P=Ts(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=P),P=!0;if(!P)return s.flags&256?(vi(s),s):(vi(s),null)}return vi(s),(s.flags&128)!==0?(s.lanes=p,s):(p=x!==null,r=r!==null&&r.memoizedState!==null,p&&(x=s.child,P=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(P=x.alternate.memoizedState.cachePool.pool),L=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(L=x.memoizedState.cachePool.pool),L!==P&&(x.flags|=2048)),p!==r&&p&&(s.child.flags|=8192),Qh(s,s.updateQueue),Mi(s),null);case 4:return gn(),r===null&&Yp(s.stateNode.containerInfo),Mi(s),null;case 10:return Es(s.type),Mi(s),null;case 19:if(at(Ei),x=s.memoizedState,x===null)return Mi(s),null;if(P=(s.flags&128)!==0,L=x.rendering,L===null)if(P)ed(x,!1);else{if(qi!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(L=oc(r),L!==null){for(s.flags|=128,ed(x,!1),r=L.updateQueue,s.updateQueue=r,Qh(s,r),s.subtreeFlags=0,r=p,p=s.child;p!==null;)nf(p,r),p=p.sibling;return Et(Ei,Ei.current&1|2),xn&&Zs(s,x.treeForkCount),s.child}r=r.sibling}x.tail!==null&&Di()>ud&&(s.flags|=128,P=!0,ed(x,!1),s.lanes=4194304)}else{if(!P)if(r=oc(L),r!==null){if(s.flags|=128,P=!0,r=r.updateQueue,s.updateQueue=r,Qh(s,r),ed(x,!0),x.tail===null&&x.tailMode==="hidden"&&!L.alternate&&!xn)return Mi(s),null}else 2*Di()-x.renderingStartTime>ud&&p!==536870912&&(s.flags|=128,P=!0,ed(x,!1),s.lanes=4194304);x.isBackwards?(L.sibling=s.child,s.child=L):(r=x.last,r!==null?r.sibling=L:s.child=L,x.last=L)}return x.tail!==null?(r=x.tail,x.rendering=r,x.tail=r.sibling,x.renderingStartTime=Di(),r.sibling=null,p=Ei.current,Et(Ei,P?p&1|2:p&1),xn&&Zs(s,x.treeForkCount),r):(Mi(s),null);case 22:case 23:return vi(s),ll(),x=s.memoizedState!==null,r!==null?r.memoizedState!==null!==x&&(s.flags|=8192):x&&(s.flags|=8192),x?(p&536870912)!==0&&(s.flags&128)===0&&(Mi(s),s.subtreeFlags&6&&(s.flags|=8192)):Mi(s),p=s.updateQueue,p!==null&&Qh(s,p.retryQueue),p=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(p=r.memoizedState.cachePool.pool),x=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(x=s.memoizedState.cachePool.pool),x!==p&&(s.flags|=2048),r!==null&&at(Yo),null;case 24:return p=null,r!==null&&(p=r.memoizedState.cache),s.memoizedState.cache!==p&&(s.flags|=2048),Es(Ni),Mi(s),null;case 25:return null;case 30:return null}throw Error(y(156,s.tag))}function Kg(r,s){switch(Kl(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Es(Ni),gn(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return bn(s),null;case 31:if(s.memoizedState!==null){if(vi(s),s.alternate===null)throw Error(y(340));ws()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(vi(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(y(340));ws()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return at(Ei),null;case 4:return gn(),null;case 10:return Es(s.type),null;case 22:case 23:return vi(s),ll(),r!==null&&at(Yo),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return Es(Ni),null;case 25:return null;default:return null}}function _f(r,s){switch(Kl(s),s.tag){case 3:Es(Ni),gn();break;case 26:case 27:case 5:bn(s);break;case 4:gn();break;case 31:s.memoizedState!==null&&vi(s);break;case 13:vi(s);break;case 19:at(Ei);break;case 10:Es(s.type);break;case 22:case 23:vi(s),ll(),r!==null&&at(Yo);break;case 24:Es(Ni)}}function rh(r,s){try{var p=s.updateQueue,x=p!==null?p.lastEffect:null;if(x!==null){var P=x.next;p=P;do{if((p.tag&r)===r){x=void 0;var L=p.create,$=p.inst;x=L(),$.destroy=x}p=p.next}while(p!==P)}}catch(oe){Qn(s,s.return,oe)}}function ml(r,s,p){try{var x=s.updateQueue,P=x!==null?x.lastEffect:null;if(P!==null){var L=P.next;x=L;do{if((x.tag&r)===r){var $=x.inst,oe=$.destroy;if(oe!==void 0){$.destroy=void 0,P=s;var Se=p,qe=oe;try{qe()}catch(tt){Qn(P,Se,tt)}}}x=x.next}while(x!==L)}}catch(tt){Qn(s,s.return,tt)}}function Nm(r){var s=r.updateQueue;if(s!==null){var p=r.stateNode;try{Qc(s,p)}catch(x){Qn(r,r.return,x)}}}function km(r,s,p){p.props=Da(r.type,r.memoizedProps),p.state=r.memoizedState;try{p.componentWillUnmount()}catch(x){Qn(r,s,x)}}function td(r,s){try{var p=r.ref;if(p!==null){switch(r.tag){case 26:case 27:case 5:var x=r.stateNode;break;case 30:x=r.stateNode;break;default:x=r.stateNode}typeof p=="function"?r.refCleanup=p(x):p.current=x}}catch(P){Qn(r,s,P)}}function is(r,s){var p=r.ref,x=r.refCleanup;if(p!==null)if(typeof x=="function")try{x()}catch(P){Qn(r,s,P)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(P){Qn(r,s,P)}else p.current=null}function yf(r){var s=r.type,p=r.memoizedProps,x=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":p.autoFocus&&x.focus();break e;case"img":p.src?x.src=p.src:p.srcSet&&(x.srcset=p.srcSet)}}catch(P){Qn(r,r.return,P)}}function vf(r,s,p){try{var x=r.stateNode;cg(x,r.type,p,s),x[dt]=s}catch(P){Qn(r,r.return,P)}}function lu(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&gu(r.type)||r.tag===4}function dc(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||lu(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&gu(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Ap(r,s,p){var x=r.tag;if(x===5||x===6)r=r.stateNode,s?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(r,s):(s=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,s.appendChild(r),p=p._reactRootContainer,p!=null||s.onclick!==null||(s.onclick=$o));else if(x!==4&&(x===27&&gu(r.type)&&(p=r.stateNode,s=null),r=r.child,r!==null))for(Ap(r,s,p),r=r.sibling;r!==null;)Ap(r,s,p),r=r.sibling}function xf(r,s,p){var x=r.tag;if(x===5||x===6)r=r.stateNode,s?p.insertBefore(r,s):p.appendChild(r);else if(x!==4&&(x===27&&gu(r.type)&&(p=r.stateNode),r=r.child,r!==null))for(xf(r,s,p),r=r.sibling;r!==null;)xf(r,s,p),r=r.sibling}function Fm(r){var s=r.stateNode,p=r.memoizedProps;try{for(var x=r.type,P=s.attributes;P.length;)s.removeAttributeNode(P[0]);Tr(s,x,p),s[vn]=r,s[dt]=p}catch(L){Qn(r,r.return,L)}}var gl=!1,fr=!1,Mp=!1,Bm=typeof WeakSet=="function"?WeakSet:Set,pr=null;function Qg(r,s){if(r=r.containerInfo,_d=Ad,r=Nc(r),Gu(r)){if("selectionStart"in r)var p={start:r.selectionStart,end:r.selectionEnd};else e:{p=(p=r.ownerDocument)&&p.defaultView||window;var x=p.getSelection&&p.getSelection();if(x&&x.rangeCount!==0){p=x.anchorNode;var P=x.anchorOffset,L=x.focusNode;x=x.focusOffset;try{p.nodeType,L.nodeType}catch{p=null;break e}var $=0,oe=-1,Se=-1,qe=0,tt=0,ct=r,Ze=null;t:for(;;){for(var Je;ct!==p||P!==0&&ct.nodeType!==3||(oe=$+P),ct!==L||x!==0&&ct.nodeType!==3||(Se=$+x),ct.nodeType===3&&($+=ct.nodeValue.length),(Je=ct.firstChild)!==null;)Ze=ct,ct=Je;for(;;){if(ct===r)break t;if(Ze===p&&++qe===P&&(oe=$),Ze===L&&++tt===x&&(Se=$),(Je=ct.nextSibling)!==null)break;ct=Ze,Ze=ct.parentNode}ct=Je}p=oe===-1||Se===-1?null:{start:oe,end:Se}}else p=null}p=p||{start:0,end:0}}else p=null;for(Wp={focusedElem:r,selectionRange:p},Ad=!1,pr=s;pr!==null;)if(s=pr,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,pr=r;else for(;pr!==null;){switch(s=pr,L=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(p=0;p<r.length;p++)P=r[p],P.ref.impl=P.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&L!==null){r=void 0,p=s,P=L.memoizedProps,L=L.memoizedState,x=p.stateNode;try{var kt=Da(p.type,P);r=x.getSnapshotBeforeUpdate(kt,L),x.__reactInternalSnapshotBeforeUpdate=r}catch(Yt){Qn(p,p.return,Yt)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,p=r.nodeType,p===9)aa(r);else if(p===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":aa(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(y(163))}if(r=s.sibling,r!==null){r.return=s.return,pr=r;break}pr=s.return}}function Ip(r,s,p){var x=p.flags;switch(p.tag){case 0:case 11:case 15:Fo(r,p),x&4&&rh(5,p);break;case 1:if(Fo(r,p),x&4)if(r=p.stateNode,s===null)try{r.componentDidMount()}catch($){Qn(p,p.return,$)}else{var P=Da(p.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(P,s,r.__reactInternalSnapshotBeforeUpdate)}catch($){Qn(p,p.return,$)}}x&64&&Nm(p),x&512&&td(p,p.return);break;case 3:if(Fo(r,p),x&64&&(r=p.updateQueue,r!==null)){if(s=null,p.child!==null)switch(p.child.tag){case 27:case 5:s=p.child.stateNode;break;case 1:s=p.child.stateNode}try{Qc(r,s)}catch($){Qn(p,p.return,$)}}break;case 27:s===null&&x&4&&Fm(p);case 26:case 5:Fo(r,p),s===null&&x&4&&yf(p),x&512&&td(p,p.return);break;case 12:Fo(r,p);break;case 31:Fo(r,p),x&4&&nd(r,p);break;case 13:Fo(r,p),x&4&&id(r,p),x&64&&(r=p.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(p=Up.bind(null,p),gr(r,p))));break;case 22:if(x=p.memoizedState!==null||gl,!x){s=s!==null&&s.memoizedState!==null||fr,P=gl;var L=fr;gl=x,(fr=s)&&!L?_l(r,p,(p.subtreeFlags&8772)!==0):Fo(r,p),gl=P,fr=L}break;case 30:break;default:Fo(r,p)}}function oh(r){var s=r.alternate;s!==null&&(r.alternate=null,oh(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&Ga(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Fi=null,zn=!1;function ko(r,s,p){for(p=p.child;p!==null;)Rp(r,s,p),p=p.sibling}function Rp(r,s,p){if(me&&typeof me.onCommitFiberUnmount=="function")try{me.onCommitFiberUnmount(ne,p)}catch{}switch(p.tag){case 26:fr||is(p,s),ko(r,s,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:fr||is(p,s);var x=Fi,P=zn;gu(p.type)&&(Fi=p.stateNode,zn=!1),ko(r,s,p),yh(p.stateNode),Fi=x,zn=P;break;case 5:fr||is(p,s);case 6:if(x=Fi,P=zn,Fi=null,ko(r,s,p),Fi=x,zn=P,Fi!==null)if(zn)try{(Fi.nodeType===9?Fi.body:Fi.nodeName==="HTML"?Fi.ownerDocument.body:Fi).removeChild(p.stateNode)}catch(L){Qn(p,s,L)}else try{Fi.removeChild(p.stateNode)}catch(L){Qn(p,s,L)}break;case 18:Fi!==null&&(zn?(r=Fi,hg(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,p.stateNode),wu(r)):hg(Fi,p.stateNode));break;case 4:x=Fi,P=zn,Fi=p.stateNode.containerInfo,zn=!0,ko(r,s,p),Fi=x,zn=P;break;case 0:case 11:case 14:case 15:ml(2,p,s),fr||ml(4,p,s),ko(r,s,p);break;case 1:fr||(is(p,s),x=p.stateNode,typeof x.componentWillUnmount=="function"&&km(p,s,x)),ko(r,s,p);break;case 21:ko(r,s,p);break;case 22:fr=(x=fr)||p.memoizedState!==null,ko(r,s,p),fr=x;break;default:ko(r,s,p)}}function nd(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{wu(r)}catch(p){Qn(s,s.return,p)}}}function id(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{wu(r)}catch(p){Qn(s,s.return,p)}}function rd(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new Bm),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new Bm),s;default:throw Error(y(435,r.tag))}}function od(r,s){var p=rd(r);s.forEach(function(x){if(!p.has(x)){p.add(x);var P=n_.bind(null,r,x);x.then(P,P)}})}function _o(r,s){var p=s.deletions;if(p!==null)for(var x=0;x<p.length;x++){var P=p[x],L=r,$=s,oe=$;e:for(;oe!==null;){switch(oe.tag){case 27:if(gu(oe.type)){Fi=oe.stateNode,zn=!1;break e}break;case 5:Fi=oe.stateNode,zn=!1;break e;case 3:case 4:Fi=oe.stateNode.containerInfo,zn=!0;break e}oe=oe.return}if(Fi===null)throw Error(y(160));Rp(L,$,P),Fi=null,zn=!1,L=P.alternate,L!==null&&(L.return=null),P.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)bf(s,r),s=s.sibling}var yo=null;function bf(r,s){var p=r.alternate,x=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:_o(s,r),wr(r),x&4&&(ml(3,r,r.return),rh(3,r),ml(5,r,r.return));break;case 1:_o(s,r),wr(r),x&512&&(fr||p===null||is(p,p.return)),x&64&&gl&&(r=r.updateQueue,r!==null&&(x=r.callbacks,x!==null&&(p=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=p===null?x:p.concat(x))));break;case 26:var P=yo;if(_o(s,r),wr(r),x&512&&(fr||p===null||is(p,p.return)),x&4){var L=p!==null?p.memoizedState:null;if(x=r.memoizedState,p===null)if(x===null)if(r.stateNode===null){e:{x=r.type,p=r.memoizedProps,P=P.ownerDocument||P;t:switch(x){case"title":L=P.getElementsByTagName("title")[0],(!L||L[Qt]||L[vn]||L.namespaceURI==="http://www.w3.org/2000/svg"||L.hasAttribute("itemprop"))&&(L=P.createElement(x),P.head.insertBefore(L,P.querySelector("head > title"))),Tr(L,x,p),L[vn]=r,wi(L),x=L;break e;case"link":var $=cm("link","href",P).get(x+(p.href||""));if($){for(var oe=0;oe<$.length;oe++)if(L=$[oe],L.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&L.getAttribute("rel")===(p.rel==null?null:p.rel)&&L.getAttribute("title")===(p.title==null?null:p.title)&&L.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){$.splice(oe,1);break t}}L=P.createElement(x),Tr(L,x,p),P.head.appendChild(L);break;case"meta":if($=cm("meta","content",P).get(x+(p.content||""))){for(oe=0;oe<$.length;oe++)if(L=$[oe],L.getAttribute("content")===(p.content==null?null:""+p.content)&&L.getAttribute("name")===(p.name==null?null:p.name)&&L.getAttribute("property")===(p.property==null?null:p.property)&&L.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&L.getAttribute("charset")===(p.charSet==null?null:p.charSet)){$.splice(oe,1);break t}}L=P.createElement(x),Tr(L,x,p),P.head.appendChild(L);break;default:throw Error(y(468,x))}L[vn]=r,wi(L),x=L}r.stateNode=x}else bd(P,r.type,r.stateNode);else r.stateNode=um(P,x,r.memoizedProps);else L!==x?(L===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):L.count--,x===null?bd(P,r.type,r.stateNode):um(P,x,r.memoizedProps)):x===null&&r.stateNode!==null&&vf(r,r.memoizedProps,p.memoizedProps)}break;case 27:_o(s,r),wr(r),x&512&&(fr||p===null||is(p,p.return)),p!==null&&x&4&&vf(r,r.memoizedProps,p.memoizedProps);break;case 5:if(_o(s,r),wr(r),x&512&&(fr||p===null||is(p,p.return)),r.flags&32){P=r.stateNode;try{qs(P,"")}catch(kt){Qn(r,r.return,kt)}}x&4&&r.stateNode!=null&&(P=r.memoizedProps,vf(r,P,p!==null?p.memoizedProps:P)),x&1024&&(Mp=!0);break;case 6:if(_o(s,r),wr(r),x&4){if(r.stateNode===null)throw Error(y(162));x=r.memoizedProps,p=r.stateNode;try{p.nodeValue=x}catch(kt){Qn(r,r.return,kt)}}break;case 3:if(Xf=null,P=yo,yo=$f(s.containerInfo),_o(s,r),yo=P,wr(r),x&4&&p!==null&&p.memoizedState.isDehydrated)try{wu(s.containerInfo)}catch(kt){Qn(r,r.return,kt)}Mp&&(Mp=!1,sd(r));break;case 4:x=yo,yo=$f(r.stateNode.containerInfo),_o(s,r),wr(r),yo=x;break;case 12:_o(s,r),wr(r);break;case 31:_o(s,r),wr(r),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,od(r,x)));break;case 13:_o(s,r),wr(r),r.child.flags&8192&&r.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(Sf=Di()),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,od(r,x)));break;case 22:P=r.memoizedState!==null;var Se=p!==null&&p.memoizedState!==null,qe=gl,tt=fr;if(gl=qe||P,fr=tt||Se,_o(s,r),fr=tt,gl=qe,wr(r),x&8192)e:for(s=r.stateNode,s._visibility=P?s._visibility&-2:s._visibility|1,P&&(p===null||Se||gl||fr||ra(r)),p=null,s=r;;){if(s.tag===5||s.tag===26){if(p===null){Se=p=s;try{if(L=Se.stateNode,P)$=L.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none";else{oe=Se.stateNode;var ct=Se.memoizedProps.style,Ze=ct!=null&&ct.hasOwnProperty("display")?ct.display:null;oe.style.display=Ze==null||typeof Ze=="boolean"?"":(""+Ze).trim()}}catch(kt){Qn(Se,Se.return,kt)}}}else if(s.tag===6){if(p===null){Se=s;try{Se.stateNode.nodeValue=P?"":Se.memoizedProps}catch(kt){Qn(Se,Se.return,kt)}}}else if(s.tag===18){if(p===null){Se=s;try{var Je=Se.stateNode;P?hn(Je,!0):hn(Se.stateNode,!1)}catch(kt){Qn(Se,Se.return,kt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;p===s&&(p=null),s=s.return}p===s&&(p=null),s.sibling.return=s.return,s=s.sibling}x&4&&(x=r.updateQueue,x!==null&&(p=x.retryQueue,p!==null&&(x.retryQueue=null,od(r,p))));break;case 19:_o(s,r),wr(r),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,od(r,x)));break;case 30:break;case 21:break;default:_o(s,r),wr(r)}}function wr(r){var s=r.flags;if(s&2){try{for(var p,x=r.return;x!==null;){if(lu(x)){p=x;break}x=x.return}if(p==null)throw Error(y(160));switch(p.tag){case 27:var P=p.stateNode,L=dc(r);xf(r,L,P);break;case 5:var $=p.stateNode;p.flags&32&&(qs($,""),p.flags&=-33);var oe=dc(r);xf(r,oe,$);break;case 3:case 4:var Se=p.stateNode.containerInfo,qe=dc(r);Ap(r,qe,Se);break;default:throw Error(y(161))}}catch(tt){Qn(r,r.return,tt)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function sd(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;sd(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function Fo(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Ip(r,s.alternate,s),s=s.sibling}function ra(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:ml(4,s,s.return),ra(s);break;case 1:is(s,s.return);var p=s.stateNode;typeof p.componentWillUnmount=="function"&&km(s,s.return,p),ra(s);break;case 27:yh(s.stateNode);case 26:case 5:is(s,s.return),ra(s);break;case 22:s.memoizedState===null&&ra(s);break;case 30:ra(s);break;default:ra(s)}r=r.sibling}}function _l(r,s,p){for(p=p&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var x=s.alternate,P=r,L=s,$=L.flags;switch(L.tag){case 0:case 11:case 15:_l(P,L,p),rh(4,L);break;case 1:if(_l(P,L,p),x=L,P=x.stateNode,typeof P.componentDidMount=="function")try{P.componentDidMount()}catch(qe){Qn(x,x.return,qe)}if(x=L,P=x.updateQueue,P!==null){var oe=x.stateNode;try{var Se=P.shared.hiddenCallbacks;if(Se!==null)for(P.shared.hiddenCallbacks=null,P=0;P<Se.length;P++)nc(Se[P],oe)}catch(qe){Qn(x,x.return,qe)}}p&&$&64&&Nm(L),td(L,L.return);break;case 27:Fm(L);case 26:case 5:_l(P,L,p),p&&x===null&&$&4&&yf(L),td(L,L.return);break;case 12:_l(P,L,p);break;case 31:_l(P,L,p),p&&$&4&&nd(P,L);break;case 13:_l(P,L,p),p&&$&4&&id(P,L);break;case 22:L.memoizedState===null&&_l(P,L,p),td(L,L.return);break;case 30:break;default:_l(P,L,p)}s=s.sibling}}function wf(r,s){var p=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(p=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==p&&(r!=null&&r.refCount++,p!=null&&eu(p))}function yl(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&eu(r))}function oa(r,s,p,x){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Pp(r,s,p,x),s=s.sibling}function Pp(r,s,p,x){var P=s.flags;switch(s.tag){case 0:case 11:case 15:oa(r,s,p,x),P&2048&&rh(9,s);break;case 1:oa(r,s,p,x);break;case 3:oa(r,s,p,x),P&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&eu(r)));break;case 12:if(P&2048){oa(r,s,p,x),r=s.stateNode;try{var L=s.memoizedProps,$=L.id,oe=L.onPostCommit;typeof oe=="function"&&oe($,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(Se){Qn(s,s.return,Se)}}else oa(r,s,p,x);break;case 31:oa(r,s,p,x);break;case 13:oa(r,s,p,x);break;case 23:break;case 22:L=s.stateNode,$=s.alternate,s.memoizedState!==null?L._visibility&2?oa(r,s,p,x):fc(r,s):L._visibility&2?oa(r,s,p,x):(L._visibility|=2,ka(r,s,p,x,(s.subtreeFlags&10256)!==0||!1)),P&2048&&wf($,s);break;case 24:oa(r,s,p,x),P&2048&&yl(s.alternate,s);break;default:oa(r,s,p,x)}}function ka(r,s,p,x,P){for(P=P&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var L=r,$=s,oe=p,Se=x,qe=$.flags;switch($.tag){case 0:case 11:case 15:ka(L,$,oe,Se,P),rh(8,$);break;case 23:break;case 22:var tt=$.stateNode;$.memoizedState!==null?tt._visibility&2?ka(L,$,oe,Se,P):fc(L,$):(tt._visibility|=2,ka(L,$,oe,Se,P)),P&&qe&2048&&wf($.alternate,$);break;case 24:ka(L,$,oe,Se,P),P&&qe&2048&&yl($.alternate,$);break;default:ka(L,$,oe,Se,P)}s=s.sibling}}function fc(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var p=r,x=s,P=x.flags;switch(x.tag){case 22:fc(p,x),P&2048&&wf(x.alternate,x);break;case 24:fc(p,x),P&2048&&yl(x.alternate,x);break;default:fc(p,x)}s=s.sibling}}var sh=8192;function pc(r,s,p){if(r.subtreeFlags&sh)for(r=r.child;r!==null;)Om(r,s,p),r=r.sibling}function Om(r,s,p){switch(r.tag){case 26:pc(r,s,p),r.flags&sh&&r.memoizedState!==null&&hm(p,yo,r.memoizedState,r.memoizedProps);break;case 5:pc(r,s,p);break;case 3:case 4:var x=yo;yo=$f(r.stateNode.containerInfo),pc(r,s,p),yo=x;break;case 22:r.memoizedState===null&&(x=r.alternate,x!==null&&x.memoizedState!==null?(x=sh,sh=16777216,pc(r,s,p),sh=x):pc(r,s,p));break;default:pc(r,s,p)}}function Um(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function ad(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var p=0;p<s.length;p++){var x=s[p];pr=x,ah(x,r)}Um(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Vm(r),r=r.sibling}function Vm(r){switch(r.tag){case 0:case 11:case 15:ad(r),r.flags&2048&&ml(9,r,r.return);break;case 3:ad(r);break;case 12:ad(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,Tf(r)):ad(r);break;default:ad(r)}}function Tf(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var p=0;p<s.length;p++){var x=s[p];pr=x,ah(x,r)}Um(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:ml(8,s,s.return),Tf(s);break;case 22:p=s.stateNode,p._visibility&2&&(p._visibility&=-3,Tf(s));break;default:Tf(s)}r=r.sibling}}function ah(r,s){for(;pr!==null;){var p=pr;switch(p.tag){case 0:case 11:case 15:ml(8,p,s);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var x=p.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:eu(p.memoizedState.cache)}if(x=p.child,x!==null)x.return=p,pr=x;else e:for(p=r;pr!==null;){x=pr;var P=x.sibling,L=x.return;if(oh(x),x===p){pr=null;break e}if(P!==null){P.return=L,pr=P;break e}pr=L}}}var e_={getCacheForType:function(r){var s=Vi(Ni),p=s.data.get(r);return p===void 0&&(p=r(),s.data.set(r,p)),p},cacheSignal:function(){return Vi(Ni).controller.signal}},Gm=typeof WeakMap=="function"?WeakMap:Map,Kn=0,mi=null,Mn=null,In=0,ri=0,vo=null,Ns=!1,uu=!1,Dp=!1,vl=0,qi=0,xl=0,mc=0,zp=0,Vr=0,gc=0,ld=null,Bo=null,Lp=!1,Sf=0,qm=0,ud=1/0,lh=null,bl=null,mr=0,wl=null,uh=null,ks=0,Np=0,Ef=null,Hm=null,cd=0,kp=null;function Oo(){return(Kn&2)!==0&&In!==0?In&-In:Qe.T!==null?Zp():zi()}function Zm(){if(Vr===0)if((In&536870912)===0||xn){var r=$e;$e<<=1,($e&3932160)===0&&($e=262144),Vr=r}else Vr=536870912;return r=St.current,r!==null&&(r.flags|=32),Vr}function Uo(r,s,p){(r===mi&&(ri===2||ri===9)||r.cancelPendingCommit!==null)&&(hh(r,0),cu(r,In,Vr,!1)),Nn(r,p),((Kn&2)===0||r!==mi)&&(r===mi&&((Kn&2)===0&&(mc|=p),qi===4&&cu(r,In,Vr,!1)),sa(r))}function or(r,s,p){if((Kn&6)!==0)throw Error(y(327));var x=!p&&(s&127)===0&&(s&r.expiredLanes)===0||Fn(r,s),P=x?dh(r,s):Mf(r,s,!0),L=x;do{if(P===0){uu&&!x&&cu(r,s,0,!1);break}else{if(p=r.current.alternate,L&&!t_(p)){P=Mf(r,s,!1),L=!1;continue}if(P===2){if(L=s,r.errorRecoveryDisabledLanes&L)var $=0;else $=r.pendingLanes&-536870913,$=$!==0?$:$&536870912?536870912:0;if($!==0){s=$;e:{var oe=r;P=ld;var Se=oe.current.memoizedState.isDehydrated;if(Se&&(hh(oe,$).flags|=256),$=Mf(oe,$,!1),$!==2){if(Dp&&!Se){oe.errorRecoveryDisabledLanes|=L,mc|=L,P=4;break e}L=Bo,Bo=P,L!==null&&(Bo===null?Bo=L:Bo.push.apply(Bo,L))}P=$}if(L=!1,P!==2)continue}}if(P===1){hh(r,0),cu(r,s,0,!0);break}e:{switch(x=r,L=P,L){case 0:case 1:throw Error(y(345));case 4:if((s&4194048)!==s)break;case 6:cu(x,s,Vr,!Ns);break e;case 2:Bo=null;break;case 3:case 5:break;default:throw Error(y(329))}if((s&62914560)===s&&(P=Sf+300-Di(),10<P)){if(cu(x,s,Vr,!Ns),Ht(x,0,!0)!==0)break e;ks=s,x.timeoutHandle=Zf(ch.bind(null,x,p,Bo,lh,Lp,s,Vr,mc,gc,Ns,L,"Throttled",-0,0),P);break e}ch(x,p,Bo,lh,Lp,s,Vr,mc,gc,Ns,L,null,-0,0)}}break}while(!0);sa(r)}function ch(r,s,p,x,P,L,$,oe,Se,qe,tt,ct,Ze,Je){if(r.timeoutHandle=-1,ct=s.subtreeFlags,ct&8192||(ct&16785408)===16785408){ct={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:$o},Om(s,L,ct);var kt=(L&62914560)===L?Sf-Di():(L&4194048)===L?qm-Di():0;if(kt=dm(ct,kt),kt!==null){ks=L,r.cancelPendingCommit=kt(Jm.bind(null,r,s,L,p,x,P,$,oe,Se,tt,ct,null,Ze,Je)),cu(r,L,$,!qe);return}}Jm(r,s,L,p,x,P,$,oe,Se)}function t_(r){for(var s=r;;){var p=s.tag;if((p===0||p===11||p===15)&&s.flags&16384&&(p=s.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var x=0;x<p.length;x++){var P=p[x],L=P.getSnapshot;P=P.value;try{if(!qr(L(),P))return!1}catch{return!1}}if(p=s.child,s.subtreeFlags&16384&&p!==null)p.return=s,s=p;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function cu(r,s,p,x){s&=~zp,s&=~mc,r.suspendedLanes|=s,r.pingedLanes&=~s,x&&(r.warmLanes|=s),x=r.expirationTimes;for(var P=s;0<P;){var L=31-Pe(P),$=1<<L;x[L]=-1,P&=~$}p!==0&&Yi(r,p,s)}function hd(){return(Kn&6)===0?(rs(0),!1):!0}function Cf(){if(Mn!==null){if(ri===0)var r=Mn.return;else r=Mn,Ss=Io=null,ta(r),As=null,sl=0,r=Mn;for(;r!==null;)_f(r.alternate,r),r=r.return;Mn=null}}function hh(r,s){var p=r.timeoutHandle;p!==-1&&(r.timeoutHandle=-1,Qp(p)),p=r.cancelPendingCommit,p!==null&&(r.cancelPendingCommit=null,p()),ks=0,Cf(),mi=r,Mn=p=co(r.current,null),In=s,ri=0,vo=null,Ns=!1,uu=Fn(r,s),Dp=!1,gc=Vr=zp=mc=xl=qi=0,Bo=ld=null,Lp=!1,(s&8)!==0&&(s|=s&32);var x=r.entangledLanes;if(x!==0)for(r=r.entanglements,x&=s;0<x;){var P=31-Pe(x),L=1<<P;s|=r[P],x&=~L}return vl=s,nl(),p}function Fp(r,s){ln=null,Qe.H=Vn,s===Xo||s===jr?(s=nu(),ri=3):s===Ma?(s=nu(),ri=4):ri=s===lf?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,vo=s,Mn===null&&(qi=1,ns(r,Ur(s,r.current)))}function Bp(){var r=St.current;return r===null?!0:(In&4194048)===In?It===null:(In&62914560)===In||(In&536870912)!==0?r===It:!1}function _c(){var r=Qe.H;return Qe.H=Vn,r===null?Vn:r}function Af(){var r=Qe.A;return Qe.A=e_,r}function dd(){qi=4,Ns||(In&4194048)!==In&&St.current!==null||(uu=!0),(xl&134217727)===0&&(mc&134217727)===0||mi===null||cu(mi,In,Vr,!1)}function Mf(r,s,p){var x=Kn;Kn|=2;var P=_c(),L=Af();(mi!==r||In!==s)&&(lh=null,hh(r,s)),s=!1;var $=qi;e:do try{if(ri!==0&&Mn!==null){var oe=Mn,Se=vo;switch(ri){case 8:Cf(),$=6;break e;case 3:case 2:case 9:case 6:St.current===null&&(s=!0);var qe=ri;if(ri=0,vo=null,fh(r,oe,Se,qe),p&&uu){$=0;break e}break;default:qe=ri,ri=0,vo=null,fh(r,oe,Se,qe)}}If(),$=qi;break}catch(tt){Fp(r,tt)}while(!0);return s&&r.shellSuspendCounter++,Ss=Io=null,Kn=x,Qe.H=P,Qe.A=L,Mn===null&&(mi=null,In=0,nl()),$}function If(){for(;Mn!==null;)jm(Mn)}function dh(r,s){var p=Kn;Kn|=2;var x=_c(),P=Af();mi!==r||In!==s?(lh=null,ud=Di()+500,hh(r,s)):uu=Fn(r,s);e:do try{if(ri!==0&&Mn!==null){s=Mn;var L=vo;t:switch(ri){case 1:ri=0,vo=null,fh(r,s,L,1);break;case 2:case 9:if(Ku(L)){ri=0,vo=null,Ym(s);break}s=function(){ri!==2&&ri!==9||mi!==r||(ri=7),sa(r)},L.then(s,s);break e;case 3:ri=7;break e;case 4:ri=5;break e;case 7:Ku(L)?(ri=0,vo=null,Ym(s)):(ri=0,vo=null,fh(r,s,L,7));break;case 5:var $=null;switch(Mn.tag){case 26:$=Mn.memoizedState;case 5:case 27:var oe=Mn;if($?wd($):oe.stateNode.complete){ri=0,vo=null;var Se=oe.sibling;if(Se!==null)Mn=Se;else{var qe=oe.return;qe!==null?(Mn=qe,Rf(qe)):Mn=null}break t}}ri=0,vo=null,fh(r,s,L,5);break;case 6:ri=0,vo=null,fh(r,s,L,6);break;case 8:Cf(),qi=6;break e;default:throw Error(y(462))}}$m();break}catch(tt){Fp(r,tt)}while(!0);return Ss=Io=null,Qe.H=x,Qe.A=P,Kn=p,Mn!==null?0:(mi=null,In=0,nl(),qi)}function $m(){for(;Mn!==null&&!io();)jm(Mn)}function jm(r){var s=Jr(r.alternate,r,vl);r.memoizedProps=r.pendingProps,s===null?Rf(r):Mn=s}function Ym(r){var s=r,p=s.alternate;switch(s.tag){case 15:case 0:s=Rm(p,s,s.pendingProps,s.type,void 0,In);break;case 11:s=Rm(p,s,s.pendingProps,s.type.render,s.ref,In);break;case 5:ta(s);default:_f(p,s),s=Mn=nf(s,vl),s=Jr(p,s,vl)}r.memoizedProps=r.pendingProps,s===null?Rf(r):Mn=s}function fh(r,s,p,x){Ss=Io=null,ta(s),As=null,sl=0;var P=s.return;try{if(af(r,P,s,p,In)){qi=1,ns(r,Ur(p,r.current)),Mn=null;return}}catch(L){if(P!==null)throw Mn=P,L;qi=1,ns(r,Ur(p,r.current)),Mn=null;return}s.flags&32768?(xn||x===1?r=!0:uu||(In&536870912)!==0?r=!1:(Ns=r=!0,(x===2||x===9||x===3||x===6)&&(x=St.current,x!==null&&x.tag===13&&(x.flags|=16384))),Xm(s,r)):Rf(s)}function Rf(r){var s=r;do{if((s.flags&32768)!==0){Xm(s,Ns);return}r=s.return;var p=Lm(s.alternate,s,vl);if(p!==null){Mn=p;return}if(s=s.sibling,s!==null){Mn=s;return}Mn=s=r}while(s!==null);qi===0&&(qi=5)}function Xm(r,s){do{var p=Kg(r.alternate,r);if(p!==null){p.flags&=32767,Mn=p;return}if(p=r.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!s&&(r=r.sibling,r!==null)){Mn=r;return}Mn=r=p}while(r!==null);qi=6,Mn=null}function Jm(r,s,p,x,P,L,$,oe,Se){r.cancelPendingCommit=null;do Pf();while(mr!==0);if((Kn&6)!==0)throw Error(y(327));if(s!==null){if(s===r.current)throw Error(y(177));if(L=s.lanes|s.childLanes,L|=tl,ii(r,p,L,$,oe,Se),r===mi&&(Mn=mi=null,In=0),uh=s,wl=r,ks=p,Np=L,Ef=P,Hm=x,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,ng(Us,function(){return tg(),null})):(r.callbackNode=null,r.callbackPriority=0),x=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||x){x=Qe.T,Qe.T=null,P=ft.p,ft.p=2,$=Kn,Kn|=4;try{Qg(r,s,p)}finally{Kn=$,ft.p=P,Qe.T=x}}mr=1,Wm(),Km(),Qm()}}function Wm(){if(mr===1){mr=0;var r=wl,s=uh,p=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||p){p=Qe.T,Qe.T=null;var x=ft.p;ft.p=2;var P=Kn;Kn|=4;try{bf(s,r);var L=Wp,$=Nc(r.containerInfo),oe=L.focusedElem,Se=L.selectionRange;if($!==oe&&oe&&oe.ownerDocument&&Lc(oe.ownerDocument.documentElement,oe)){if(Se!==null&&Gu(oe)){var qe=Se.start,tt=Se.end;if(tt===void 0&&(tt=qe),"selectionStart"in oe)oe.selectionStart=qe,oe.selectionEnd=Math.min(tt,oe.value.length);else{var ct=oe.ownerDocument||document,Ze=ct&&ct.defaultView||window;if(Ze.getSelection){var Je=Ze.getSelection(),kt=oe.textContent.length,Yt=Math.min(Se.start,kt),oi=Se.end===void 0?Yt:Math.min(Se.end,kt);!Je.extend&&Yt>oi&&($=oi,oi=Yt,Yt=$);var ze=Vu(oe,Yt),Ie=Vu(oe,oi);if(ze&&Ie&&(Je.rangeCount!==1||Je.anchorNode!==ze.node||Je.anchorOffset!==ze.offset||Je.focusNode!==Ie.node||Je.focusOffset!==Ie.offset)){var Ge=ct.createRange();Ge.setStart(ze.node,ze.offset),Je.removeAllRanges(),Yt>oi?(Je.addRange(Ge),Je.extend(Ie.node,Ie.offset)):(Ge.setEnd(Ie.node,Ie.offset),Je.addRange(Ge))}}}}for(ct=[],Je=oe;Je=Je.parentNode;)Je.nodeType===1&&ct.push({element:Je,left:Je.scrollLeft,top:Je.scrollTop});for(typeof oe.focus=="function"&&oe.focus(),oe=0;oe<ct.length;oe++){var lt=ct[oe];lt.element.scrollLeft=lt.left,lt.element.scrollTop=lt.top}}Ad=!!_d,Wp=_d=null}finally{Kn=P,ft.p=x,Qe.T=p}}r.current=s,mr=2}}function Km(){if(mr===2){mr=0;var r=wl,s=uh,p=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||p){p=Qe.T,Qe.T=null;var x=ft.p;ft.p=2;var P=Kn;Kn|=4;try{Ip(r,s.alternate,s)}finally{Kn=P,ft.p=x,Qe.T=p}}mr=3}}function Qm(){if(mr===4||mr===3){mr=0,Bs();var r=wl,s=uh,p=ks,x=Hm;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?mr=5:(mr=0,uh=wl=null,eg(r,r.pendingLanes));var P=r.pendingLanes;if(P===0&&(bl=null),it(p),s=s.stateNode,me&&typeof me.onCommitFiberRoot=="function")try{me.onCommitFiberRoot(ne,s,void 0,(s.current.flags&128)===128)}catch{}if(x!==null){s=Qe.T,P=ft.p,ft.p=2,Qe.T=null;try{for(var L=r.onRecoverableError,$=0;$<x.length;$++){var oe=x[$];L(oe.value,{componentStack:oe.stack})}}finally{Qe.T=s,ft.p=P}}(ks&3)!==0&&Pf(),sa(r),P=r.pendingLanes,(p&261930)!==0&&(P&42)!==0?r===kp?cd++:(cd=0,kp=r):cd=0,rs(0)}}function eg(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,eu(s)))}function Pf(){return Wm(),Km(),Qm(),tg()}function tg(){if(mr!==5)return!1;var r=wl,s=Np;Np=0;var p=it(ks),x=Qe.T,P=ft.p;try{ft.p=32>p?32:p,Qe.T=null,p=Ef,Ef=null;var L=wl,$=ks;if(mr=0,uh=wl=null,ks=0,(Kn&6)!==0)throw Error(y(331));var oe=Kn;if(Kn|=4,Vm(L.current),Pp(L,L.current,$,p),Kn=oe,rs(0,!1),me&&typeof me.onPostCommitFiberRoot=="function")try{me.onPostCommitFiberRoot(ne,L)}catch{}return!0}finally{ft.p=P,Qe.T=x,eg(r,s)}}function Op(r,s,p){s=Ur(p,s),s=uc(r.stateNode,s,2),r=Ws(r,s,2),r!==null&&(Nn(r,2),sa(r))}function Qn(r,s,p){if(r.tag===3)Op(r,r,p);else for(;s!==null;){if(s.tag===3){Op(s,r,p);break}else if(s.tag===1){var x=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(bl===null||!bl.has(x))){r=Ur(p,r),p=cc(2),x=Ws(s,p,2),x!==null&&(hc(p,x,s,r),Nn(x,2),sa(x));break}}s=s.return}}function Df(r,s,p){var x=r.pingCache;if(x===null){x=r.pingCache=new Gm;var P=new Set;x.set(s,P)}else P=x.get(s),P===void 0&&(P=new Set,x.set(s,P));P.has(p)||(Dp=!0,P.add(p),r=hu.bind(null,r,s,p),s.then(r,r))}function hu(r,s,p){var x=r.pingCache;x!==null&&x.delete(s),r.pingedLanes|=r.suspendedLanes&p,r.warmLanes&=~p,mi===r&&(In&p)===p&&(qi===4||qi===3&&(In&62914560)===In&&300>Di()-Sf?(Kn&2)===0&&hh(r,0):zp|=p,gc===In&&(gc=0)),sa(r)}function fd(r,s){s===0&&(s=Ot()),r=Mo(r,s),r!==null&&(Nn(r,s),sa(r))}function Up(r){var s=r.memoizedState,p=0;s!==null&&(p=s.retryLane),fd(r,p)}function n_(r,s){var p=0;switch(r.tag){case 31:case 13:var x=r.stateNode,P=r.memoizedState;P!==null&&(p=P.retryLane);break;case 19:x=r.stateNode;break;case 22:x=r.stateNode._retryCache;break;default:throw Error(y(314))}x!==null&&x.delete(s),fd(r,p)}function ng(r,s){return Ho(r,s)}var zf=null,ph=null,Vp=!1,Lf=!1,Gp=!1,Tl=0;function sa(r){r!==ph&&r.next===null&&(ph===null?zf=ph=r:ph=ph.next=r),Lf=!0,Vp||(Vp=!0,Hp())}function rs(r,s){if(!Gp&&Lf){Gp=!0;do for(var p=!1,x=zf;x!==null;){if(r!==0){var P=x.pendingLanes;if(P===0)var L=0;else{var $=x.suspendedLanes,oe=x.pingedLanes;L=(1<<31-Pe(42|r)+1)-1,L&=P&~($&~oe),L=L&201326741?L&201326741|1:L?L|2:0}L!==0&&(p=!0,pd(x,L))}else L=In,L=Ht(x,x===mi?L:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),(L&3)===0||Fn(x,L)||(p=!0,pd(x,L));x=x.next}while(p);Gp=!1}}function du(){qp()}function qp(){Lf=Vp=!1;var r=0;Tl!==0&&Hf()&&(r=Tl);for(var s=Di(),p=null,x=zf;x!==null;){var P=x.next,L=Nf(x,s);L===0?(x.next=null,p===null?zf=P:p.next=P,P===null&&(ph=p)):(p=x,(r!==0||(L&3)!==0)&&(Lf=!0)),x=P}mr!==0&&mr!==5||rs(r),Tl!==0&&(Tl=0)}function Nf(r,s){for(var p=r.suspendedLanes,x=r.pingedLanes,P=r.expirationTimes,L=r.pendingLanes&-62914561;0<L;){var $=31-Pe(L),oe=1<<$,Se=P[$];Se===-1?((oe&p)===0||(oe&x)!==0)&&(P[$]=Mt(oe,s)):Se<=s&&(r.expiredLanes|=oe),L&=~oe}if(s=mi,p=In,p=Ht(r,r===s?p:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x=r.callbackNode,p===0||r===s&&(ri===2||ri===9)||r.cancelPendingCommit!==null)return x!==null&&x!==null&&Dr(x),r.callbackNode=null,r.callbackPriority=0;if((p&3)===0||Fn(r,p)){if(s=p&-p,s===r.callbackPriority)return s;switch(x!==null&&Dr(x),it(p)){case 2:case 8:p=Ll;break;case 32:p=Us;break;case 268435456:p=Re;break;default:p=Us}return x=ig.bind(null,r),p=Ho(p,x),r.callbackPriority=s,r.callbackNode=p,s}return x!==null&&x!==null&&Dr(x),r.callbackPriority=2,r.callbackNode=null,2}function ig(r,s){if(mr!==0&&mr!==5)return r.callbackNode=null,r.callbackPriority=0,null;var p=r.callbackNode;if(Pf()&&r.callbackNode!==p)return null;var x=In;return x=Ht(r,r===mi?x:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x===0?null:(or(r,x,s),Nf(r,Di()),r.callbackNode!=null&&r.callbackNode===p?ig.bind(null,r):null)}function pd(r,s){if(Pf())return null;or(r,s,!0)}function Hp(){tm(function(){(Kn&6)!==0?Ho(Os,du):qp()})}function Zp(){if(Tl===0){var r=ol;r===0&&(r=et,et<<=1,(et&261888)===0&&(et=256)),Tl=r}return Tl}function kf(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:rn(""+r)}function Ff(r,s){var p=s.ownerDocument.createElement("input");return p.name=s.name,p.value=s.value,r.id&&p.setAttribute("form",r.id),s.parentNode.insertBefore(p,s),r=new FormData(r),p.parentNode.removeChild(p),r}function mh(r,s,p,x,P){if(s==="submit"&&p&&p.stateNode===P){var L=kf((P[dt]||null).action),$=x.submitter;$&&(s=(s=$[dt]||null)?kf(s.formAction):$.getAttribute("formAction"),s!==null&&(L=s,$=null));var oe=new Ru("action","action",null,x,P);r.push({event:oe,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(Tl!==0){var Se=$?Ff(P,$):new FormData(P);Ci(p,{pending:!0,data:Se,method:P.method,action:L},null,Se)}}else typeof L=="function"&&(oe.preventDefault(),Se=$?Ff(P,$):new FormData(P),Ci(p,{pending:!0,data:Se,method:P.method,action:L},L,Se))},currentTarget:P}]})}}for(var Bf=0;Bf<Oc.length;Bf++){var Of=Oc[Bf],$p=Of.toLowerCase(),rg=Of[0].toUpperCase()+Of.slice(1);lo($p,"on"+rg)}lo(Zu,"onAnimationEnd"),lo($u,"onAnimationIteration"),lo(Bc,"onAnimationStart"),lo("dblclick","onDoubleClick"),lo("focusin","onFocus"),lo("focusout","onBlur"),lo(el,"onTransitionRun"),lo(ju,"onTransitionStart"),lo(Xl,"onTransitionCancel"),lo(ao,"onTransitionEnd"),Gs("onMouseEnter",["mouseout","mouseover"]),Gs("onMouseLeave",["mouseout","mouseover"]),Gs("onPointerEnter",["pointerout","pointerover"]),Gs("onPointerLeave",["pointerout","pointerover"]),Sn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Sn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Sn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Sn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Sn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Sn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),og=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(fu));function sg(r,s){s=(s&4)!==0;for(var p=0;p<r.length;p++){var x=r[p],P=x.event;x=x.listeners;e:{var L=void 0;if(s)for(var $=x.length-1;0<=$;$--){var oe=x[$],Se=oe.instance,qe=oe.currentTarget;if(oe=oe.listener,Se!==L&&P.isPropagationStopped())break e;L=oe,P.currentTarget=qe;try{L(P)}catch(tt){ys(tt)}P.currentTarget=null,L=Se}else for($=0;$<x.length;$++){if(oe=x[$],Se=oe.instance,qe=oe.currentTarget,oe=oe.listener,Se!==L&&P.isPropagationStopped())break e;L=oe,P.currentTarget=qe;try{L(P)}catch(tt){ys(tt)}P.currentTarget=null,L=Se}}}}function Rn(r,s){var p=s[on];p===void 0&&(p=s[on]=new Set);var x=r+"__bubble";p.has(x)||(Vf(s,r,2,!1),p.add(x))}function jp(r,s,p){var x=0;s&&(x|=4),Vf(p,r,x,s)}var Uf="_reactListening"+Math.random().toString(36).slice(2);function Yp(r){if(!r[Uf]){r[Uf]=!0,kl.forEach(function(p){p!=="selectionchange"&&(og.has(p)||jp(p,!1,r),jp(p,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Uf]||(s[Uf]=!0,jp("selectionchange",!1,s))}}function Vf(r,s,p,x){switch(xc(s)){case 2:var P=Md;break;case 8:P=xg;break;default:P=pm}p=P.bind(null,s,p,r),P=void 0,!Nr||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(P=!0),x?P!==void 0?r.addEventListener(s,p,{capture:!0,passive:P}):r.addEventListener(s,p,!0):P!==void 0?r.addEventListener(s,p,{passive:P}):r.addEventListener(s,p,!1)}function Fa(r,s,p,x,P){var L=x;if((s&1)===0&&(s&2)===0&&x!==null)e:for(;;){if(x===null)return;var $=x.tag;if($===3||$===4){var oe=x.stateNode.containerInfo;if(oe===P)break;if($===4)for($=x.return;$!==null;){var Se=$.tag;if((Se===3||Se===4)&&$.stateNode.containerInfo===P)return;$=$.return}for(;oe!==null;){if($=hs(oe),$===null)return;if(Se=$.tag,Se===5||Se===6||Se===26||Se===27){x=L=$;continue e}oe=oe.parentNode}}x=x.return}Yn(function(){var qe=L,tt=Iu(p),ct=[];e:{var Ze=Fh.get(r);if(Ze!==void 0){var Je=Ru,kt=r;switch(r){case"keypress":if(so(p)===0)break e;case"keydown":case"keyup":Je=Si;break;case"focusin":kt="focus",Je=ga;break;case"focusout":kt="blur",Je=ga;break;case"beforeblur":case"afterblur":Je=ga;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Je=Xa;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Je=Pu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Je=_p;break;case Zu:case $u:case Bc:Je=Hd;break;case ao:Je=Rc;break;case"scroll":case"scrollend":Je=Ya;break;case"wheel":Je=Dh;break;case"copy":case"cut":case"paste":Je=Rh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Je=Ic;break;case"toggle":case"beforetoggle":Je=ql}var Yt=(s&4)!==0,oi=!Yt&&(r==="scroll"||r==="scrollend"),ze=Yt?Ze!==null?Ze+"Capture":null:Ze;Yt=[];for(var Ie=qe,Ge;Ie!==null;){var lt=Ie;if(Ge=lt.stateNode,lt=lt.tag,lt!==5&&lt!==26&&lt!==27||Ge===null||ze===null||(lt=So(Ie,ze),lt!=null&&Yt.push(gh(Ie,lt,Ge))),oi)break;Ie=Ie.return}0<Yt.length&&(Ze=new Je(Ze,kt,null,p,tt),ct.push({event:Ze,listeners:Yt}))}}if((s&7)===0){e:{if(Ze=r==="mouseover"||r==="pointerover",Je=r==="mouseout"||r==="pointerout",Ze&&p!==Ih&&(kt=p.relatedTarget||p.fromElement)&&(hs(kt)||kt[jt]))break e;if((Je||Ze)&&(Ze=tt.window===tt?tt:(Ze=tt.ownerDocument)?Ze.defaultView||Ze.parentWindow:window,Je?(kt=p.relatedTarget||p.toElement,Je=qe,kt=kt?hs(kt):null,kt!==null&&(oi=I(kt),Yt=kt.tag,kt!==oi||Yt!==5&&Yt!==27&&Yt!==6)&&(kt=null)):(Je=null,kt=qe),Je!==kt)){if(Yt=Xa,lt="onMouseLeave",ze="onMouseEnter",Ie="mouse",(r==="pointerout"||r==="pointerover")&&(Yt=Ic,lt="onPointerLeave",ze="onPointerEnter",Ie="pointer"),oi=Je==null?Ze:ds(Je),Ge=kt==null?Ze:ds(kt),Ze=new Yt(lt,Ie+"leave",Je,p,tt),Ze.target=oi,Ze.relatedTarget=Ge,lt=null,hs(tt)===qe&&(Yt=new Yt(ze,Ie+"enter",kt,p,tt),Yt.target=Ge,Yt.relatedTarget=oi,lt=Yt),oi=lt,Je&&kt)t:{for(Yt=ag,ze=Je,Ie=kt,Ge=0,lt=ze;lt;lt=Yt(lt))Ge++;lt=0;for(var Zt=Ie;Zt;Zt=Yt(Zt))lt++;for(;0<Ge-lt;)ze=Yt(ze),Ge--;for(;0<lt-Ge;)Ie=Yt(Ie),lt--;for(;Ge--;){if(ze===Ie||Ie!==null&&ze===Ie.alternate){Yt=ze;break t}ze=Yt(ze),Ie=Yt(Ie)}Yt=null}else Yt=null;Je!==null&&Xp(ct,Ze,Je,Yt,!1),kt!==null&&oi!==null&&Xp(ct,oi,kt,Yt,!0)}}e:{if(Ze=qe?ds(qe):window,Je=Ze.nodeName&&Ze.nodeName.toLowerCase(),Je==="select"||Je==="input"&&Ze.type==="file")var $n=va;else if(Dc(Ze))if(zh)$n=ef;else{$n=Qd;var Ft=yp}else Je=Ze.nodeName,!Je||Je.toLowerCase()!=="input"||Ze.type!=="checkbox"&&Ze.type!=="radio"?qe&&Za(qe.elementType)&&($n=va):$n=Uu;if($n&&($n=$n(r,qe))){zc(ct,$n,p,tt);break e}Ft&&Ft(r,Ze,qe),r==="focusout"&&qe&&Ze.type==="number"&&qe.memoizedProps.value!=null&&Mu(Ze,"number",Ze.value)}switch(Ft=qe?ds(qe):window,r){case"focusin":(Dc(Ft)||Ft.contentEditable==="true")&&(Ao=Ft,qu=qe,Hu=null);break;case"focusout":Hu=qu=Ao=null;break;case"mousedown":Fc=!0;break;case"contextmenu":case"mouseup":case"dragend":Fc=!1,tf(ct,p,tt);break;case"selectionchange":if(kc)break;case"keydown":case"keyup":tf(ct,p,tt)}var Gt;if(Li)e:{switch(r){case"compositionstart":var Cn="onCompositionStart";break e;case"compositionend":Cn="onCompositionEnd";break e;case"compositionupdate":Cn="onCompositionUpdate";break e}Cn=void 0}else jo?ku(r,p)&&(Cn="onCompositionEnd"):r==="keydown"&&p.keyCode===229&&(Cn="onCompositionStart");Cn&&(jl&&p.locale!=="ko"&&(jo||Cn!=="onCompositionStart"?Cn==="onCompositionEnd"&&jo&&(Gt=pa()):(oo=tt,ms="value"in oo?oo.value:oo.textContent,jo=!0)),Ft=md(qe,Cn),0<Ft.length&&(Cn=new Ph(Cn,r,null,p,tt),ct.push({event:Cn,listeners:Ft}),Gt?Cn.data=Gt:(Gt=Yd(p),Gt!==null&&(Cn.data=Gt)))),(Gt=$l?Pc(r,p):Xd(r,p))&&(Cn=md(qe,"onBeforeInput"),0<Cn.length&&(Ft=new Ph("onBeforeInput","beforeinput",null,p,tt),ct.push({event:Ft,listeners:Cn}),Ft.data=Gt)),mh(ct,r,qe,p,tt)}sg(ct,s)})}function gh(r,s,p){return{instance:r,listener:s,currentTarget:p}}function md(r,s){for(var p=s+"Capture",x=[];r!==null;){var P=r,L=P.stateNode;if(P=P.tag,P!==5&&P!==26&&P!==27||L===null||(P=So(r,p),P!=null&&x.unshift(gh(r,P,L)),P=So(r,s),P!=null&&x.push(gh(r,P,L))),r.tag===3)return x;r=r.return}return[]}function ag(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Xp(r,s,p,x,P){for(var L=s._reactName,$=[];p!==null&&p!==x;){var oe=p,Se=oe.alternate,qe=oe.stateNode;if(oe=oe.tag,Se!==null&&Se===x)break;oe!==5&&oe!==26&&oe!==27||qe===null||(Se=qe,P?(qe=So(p,L),qe!=null&&$.unshift(gh(p,qe,Se))):P||(qe=So(p,L),qe!=null&&$.push(gh(p,qe,Se)))),p=p.return}$.length!==0&&r.push({event:s,listeners:$})}var lg=/\r\n?/g,ug=/\u0000|\uFFFD/g;function gd(r){return(typeof r=="string"?r:""+r).replace(lg,`
`).replace(ug,"")}function Jp(r,s){return s=gd(s),gd(r)===s}function Zn(r,s,p,x,P,L){switch(p){case"children":typeof x=="string"?s==="body"||s==="textarea"&&x===""||qs(r,x):(typeof x=="number"||typeof x=="bigint")&&s!=="body"&&qs(r,""+x);break;case"className":ps(r,"class",x);break;case"tabIndex":ps(r,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":ps(r,p,x);break;case"style":Mc(r,x,L);break;case"data":if(s!=="object"){ps(r,"data",x);break}case"src":case"href":if(x===""&&(s!=="a"||p!=="href")){r.removeAttribute(p);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(p);break}x=rn(""+x),r.setAttribute(p,x);break;case"action":case"formAction":if(typeof x=="function"){r.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof L=="function"&&(p==="formAction"?(s!=="input"&&Zn(r,s,"name",P.name,P,null),Zn(r,s,"formEncType",P.formEncType,P,null),Zn(r,s,"formMethod",P.formMethod,P,null),Zn(r,s,"formTarget",P.formTarget,P,null)):(Zn(r,s,"encType",P.encType,P,null),Zn(r,s,"method",P.method,P,null),Zn(r,s,"target",P.target,P,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(p);break}x=rn(""+x),r.setAttribute(p,x);break;case"onClick":x!=null&&(r.onclick=$o);break;case"onScroll":x!=null&&Rn("scroll",r);break;case"onScrollEnd":x!=null&&Rn("scrollend",r);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(y(61));if(p=x.__html,p!=null){if(P.children!=null)throw Error(y(60));r.innerHTML=p}}break;case"multiple":r.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":r.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){r.removeAttribute("xlink:href");break}p=rn(""+x),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(p,""+x):r.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(p,""):r.removeAttribute(p);break;case"capture":case"download":x===!0?r.setAttribute(p,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(p,x):r.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?r.setAttribute(p,x):r.removeAttribute(p);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?r.removeAttribute(p):r.setAttribute(p,x);break;case"popover":Rn("beforetoggle",r),Rn("toggle",r),Eu(r,"popover",x);break;case"xlinkActuate":To(r,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":To(r,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":To(r,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":To(r,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":To(r,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":To(r,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":To(r,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":To(r,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":To(r,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":Eu(r,"is",x);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=fa.get(p)||p,Eu(r,p,x))}}function Gf(r,s,p,x,P,L){switch(p){case"style":Mc(r,x,L);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(y(61));if(p=x.__html,p!=null){if(P.children!=null)throw Error(y(60));r.innerHTML=p}}break;case"children":typeof x=="string"?qs(r,x):(typeof x=="number"||typeof x=="bigint")&&qs(r,""+x);break;case"onScroll":x!=null&&Rn("scroll",r);break;case"onScrollEnd":x!=null&&Rn("scrollend",r);break;case"onClick":x!=null&&(r.onclick=$o);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Er.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(P=p.endsWith("Capture"),s=p.slice(2,P?p.length-7:void 0),L=r[dt]||null,L=L!=null?L[p]:null,typeof L=="function"&&r.removeEventListener(s,L,P),typeof x=="function")){typeof L!="function"&&L!==null&&(p in r?r[p]=null:r.hasAttribute(p)&&r.removeAttribute(p)),r.addEventListener(s,x,P);break e}p in r?r[p]=x:x===!0?r.setAttribute(p,""):Eu(r,p,x)}}}function Tr(r,s,p){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Rn("error",r),Rn("load",r);var x=!1,P=!1,L;for(L in p)if(p.hasOwnProperty(L)){var $=p[L];if($!=null)switch(L){case"src":x=!0;break;case"srcSet":P=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(y(137,s));default:Zn(r,s,L,$,p,null)}}P&&Zn(r,s,"srcSet",p.srcSet,p,null),x&&Zn(r,s,"src",p.src,p,null);return;case"input":Rn("invalid",r);var oe=L=$=P=null,Se=null,qe=null;for(x in p)if(p.hasOwnProperty(x)){var tt=p[x];if(tt!=null)switch(x){case"name":P=tt;break;case"type":$=tt;break;case"checked":Se=tt;break;case"defaultChecked":qe=tt;break;case"value":L=tt;break;case"defaultValue":oe=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(y(137,s));break;default:Zn(r,s,x,tt,p,null)}}Ac(r,L,oe,Se,qe,$,P,!1);return;case"select":Rn("invalid",r),x=$=L=null;for(P in p)if(p.hasOwnProperty(P)&&(oe=p[P],oe!=null))switch(P){case"value":L=oe;break;case"defaultValue":$=oe;break;case"multiple":x=oe;default:Zn(r,s,P,oe,p,null)}s=L,p=$,r.multiple=!!x,s!=null?da(r,!!x,s,!1):p!=null&&da(r,!!x,p,!0);return;case"textarea":Rn("invalid",r),L=P=x=null;for($ in p)if(p.hasOwnProperty($)&&(oe=p[$],oe!=null))switch($){case"value":x=oe;break;case"defaultValue":P=oe;break;case"children":L=oe;break;case"dangerouslySetInnerHTML":if(oe!=null)throw Error(y(91));break;default:Zn(r,s,$,oe,p,null)}Ol(r,x,P,L);return;case"option":for(Se in p)if(p.hasOwnProperty(Se)&&(x=p[Se],x!=null))switch(Se){case"selected":r.selected=x&&typeof x!="function"&&typeof x!="symbol";break;default:Zn(r,s,Se,x,p,null)}return;case"dialog":Rn("beforetoggle",r),Rn("toggle",r),Rn("cancel",r),Rn("close",r);break;case"iframe":case"object":Rn("load",r);break;case"video":case"audio":for(x=0;x<fu.length;x++)Rn(fu[x],r);break;case"image":Rn("error",r),Rn("load",r);break;case"details":Rn("toggle",r);break;case"embed":case"source":case"link":Rn("error",r),Rn("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(qe in p)if(p.hasOwnProperty(qe)&&(x=p[qe],x!=null))switch(qe){case"children":case"dangerouslySetInnerHTML":throw Error(y(137,s));default:Zn(r,s,qe,x,p,null)}return;default:if(Za(s)){for(tt in p)p.hasOwnProperty(tt)&&(x=p[tt],x!==void 0&&Gf(r,s,tt,x,p,void 0));return}}for(oe in p)p.hasOwnProperty(oe)&&(x=p[oe],x!=null&&Zn(r,s,oe,x,p,null))}function cg(r,s,p,x){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var P=null,L=null,$=null,oe=null,Se=null,qe=null,tt=null;for(Je in p){var ct=p[Je];if(p.hasOwnProperty(Je)&&ct!=null)switch(Je){case"checked":break;case"value":break;case"defaultValue":Se=ct;default:x.hasOwnProperty(Je)||Zn(r,s,Je,null,x,ct)}}for(var Ze in x){var Je=x[Ze];if(ct=p[Ze],x.hasOwnProperty(Ze)&&(Je!=null||ct!=null))switch(Ze){case"type":L=Je;break;case"name":P=Je;break;case"checked":qe=Je;break;case"defaultChecked":tt=Je;break;case"value":$=Je;break;case"defaultValue":oe=Je;break;case"children":case"dangerouslySetInnerHTML":if(Je!=null)throw Error(y(137,s));break;default:Je!==ct&&Zn(r,s,Ze,Je,x,ct)}}Au(r,$,oe,Se,qe,tt,L,P);return;case"select":Je=$=oe=Ze=null;for(L in p)if(Se=p[L],p.hasOwnProperty(L)&&Se!=null)switch(L){case"value":break;case"multiple":Je=Se;default:x.hasOwnProperty(L)||Zn(r,s,L,null,x,Se)}for(P in x)if(L=x[P],Se=p[P],x.hasOwnProperty(P)&&(L!=null||Se!=null))switch(P){case"value":Ze=L;break;case"defaultValue":oe=L;break;case"multiple":$=L;default:L!==Se&&Zn(r,s,P,L,x,Se)}s=oe,p=$,x=Je,Ze!=null?da(r,!!p,Ze,!1):!!x!=!!p&&(s!=null?da(r,!!p,s,!0):da(r,!!p,p?[]:"",!1));return;case"textarea":Je=Ze=null;for(oe in p)if(P=p[oe],p.hasOwnProperty(oe)&&P!=null&&!x.hasOwnProperty(oe))switch(oe){case"value":break;case"children":break;default:Zn(r,s,oe,null,x,P)}for($ in x)if(P=x[$],L=p[$],x.hasOwnProperty($)&&(P!=null||L!=null))switch($){case"value":Ze=P;break;case"defaultValue":Je=P;break;case"children":break;case"dangerouslySetInnerHTML":if(P!=null)throw Error(y(91));break;default:P!==L&&Zn(r,s,$,P,x,L)}Gd(r,Ze,Je);return;case"option":for(var kt in p)if(Ze=p[kt],p.hasOwnProperty(kt)&&Ze!=null&&!x.hasOwnProperty(kt))switch(kt){case"selected":r.selected=!1;break;default:Zn(r,s,kt,null,x,Ze)}for(Se in x)if(Ze=x[Se],Je=p[Se],x.hasOwnProperty(Se)&&Ze!==Je&&(Ze!=null||Je!=null))switch(Se){case"selected":r.selected=Ze&&typeof Ze!="function"&&typeof Ze!="symbol";break;default:Zn(r,s,Se,Ze,x,Je)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Yt in p)Ze=p[Yt],p.hasOwnProperty(Yt)&&Ze!=null&&!x.hasOwnProperty(Yt)&&Zn(r,s,Yt,null,x,Ze);for(qe in x)if(Ze=x[qe],Je=p[qe],x.hasOwnProperty(qe)&&Ze!==Je&&(Ze!=null||Je!=null))switch(qe){case"children":case"dangerouslySetInnerHTML":if(Ze!=null)throw Error(y(137,s));break;default:Zn(r,s,qe,Ze,x,Je)}return;default:if(Za(s)){for(var oi in p)Ze=p[oi],p.hasOwnProperty(oi)&&Ze!==void 0&&!x.hasOwnProperty(oi)&&Gf(r,s,oi,void 0,x,Ze);for(tt in x)Ze=x[tt],Je=p[tt],!x.hasOwnProperty(tt)||Ze===Je||Ze===void 0&&Je===void 0||Gf(r,s,tt,Ze,x,Je);return}}for(var ze in p)Ze=p[ze],p.hasOwnProperty(ze)&&Ze!=null&&!x.hasOwnProperty(ze)&&Zn(r,s,ze,null,x,Ze);for(ct in x)Ze=x[ct],Je=p[ct],!x.hasOwnProperty(ct)||Ze===Je||Ze==null&&Je==null||Zn(r,s,ct,Ze,x,Je)}function Vo(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function _h(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,p=performance.getEntriesByType("resource"),x=0;x<p.length;x++){var P=p[x],L=P.transferSize,$=P.initiatorType,oe=P.duration;if(L&&oe&&Vo($)){for($=0,oe=P.responseEnd,x+=1;x<p.length;x++){var Se=p[x],qe=Se.startTime;if(qe>oe)break;var tt=Se.transferSize,ct=Se.initiatorType;tt&&Vo(ct)&&(Se=Se.responseEnd,$+=tt*(Se<oe?1:(oe-qe)/(Se-qe)))}if(--x,s+=8*(L+$)/(P.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var _d=null,Wp=null;function yd(r){return r.nodeType===9?r:r.ownerDocument}function pu(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Kp(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function qf(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var mu=null;function Hf(){var r=window.event;return r&&r.type==="popstate"?r===mu?!1:(mu=r,!0):(mu=null,!1)}var Zf=typeof setTimeout=="function"?setTimeout:void 0,Qp=typeof clearTimeout=="function"?clearTimeout:void 0,em=typeof Promise=="function"?Promise:void 0,tm=typeof queueMicrotask=="function"?queueMicrotask:typeof em<"u"?function(r){return em.resolve(null).then(r).catch(nm)}:Zf;function nm(r){setTimeout(function(){throw r})}function gu(r){return r==="head"}function hg(r,s){var p=s,x=0;do{var P=p.nextSibling;if(r.removeChild(p),P&&P.nodeType===8)if(p=P.data,p==="/$"||p==="/&"){if(x===0){r.removeChild(P),wu(s);return}x--}else if(p==="$"||p==="$?"||p==="$~"||p==="$!"||p==="&")x++;else if(p==="html")yh(r.ownerDocument.documentElement);else if(p==="head"){p=r.ownerDocument.head,yh(p);for(var L=p.firstChild;L;){var $=L.nextSibling,oe=L.nodeName;L[Qt]||oe==="SCRIPT"||oe==="STYLE"||oe==="LINK"&&L.rel.toLowerCase()==="stylesheet"||p.removeChild(L),L=$}}else p==="body"&&yh(r.ownerDocument.body);p=P}while(p);wu(s)}function hn(r,s){var p=r;r=0;do{var x=p.nextSibling;if(p.nodeType===1?s?(p._stashedDisplay=p.style.display,p.style.display="none"):(p.style.display=p._stashedDisplay||"",p.getAttribute("style")===""&&p.removeAttribute("style")):p.nodeType===3&&(s?(p._stashedText=p.nodeValue,p.nodeValue=""):p.nodeValue=p._stashedText||""),x&&x.nodeType===8)if(p=x.data,p==="/$"){if(r===0)break;r--}else p!=="$"&&p!=="$?"&&p!=="$~"&&p!=="$!"||r++;p=x}while(p)}function aa(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var p=s;switch(s=s.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":aa(p),Ga(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}r.removeChild(p)}}function Mr(r,s,p,x){for(;r.nodeType===1;){var P=p;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!x&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(x){if(!r[Qt])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(L=r.getAttribute("rel"),L==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(L!==P.rel||r.getAttribute("href")!==(P.href==null||P.href===""?null:P.href)||r.getAttribute("crossorigin")!==(P.crossOrigin==null?null:P.crossOrigin)||r.getAttribute("title")!==(P.title==null?null:P.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(L=r.getAttribute("src"),(L!==(P.src==null?null:P.src)||r.getAttribute("type")!==(P.type==null?null:P.type)||r.getAttribute("crossorigin")!==(P.crossOrigin==null?null:P.crossOrigin))&&L&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var L=P.name==null?null:""+P.name;if(P.type==="hidden"&&r.getAttribute("name")===L)return r}else return r;if(r=os(r.nextSibling),r===null)break}return null}function la(r,s,p){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!p||(r=os(r.nextSibling),r===null))return null;return r}function _u(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=os(r.nextSibling),r===null))return null;return r}function Wr(r){return r.data==="$?"||r.data==="$~"}function Ki(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function gr(r,s){var p=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||p.readyState!=="loading")s();else{var x=function(){s(),p.removeEventListener("DOMContentLoaded",x)};p.addEventListener("DOMContentLoaded",x),r._reactRetry=x}}function os(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var xo=null;function _r(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var p=r.data;if(p==="/$"||p==="/&"){if(s===0)return os(r.nextSibling);s--}else p!=="$"&&p!=="$!"&&p!=="$?"&&p!=="$~"&&p!=="&"||s++}r=r.nextSibling}return null}function vd(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var p=r.data;if(p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"){if(s===0)return r;s--}else p!=="/$"&&p!=="/&"||s++}r=r.previousSibling}return null}function dg(r,s,p){switch(s=yd(p),r){case"html":if(r=s.documentElement,!r)throw Error(y(452));return r;case"head":if(r=s.head,!r)throw Error(y(453));return r;case"body":if(r=s.body,!r)throw Error(y(454));return r;default:throw Error(y(451))}}function yh(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);Ga(r)}var Ir=new Map,yc=new Set;function $f(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Ba=ft.d;ft.d={f:fg,r:pg,D:rm,C:Kr,L:ua,m:Qr,X:jf,S:vu,M:om};function fg(){var r=Ba.f(),s=hd();return r||s}function pg(r){var s=Vs(r);s!==null&&s.tag===5&&s.type==="form"?hr(s):Ba.r(r)}var yu=typeof document>"u"?null:document;function im(r,s,p){var x=yu;if(x&&typeof s=="string"&&s){var P=Lr(s);P='link[rel="'+r+'"][href="'+P+'"]',typeof p=="string"&&(P+='[crossorigin="'+p+'"]'),yc.has(P)||(yc.add(P),r={rel:r,crossOrigin:p,href:s},x.querySelector(P)===null&&(s=x.createElement("link"),Tr(s,"link",r),wi(s),x.head.appendChild(s)))}}function rm(r){Ba.D(r),im("dns-prefetch",r,null)}function Kr(r,s){Ba.C(r,s),im("preconnect",r,s)}function ua(r,s,p){Ba.L(r,s,p);var x=yu;if(x&&r&&s){var P='link[rel="preload"][as="'+Lr(s)+'"]';s==="image"&&p&&p.imageSrcSet?(P+='[imagesrcset="'+Lr(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(P+='[imagesizes="'+Lr(p.imageSizes)+'"]')):P+='[href="'+Lr(r)+'"]';var L=P;switch(s){case"style":L=vc(r);break;case"script":L=Sl(r)}Ir.has(L)||(r=K({rel:"preload",href:s==="image"&&p&&p.imageSrcSet?void 0:r,as:s},p),Ir.set(L,r),x.querySelector(P)!==null||s==="style"&&x.querySelector(vh(L))||s==="script"&&x.querySelector(xh(L))||(s=x.createElement("link"),Tr(s,"link",r),wi(s),x.head.appendChild(s)))}}function Qr(r,s){Ba.m(r,s);var p=yu;if(p&&r){var x=s&&typeof s.as=="string"?s.as:"script",P='link[rel="modulepreload"][as="'+Lr(x)+'"][href="'+Lr(r)+'"]',L=P;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":L=Sl(r)}if(!Ir.has(L)&&(r=K({rel:"modulepreload",href:r},s),Ir.set(L,r),p.querySelector(P)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(xh(L)))return}x=p.createElement("link"),Tr(x,"link",r),wi(x),p.head.appendChild(x)}}}function vu(r,s,p){Ba.S(r,s,p);var x=yu;if(x&&r){var P=fs(x).hoistableStyles,L=vc(r);s=s||"default";var $=P.get(L);if(!$){var oe={loading:0,preload:null};if($=x.querySelector(vh(L)))oe.loading=5;else{r=K({rel:"stylesheet",href:r,"data-precedence":s},p),(p=Ir.get(L))&&xd(r,p);var Se=$=x.createElement("link");wi(Se),Tr(Se,"link",r),Se._p=new Promise(function(qe,tt){Se.onload=qe,Se.onerror=tt}),Se.addEventListener("load",function(){oe.loading|=1}),Se.addEventListener("error",function(){oe.loading|=2}),oe.loading|=4,El($,s,x)}$={type:"stylesheet",instance:$,count:1,state:oe},P.set(L,$)}}}function jf(r,s){Ba.X(r,s);var p=yu;if(p&&r){var x=fs(p).hoistableScripts,P=Sl(r),L=x.get(P);L||(L=p.querySelector(xh(P)),L||(r=K({src:r,async:!0},s),(s=Ir.get(P))&&Yf(r,s),L=p.createElement("script"),wi(L),Tr(L,"link",r),p.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},x.set(P,L))}}function om(r,s){Ba.M(r,s);var p=yu;if(p&&r){var x=fs(p).hoistableScripts,P=Sl(r),L=x.get(P);L||(L=p.querySelector(xh(P)),L||(r=K({src:r,async:!0,type:"module"},s),(s=Ir.get(P))&&Yf(r,s),L=p.createElement("script"),wi(L),Tr(L,"link",r),p.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},x.set(P,L))}}function sm(r,s,p,x){var P=(P=Vt.current)?$f(P):null;if(!P)throw Error(y(446));switch(r){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(s=vc(p.href),p=fs(P).hoistableStyles,x=p.get(s),x||(x={type:"style",instance:null,count:0,state:null},p.set(s,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){r=vc(p.href);var L=fs(P).hoistableStyles,$=L.get(r);if($||(P=P.ownerDocument||P,$={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},L.set(r,$),(L=P.querySelector(vh(r)))&&!L._p&&($.instance=L,$.state.loading=5),Ir.has(r)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},Ir.set(r,p),L||lm(P,r,p,$.state))),s&&x===null)throw Error(y(528,""));return $}if(s&&x!==null)throw Error(y(529,""));return null;case"script":return s=p.async,p=p.src,typeof p=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Sl(p),p=fs(P).hoistableScripts,x=p.get(s),x||(x={type:"script",instance:null,count:0,state:null},p.set(s,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(y(444,r))}}function vc(r){return'href="'+Lr(r)+'"'}function vh(r){return'link[rel="stylesheet"]['+r+"]"}function am(r){return K({},r,{"data-precedence":r.precedence,precedence:null})}function lm(r,s,p,x){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?x.loading=1:(s=r.createElement("link"),x.preload=s,s.addEventListener("load",function(){return x.loading|=1}),s.addEventListener("error",function(){return x.loading|=2}),Tr(s,"link",p),wi(s),r.head.appendChild(s))}function Sl(r){return'[src="'+Lr(r)+'"]'}function xh(r){return"script[async]"+r}function um(r,s,p){if(s.count++,s.instance===null)switch(s.type){case"style":var x=r.querySelector('style[data-href~="'+Lr(p.href)+'"]');if(x)return s.instance=x,wi(x),x;var P=K({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return x=(r.ownerDocument||r).createElement("style"),wi(x),Tr(x,"style",P),El(x,p.precedence,r),s.instance=x;case"stylesheet":P=vc(p.href);var L=r.querySelector(vh(P));if(L)return s.state.loading|=4,s.instance=L,wi(L),L;x=am(p),(P=Ir.get(P))&&xd(x,P),L=(r.ownerDocument||r).createElement("link"),wi(L);var $=L;return $._p=new Promise(function(oe,Se){$.onload=oe,$.onerror=Se}),Tr(L,"link",x),s.state.loading|=4,El(L,p.precedence,r),s.instance=L;case"script":return L=Sl(p.src),(P=r.querySelector(xh(L)))?(s.instance=P,wi(P),P):(x=p,(P=Ir.get(L))&&(x=K({},p),Yf(x,P)),r=r.ownerDocument||r,P=r.createElement("script"),wi(P),Tr(P,"link",x),r.head.appendChild(P),s.instance=P);case"void":return null;default:throw Error(y(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(x=s.instance,s.state.loading|=4,El(x,p.precedence,r));return s.instance}function El(r,s,p){for(var x=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),P=x.length?x[x.length-1]:null,L=P,$=0;$<x.length;$++){var oe=x[$];if(oe.dataset.precedence===s)L=oe;else if(L!==P)break}L?L.parentNode.insertBefore(r,L.nextSibling):(s=p.nodeType===9?p.head:p,s.insertBefore(r,s.firstChild))}function xd(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function Yf(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var Xf=null;function cm(r,s,p){if(Xf===null){var x=new Map,P=Xf=new Map;P.set(p,x)}else P=Xf,x=P.get(p),x||(x=new Map,P.set(p,x));if(x.has(r))return x;for(x.set(r,null),p=p.getElementsByTagName(r),P=0;P<p.length;P++){var L=p[P];if(!(L[Qt]||L[vn]||r==="link"&&L.getAttribute("rel")==="stylesheet")&&L.namespaceURI!=="http://www.w3.org/2000/svg"){var $=L.getAttribute(s)||"";$=r+$;var oe=x.get($);oe?oe.push(L):x.set($,[L])}}return x}function bd(r,s,p){r=r.ownerDocument||r,r.head.insertBefore(p,s==="title"?r.querySelector("head > title"):null)}function Jf(r,s,p){if(p===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return r=s.disabled,typeof s.precedence=="string"&&r==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function wd(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function hm(r,s,p,x){if(p.type==="stylesheet"&&(typeof x.media!="string"||matchMedia(x.media).matches!==!1)&&(p.state.loading&4)===0){if(p.instance===null){var P=vc(x.href),L=s.querySelector(vh(P));if(L){s=L._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=Sd.bind(r),s.then(r,r)),p.state.loading|=4,p.instance=L,wi(L);return}L=s.ownerDocument||s,x=am(x),(P=Ir.get(P))&&xd(x,P),L=L.createElement("link"),wi(L);var $=L;$._p=new Promise(function(oe,Se){$.onload=oe,$.onerror=Se}),Tr(L,"link",x),p.instance=L}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(p,s),(s=p.state.preload)&&(p.state.loading&3)===0&&(r.count++,p=Sd.bind(r),s.addEventListener("load",p),s.addEventListener("error",p))}}var Td=0;function dm(r,s){return r.stylesheets&&r.count===0&&Cd(r,r.stylesheets),0<r.count||0<r.imgCount?function(p){var x=setTimeout(function(){if(r.stylesheets&&Cd(r,r.stylesheets),r.unsuspend){var L=r.unsuspend;r.unsuspend=null,L()}},6e4+s);0<r.imgBytes&&Td===0&&(Td=62500*_h());var P=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Cd(r,r.stylesheets),r.unsuspend)){var L=r.unsuspend;r.unsuspend=null,L()}},(r.imgBytes>Td?50:800)+s);return r.unsuspend=p,function(){r.unsuspend=null,clearTimeout(x),clearTimeout(P)}}:null}function Sd(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Cd(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Ed=null;function Cd(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Ed=new Map,s.forEach(mg,r),Ed=null,Sd.call(r))}function mg(r,s){if(!(s.state.loading&4)){var p=Ed.get(r);if(p)var x=p.get(null);else{p=new Map,Ed.set(r,p);for(var P=r.querySelectorAll("link[data-precedence],style[data-precedence]"),L=0;L<P.length;L++){var $=P[L];($.nodeName==="LINK"||$.getAttribute("media")!=="not all")&&(p.set($.dataset.precedence,$),x=$)}x&&p.set(null,x)}P=s.instance,$=P.getAttribute("data-precedence"),L=p.get($)||x,L===x&&p.set(null,P),p.set($,P),this.count++,x=Sd.bind(this),P.addEventListener("load",x),P.addEventListener("error",x),L?L.parentNode.insertBefore(P,L.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(P,r.firstChild)),s.state.loading|=4}}var bh={$$typeof:We,Provider:null,Consumer:null,_currentValue:Dt,_currentValue2:Dt,_threadCount:0};function i_(r,s,p,x,P,L,$,oe,Se){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Jt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Jt(0),this.hiddenUpdates=Jt(null),this.identifierPrefix=x,this.onUncaughtError=P,this.onCaughtError=L,this.onRecoverableError=$,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Se,this.incompleteTransitions=new Map}function fm(r,s,p,x,P,L,$,oe,Se,qe,tt,ct){return r=new i_(r,s,p,$,Se,qe,tt,ct,oe),s=1,L===!0&&(s|=24),L=uo(3,null,null,s),r.current=L,L.stateNode=r,s=Cs(),s.refCount++,r.pooledCache=s,s.refCount++,L.memoizedState={element:x,isDehydrated:p,cache:s},Kc(L),r}function gg(r){return r?(r=nn,r):nn}function _g(r,s,p,x,P,L){P=gg(P),x.context===null?x.context=P:x.pendingContext=P,x=Ps(s),x.payload={element:p},L=L===void 0?null:L,L!==null&&(x.callback=L),p=Ws(r,x,s),p!==null&&(Uo(p,r,s),Po(p,r,s))}function Wf(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var p=r.retryLane;r.retryLane=p!==0&&p<s?p:s}}function Kf(r,s){Wf(r,s),(r=r.alternate)&&Wf(r,s)}function yg(r){if(r.tag===13||r.tag===31){var s=Mo(r,67108864);s!==null&&Uo(s,r,67108864),Kf(r,67108864)}}function vg(r){if(r.tag===13||r.tag===31){var s=Oo();s=Oi(s);var p=Mo(r,s);p!==null&&Uo(p,r,s),Kf(r,s)}}var Ad=!0;function Md(r,s,p,x){var P=Qe.T;Qe.T=null;var L=ft.p;try{ft.p=2,pm(r,s,p,x)}finally{ft.p=L,Qe.T=P}}function xg(r,s,p,x){var P=Qe.T;Qe.T=null;var L=ft.p;try{ft.p=8,pm(r,s,p,x)}finally{ft.p=L,Qe.T=P}}function pm(r,s,p,x){if(Ad){var P=Id(x);if(P===null)Fa(r,s,x,wh,p),bg(r,x);else if(o_(P,r,s,p,x))x.stopPropagation();else if(bg(r,x),s&4&&-1<r_.indexOf(r)){for(;P!==null;){var L=Vs(P);if(L!==null)switch(L.tag){case 3:if(L=L.stateNode,L.current.memoizedState.isDehydrated){var $=Ce(L.pendingLanes);if($!==0){var oe=L;for(oe.pendingLanes|=2,oe.entangledLanes|=2;$;){var Se=1<<31-Pe($);oe.entanglements[1]|=Se,$&=~Se}sa(L),(Kn&6)===0&&(ud=Di()+500,rs(0))}}break;case 31:case 13:oe=Mo(L,2),oe!==null&&Uo(oe,L,2),hd(),Kf(L,2)}if(L=Id(x),L===null&&Fa(r,s,x,wh,p),L===P)break;P=L}P!==null&&x.stopPropagation()}else Fa(r,s,x,null,p)}}function Id(r){return r=Iu(r),Qf(r)}var wh=null;function Qf(r){if(wh=null,r=hs(r),r!==null){var s=I(r);if(s===null)r=null;else{var p=s.tag;if(p===13){if(r=S(s),r!==null)return r;r=null}else if(p===31){if(r=c(s),r!==null)return r;r=null}else if(p===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return wh=r,null}function xc(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Sr()){case Os:return 2;case Ll:return 8;case Us:case Nl:return 32;case Re:return 268435456;default:return 32}default:return 32}}var ep=!1,xu=null,Fs=null,bu=null,Rd=new Map,Th=new Map,Cl=[],r_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bg(r,s){switch(r){case"focusin":case"focusout":xu=null;break;case"dragenter":case"dragleave":Fs=null;break;case"mouseover":case"mouseout":bu=null;break;case"pointerover":case"pointerout":Rd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Th.delete(s.pointerId)}}function Pd(r,s,p,x,P,L){return r===null||r.nativeEvent!==L?(r={blockedOn:s,domEventName:p,eventSystemFlags:x,nativeEvent:L,targetContainers:[P]},s!==null&&(s=Vs(s),s!==null&&yg(s)),r):(r.eventSystemFlags|=x,s=r.targetContainers,P!==null&&s.indexOf(P)===-1&&s.push(P),r)}function o_(r,s,p,x,P){switch(s){case"focusin":return xu=Pd(xu,r,s,p,x,P),!0;case"dragenter":return Fs=Pd(Fs,r,s,p,x,P),!0;case"mouseover":return bu=Pd(bu,r,s,p,x,P),!0;case"pointerover":var L=P.pointerId;return Rd.set(L,Pd(Rd.get(L)||null,r,s,p,x,P)),!0;case"gotpointercapture":return L=P.pointerId,Th.set(L,Pd(Th.get(L)||null,r,s,p,x,P)),!0}return!1}function wg(r){var s=hs(r.target);if(s!==null){var p=I(s);if(p!==null){if(s=p.tag,s===13){if(s=S(p),s!==null){r.blockedOn=s,zr(r.priority,function(){vg(p)});return}}else if(s===31){if(s=c(p),s!==null){r.blockedOn=s,zr(r.priority,function(){vg(p)});return}}else if(s===3&&p.stateNode.current.memoizedState.isDehydrated){r.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Dd(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var p=Id(r.nativeEvent);if(p===null){p=r.nativeEvent;var x=new p.constructor(p.type,p);Ih=x,p.target.dispatchEvent(x),Ih=null}else return s=Vs(p),s!==null&&yg(s),r.blockedOn=p,!1;s.shift()}return!0}function Tg(r,s,p){Dd(r)&&p.delete(s)}function zd(){ep=!1,xu!==null&&Dd(xu)&&(xu=null),Fs!==null&&Dd(Fs)&&(Fs=null),bu!==null&&Dd(bu)&&(bu=null),Rd.forEach(Tg),Th.forEach(Tg)}function tp(r,s){r.blockedOn===s&&(r.blockedOn=null,ep||(ep=!0,u.unstable_scheduleCallback(u.unstable_NormalPriority,zd)))}var np=null;function Sg(r){np!==r&&(np=r,u.unstable_scheduleCallback(u.unstable_NormalPriority,function(){np===r&&(np=null);for(var s=0;s<r.length;s+=3){var p=r[s],x=r[s+1],P=r[s+2];if(typeof x!="function"){if(Qf(x||p)===null)continue;break}var L=Vs(p);L!==null&&(r.splice(s,3),s-=3,Ci(L,{pending:!0,data:P,method:p.method,action:x},x,P))}}))}function wu(r){function s(Se){return tp(Se,r)}xu!==null&&tp(xu,r),Fs!==null&&tp(Fs,r),bu!==null&&tp(bu,r),Rd.forEach(s),Th.forEach(s);for(var p=0;p<Cl.length;p++){var x=Cl[p];x.blockedOn===r&&(x.blockedOn=null)}for(;0<Cl.length&&(p=Cl[0],p.blockedOn===null);)wg(p),p.blockedOn===null&&Cl.shift();if(p=(r.ownerDocument||r).$$reactFormReplay,p!=null)for(x=0;x<p.length;x+=3){var P=p[x],L=p[x+1],$=P[dt]||null;if(typeof L=="function")$||Sg(p);else if($){var oe=null;if(L&&L.hasAttribute("formAction")){if(P=L,$=L[dt]||null)oe=$.formAction;else if(Qf(P)!==null)continue}else oe=$.action;typeof oe=="function"?p[x+1]=oe:(p.splice(x,3),x-=3),Sg(p)}}}function mm(){function r(L){L.canIntercept&&L.info==="react-transition"&&L.intercept({handler:function(){return new Promise(function($){return P=$})},focusReset:"manual",scroll:"manual"})}function s(){P!==null&&(P(),P=null),x||setTimeout(p,20)}function p(){if(!x&&!navigation.transition){var L=navigation.currentEntry;L&&L.url!=null&&navigation.navigate(L.url,{state:L.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var x=!1,P=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(p,100),function(){x=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),P!==null&&(P(),P=null)}}}function gm(r){this._internalRoot=r}ip.prototype.render=gm.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(y(409));var p=s.current,x=Oo();_g(p,x,r,s,null,null)},ip.prototype.unmount=gm.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;_g(r.current,2,null,r,null,null),hd(),s[jt]=null}};function ip(r){this._internalRoot=r}ip.prototype.unstable_scheduleHydration=function(r){if(r){var s=zi();r={blockedOn:null,target:r,priority:s};for(var p=0;p<Cl.length&&s!==0&&s<Cl[p].priority;p++);Cl.splice(p,0,r),p===0&&wg(r)}};var _m=a.version;if(_m!=="19.2.4")throw Error(y(527,_m,"19.2.4"));ft.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(y(188)):(r=Object.keys(r).join(","),Error(y(268,r)));return r=k(s),r=r!==null?G(r):null,r=r===null?null:r.stateNode,r};var Eg={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:Qe,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rp.isDisabled&&rp.supportsFiber)try{ne=rp.inject(Eg),me=rp}catch{}}return Tm.createRoot=function(r,s){if(!T(r))throw Error(y(299));var p=!1,x="",P=nh,L=na,$=ia;return s!=null&&(s.unstable_strictMode===!0&&(p=!0),s.identifierPrefix!==void 0&&(x=s.identifierPrefix),s.onUncaughtError!==void 0&&(P=s.onUncaughtError),s.onCaughtError!==void 0&&(L=s.onCaughtError),s.onRecoverableError!==void 0&&($=s.onRecoverableError)),s=fm(r,1,!1,null,null,p,x,null,P,L,$,mm),r[jt]=s.current,Yp(r),new gm(s)},Tm.hydrateRoot=function(r,s,p){if(!T(r))throw Error(y(299));var x=!1,P="",L=nh,$=na,oe=ia,Se=null;return p!=null&&(p.unstable_strictMode===!0&&(x=!0),p.identifierPrefix!==void 0&&(P=p.identifierPrefix),p.onUncaughtError!==void 0&&(L=p.onUncaughtError),p.onCaughtError!==void 0&&($=p.onCaughtError),p.onRecoverableError!==void 0&&(oe=p.onRecoverableError),p.formState!==void 0&&(Se=p.formState)),s=fm(r,1,!0,s,p??null,x,P,Se,L,$,oe,mm),s.context=gg(null),p=s.current,x=Oo(),x=Oi(x),P=Ps(x),P.callback=null,Ws(p,P,x),p=x,s.current.lanes=p,Nn(s,p),sa(s),r[jt]=s.current,Yp(r),new ip(s)},Tm.version="19.2.4",Tm}var xy;function Mx(){if(xy)return __.exports;xy=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(a){console.error(a)}}return u(),__.exports=Ax(),__.exports}var Ix=Mx();const Rx=ov(Ix);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sv=(...u)=>u.filter((a,f,y)=>!!a&&a.trim()!==""&&y.indexOf(a)===f).join(" ").trim();/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Px=u=>u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dx=u=>u.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,f,y)=>y?y.toUpperCase():f.toLowerCase());/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const by=u=>{const a=Dx(u);return a.charAt(0).toUpperCase()+a.slice(1)};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var zx={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lx=u=>{for(const a in u)if(a.startsWith("aria-")||a==="role"||a==="title")return!0;return!1};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nx=Tn.forwardRef(({color:u="currentColor",size:a=24,strokeWidth:f=2,absoluteStrokeWidth:y,className:T="",children:I,iconNode:S,...c},F)=>Tn.createElement("svg",{ref:F,...zx,width:a,height:a,stroke:u,strokeWidth:y?Number(f)*24/Number(a):f,className:sv("lucide",T),...!I&&!Lx(c)&&{"aria-hidden":"true"},...c},[...S.map(([k,G])=>Tn.createElement(k,G)),...Array.isArray(I)?I:[I]]));/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $i=(u,a)=>{const f=Tn.forwardRef(({className:y,...T},I)=>Tn.createElement(Nx,{ref:I,iconNode:a,className:sv(`lucide-${Px(by(u))}`,`lucide-${u}`,y),...T}));return f.displayName=by(u),f};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kx=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Ng=$i("activity",kx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fx=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],Mg=$i("building",Fx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bx=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Ox=$i("calendar",Bx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ux=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Vx=$i("chevron-right",Ux);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gx=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],wy=$i("circle-alert",Gx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qx=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Hx=$i("circle-check-big",qx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zx=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],$x=$i("cpu",Zx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jx=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Yx=$i("dollar-sign",jx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xx=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Jx=$i("external-link",Xx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wx=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Kx=$i("eye",Wx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qx=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],E_=$i("globe",Qx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eb=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],tb=$i("grid-3x3",eb);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nb=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],ib=$i("house",nb);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rb=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ty=$i("log-out",rb);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ob=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Fd=$i("map-pin",ob);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sb=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],ab=$i("maximize-2",sb);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lb=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],ub=$i("minimize-2",lb);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cb=[["polygon",{points:"12 2 19 21 12 17 5 21 12 2",key:"x8c0qg"}]],hb=$i("navigation-2",cb);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const db=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],fb=$i("network",db);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pb=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],mb=$i("send",pb);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gb=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Sy=$i("shield",gb);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _b=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],yb=$i("sparkles",_b);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vb=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],xb=$i("user",vb);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bb=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],wb=$i("users",bb);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tb=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],C_=$i("x",Tb);var pn=(u=>(u.SAFETY_SENTINEL="SAFETY_SENTINEL",u.SPATIAL_ARCHITECT="SPATIAL_ARCHITECT",u.REPUTATION_STEWARD="REPUTATION_STEWARD",u.MERCHANT_PULSE="MERCHANT_PULSE",u.TENANT_CONCIERGE="TENANT_CONCIERGE",u.INFRA_JANITOR="INFRA_JANITOR",u.SETTLEMENT_MEDIATOR="SETTLEMENT_MEDIATOR",u.CITY_CORE="CITY_CORE",u))(pn||{});const Su={lat:41.8781,lng:-87.6298},kg={[pn.CITY_CORE]:{id:pn.CITY_CORE,name:"Neo-Chicago Core",role:"Central Intelligence",color:"bg-slate-500",description:"The foundation of the Twin-City OS, coordinating all sub-agents.",icon:"",avatar:"https://api.dicebear.com/7.x/bottts-neutral/svg?seed=Core&backgroundColor=020617,64748b",did:"did:twin:chi:core:0x000",walletAddress:"0x0000...0000",status:"ACTIVE",creditScore:1e3,embodiedTask:"City-wide resource orchestration.",jsonFeatures:["global_sync_state","active_agent_count"]},[pn.SAFETY_SENTINEL]:{id:pn.SAFETY_SENTINEL,name:"AlphaChicago Safety Sentinel",role:"",color:"bg-red-500",description:"",icon:"",avatar:"https://api.dicebear.com/7.x/bottts-neutral/svg?seed=Safety&backgroundColor=020617,ef4444",did:"did:twin:chi:agent:safety:0x84f",walletAddress:"0x321a...89bc",status:"ACTIVE",creditScore:998,embodiedTask:" 3D  2026 ",jsonFeatures:["safety_score","surveillance_coverage_index","lighting_analysis"]},[pn.SPATIAL_ARCHITECT]:{id:pn.SPATIAL_ARCHITECT,name:"Spatial Architect",role:"/",color:"bg-emerald-500",description:" 3D ",icon:"",avatar:"https://api.dicebear.com/7.x/bottts-neutral/svg?seed=Spatial&backgroundColor=020617,10b981",did:"did:twin:chi:agent:spatial:0x12d",walletAddress:"0x9522...bafe5",status:"ACTIVE",creditScore:845,embodiedTask:" Google  3D ",jsonFeatures:["three_js_model_nodes","topology_graph","lux_lighting_map"]},[pn.REPUTATION_STEWARD]:{id:pn.REPUTATION_STEWARD,name:"Community Reputation Steward",role:"",color:"bg-emerald-400",description:"",icon:"",avatar:"https://api.dicebear.com/7.x/bottts-neutral/svg?seed=Reputation&backgroundColor=020617,34d399",did:"did:twin:chi:agent:credit:0x44c",walletAddress:"0x17f8...1689",status:"ACTIVE",creditScore:992,embodiedTask:"/ (Credit Score)",jsonFeatures:["credit_level","risk_warning_index","neighborhood_trust_score"]},[pn.MERCHANT_PULSE]:{id:pn.MERCHANT_PULSE,name:"Merchant Pulse",role:"",color:"bg-amber-500",description:"",icon:"",avatar:"https://api.dicebear.com/7.x/bottts-neutral/svg?seed=Merchant&backgroundColor=020617,f59e0b",did:"did:twin:chi:agent:merchant:0x99b",walletAddress:"0x5c90...03e1",status:"ACTIVE",creditScore:780,embodiedTask:" (Foot traffic)",jsonFeatures:["live_traffic_index","merchant_status_map","proximity_bonus"]},[pn.TENANT_CONCIERGE]:{id:pn.TENANT_CONCIERGE,name:"Tenant Concierge",role:"",color:"bg-blue-400",description:"",icon:"",avatar:"https://api.dicebear.com/7.x/bottts-neutral/svg?seed=Tenant&backgroundColor=020617,60a5fa",did:"did:twin:chi:agent:concierge:0xcc1",walletAddress:"0xdead...128",status:"ACTIVE",creditScore:915,embodiedTask:"",jsonFeatures:["lifestyle_match_rate","virtual_tour_nodes","commute_optimization"]},[pn.INFRA_JANITOR]:{id:pn.INFRA_JANITOR,name:"Infrastructure Janitor",role:"",color:"bg-rose-500",description:"",icon:"",avatar:"https://api.dicebear.com/7.x/bottts-neutral/svg?seed=Infra&backgroundColor=020617,f43f5e",did:"did:twin:chi:agent:infra:0x111",walletAddress:"0x1111...aaaa",status:"SYNCING",creditScore:889,embodiedTask:" Wi-Fi",jsonFeatures:["hardware_fault_nodes","maintenance_schedule","wifi_signal_heatmap"]},[pn.SETTLEMENT_MEDIATOR]:{id:pn.SETTLEMENT_MEDIATOR,name:"Settlement Mediator",role:"",color:"bg-purple-500",description:"",icon:"",avatar:"https://api.dicebear.com/7.x/bottts-neutral/svg?seed=Settlement&backgroundColor=020617,a855f7",did:"did:twin:chi:agent:mediator:0x222",walletAddress:"0x2222...bbbb",status:"ACTIVE",creditScore:999,embodiedTask:"",jsonFeatures:["transaction_status","contract_summary_hash","dispute_resolution_state"]}},Ey=[{id:"listing-001",name:"Aqua Luxury Studio (Listing)",category:"RESIDENTIAL",address:"225 N Columbus Dr, Chicago, IL 60601",coordinates:{lat:41.8867,lng:-87.6201},specs:{height:"822 ft",units:1,occupancy:"Available"},safetyScore:97,rent:"2800 USD/mo",yearBuilt:2009,description:"24",securityLevel:"HIGH",nearbyFacilities:["","","","",""],availability:!0},{id:"listing-002",name:"River Plaza Loft (Listing)",category:"RESIDENTIAL",address:"150 N Riverside Plaza, Chicago, IL 60606",coordinates:{lat:41.8825,lng:-87.639},specs:{height:"747 ft",units:1,occupancy:"Available"},safetyScore:96,rent:"3150 USD/mo",yearBuilt:2015,description:"",securityLevel:"HIGH",nearbyFacilities:["","","","",""],availability:!0},{id:"listing-003",name:"Millennium View Condo (Listing)",category:"RESIDENTIAL",address:"130 E Randolph St, Chicago, IL 60601",coordinates:{lat:41.8845,lng:-87.6235},specs:{height:"400 ft",units:1,occupancy:"Available"},safetyScore:99,rent:"2600 USD/mo",yearBuilt:2018,description:"",securityLevel:"HIGH",nearbyFacilities:["","","","",""],availability:!0},{id:"landmark-aic",name:"Art Institute of Chicago",category:"SIGHTSEEING",address:"111 S Michigan Ave, Chicago, IL 60603",coordinates:{lat:41.8796,lng:-87.6237},specs:{height:"N/A",units:0,occupancy:"Peak"},safetyScore:98,yearBuilt:1893,description:"",securityLevel:"HIGH",nearbyFacilities:["","","","",""]},{id:"commercial-001",name:"The Shops at North Bridge",category:"LANDMARK",address:"520 N Michigan Ave, Chicago, IL 60611",coordinates:{lat:41.8915,lng:-87.6245},specs:{height:"N/A",units:0,occupancy:"High"},safetyScore:95,description:"",securityLevel:"MEDIUM",nearbyFacilities:["","","","",""]}],Ig=({type:u,userAvatar:a,showMinimize:f=!1})=>{if(u==="USER")return _e.jsx("div",{className:"w-full h-full rounded-xl overflow-hidden border border-blue-500/50 bg-blue-500/10 flex items-center justify-center",children:a?_e.jsx("img",{src:a,alt:"User",className:"w-full h-full object-cover"}):_e.jsx(xb,{className:"w-4 h-4 text-blue-400"})});const y=kg[u];return _e.jsxs("div",{className:"w-full h-full rounded-xl overflow-hidden border border-white/10 bg-slate-900 flex items-center justify-center shadow-inner relative group",children:[_e.jsx("img",{src:y.avatar,alt:y.name,className:"w-full h-full object-cover"}),f&&_e.jsx("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity",children:_e.jsx(ub,{size:16,className:"text-white"})})]})},Sb=({messages:u,onSendMessage:a,activeAgent:f,isTyping:y,isCollapsed:T,onToggleCollapse:I})=>{const[S,c]=Tn.useState(""),F=Tn.useRef(null);Tn.useEffect(()=>{F.current&&!T&&(F.current.scrollTop=F.current.scrollHeight)},[u,y,T]);const k=K=>{K.preventDefault(),S.trim()&&(a(S),c(""))},G=kg[f]||kg[pn.CITY_CORE];return T?_e.jsx("button",{onClick:I,className:"w-full h-full flex items-center justify-center hover:bg-white/5 transition-all p-1 group relative",children:_e.jsxs("div",{className:"w-full h-full relative",children:[_e.jsx(Ig,{type:f}),_e.jsx("div",{className:"absolute inset-0 bg-blue-600/20 opacity-0 group-hover:opacity-100 flex items-center justify-center rounded-xl transition-all",children:_e.jsx(ab,{size:20,className:"text-white animate-pulse"})})]})}):_e.jsxs("div",{className:"flex flex-col h-full overflow-hidden bg-[#0f172a]/80 backdrop-blur-xl animate-in fade-in zoom-in-95 duration-300",children:[_e.jsx("div",{className:"p-4 border-b border-white/10 flex items-center justify-between bg-white/5",children:_e.jsxs("div",{className:"flex items-center gap-4",children:[_e.jsxs("button",{onClick:I,className:"w-12 h-12 relative group hover:scale-105 transition-all active:scale-95",children:[_e.jsx(Ig,{type:f,showMinimize:!0}),_e.jsx("div",{className:`absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-4 border-[#020617] animate-pulse ${G.color}`})]}),_e.jsxs("div",{children:[_e.jsxs("div",{className:"flex items-center gap-2",children:[_e.jsx("h3",{className:"text-sm font-bold tracking-widest uppercase text-white/90",children:G.name}),_e.jsx(yb,{size:12,className:"text-blue-400 animate-pulse"})]}),_e.jsx("p",{className:"text-[10px] font-mono text-white/40 uppercase tracking-tighter",children:G.role})]})]})}),_e.jsxs("div",{ref:F,className:"flex-1 overflow-y-auto p-5 space-y-6 bg-gradient-to-b from-transparent to-blue-500/5",children:[u.map(K=>{var Le;const ee=K.sender!=="USER"?kg[K.sender]:null,ye=((Le=K.metadata)==null?void 0:Le.grounding)||[];return _e.jsxs("div",{className:`flex gap-4 animate-in fade-in slide-in-from-bottom-2 duration-300 ${K.sender==="USER"?"flex-row-reverse":""}`,children:[_e.jsx("div",{className:"w-10 h-10 flex-shrink-0 mt-1",children:_e.jsx(Ig,{type:K.sender})}),_e.jsxs("div",{className:`flex flex-col gap-1.5 max-w-[85%] ${K.sender==="USER"?"items-end":"items-start"}`,children:[_e.jsx("div",{className:"flex items-center gap-2 px-1",children:_e.jsx("span",{className:"text-[10px] font-bold text-white/30 uppercase tracking-widest",children:K.sender==="USER"?"Authorized User":ee==null?void 0:ee.name})}),_e.jsxs("div",{className:`rounded-2xl p-4 text-sm leading-relaxed shadow-sm
                  ${K.sender==="USER"?"bg-blue-600/20 text-blue-50 border border-blue-500/20 rounded-tr-none":"bg-white/5 text-slate-200 border border-white/10 rounded-tl-none"}`,children:[_e.jsx("div",{className:"whitespace-pre-wrap",children:K.text}),ye.length>0&&_e.jsx("div",{className:"mt-4 pt-4 border-t border-white/5 flex flex-wrap gap-2",children:ye.map((Ne,se)=>{var We,gt,nt,zt;const Ye=((We=Ne.maps)==null?void 0:We.uri)||((gt=Ne.web)==null?void 0:gt.uri),st=((nt=Ne.maps)==null?void 0:nt.title)||((zt=Ne.web)==null?void 0:zt.title);return Ye?_e.jsxs("a",{href:Ye,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1.5 px-2 py-1 rounded bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/20 text-[10px] text-blue-400 font-mono transition-all",children:[_e.jsx(Fd,{size:10}),_e.jsx("span",{className:"truncate max-w-[150px]",children:st}),_e.jsx(Jx,{size:10,className:"opacity-50"})]},se):null})})]}),_e.jsx("span",{className:"text-[9px] font-mono text-white/20 px-1",children:K.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},K.id)}),y&&_e.jsxs("div",{className:"flex gap-4",children:[_e.jsx("div",{className:"w-10 h-10 flex-shrink-0 animate-pulse",children:_e.jsx(Ig,{type:f})}),_e.jsxs("div",{className:"flex flex-col gap-1.5",children:[_e.jsxs("span",{className:"text-[10px] font-bold text-white/30 uppercase tracking-widest px-1",children:[G.name," processing grounding..."]}),_e.jsx("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-4 rounded-tl-none",children:_e.jsxs("div",{className:"flex gap-1.5",children:[_e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-400/60 rounded-full animate-bounce"}),_e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-400/60 rounded-full animate-bounce [animation-delay:0.2s]"}),_e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-400/60 rounded-full animate-bounce [animation-delay:0.4s]"})]})})]})]})]}),_e.jsx("form",{onSubmit:k,className:"p-5 border-t border-white/10 bg-black/20",children:_e.jsxs("div",{className:"relative group",children:[_e.jsx("input",{type:"text",value:S,onChange:K=>c(K.target.value),placeholder:`Instruct @${f.toLowerCase()}...`,className:"w-full bg-slate-900 border border-white/10 rounded-2xl py-4 px-6 pr-16 focus:outline-none focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 transition-all text-sm placeholder:text-white/20 text-white shadow-inner"}),_e.jsx("button",{type:"submit",disabled:!S.trim(),className:"absolute right-2 top-1/2 -translate-y-1/2 p-3 bg-blue-600 hover:bg-blue-500 disabled:opacity-20 disabled:hover:bg-blue-600 rounded-xl transition-all text-white shadow-lg active:scale-95",children:_e.jsx(mb,{size:20})})]})})]})};var Fg={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.17.0/LICENSE.txt
 */var Eb=Fg.exports,Cy;function Cb(){return Cy||(Cy=1,(function(u,a){(function(f,y){u.exports=y()})(Eb,(function(){var f={},y={};function T(S,c,F){if(y[S]=F,S==="index"){var k="var sharedModule = {}; ("+y.shared+")(sharedModule); ("+y.worker+")(sharedModule);",G={};return y.shared(G),y.index(f,G),typeof window<"u"&&f.setWorkerUrl(window.URL.createObjectURL(new Blob([k],{type:"text/javascript"}))),f}}T("shared",["exports"],(function(S){function c(i,t,n,l){return new(n||(n=Promise))((function(d,g){function _(D){try{A(l.next(D))}catch(N){g(N)}}function w(D){try{A(l.throw(D))}catch(N){g(N)}}function A(D){var N;D.done?d(D.value):(N=D.value,N instanceof n?N:new n((function(O){O(N)}))).then(_,w)}A((l=l.apply(i,t||[])).next())}))}function F(i,t){this.x=i,this.y=t}function k(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var G,K;typeof SuppressedError=="function"&&SuppressedError,F.prototype={clone(){return new F(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,t){return this.clone()._rotateAround(i,t)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const t=i.x-this.x,n=i.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult(i){const t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const t=Math.cos(i),n=Math.sin(i),l=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=l,this},_rotateAround(i,t){const n=Math.cos(i),l=Math.sin(i),d=t.y+l*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-l*(this.y-t.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:F},F.convert=function(i){if(i instanceof F)return i;if(Array.isArray(i))return new F(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new F(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var ee=(function(){if(K)return G;function i(t,n,l,d){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=l,this.p2y=d}return K=1,G=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,d=0;d<8;d++){var g=this.sampleCurveX(l)-t;if(Math.abs(g)<n)return l;var _=this.sampleCurveDerivativeX(l);if(Math.abs(_)<1e-6)break;l-=g/_}var w=0,A=1;for(l=t,d=0;d<20&&(g=this.sampleCurveX(l),!(Math.abs(g-t)<n));d++)t>g?w=l:A=l,l=.5*(A-w)+w;return l},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},G})(),ye=k(ee);let Le,Ne;function se(){return Le==null&&(Le=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Le}function Ye(){if(Ne==null&&(Ne=!1,se())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<25;l++){const d=4*l;t.fillStyle=`rgb(${d},${d+1},${d+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let l=0;l<100;l++)if(l%4!=3&&n[l]!==l){Ne=!0;break}}}return Ne||!1}var st=1e-6,We=typeof Float32Array<"u"?Float32Array:Array;function gt(){var i=new We(9);return We!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function nt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function zt(){var i=new We(3);return We!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function _t(i){var t=i[0],n=i[1],l=i[2];return Math.sqrt(t*t+n*n+l*l)}function Ut(i,t,n){var l=new We(3);return l[0]=i,l[1]=t,l[2]=n,l}function At(i,t,n){return i[0]=t[0]+n[0],i[1]=t[1]+n[1],i[2]=t[2]+n[2],i}function Xt(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i}function tn(i,t,n){var l=t[0],d=t[1],g=t[2],_=n[0],w=n[1],A=n[2];return i[0]=d*A-g*w,i[1]=g*_-l*A,i[2]=l*w-d*_,i}var an,An=_t;function kn(i,t,n){var l=t[0],d=t[1],g=t[2],_=t[3];return i[0]=n[0]*l+n[4]*d+n[8]*g+n[12]*_,i[1]=n[1]*l+n[5]*d+n[9]*g+n[13]*_,i[2]=n[2]*l+n[6]*d+n[10]*g+n[14]*_,i[3]=n[3]*l+n[7]*d+n[11]*g+n[15]*_,i}function si(){var i=new We(4);return We!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Qe(i,t,n,l){var d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",g=Math.PI/360;t*=g,l*=g,n*=g;var _=Math.sin(t),w=Math.cos(t),A=Math.sin(n),D=Math.cos(n),N=Math.sin(l),O=Math.cos(l);switch(d){case"xyz":i[0]=_*D*O+w*A*N,i[1]=w*A*O-_*D*N,i[2]=w*D*N+_*A*O,i[3]=w*D*O-_*A*N;break;case"xzy":i[0]=_*D*O-w*A*N,i[1]=w*A*O-_*D*N,i[2]=w*D*N+_*A*O,i[3]=w*D*O+_*A*N;break;case"yxz":i[0]=_*D*O+w*A*N,i[1]=w*A*O-_*D*N,i[2]=w*D*N-_*A*O,i[3]=w*D*O+_*A*N;break;case"yzx":i[0]=_*D*O+w*A*N,i[1]=w*A*O+_*D*N,i[2]=w*D*N-_*A*O,i[3]=w*D*O-_*A*N;break;case"zxy":i[0]=_*D*O-w*A*N,i[1]=w*A*O+_*D*N,i[2]=w*D*N+_*A*O,i[3]=w*D*O-_*A*N;break;case"zyx":i[0]=_*D*O-w*A*N,i[1]=w*A*O+_*D*N,i[2]=w*D*N-_*A*O,i[3]=w*D*O+_*A*N;break;default:throw new Error("Unknown angle order "+d)}return i}function ft(){var i=new We(2);return We!=Float32Array&&(i[0]=0,i[1]=0),i}function Dt(i,t){var n=new We(2);return n[0]=i,n[1]=t,n}zt(),an=new We(4),We!=Float32Array&&(an[0]=0,an[1]=0,an[2]=0,an[3]=0),zt(),Ut(1,0,0),Ut(0,1,0),si(),si(),gt(),ft();const Lt=8192;function yn(i,t,n){return t*(Lt/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function Me(i,t){return(i%t+t)%t}function at(i,t,n){return i*(1-n)+t*n}function Et(i){if(i<=0)return 0;if(i>=1)return 1;const t=i*i,n=t*i;return 4*(i<.5?n:3*(i-t)+n-.75)}function Rt(i,t,n,l){const d=new ye(i,t,n,l);return g=>d.solve(g)}const $t=Rt(.25,.1,.25,1);function Vt(i,t,n){return Math.min(n,Math.max(t,i))}function mn(i,t,n){const l=n-t,d=((i-t)%l+l)%l+t;return d===t?n:d}function Nt(i,...t){for(const n of t)for(const l in n)i[l]=n[l];return i}let gn=1;function ei(i,t,n){const l={};for(const d in i)l[d]=t.call(this,i[d],d,i);return l}function bn(i,t,n){const l={};for(const d in i)t.call(this,i[d],d,i)&&(l[d]=i[d]);return l}function Pi(i){return Array.isArray(i)?i.map(Pi):typeof i=="object"&&i?ei(i,Pi):i}const er={};function wn(i){er[i]||(typeof console<"u"&&console.warn(i),er[i]=!0)}function ji(i,t,n){return(n.y-i.y)*(t.x-i.x)>(t.y-i.y)*(n.x-i.x)}function sr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let un=null;function ar(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const wo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ho(i,t,n,l,d){return c(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(i,{timestamp:0});try{const _=g==null?void 0:g.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const w=_.startsWith("BGR"),A=new Uint8ClampedArray(l*d*4);if(yield g.copyTo(A,(function(D,N,O,V,q){const j=4*Math.max(-N,0),Y=(Math.max(0,O)-O)*V*4+j,J=4*V,ie=Math.max(0,N),de=Math.max(0,O);return{rect:{x:ie,y:de,width:Math.min(D.width,N+V)-ie,height:Math.min(D.height,O+q)-de},layout:[{offset:Y,stride:J}]}})(i,t,n,l,d)),w)for(let D=0;D<A.length;D+=4){const N=A[D];A[D]=A[D+2],A[D+2]=N}return A}finally{g.close()}}))}let Dr,io;function Bs(i,t,n,l){return i.addEventListener(t,n,l),{unsubscribe:()=>{i.removeEventListener(t,n,l)}}}function Di(i){return i*Math.PI/180}function Sr(i){return i/Math.PI*180}const Os={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Ll={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Us="AbortError";class Nl extends Error{constructor(t=Us){super(t instanceof Error?t.message:t),this.name=Us,t instanceof Error&&t.stack&&(this.stack=t.stack)}}function Re(i){return i.name===Us}const W={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Q(i){return W.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const ne="global-dispatcher";class me extends Error{constructor(t,n,l,d){super(`AJAXError: ${n} (${t}): ${l}`),this.status=t,this.statusText=n,this.url=l,this.body=d}}const we=()=>sr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Pe=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=Q(i.url);if(l)return l(i,t);if(sr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:ne},t)}if(!(/^file:/.test(n=i.url)||/^file:/.test(we())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(l,d){return c(this,void 0,void 0,(function*(){const g=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:we(),signal:d.signal});let _,w;l.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");try{_=yield fetch(g)}catch(D){throw Re(D)?D:new me(0,D.message,l.url,new Blob)}if(!_.ok){const D=yield _.blob();throw new me(_.status,_.statusText,l.url,D)}w=l.type==="arrayBuffer"||l.type==="image"?_.arrayBuffer():l.type==="json"?_.json():_.text();const A=yield w;return d.signal.throwIfAborted(),{data:A,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}}))})(i,t);if(sr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:ne},t)}var n;return(function(l,d){return new Promise(((g,_)=>{var w;const A=new XMLHttpRequest;A.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(A.responseType="arraybuffer");for(const D in l.headers)A.setRequestHeader(D,l.headers[D]);l.type==="json"&&(A.responseType="text",!((w=l.headers)===null||w===void 0)&&w.Accept||A.setRequestHeader("Accept","application/json")),A.withCredentials=l.credentials==="include",A.onerror=()=>{_(new Error(A.statusText))},A.onload=()=>{if(!d.signal.aborted)if((A.status>=200&&A.status<300||A.status===0)&&A.response!==null){let D=A.response;if(l.type==="json")try{D=JSON.parse(A.response)}catch(N){return void _(N)}g({data:D,cacheControl:A.getResponseHeader("Cache-Control"),expires:A.getResponseHeader("Expires")})}else{const D=new Blob([A.response],{type:A.getResponseHeader("Content-Type")});_(new me(A.status,A.statusText,l.url,D))}},d.signal.addEventListener("abort",(()=>{A.abort(),_(new Nl(d.signal.reason))})),A.send(l.body)}))})(i,t)};function Be(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function Ee(i,t,n){n[i]&&n[i].indexOf(t)!==-1||(n[i]=n[i]||[],n[i].push(t))}function De(i,t,n){if(n&&n[i]){const l=n[i].indexOf(t);l!==-1&&n[i].splice(l,1)}}class et{constructor(t,n={}){Nt(this,n),this.type=t}}class $e extends et{constructor(t,n={}){super("error",Nt({error:t},n))}}class ut{on(t,n){return this._listeners=this._listeners||{},Ee(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return De(t,n,this._listeners),De(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Ee(t,n,this._oneTimeListeners),this):new Promise((l=>this.once(t,l)))}fire(t,n){typeof t=="string"&&(t=new et(t,n||{}));const l=t.type;if(this.listens(l)){t.target=this;const d=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const w of d)w.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const w of g)De(l,w,this._oneTimeListeners),w.call(this,t);const _=this._eventedParent;_&&(Nt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof $e&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var Ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const Ht=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Fn(i,t){const n={};for(const l in i)l!=="ref"&&(n[l]=i[l]);return Ht.forEach((l=>{l in t&&(n[l]=t[l])})),n}function Mt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!Mt(i[n],t[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const n in i)if(!Mt(i[n],t[n]))return!1;return!0}return i===t}function Ot(i,t){i.push(t)}function Jt(i,t,n){Ot(n,{command:"addSource",args:[i,t[i]]})}function Nn(i,t,n){Ot(t,{command:"removeSource",args:[i]}),n[i]=!0}function ii(i,t,n,l){Nn(i,n,l),Jt(i,t,n)}function Yi(i,t,n){let l;for(l in i[n])if(Object.prototype.hasOwnProperty.call(i[n],l)&&l!=="data"&&!Mt(i[n][l],t[n][l]))return!1;for(l in t[n])if(Object.prototype.hasOwnProperty.call(t[n],l)&&l!=="data"&&!Mt(i[n][l],t[n][l]))return!1;return!0}function Xi(i,t,n,l,d,g){i=i||{},t=t||{};for(const _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(Mt(i[_],t[_])||n.push({command:g,args:[l,_,t[_],d]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(i,_)&&(Mt(i[_],t[_])||n.push({command:g,args:[l,_,t[_],d]}))}function _i(i){return i.id}function Oi(i,t){return i[t.id]=t,i}class it{constructor(t,n,l,d){this.message=(t?`${t}: `:"")+l,d&&(this.identifier=d),n!=null&&n.__line__&&(this.line=n.__line__)}}function zi(i,...t){for(const n of t)for(const l in n)i[l]=n[l];return i}class zr extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Gr{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[l,d]of n)this.bindings[l]=d}concat(t){return new Gr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const vn={kind:"null"},dt={kind:"number"},jt={kind:"string"},on={kind:"boolean"},ro={kind:"color"},Cc={kind:"projectionDefinition"},cs={kind:"object"},Qt={kind:"value"},Ga={kind:"collator"},hs={kind:"formatted"},Vs={kind:"padding"},ds={kind:"colorArray"},fs={kind:"numberArray"},wi={kind:"resolvedImage"},kl={kind:"variableAnchorOffsetCollection"};function Er(i,t){return{kind:"array",itemType:i,N:t}}function Sn(i){if(i.kind==="array"){const t=Sn(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const Gs=[vn,dt,jt,on,ro,Cc,hs,cs,Er(Qt),Vs,fs,ds,wi,kl];function Fl(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Fl(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const n of Gs)if(!Fl(n,t))return null}}return`Expected ${Sn(i)} but found ${Sn(t)} instead.`}function Bl(i,t){return t.some((n=>n.kind===i.kind))}function ha(i,t){return t.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function Zo(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const Eu=.96422,ps=.82521,To=4/29,Pn=6/29,Ah=3*Pn*Pn,Ud=Pn*Pn*Pn,qa=Math.PI/180,Mh=180/Math.PI;function Cu(i){return(i%=360)<0&&(i+=360),i}function Vd([i,t,n,l]){let d,g;const _=Au((.2225045*(i=Lr(i))+.7168786*(t=Lr(t))+.0606169*(n=Lr(n)))/1);i===t&&t===n?d=g=_:(d=Au((.4360747*i+.3850649*t+.1430804*n)/Eu),g=Au((.0139322*i+.0971045*t+.7141733*n)/ps));const w=116*_-16;return[w<0?0:w,500*(d-_),200*(_-g),l]}function Lr(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Au(i){return i>Ud?Math.pow(i,1/3):i/Ah+To}function Ac([i,t,n,l]){let d=(i+16)/116,g=isNaN(t)?d:d+t/500,_=isNaN(n)?d:d-n/200;return d=1*da(d),g=Eu*da(g),_=ps*da(_),[Mu(3.1338561*g-1.6168667*d-.4906146*_),Mu(-.9787684*g+1.9161415*d+.033454*_),Mu(.0719453*g-.2289914*d+1.4052427*_),l]}function Mu(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function da(i){return i>Pn?i*i*i:Ah*(i-To)}const Gd=Object.hasOwn||function(i,t){return Object.prototype.hasOwnProperty.call(i,t)};function Ol(i,t){return Gd(i,t)?i[t]:void 0}function qs(i){return parseInt(i.padEnd(2,i),16)/255}function qd(i,t){return Ha(t?i/100:i,0,1)}function Ha(i,t,n){return Math.min(Math.max(t,i),n)}function Mc(i){return!i.some(Number.isNaN)}const Za={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function fa(i,t,n){return i+n*(t-i)}function Ul(i,t,n){return i.map(((l,d)=>fa(l,t[d],n)))}class rn{constructor(t,n,l,d=1,g=!0){this.r=t,this.g=n,this.b=l,this.a=d,g||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[t,n,l,d]))}static parse(t){if(t instanceof rn)return t;if(typeof t!="string")return;const n=(function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=Ol(Za,l);if(d){const[_,w,A]=d;return[_/255,w/255,A/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const _=l.length<6?1:2;let w=1;return[qs(l.slice(w,w+=_)),qs(l.slice(w,w+=_)),qs(l.slice(w,w+=_)),qs(l.slice(w,w+_)||"ff")]}if(l.startsWith("rgb")){const _=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[w,A,D,N,O,V,q,j,Y,J,ie,de]=_,re=[N||" ",q||" ",J].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const ae=[D,V,Y].join(""),pe=ae==="%%%"?100:ae===""?255:0;if(pe){const be=[Ha(+A/pe,0,1),Ha(+O/pe,0,1),Ha(+j/pe,0,1),ie?qd(+ie,de):1];if(Mc(be))return be}}return}}const g=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,w,A,D,N,O,V,q,j]=g,Y=[A||" ",N||" ",V].join("");if(Y==="  "||Y==="  /"||Y===",,"||Y===",,,"){const J=[+w,Ha(+D,0,100),Ha(+O,0,100),q?qd(+q,j):1];if(Mc(J))return(function([ie,de,re,ae]){function pe(be){const Fe=(be+ie/30)%12,Ke=de*Math.min(re,1-re);return re-Ke*Math.max(-1,Math.min(Fe-3,9-Fe,1))}return ie=Cu(ie),de/=100,re/=100,[pe(0),pe(8),pe(4),ae]})(J)}}})(t);return n?new rn(...n,!1):void 0}get rgb(){const{r:t,g:n,b:l,a:d}=this,g=d||1/0;return this.overwriteGetter("rgb",[t/g,n/g,l/g,d])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[n,l,d,g]=Vd(t),_=Math.sqrt(l*l+d*d);return[Math.round(1e4*_)?Cu(Math.atan2(d,l)*Mh):NaN,_,n,g]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Vd(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,l,d]=this.rgb;return`rgba(${[t,n,l].map((g=>Math.round(255*g))).join(",")},${d})`}static interpolate(t,n,l,d="rgb"){switch(d){case"rgb":{const[g,_,w,A]=Ul(t.rgb,n.rgb,l);return new rn(g,_,w,A,!1)}case"hcl":{const[g,_,w,A]=t.hcl,[D,N,O,V]=n.hcl;let q,j;if(isNaN(g)||isNaN(D))isNaN(g)?isNaN(D)?q=NaN:(q=D,w!==1&&w!==0||(j=N)):(q=g,O!==1&&O!==0||(j=_));else{let re=D-g;D>g&&re>180?re-=360:D<g&&g-D>180&&(re+=360),q=g+l*re}const[Y,J,ie,de]=(function([re,ae,pe,be]){return re=isNaN(re)?0:re*qa,Ac([pe,Math.cos(re)*ae,Math.sin(re)*ae,be])})([q,j??fa(_,N,l),fa(w,O,l),fa(A,V,l)]);return new rn(Y,J,ie,de,!1)}case"lab":{const[g,_,w,A]=Ac(Ul(t.lab,n.lab,l));return new rn(g,_,w,A,!1)}}}}rn.black=new rn(0,0,0,1),rn.white=new rn(1,1,1,1),rn.transparent=new rn(0,0,0,0),rn.red=new rn(1,0,0,1);class $o{constructor(t,n,l){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ih=["bottom","center","top"];class Iu{constructor(t,n,l,d,g,_){this.text=t,this.image=n,this.scale=l,this.fontStack=d,this.textColor=g,this.verticalAlign=_}}class tr{constructor(t){this.sections=t}static fromString(t){return new tr([new Iu(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof tr?t:tr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Ui{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ui)return t;if(typeof t=="number")return new Ui([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Ui(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,l){return new Ui(Ul(t.values,n.values,l))}}class ci{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ci)return t;if(typeof t=="number")return new ci([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new ci(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,l){return new ci(Ul(t.values,n.values,l))}}class qt{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof qt)return t;if(typeof t=="string"){const l=rn.parse(t);return l?new qt([l]):void 0}if(!Array.isArray(t))return;const n=[];for(const l of t){if(typeof l!="string")return;const d=rn.parse(l);if(!d)return;n.push(d)}return new qt(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,l,d="rgb"){const g=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)g.push(rn.interpolate(t.values[_],n.values[_],l,d));return new qt(g)}}class Yn extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const So=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ti{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ti)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const l=t[n],d=t[n+1];if(typeof l!="string"||!So.has(l)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new Ti(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,l){const d=t.values,g=n.values;if(d.length!==g.length)throw new Yn(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const _=[];for(let w=0;w<d.length;w+=2){if(d[w]!==g[w])throw new Yn(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${d[w]}, to[${w}]: ${g[w]}`);_.push(d[w]);const[A,D]=d[w+1],[N,O]=g[w+1];_.push([fa(A,N,l),fa(D,O,l)])}return new Ti(_)}}class Nr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Nr({name:t,available:!1}):null}}class nr{constructor(t,n,l){this.from=t,this.to=n,this.transition=l}static interpolate(t,n,l){return new nr(t,n,l)}static parse(t){return t instanceof nr?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new nr(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new nr(t.from,t.to,t.transition):typeof t=="string"?new nr(t,t,1):void 0}}function oo(i,t,n,l){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,t,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,t,n,l]:[i,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ms(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof nr||i instanceof rn||i instanceof $o||i instanceof tr||i instanceof Ui||i instanceof ci||i instanceof qt||i instanceof Ti||i instanceof Nr)return!0;if(Array.isArray(i)){for(const t of i)if(!ms(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!ms(i[t]))return!1;return!0}return!1}function hi(i){if(i===null)return vn;if(typeof i=="string")return jt;if(typeof i=="boolean")return on;if(typeof i=="number")return dt;if(i instanceof rn)return ro;if(i instanceof nr)return Cc;if(i instanceof $o)return Ga;if(i instanceof tr)return hs;if(i instanceof Ui)return Vs;if(i instanceof ci)return fs;if(i instanceof qt)return ds;if(i instanceof Ti)return kl;if(i instanceof Nr)return wi;if(Array.isArray(i)){const t=i.length;let n;for(const l of i){const d=hi(l);if(n){if(n===d)continue;n=Qt;break}n=d}return Er(n||Qt,t)}return cs}function pa(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof rn||i instanceof nr||i instanceof tr||i instanceof Ui||i instanceof ci||i instanceof qt||i instanceof Ti||i instanceof Nr?i.toString():JSON.stringify(i)}class so{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ms(t[1]))return n.error("invalid value");const l=t[1];let d=hi(l);const g=n.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new so(d,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const $a={string:jt,number:dt,boolean:on,object:cs};class kr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let l,d=1;const g=t[0];if(g==="array"){let w,A;if(t.length>2){const D=t[1];if(typeof D!="string"||!(D in $a)||D==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);w=$a[D],d++}else w=Qt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);A=t[2],d++}l=Er(w,A)}else{if(!$a[g])throw new Error(`Types doesn't contain name = ${g}`);l=$a[g]}const _=[];for(;d<t.length;d++){const w=n.parse(t[d],d,Qt);if(!w)return null;_.push(w)}return new kr(l,_)}evaluate(t){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(t);if(!Fl(this.type,hi(l)))return l;if(n===this.args.length-1)throw new Yn(`Expected value to be of type ${Sn(this.type)}, but found ${Sn(hi(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Ji={"to-boolean":on,"to-color":ro,"to-number":dt,"to-string":jt};class Fr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const l=t[0];if(!Ji[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return n.error("Expected one argument.");const d=Ji[l],g=[];for(let _=1;_<t.length;_++){const w=n.parse(t[_],_,Qt);if(!w)return null;g.push(w)}return new Fr(d,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,l;for(const d of this.args){if(n=d.evaluate(t),l=null,n instanceof rn)return n;if(typeof n=="string"){const g=t.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:oo(n[0],n[1],n[2],n[3]),!l))return new rn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Yn(l||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const l of this.args){n=l.evaluate(t);const d=Ui.parse(n);if(d)return d}throw new Yn(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const l of this.args){n=l.evaluate(t);const d=ci.parse(n);if(d)return d}throw new Yn(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const l of this.args){n=l.evaluate(t);const d=qt.parse(n);if(d)return d}throw new Yn(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const l of this.args){n=l.evaluate(t);const d=Ti.parse(n);if(d)return d}throw new Yn(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const l of this.args){if(n=l.evaluate(t),n===null)return 0;const d=Number(n);if(!isNaN(d))return d}throw new Yn(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return tr.fromString(pa(this.args[0].evaluate(t)));case"resolvedImage":return Nr.fromString(pa(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return pa(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Ru=["Unknown","Point","LineString","Polygon"];class ja{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ru[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=rn.parse(t),this._parseColorCache.set(t,n)),n}}class Ya{constructor(t,n,l=[],d,g=new Gr,_=[]){this.registry=t,this.path=l,this.key=l.map((w=>`[${w}]`)).join(""),this.scope=g,this.errors=_,this.expectedType=d,this._isConstant=n}parse(t,n,l,d,g={}){return n?this.concat(n,l,d)._parse(t,g):this._parse(t,g)}_parse(t,n){function l(d,g,_){return _==="assert"?new kr(g,[d]):_==="coerce"?new Fr(g,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=t[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[d];if(g){let _=g.parse(t,this);if(!_)return null;if(this.expectedType){const w=this.expectedType,A=_.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||A.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(A.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(A.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(A.kind)||w.kind==="colorArray"&&["value","string","array"].includes(A.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(A.kind))_=l(_,w,n.typeAnnotation||"coerce");else if(this.checkSubtype(w,A))return null}else _=l(_,w,n.typeAnnotation||"assert")}if(!(_ instanceof so)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const w=new ja;try{_=new so(_.type,_.evaluate(w))}catch(A){return this.error(A.message),null}}return _}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,l){const d=typeof t=="number"?this.path.concat(t):this.path,g=l?this.scope.concat(l):this.scope;return new Ya(this.registry,this._isConstant,d,n||null,g,this.errors)}error(t,...n){const l=`${this.key}${n.map((d=>`[${d}]`)).join("")}`;this.errors.push(new zr(l,t))}checkSubtype(t,n){const l=Fl(t,n);return l&&this.error(l),l}}class qn{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=n.parse(t[g+1],g+1);if(!w)return null;l.push([_,w])}const d=n.parse(t[t.length-1],t.length-1,n.expectedType,l);return d?new qn(l,d):null}outputDefined(){return this.result.outputDefined()}}class ma{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=t[1];return n.scope.has(l)?new ma(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class cn{constructor(t,n,l){this.type=t,this.index=n,this.input=l}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,dt),d=n.parse(t[2],2,Er(n.expectedType||Qt));return l&&d?new cn(d.type.itemType,l,d):null}evaluate(t){const n=this.index.evaluate(t),l=this.input.evaluate(t);if(n<0)throw new Yn(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new Yn(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new Yn(`Array index must be an integer, but found ${n} instead.`);return l[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class en{constructor(t,n){this.type=on,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,Qt),d=n.parse(t[2],2,Qt);return l&&d?Bl(l.type,[on,jt,dt,vn,Qt])?new en(l,d):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(l.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!ha(n,["boolean","string","number","null"]))throw new Yn(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(hi(n))} instead.`);if(!ha(l,["string","array"]))throw new Yn(`Expected second argument to be of type array or string, but found ${Sn(hi(l))} instead.`);return l.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Xa{constructor(t,n,l){this.type=dt,this.needle=t,this.haystack=n,this.fromIndex=l}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,Qt),d=n.parse(t[2],2,Qt);if(!l||!d)return null;if(!Bl(l.type,[on,jt,dt,vn,Qt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(l.type)} instead`);if(t.length===4){const g=n.parse(t[3],3,dt);return g?new Xa(l,d,g):null}return new Xa(l,d)}evaluate(t){const n=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!ha(n,["boolean","string","number","null"]))throw new Yn(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(hi(n))} instead.`);let d;if(this.fromIndex&&(d=this.fromIndex.evaluate(t)),ha(l,["string"])){const g=l.indexOf(n,d);return g===-1?-1:[...l.slice(0,g)].length}if(ha(l,["array"]))return l.indexOf(n,d);throw new Yn(`Expected second argument to be of type array or string, but found ${Sn(hi(l))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class En{constructor(t,n,l,d,g,_){this.inputType=t,this.type=n,this.input=l,this.cases=d,this.outputs=g,this.otherwise=_}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let l,d;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);const g={},_=[];for(let D=2;D<t.length-1;D+=2){let N=t[D];const O=t[D+1];Array.isArray(N)||(N=[N]);const V=n.concat(D);if(N.length===0)return V.error("Expected at least one branch label.");for(const j of N){if(typeof j!="number"&&typeof j!="string")return V.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return V.error("Numeric branch labels must be integer values.");if(l){if(V.checkSubtype(l,hi(j)))return null}else l=hi(j);if(g[String(j)]!==void 0)return V.error("Branch labels must be unique.");g[String(j)]=_.length}const q=n.parse(O,D,d);if(!q)return null;d=d||q.type,_.push(q)}const w=n.parse(t[1],1,Qt);if(!w)return null;const A=n.parse(t[t.length-1],t.length-1,d);return A?w.type.kind!=="value"&&n.concat(1).checkSubtype(l,w.type)?null:new En(l,d,w,g,_,A):null}evaluate(t){const n=this.input.evaluate(t);return(hi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Pu{constructor(t,n,l){this.type=t,this.branches=n,this.otherwise=l}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const d=[];for(let _=1;_<t.length-1;_+=2){const w=n.parse(t[_],_,on);if(!w)return null;const A=n.parse(t[_+1],_+1,l);if(!A)return null;d.push([w,A]),l=l||A.type}const g=n.parse(t[t.length-1],t.length-1,l);if(!g)return null;if(!l)throw new Error("Can't infer output type");return new Pu(l,d,g)}evaluate(t){for(const[n,l]of this.branches)if(n.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,l]of this.branches)t(n),t(l);t(this.otherwise)}outputDefined(){return this.branches.every((([t,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Eo{constructor(t,n,l,d){this.type=t,this.input=n,this.beginIndex=l,this.endIndex=d}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const l=n.parse(t[1],1,Qt),d=n.parse(t[2],2,dt);if(!l||!d)return null;if(!Bl(l.type,[Er(Qt),jt,Qt]))return n.error(`Expected first argument to be of type array or string, but found ${Sn(l.type)} instead`);if(t.length===4){const g=n.parse(t[3],3,dt);return g?new Eo(l.type,l,d,g):null}return new Eo(l.type,l,d)}evaluate(t){const n=this.input.evaluate(t),l=this.beginIndex.evaluate(t);let d;if(this.endIndex&&(d=this.endIndex.evaluate(t)),ha(n,["string"]))return[...n].slice(l,d).join("");if(ha(n,["array"]))return n.slice(l,d);throw new Yn(`Expected first argument to be of type array or string, but found ${Sn(hi(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ga(i,t){const n=i.length-1;let l,d,g=0,_=n,w=0;for(;g<=_;)if(w=Math.floor((g+_)/2),l=i[w],d=i[w+1],l<=t){if(w===n||t<d)return w;g=w+1}else{if(!(l>t))throw new Yn("Input is not a number.");_=w-1}return 0}class _a{constructor(t,n,l){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[d,g]of l)this.labels.push(d),this.outputs.push(g)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(t[1],1,dt);if(!l)return null;const d=[];let g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let _=1;_<t.length;_+=2){const w=_===1?-1/0:t[_],A=t[_+1],D=_,N=_+1;if(typeof w!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(d.length&&d[d.length-1][0]>=w)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const O=n.parse(A,N,g);if(!O)return null;g=g||O.type,d.push([w,O])}return new _a(g,l,d)}evaluate(t){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(t);const d=this.input.evaluate(t);if(d<=n[0])return l[0].evaluate(t);const g=n.length;return d>=n[g-1]?l[g-1].evaluate(t):l[ga(n,d)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Hd(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Du,Rh,gp=(function(){if(Rh)return Du;function i(t,n,l,d){this.cx=3*t,this.bx=3*(l-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=l,this.p2y=d}return Rh=1,Du=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var l=t,d=0;d<8;d++){var g=this.sampleCurveX(l)-t;if(Math.abs(g)<n)return l;var _=this.sampleCurveDerivativeX(l);if(Math.abs(_)<1e-6)break;l-=g/_}var w=0,A=1;for(l=t,d=0;d<20&&(g=this.sampleCurveX(l),!(Math.abs(g-t)<n));d++)t>g?w=l:A=l,l=.5*(A-w)+w;return l},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Du})(),Ph=Hd(gp);class Br{constructor(t,n,l,d,g){this.type=t,this.operator=n,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(const[_,w]of g)this.labels.push(_),this.outputs.push(w)}static interpolationFactor(t,n,l,d){let g=0;if(t.name==="exponential")g=gs(n,t.base,l,d);else if(t.name==="linear")g=gs(n,1,l,d);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new Ph(_[0],_[1],_[2],_[3]).solve(gs(n,1,l,d))}return g}static parse(t,n){let[l,d,g,..._]=t;if(!Array.isArray(d)||d.length===0)return n.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const D=d[1];if(typeof D!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:D}}else{if(d[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const D=d.slice(1);if(D.length!==4||D.some((N=>typeof N!="number"||N<0||N>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:D}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,dt),!g)return null;const w=[];let A=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||n.expectedType==ds?n.expectedType&&n.expectedType.kind!=="value"&&(A=n.expectedType):A=ro;for(let D=0;D<_.length;D+=2){const N=_[D],O=_[D+1],V=D+3,q=D+4;if(typeof N!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(w.length&&w[w.length-1][0]>=N)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const j=n.parse(O,q,A);if(!j)return null;A=A||j.type,w.push([N,j])}return Zo(A,dt)||Zo(A,Cc)||Zo(A,ro)||Zo(A,Vs)||Zo(A,fs)||Zo(A,ds)||Zo(A,kl)||Zo(A,Er(dt))?new Br(A,l,d,g,w):n.error(`Type ${Sn(A)} is not interpolatable.`)}evaluate(t){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(t);const d=this.input.evaluate(t);if(d<=n[0])return l[0].evaluate(t);const g=n.length;if(d>=n[g-1])return l[g-1].evaluate(t);const _=ga(n,d),w=Br.interpolationFactor(this.interpolation,d,n[_],n[_+1]),A=l[_].evaluate(t),D=l[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return fa(A,D,w);case"color":return rn.interpolate(A,D,w);case"padding":return Ui.interpolate(A,D,w);case"colorArray":return qt.interpolate(A,D,w);case"numberArray":return ci.interpolate(A,D,w);case"variableAnchorOffsetCollection":return Ti.interpolate(A,D,w);case"array":return Ul(A,D,w);case"projectionDefinition":return nr.interpolate(A,D,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return rn.interpolate(A,D,w,"hcl");case"colorArray":return qt.interpolate(A,D,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return rn.interpolate(A,D,w,"lab");case"colorArray":return qt.interpolate(A,D,w,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function gs(i,t,n,l){const d=l-n,g=i-n;return d===0?0:t===1?g/d:(Math.pow(t,g)-1)/(Math.pow(t,d)-1)}const di={color:rn.interpolate,number:fa,padding:Ui.interpolate,numberArray:ci.interpolate,colorArray:qt.interpolate,variableAnchorOffsetCollection:Ti.interpolate,array:Ul};class Ja{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let l=null;const d=n.expectedType;d&&d.kind!=="value"&&(l=d);const g=[];for(const w of t.slice(1)){const A=n.parse(w,1+g.length,l,void 0,{typeAnnotation:"omit"});if(!A)return null;l=l||A.type,g.push(A)}if(!l)throw new Error("No output type");const _=d&&g.some((w=>Fl(d,w.type)));return new Ja(_?Qt:l,g)}evaluate(t){let n,l=null,d=0;for(const g of this.args)if(d++,l=g.evaluate(t),l&&l instanceof Nr&&!l.available&&(n||(n=l.name),l=null,d===this.args.length&&(l=n)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function zu(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Lu(i,t,n,l){return l.compare(t,n)===0}function Si(i,t,n){const l=i!=="=="&&i!=="!=";return class av{constructor(g,_,w){this.type=on,this.lhs=g,this.rhs=_,this.collator=w,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const w=g[0];let A=_.parse(g[1],1,Qt);if(!A)return null;if(!zu(w,A.type))return _.concat(1).error(`"${w}" comparisons are not supported for type '${Sn(A.type)}'.`);let D=_.parse(g[2],2,Qt);if(!D)return null;if(!zu(w,D.type))return _.concat(2).error(`"${w}" comparisons are not supported for type '${Sn(D.type)}'.`);if(A.type.kind!==D.type.kind&&A.type.kind!=="value"&&D.type.kind!=="value")return _.error(`Cannot compare types '${Sn(A.type)}' and '${Sn(D.type)}'.`);l&&(A.type.kind==="value"&&D.type.kind!=="value"?A=new kr(D.type,[A]):A.type.kind!=="value"&&D.type.kind==="value"&&(D=new kr(A.type,[D])));let N=null;if(g.length===4){if(A.type.kind!=="string"&&D.type.kind!=="string"&&A.type.kind!=="value"&&D.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(N=_.parse(g[3],3,Ga),!N)return null}return new av(A,D,N)}evaluate(g){const _=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(l&&this.hasUntypedArgument){const A=hi(_),D=hi(w);if(A.kind!==D.kind||A.kind!=="string"&&A.kind!=="number")throw new Yn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${A.kind}, ${D.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const A=hi(_),D=hi(w);if(A.kind!=="string"||D.kind!=="string")return t(g,_,w)}return this.collator?n(g,_,w,this.collator.evaluate(g)):t(g,_,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Zd=Si("==",(function(i,t,n){return t===n}),Lu),Ic=Si("!=",(function(i,t,n){return t!==n}),(function(i,t,n,l){return!Lu(0,t,n,l)})),$d=Si("<",(function(i,t,n){return t<n}),(function(i,t,n,l){return l.compare(t,n)<0})),_p=Si(">",(function(i,t,n){return t>n}),(function(i,t,n,l){return l.compare(t,n)>0})),Vl=Si("<=",(function(i,t,n){return t<=n}),(function(i,t,n,l){return l.compare(t,n)<=0})),Rc=Si(">=",(function(i,t,n){return t>=n}),(function(i,t,n,l){return l.compare(t,n)>=0}));class Gl{constructor(t,n,l){this.type=Ga,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const d=n.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,on);if(!d)return null;const g=n.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,on);if(!g)return null;let _=null;return l.locale&&(_=n.parse(l.locale,1,jt),!_)?null:new Gl(d,g,_)}evaluate(t){return new $o(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Dh{constructor(t,n,l,d,g){this.type=jt,this.number=t,this.locale=n,this.currency=l,this.minFractionDigits=d,this.maxFractionDigits=g}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const l=n.parse(t[1],1,dt);if(!l)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return n.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=n.parse(d.locale,1,jt),!g))return null;let _=null;if(d.currency&&(_=n.parse(d.currency,1,jt),!_))return null;let w=null;if(d["min-fraction-digits"]&&(w=n.parse(d["min-fraction-digits"],1,dt),!w))return null;let A=null;return d["max-fraction-digits"]&&(A=n.parse(d["max-fraction-digits"],1,dt),!A)?null:new Dh(l,g,_,w,A)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Nu{constructor(t){this.type=hs,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const d=[];let g=!1;for(let _=1;_<=t.length-1;++_){const w=t[_];if(g&&typeof w=="object"&&!Array.isArray(w)){g=!1;let A=null;if(w["font-scale"]&&(A=n.parse(w["font-scale"],1,dt),!A))return null;let D=null;if(w["text-font"]&&(D=n.parse(w["text-font"],1,Er(jt)),!D))return null;let N=null;if(w["text-color"]&&(N=n.parse(w["text-color"],1,ro),!N))return null;let O=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!Ih.includes(w["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(O=n.parse(w["vertical-align"],1,jt),!O)return null}const V=d[d.length-1];V.scale=A,V.font=D,V.textColor=N,V.verticalAlign=O}else{const A=n.parse(t[_],1,Qt);if(!A)return null;const D=A.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:A,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Nu(d)}evaluate(t){return new tr(this.sections.map((n=>{const l=n.content.evaluate(t);return hi(l)===wi?new Iu("",l,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new Iu(pa(l),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class ql{constructor(t){this.type=wi,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const l=n.parse(t[1],1,jt);return l?new ql(l):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),l=Nr.fromString(n);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(n)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class Hl{constructor(t){this.type=dt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=n.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Sn(l.type)} instead.`):new Hl(l):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Yn(`Expected value to be of type string or array, but found ${Sn(hi(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Li=8192;function Zl(i,t){const n=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(n*d*Li),Math.round(l*d*Li)]}function $l(i,t){const n=Math.pow(2,t.z);return[(d=(i[0]/Li+t.x)/n,360*d-180),(l=(i[1]/Li+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,d}function jl(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function ya(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function jd(i,t,n){const l=i[0]-t[0],d=i[1]-t[1],g=i[0]-n[0],_=i[1]-n[1];return l*_-g*d==0&&l*g<=0&&d*_<=0}function ku(i,t,n,l){return(d=[l[0]-n[0],l[1]-n[1]])[0]*(g=[t[0]-i[0],t[1]-i[1]])[1]-d[1]*g[0]!=0&&!(!Dc(i,t,n,l)||!Dc(n,l,i,t));var d,g}function Yd(i,t,n){for(const l of n)for(let d=0;d<l.length-1;++d)if(ku(i,t,l[d],l[d+1]))return!0;return!1}function jo(i,t,n=!1){let l=!1;for(const w of t)for(let A=0;A<w.length-1;A++){if(jd(i,w[A],w[A+1]))return n;(g=w[A])[1]>(d=i)[1]!=(_=w[A+1])[1]>d[1]&&d[0]<(_[0]-g[0])*(d[1]-g[1])/(_[1]-g[1])+g[0]&&(l=!l)}var d,g,_;return l}function Pc(i,t){for(const n of t)if(jo(i,n))return!0;return!1}function Xd(i,t){for(const n of i)if(!jo(n,t))return!1;for(let n=0;n<i.length-1;++n)if(Yd(i[n],i[n+1],t))return!1;return!0}function Jd(i,t){for(const n of t)if(Xd(i,n))return!0;return!1}function Dc(i,t,n,l){const d=l[0]-n[0],g=l[1]-n[1],_=(i[0]-n[0])*g-d*(i[1]-n[1]),w=(t[0]-n[0])*g-d*(t[1]-n[1]);return _>0&&w<0||_<0&&w>0}function zc(i,t,n){const l=[];for(let d=0;d<i.length;d++){const g=[];for(let _=0;_<i[d].length;_++){const w=Zl(i[d][_],n);jl(t,w),g.push(w)}l.push(g)}return l}function Wa(i,t,n){const l=[];for(let d=0;d<i.length;d++){const g=zc(i[d],t,n);l.push(g)}return l}function Yl(i,t,n,l){if(i[0]<n[0]||i[0]>n[2]){const d=.5*l;let g=i[0]-n[0]>d?-l:n[0]-i[0]>d?l:0;g===0&&(g=i[0]-n[2]>d?-l:n[2]-i[0]>d?l:0),i[0]+=g}jl(t,i)}function Wd(i,t,n,l){const d=Math.pow(2,l.z)*Li,g=[l.x*Li,l.y*Li],_=[];for(const w of i)for(const A of w){const D=[A.x+g[0],A.y+g[1]];Yl(D,t,n,d),_.push(D)}return _}function Fu(i,t,n,l){const d=Math.pow(2,l.z)*Li,g=[l.x*Li,l.y*Li],_=[];for(const A of i){const D=[];for(const N of A){const O=[N.x+g[0],N.y+g[1]];jl(t,O),D.push(O)}_.push(D)}if(t[2]-t[0]<=d/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const A of _)for(const D of A)Yl(D,t,n,d)}var w;return _}class va{constructor(t,n){this.type=on,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ms(t[1])){const l=t[1];if(l.type==="FeatureCollection"){const d=[];for(const g of l.features){const{type:_,coordinates:w}=g.geometry;_==="Polygon"&&d.push(w),_==="MultiPolygon"&&d.push(...w)}if(d.length)return new va(l,{type:"MultiPolygon",coordinates:d})}else if(l.type==="Feature"){const d=l.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new va(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new va(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,l){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(l.type==="Polygon"){const w=zc(l.coordinates,g,_),A=Wd(n.geometry(),d,g,_);if(!ya(d,g))return!1;for(const D of A)if(!jo(D,w))return!1}if(l.type==="MultiPolygon"){const w=Wa(l.coordinates,g,_),A=Wd(n.geometry(),d,g,_);if(!ya(d,g))return!1;for(const D of A)if(!Pc(D,w))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,l){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(l.type==="Polygon"){const w=zc(l.coordinates,g,_),A=Fu(n.geometry(),d,g,_);if(!ya(d,g))return!1;for(const D of A)if(!Xd(D,w))return!1}if(l.type==="MultiPolygon"){const w=Wa(l.coordinates,g,_),A=Fu(n.geometry(),d,g,_);if(!ya(d,g))return!1;for(const D of A)if(!Jd(D,w))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let zh=class{constructor(i=[],t=(n,l)=>n<l?-1:n>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:n}=this,l=t[i];for(;i>0;){const d=i-1>>1,g=t[d];if(n(l,g)>=0)break;t[i]=g,i=d}t[i]=l}_down(i){const{data:t,compare:n}=this,l=this.length>>1,d=t[i];for(;i<l;){let g=1+(i<<1);const _=g+1;if(_<this.length&&n(t[_],t[g])<0&&(g=_),n(t[g],d)>=0)break;t[i]=t[g],i=g}t[i]=d}};function Bu(i,t,n=0,l=i.length-1,d=Lh){for(;l>n;){if(l-n>600){const A=l-n+1,D=t-n+1,N=Math.log(A),O=.5*Math.exp(2*N/3),V=.5*Math.sqrt(N*O*(A-O)/A)*(D-A/2<0?-1:1);Bu(i,t,Math.max(n,Math.floor(t-D*O/A+V)),Math.min(l,Math.floor(t+(A-D)*O/A+V)),d)}const g=i[t];let _=n,w=l;for(xa(i,n,t),d(i[l],g)>0&&xa(i,n,l);_<w;){for(xa(i,_,w),_++,w--;d(i[_],g)<0;)_++;for(;d(i[w],g)>0;)w--}d(i[n],g)===0?xa(i,n,w):(w++,xa(i,w,l)),w<=t&&(n=w+1),t<=w&&(l=w-1)}}function xa(i,t,n){const l=i[t];i[t]=i[n],i[n]=l}function Lh(i,t){return i<t?-1:i>t?1:0}function Ou(i,t){if(i.length<=1)return[i];const n=[];let l,d;for(const g of i){const _=yp(g);_!==0&&(g.area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(l&&n.push(l),l=[g]):l.push(g))}if(l&&n.push(l),t>1)for(let g=0;g<n.length;g++)n[g].length<=t||(Bu(n[g],t,1,n[g].length-1,Kd),n[g]=n[g].slice(0,t));return n}function Kd(i,t){return t.area-i.area}function yp(i){let t=0;for(let n,l,d=0,g=i.length,_=g-1;d<g;_=d++)n=i[d],l=i[_],t+=(l.x-n.x)*(n.y+l.y);return t}const Qd=1/298.257223563,Uu=Qd*(2-Qd),ef=Math.PI/180;class Nh{constructor(t){const n=6378.137*ef*1e3,l=Math.cos(t*ef),d=1/(1-Uu*(1-l*l)),g=Math.sqrt(d);this.kx=n*g*l,this.ky=n*g*d*(1-Uu)}distance(t,n){const l=this.wrap(t[0]-n[0])*this.kx,d=(t[1]-n[1])*this.ky;return Math.sqrt(l*l+d*d)}pointOnLine(t,n){let l,d,g,_,w=1/0;for(let A=0;A<t.length-1;A++){let D=t[A][0],N=t[A][1],O=this.wrap(t[A+1][0]-D)*this.kx,V=(t[A+1][1]-N)*this.ky,q=0;O===0&&V===0||(q=(this.wrap(n[0]-D)*this.kx*O+(n[1]-N)*this.ky*V)/(O*O+V*V),q>1?(D=t[A+1][0],N=t[A+1][1]):q>0&&(D+=O/this.kx*q,N+=V/this.ky*q)),O=this.wrap(n[0]-D)*this.kx,V=(n[1]-N)*this.ky;const j=O*O+V*V;j<w&&(w=j,l=D,d=N,g=A,_=q)}return{point:[l,d],index:g,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function qr(i,t){return t[0]-i[0]}function ba(i){return i[1]-i[0]+1}function Co(i,t){return i[1]>=i[0]&&i[1]<t}function Vu(i,t){if(i[0]>i[1])return[null,null];const n=ba(i);if(t){if(n===2)return[i,null];const d=Math.floor(n/2);return[[i[0],i[0]+d],[i[0]+d,i[1]]]}if(n===1)return[i,null];const l=Math.floor(n/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function Lc(i,t){if(!Co(t,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let l=t[0];l<=t[1];++l)jl(n,i[l]);return n}function Nc(i){const t=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const l of n)jl(t,l);return t}function Gu(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function kc(i,t,n){if(!Gu(i)||!Gu(t))return NaN;let l=0,d=0;return i[2]<t[0]&&(l=t[0]-i[2]),i[0]>t[2]&&(l=i[0]-t[2]),i[1]>t[3]&&(d=i[1]-t[3]),i[3]<t[1]&&(d=t[1]-i[3]),n.distance([0,0],[l,d])}function Ao(i,t,n){const l=n.pointOnLine(t,i);return n.distance(i,l.point)}function qu(i,t,n,l,d){const g=Math.min(Ao(i,[n,l],d),Ao(t,[n,l],d)),_=Math.min(Ao(n,[i,t],d),Ao(l,[i,t],d));return Math.min(g,_)}function Hu(i,t,n,l,d){if(!Co(t,i.length)||!Co(l,n.length))return 1/0;let g=1/0;for(let _=t[0];_<t[1];++_){const w=i[_],A=i[_+1];for(let D=l[0];D<l[1];++D){const N=n[D],O=n[D+1];if(ku(w,A,N,O))return 0;g=Math.min(g,qu(w,A,N,O,d))}}return g}function Fc(i,t,n,l,d){if(!Co(t,i.length)||!Co(l,n.length))return NaN;let g=1/0;for(let _=t[0];_<=t[1];++_)for(let w=l[0];w<=l[1];++w)if(g=Math.min(g,d.distance(i[_],n[w])),g===0)return g;return g}function tf(i,t,n){if(jo(i,t,!0))return 0;let l=1/0;for(const d of t){const g=d[0],_=d[d.length-1];if(g!==_&&(l=Math.min(l,Ao(i,[_,g],n)),l===0))return l;const w=n.pointOnLine(d,i);if(l=Math.min(l,n.distance(i,w.point)),l===0)return l}return l}function Ka(i,t,n,l){if(!Co(t,i.length))return NaN;for(let g=t[0];g<=t[1];++g)if(jo(i[g],n,!0))return 0;let d=1/0;for(let g=t[0];g<t[1];++g){const _=i[g],w=i[g+1];for(const A of n)for(let D=0,N=A.length,O=N-1;D<N;O=D++){const V=A[O],q=A[D];if(ku(_,w,V,q))return 0;d=Math.min(d,qu(_,w,V,q,l))}}return d}function Qa(i,t){for(const n of i)for(const l of n)if(jo(l,t,!0))return!0;return!1}function kh(i,t,n,l=1/0){const d=Nc(i),g=Nc(t);if(l!==1/0&&kc(d,g,n)>=l)return l;if(ya(d,g)){if(Qa(i,t))return 0}else if(Qa(t,i))return 0;let _=1/0;for(const w of i)for(let A=0,D=w.length,N=D-1;A<D;N=A++){const O=w[N],V=w[A];for(const q of t)for(let j=0,Y=q.length,J=Y-1;j<Y;J=j++){const ie=q[J],de=q[j];if(ku(O,V,ie,de))return 0;_=Math.min(_,qu(O,V,ie,de,n))}}return _}function Dn(i,t,n,l,d,g){if(!g)return;const _=kc(Lc(l,g),d,n);_<t&&i.push([_,g,[0,0]])}function _s(i,t,n,l,d,g,_){if(!g||!_)return;const w=kc(Lc(l,g),Lc(d,_),n);w<t&&i.push([w,g,_])}function Zu(i,t,n,l,d=1/0){let g=Math.min(l.distance(i[0],n[0][0]),d);if(g===0)return g;const _=new zh([[0,[0,i.length-1],[0,0]]],qr),w=Nc(n);for(;_.length>0;){const A=_.pop();if(A[0]>=g)continue;const D=A[1],N=t?50:100;if(ba(D)<=N){if(!Co(D,i.length))return NaN;if(t){const O=Ka(i,D,n,l);if(isNaN(O)||O===0)return O;g=Math.min(g,O)}else for(let O=D[0];O<=D[1];++O){const V=tf(i[O],n,l);if(g=Math.min(g,V),g===0)return 0}}else{const O=Vu(D,t);Dn(_,g,l,i,w,O[0]),Dn(_,g,l,i,w,O[1])}}return g}function $u(i,t,n,l,d,g=1/0){let _=Math.min(g,d.distance(i[0],n[0]));if(_===0)return _;const w=new zh([[0,[0,i.length-1],[0,n.length-1]]],qr);for(;w.length>0;){const A=w.pop();if(A[0]>=_)continue;const D=A[1],N=A[2],O=t?50:100,V=l?50:100;if(ba(D)<=O&&ba(N)<=V){if(!Co(D,i.length)&&Co(N,n.length))return NaN;let q;if(t&&l)q=Hu(i,D,n,N,d),_=Math.min(_,q);else if(t&&!l){const j=i.slice(D[0],D[1]+1);for(let Y=N[0];Y<=N[1];++Y)if(q=Ao(n[Y],j,d),_=Math.min(_,q),_===0)return _}else if(!t&&l){const j=n.slice(N[0],N[1]+1);for(let Y=D[0];Y<=D[1];++Y)if(q=Ao(i[Y],j,d),_=Math.min(_,q),_===0)return _}else q=Fc(i,D,n,N,d),_=Math.min(_,q)}else{const q=Vu(D,t),j=Vu(N,l);_s(w,_,d,i,n,q[0],j[0]),_s(w,_,d,i,n,q[0],j[1]),_s(w,_,d,i,n,q[1],j[0]),_s(w,_,d,i,n,q[1],j[1])}}return _}function Bc(i){return i.type==="MultiPolygon"?i.coordinates.map((t=>({type:"Polygon",coordinates:t}))):i.type==="MultiLineString"?i.coordinates.map((t=>({type:"LineString",coordinates:t}))):i.type==="MultiPoint"?i.coordinates.map((t=>({type:"Point",coordinates:t}))):[i]}class el{constructor(t,n){this.type=dt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ms(t[1])){const l=t[1];if(l.type==="FeatureCollection")return new el(l,l.features.map((d=>Bc(d.geometry))).flat());if(l.type==="Feature")return new el(l,Bc(l.geometry));if("type"in l&&"coordinates"in l)return new el(l,Bc(l))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,l){const d=n.geometry(),g=d.flat().map((A=>$l([A.x,A.y],n.canonical)));if(d.length===0)return NaN;const _=new Nh(g[0][1]);let w=1/0;for(const A of l){switch(A.type){case"Point":w=Math.min(w,$u(g,!1,[A.coordinates],!1,_,w));break;case"LineString":w=Math.min(w,$u(g,!1,A.coordinates,!0,_,w));break;case"Polygon":w=Math.min(w,Zu(g,!1,A.coordinates,_,w))}if(w===0)return w}return w})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,l){const d=n.geometry(),g=d.flat().map((A=>$l([A.x,A.y],n.canonical)));if(d.length===0)return NaN;const _=new Nh(g[0][1]);let w=1/0;for(const A of l){switch(A.type){case"Point":w=Math.min(w,$u(g,!0,[A.coordinates],!1,_,w));break;case"LineString":w=Math.min(w,$u(g,!0,A.coordinates,!0,_,w));break;case"Polygon":w=Math.min(w,Zu(g,!0,A.coordinates,_,w))}if(w===0)return w}return w})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(n,l){const d=n.geometry();if(d.length===0||d[0].length===0)return NaN;const g=Ou(d,0).map((A=>A.map((D=>D.map((N=>$l([N.x,N.y],n.canonical))))))),_=new Nh(g[0][0][0][1]);let w=1/0;for(const A of l)for(const D of g){switch(A.type){case"Point":w=Math.min(w,Zu([A.coordinates],!1,D,_,w));break;case"LineString":w=Math.min(w,Zu(A.coordinates,!0,D,_,w));break;case"Polygon":w=Math.min(w,kh(D,A.coordinates,_,w))}if(w===0)return w}return w})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ju{constructor(t){this.type=Qt,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=t[1];return l==null?n.error("Global state property must be defined."):typeof l!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new ju(l)}evaluate(t){var n;const l=(n=t.globals)===null||n===void 0?void 0:n.globalState;return l&&Object.keys(l).length!==0?Ol(l,this.key):null}eachChild(){}outputDefined(){return!1}}const Xl={"==":Zd,"!=":Ic,">":_p,"<":$d,">=":Rc,"<=":Vl,array:kr,at:cn,boolean:kr,case:Pu,coalesce:Ja,collator:Gl,format:Nu,image:ql,in:en,"index-of":Xa,interpolate:Br,"interpolate-hcl":Br,"interpolate-lab":Br,length:Hl,let:qn,literal:so,match:En,number:kr,"number-format":Dh,object:kr,slice:Eo,step:_a,string:kr,"to-boolean":Fr,"to-color":Fr,"to-number":Fr,"to-string":Fr,var:ma,within:va,distance:el,"global-state":ju};class ao{constructor(t,n,l,d){this.name=t,this.type=n,this._evaluate=l,this.args=d}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const l=t[0],d=ao.definitions[l];if(!d)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,w=_.filter((([D])=>!Array.isArray(D)||D.length===t.length-1));let A=null;for(const[D,N]of w){A=new Ya(n.registry,Or,n.path,null,n.scope);const O=[];let V=!1;for(let q=1;q<t.length;q++){const j=t[q],Y=Array.isArray(D)?D[q-1]:D.type,J=A.parse(j,1+O.length,Y);if(!J){V=!0;break}O.push(J)}if(!V)if(Array.isArray(D)&&D.length!==O.length)A.error(`Expected ${D.length} arguments, but found ${O.length} instead.`);else{for(let q=0;q<O.length;q++){const j=Array.isArray(D)?D[q]:D.type,Y=O[q];A.concat(q+1).checkSubtype(j,Y.type)}if(A.errors.length===0)return new ao(l,g,N,O)}}if(w.length===1)n.errors.push(...A.errors);else{const D=(w.length?w:_).map((([O])=>{return V=O,Array.isArray(V)?`(${V.map(Sn).join(", ")})`:`(${Sn(V.type)}...)`;var V})).join(" | "),N=[];for(let O=1;O<t.length;O++){const V=n.parse(t[O],1+N.length);if(!V)return null;N.push(Sn(V.type))}n.error(`Expected arguments of type ${D}, but found (${N.join(", ")}) instead.`)}return null}static register(t,n){ao.definitions=n;for(const l in n)t[l]=ao}}function Fh(i,[t,n,l,d]){t=t.evaluate(i),n=n.evaluate(i),l=l.evaluate(i);const g=d?d.evaluate(i):1,_=oo(t,n,l,g);if(_)throw new Yn(_);return new rn(t/255,n/255,l/255,g,!1)}function Oc(i,t){return i in t}function lo(i,t){const n=t[i];return n===void 0?null:n}function ys(i){return{type:i}}function Or(i){if(i instanceof ma)return Or(i.boundExpression);if(i instanceof ao&&i.name==="error"||i instanceof Gl||i instanceof va||i instanceof el||i instanceof ju)return!1;const t=i instanceof Fr||i instanceof kr;let n=!0;return i.eachChild((l=>{n=t?n&&Or(l):n&&l instanceof so})),!!n&&Hs(i)&&nl(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Hs(i){if(i instanceof ao&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof va||i instanceof el)return!1;let t=!0;return i.eachChild((n=>{t&&!Hs(n)&&(t=!1)})),t}function tl(i){if(i instanceof ao&&i.name==="feature-state")return!1;let t=!0;return i.eachChild((n=>{t&&!tl(n)&&(t=!1)})),t}function nl(i,t){if(i instanceof ao&&t.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((l=>{n&&!nl(l,t)&&(n=!1)})),n}function Yu(i){return{result:"success",value:i}}function wa(i){return{result:"error",value:i}}function Mo(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Bh(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Jl(i){return!!i.expression&&i.expression.interpolated}function nn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Uc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&hi(i)===cs}function uo(i){return i}function Vc(i,t){const n=i.stops&&typeof i.stops[0][0]=="object",l=n||!(n||i.property!==void 0),d=i.type||(Jl(t)?"exponential":"interval"),g=(function(N){switch(N.type){case"color":return rn.parse;case"padding":return Ui.parse;case"numberArray":return ci.parse;case"colorArray":return qt.parse;default:return null}})(t);if(g&&((i=zi({},i)).stops&&(i.stops=i.stops.map((N=>[N[0],g(N[1])]))),i.default=g(i.default?i.default:t.default)),i.colorSpace&&(_=i.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var _;const w=(function(N){switch(N){case"exponential":return Ta;case"interval":return Gc;case"categorical":return nf;case"identity":return Oh;default:throw new Error(`Unknown function type "${N}"`)}})(d);let A,D;if(d==="categorical"){A=Object.create(null);for(const N of i.stops)A[N[0]]=N[1];D=typeof i.stops[0][0]}if(n){const N={},O=[];for(let j=0;j<i.stops.length;j++){const Y=i.stops[j],J=Y[0].zoom;N[J]===void 0&&(N[J]={zoom:J,type:i.type,property:i.property,default:i.default,stops:[]},O.push(J)),N[J].stops.push([Y[0].value,Y[1]])}const V=[];for(const j of O)V.push([N[j].zoom,Vc(N[j],t)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:Br.interpolationFactor.bind(void 0,q),zoomStops:V.map((j=>j[0])),evaluate:({zoom:j},Y)=>Ta({stops:V,base:i.base},t,j).evaluate(j,Y)}}if(l){const N=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:Br.interpolationFactor.bind(void 0,N),zoomStops:i.stops.map((O=>O[0])),evaluate:({zoom:O})=>w(i,t,O,A,D)}}return{kind:"source",evaluate(N,O){const V=O&&O.properties?O.properties[i.property]:void 0;return V===void 0?co(i.default,t.default):w(i,t,V,A,D)}}}function co(i,t,n){return i!==void 0?i:t!==void 0?t:n!==void 0?n:void 0}function nf(i,t,n,l,d){return co(typeof n===d?l[n]:void 0,i.default,t.default)}function Gc(i,t,n){if(nn(n)!=="number")return co(i.default,t.default);const l=i.stops.length;if(l===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[l-1][0])return i.stops[l-1][1];const d=ga(i.stops.map((g=>g[0])),n);return i.stops[d][1]}function Ta(i,t,n){const l=i.base!==void 0?i.base:1;if(nn(n)!=="number")return co(i.default,t.default);const d=i.stops.length;if(d===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[d-1][0])return i.stops[d-1][1];const g=ga(i.stops.map((N=>N[0])),n),_=(function(N,O,V,q){const j=q-V,Y=N-V;return j===0?0:O===1?Y/j:(Math.pow(O,Y)-1)/(Math.pow(O,j)-1)})(n,l,i.stops[g][0],i.stops[g+1][0]),w=i.stops[g][1],A=i.stops[g+1][1],D=di[t.type]||uo;return typeof w.evaluate=="function"?{evaluate(...N){const O=w.evaluate.apply(void 0,N),V=A.evaluate.apply(void 0,N);if(O!==void 0&&V!==void 0)return D(O,V,_,i.colorSpace)}}:D(w,A,_,i.colorSpace)}function Oh(i,t,n){switch(t.type){case"color":n=rn.parse(n);break;case"formatted":n=tr.fromString(n.toString());break;case"resolvedImage":n=Nr.fromString(n.toString());break;case"padding":n=Ui.parse(n);break;case"colorArray":n=qt.parse(n);break;case"numberArray":n=ci.parse(n);break;default:nn(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return co(n,i.default,t.default)}ao.register(Xl,{error:[{kind:"error"},[jt],(i,[t])=>{throw new Yn(t.evaluate(i))}],typeof:[jt,[Qt],(i,[t])=>Sn(hi(t.evaluate(i)))],"to-rgba":[Er(dt,4),[ro],(i,[t])=>{const[n,l,d,g]=t.evaluate(i).rgb;return[255*n,255*l,255*d,g]}],rgb:[ro,[dt,dt,dt],Fh],rgba:[ro,[dt,dt,dt,dt],Fh],has:{type:on,overloads:[[[jt],(i,[t])=>Oc(t.evaluate(i),i.properties())],[[jt,cs],(i,[t,n])=>Oc(t.evaluate(i),n.evaluate(i))]]},get:{type:Qt,overloads:[[[jt],(i,[t])=>lo(t.evaluate(i),i.properties())],[[jt,cs],(i,[t,n])=>lo(t.evaluate(i),n.evaluate(i))]]},"feature-state":[Qt,[jt],(i,[t])=>lo(t.evaluate(i),i.featureState||{})],properties:[cs,[],i=>i.properties()],"geometry-type":[jt,[],i=>i.geometryType()],id:[Qt,[],i=>i.id()],zoom:[dt,[],i=>i.globals.zoom],"heatmap-density":[dt,[],i=>i.globals.heatmapDensity||0],elevation:[dt,[],i=>i.globals.elevation||0],"line-progress":[dt,[],i=>i.globals.lineProgress||0],accumulated:[Qt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[dt,ys(dt),(i,t)=>{let n=0;for(const l of t)n+=l.evaluate(i);return n}],"*":[dt,ys(dt),(i,t)=>{let n=1;for(const l of t)n*=l.evaluate(i);return n}],"-":{type:dt,overloads:[[[dt,dt],(i,[t,n])=>t.evaluate(i)-n.evaluate(i)],[[dt],(i,[t])=>-t.evaluate(i)]]},"/":[dt,[dt,dt],(i,[t,n])=>t.evaluate(i)/n.evaluate(i)],"%":[dt,[dt,dt],(i,[t,n])=>t.evaluate(i)%n.evaluate(i)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(i,[t,n])=>Math.pow(t.evaluate(i),n.evaluate(i))],sqrt:[dt,[dt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[dt,[dt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[dt,[dt],(i,[t])=>Math.log(t.evaluate(i))],log2:[dt,[dt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[dt,[dt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[dt,[dt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[dt,[dt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[dt,[dt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[dt,[dt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[dt,[dt],(i,[t])=>Math.atan(t.evaluate(i))],min:[dt,ys(dt),(i,t)=>Math.min(...t.map((n=>n.evaluate(i))))],max:[dt,ys(dt),(i,t)=>Math.max(...t.map((n=>n.evaluate(i))))],abs:[dt,[dt],(i,[t])=>Math.abs(t.evaluate(i))],round:[dt,[dt],(i,[t])=>{const n=t.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[dt,[dt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[dt,[dt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[on,[jt,Qt],(i,[t,n])=>i.properties()[t.value]===n.value],"filter-id-==":[on,[Qt],(i,[t])=>i.id()===t.value],"filter-type-==":[on,[jt],(i,[t])=>i.geometryType()===t.value],"filter-<":[on,[jt,Qt],(i,[t,n])=>{const l=i.properties()[t.value],d=n.value;return typeof l==typeof d&&l<d}],"filter-id-<":[on,[Qt],(i,[t])=>{const n=i.id(),l=t.value;return typeof n==typeof l&&n<l}],"filter->":[on,[jt,Qt],(i,[t,n])=>{const l=i.properties()[t.value],d=n.value;return typeof l==typeof d&&l>d}],"filter-id->":[on,[Qt],(i,[t])=>{const n=i.id(),l=t.value;return typeof n==typeof l&&n>l}],"filter-<=":[on,[jt,Qt],(i,[t,n])=>{const l=i.properties()[t.value],d=n.value;return typeof l==typeof d&&l<=d}],"filter-id-<=":[on,[Qt],(i,[t])=>{const n=i.id(),l=t.value;return typeof n==typeof l&&n<=l}],"filter->=":[on,[jt,Qt],(i,[t,n])=>{const l=i.properties()[t.value],d=n.value;return typeof l==typeof d&&l>=d}],"filter-id->=":[on,[Qt],(i,[t])=>{const n=i.id(),l=t.value;return typeof n==typeof l&&n>=l}],"filter-has":[on,[Qt],(i,[t])=>t.value in i.properties()],"filter-has-id":[on,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[on,[Er(jt)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[on,[Er(Qt)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[on,[jt,Er(Qt)],(i,[t,n])=>n.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[on,[jt,Er(Qt)],(i,[t,n])=>(function(l,d,g,_){for(;g<=_;){const w=g+_>>1;if(d[w]===l)return!0;d[w]>l?_=w-1:g=w+1}return!1})(i.properties()[t.value],n.value,0,n.value.length-1)],all:{type:on,overloads:[[[on,on],(i,[t,n])=>t.evaluate(i)&&n.evaluate(i)],[ys(on),(i,t)=>{for(const n of t)if(!n.evaluate(i))return!1;return!0}]]},any:{type:on,overloads:[[[on,on],(i,[t,n])=>t.evaluate(i)||n.evaluate(i)],[ys(on),(i,t)=>{for(const n of t)if(n.evaluate(i))return!0;return!1}]]},"!":[on,[on],(i,[t])=>!t.evaluate(i)],"is-supported-script":[on,[jt],(i,[t])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(t.evaluate(i))}],upcase:[jt,[jt],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[jt,[jt],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[jt,ys(Qt),(i,t)=>t.map((n=>pa(n.evaluate(i)))).join("")],"resolved-locale":[jt,[Ga],(i,[t])=>t.evaluate(i).resolvedLocale()]});class qc{constructor(t,n,l){this.expression=t,this._warningHistory={},this._evaluator=new ja,this._defaultValue=n?(function(d){if(d.type==="color"&&Uc(d.default))return new rn(0,0,0,0);switch(d.type){case"color":return rn.parse(d.default)||null;case"padding":return Ui.parse(d.default)||null;case"numberArray":return ci.parse(d.default)||null;case"colorArray":return qt.parse(d.default)||null;case"variableAnchorOffsetCollection":return Ti.parse(d.default)||null;case"projectionDefinition":return nr.parse(d.default)||null;default:return d.default===void 0?null:d.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=l}evaluateWithoutErrorHandling(t,n,l,d,g,_){return this._globalState&&(t=lr(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,n,l,d,g,_){this._globalState&&(t=lr(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Yn(`Expected value to be one of ${Object.keys(this._enumValues).map((A=>JSON.stringify(A))).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Sa(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Xl}function Wl(i,t,n){const l=new Ya(Xl,Or,[],t?(function(g){const _={color:ro,string:jt,number:dt,enum:jt,boolean:on,formatted:hs,padding:Vs,numberArray:fs,colorArray:ds,projectionDefinition:Cc,resolvedImage:wi,variableAnchorOffsetCollection:kl};return g.type==="array"?Er(_[g.value]||Qt,g.length):_[g.type]})(t):void 0),d=l.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Yu(new qc(d,t,n)):wa(l.errors)}class Ur{constructor(t,n,l){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!tl(n.expression),this.globalStateRefs=ir(n.expression),this._globalState=l}evaluateWithoutErrorHandling(t,n,l,d,g,_){return this._globalState&&(t=lr(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,l,d,g,_)}evaluate(t,n,l,d,g,_){return this._globalState&&(t=lr(t,this._globalState)),this._styleExpression.evaluate(t,n,l,d,g,_)}}class Ea{constructor(t,n,l,d,g){this.kind=t,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!tl(n.expression),this.globalStateRefs=ir(n.expression),this.interpolationType=d,this._globalState=g}evaluateWithoutErrorHandling(t,n,l,d,g,_){return this._globalState&&(t=lr(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,l,d,g,_)}evaluate(t,n,l,d,g,_){return this._globalState&&(t=lr(t,this._globalState)),this._styleExpression.evaluate(t,n,l,d,g,_)}interpolationFactor(t,n,l){return this.interpolationType?Br.interpolationFactor(this.interpolationType,t,n,l):0}}function Ca(i,t,n){const l=Wl(i,t,n);if(l.result==="error")return l;const d=l.value.expression,g=Hs(d);if(!g&&!Mo(t))return wa([new zr("","data expressions not supported")]);const _=nl(d,["zoom"]);if(!_&&!Bh(t))return wa([new zr("","zoom expressions not supported")]);const w=Aa(d);return w||_?w instanceof zr?wa([w]):w instanceof Br&&!Jl(t)?wa([new zr("",'"interpolate" expressions cannot be used with this property')]):Yu(w?new Ea(g?"camera":"composite",l.value,w.labels,w instanceof Br?w.interpolation:void 0,n):new Ur(g?"constant":"source",l.value,n)):wa([new zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class il{constructor(t,n){this._parameters=t,this._specification=n,zi(this,Vc(this._parameters,this._specification))}static deserialize(t){return new il(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Aa(i){let t=null;if(i instanceof qn)t=Aa(i.result);else if(i instanceof Ja){for(const n of i.args)if(t=Aa(n),t)break}else(i instanceof _a||i instanceof Br)&&i.input instanceof ao&&i.input.name==="zoom"&&(t=i);return t instanceof zr||i.eachChild((n=>{const l=Aa(n);l instanceof zr?t=l:!t&&l?t=new zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new zr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function ir(i,t=new Set){return i instanceof ju&&t.add(i.key),i.eachChild((n=>{ir(n,t)})),t}function lr(i,t){const{zoom:n,heatmapDensity:l,elevation:d,lineProgress:g,isSupportedScript:_,accumulated:w}=i??{};return{zoom:n,heatmapDensity:l,elevation:d,lineProgress:g,isSupportedScript:_,accumulated:w,globalState:t}}function vs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!vs(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const xs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Hr(i,t){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};vs(i)||(i=rl(i));const n=Wl(i,xs,t);if(n.result==="error")throw new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));return{filter:(l,d,g)=>n.value.evaluate(l,d,{},g),needGeometry:Uh(i),getGlobalStateRefs:()=>ir(n.value.expression)}}function Zs(i,t){return i<t?-1:i>t?1:0}function Uh(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(Uh(i[t]))return!0;return!1}function rl(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?Kl(i[1],i[2],"=="):t==="!="?Xn(Kl(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Kl(i[1],i[2],t):t==="any"?(n=i.slice(1),["any"].concat(n.map(rl))):t==="all"?["all"].concat(i.slice(1).map(rl)):t==="none"?["all"].concat(i.slice(1).map(rl).map(Xn)):t==="in"?Vh(i[1],i.slice(2)):t==="!in"?Xn(Vh(i[1],i.slice(2))):t==="has"?ur(i[1]):t!=="!has"||Xn(ur(i[1]));var n}function Kl(i,t,n){switch(i){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,i,t]}}function Vh(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((n=>typeof n!=typeof t[0]))?["filter-in-large",i,["literal",t.sort(Zs)]]:["filter-in-small",i,["literal",t]]}}function ur(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Xn(i){return["!",i]}function xn(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let d="[";for(const g of i)d+=`${xn(g)},`;return`${d}]`}const n=Object.keys(i).sort();let l="{";for(let d=0;d<n.length;d++)l+=`${JSON.stringify(n[d])}:${xn(i[n[d]])},`;return`${l}}`}function $s(i){let t="";for(const n of Ht)t+=`/${xn(i[n])}`;return t}function ho(i){const t=i.value;return t?[new it(i.key,t,"constants have been deprecated as of v8")]:[]}function yi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Zr(i){if(Array.isArray(i))return i.map(Zr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const n in i)t[n]=Zr(i[n]);return t}return yi(i)}function $r(i){const t=i.key,n=i.value,l=i.valueSpec||{},d=i.objectElementValidators||{},g=i.style,_=i.styleSpec,w=i.validateSpec;let A=[];const D=nn(n);if(D!=="object")return[new it(t,n,`object expected, ${D} found`)];for(const N in n){const O=N.split(".")[0],V=Ol(l,O)||l["*"];let q;if(Ol(d,O))q=d[O];else if(Ol(l,O)){if(n[N]===void 0)continue;q=w}else if(d["*"])q=d["*"];else{if(!l["*"]){A.push(new it(t,n[N],`unknown property "${N}"`));continue}q=w}A=A.concat(q({key:(t&&`${t}.`)+N,value:n[N],valueSpec:V,style:g,styleSpec:_,object:n,objectKey:N,validateSpec:w},n))}for(const N in l)d[N]||l[N].required&&l[N].default===void 0&&n[N]===void 0&&A.push(new it(t,n,`missing required property "${N}"`));return A}function Xu(i){const t=i.value,n=i.valueSpec,l=i.style,d=i.styleSpec,g=i.key,_=i.arrayElementValidator||i.validateSpec;if(nn(t)!=="array")return[new it(g,t,`array expected, ${nn(t)} found`)];if(n.length&&t.length!==n.length)return[new it(g,t,`array length ${n.length} expected, length ${t.length} found`)];let w={type:n.value,values:n.values};d.$version<7&&(w.function=n.function),nn(n.value)==="object"&&(w=n.value);let A=[];for(let D=0;D<t.length;D++)A=A.concat(_({array:t,arrayIndex:D,value:t[D],valueSpec:w,validateSpec:i.validateSpec,style:l,styleSpec:d,key:`${g}[${D}]`}));return A}function bs(i){const t=i.key,n=i.value,l=i.valueSpec;let d=nn(n);return d==="number"&&n!=n&&(d="NaN"),d!=="number"?[new it(t,n,`number expected, ${d} found`)]:"minimum"in l&&n<l.minimum?[new it(t,n,`${n} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&n>l.maximum?[new it(t,n,`${n} is greater than the maximum value ${l.maximum}`)]:[]}function ws(i){const t=i.valueSpec,n=yi(i.value.type);let l,d,g,_={};const w=n!=="categorical"&&i.value.property===void 0,A=!w,D=nn(i.value.stops)==="array"&&nn(i.value.stops[0])==="array"&&nn(i.value.stops[0][0])==="object",N=$r({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(q){if(n==="identity")return[new it(q.key,q.value,'identity function may not have a "stops" property')];let j=[];const Y=q.value;return j=j.concat(Xu({key:q.key,value:Y,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:O})),nn(Y)==="array"&&Y.length===0&&j.push(new it(q.key,Y,"array must have at least one stop")),j},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:t,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return n==="identity"&&w&&N.push(new it(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||N.push(new it(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!Jl(i.valueSpec)&&N.push(new it(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(A&&!Mo(i.valueSpec)?N.push(new it(i.key,i.value,"property functions not supported")):w&&!Bh(i.valueSpec)&&N.push(new it(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!D||i.value.property!==void 0||N.push(new it(i.key,i.value,'"property" property is required')),N;function O(q){let j=[];const Y=q.value,J=q.key;if(nn(Y)!=="array")return[new it(J,Y,`array expected, ${nn(Y)} found`)];if(Y.length!==2)return[new it(J,Y,`array length 2 expected, length ${Y.length} found`)];if(D){if(nn(Y[0])!=="object")return[new it(J,Y,`object expected, ${nn(Y[0])} found`)];if(Y[0].zoom===void 0)return[new it(J,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new it(J,Y,"object stop key must have value")];if(g&&g>yi(Y[0].zoom))return[new it(J,Y[0].zoom,"stop zoom values must appear in ascending order")];yi(Y[0].zoom)!==g&&(g=yi(Y[0].zoom),d=void 0,_={}),j=j.concat($r({key:`${J}[0]`,value:Y[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:bs,value:V}}))}else j=j.concat(V({key:`${J}[0]`,value:Y[0],validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},Y));return Sa(Zr(Y[1]))?j.concat([new it(`${J}[1]`,Y[1],"expressions are not allowed in function stops.")]):j.concat(q.validateSpec({key:`${J}[1]`,value:Y[1],valueSpec:t,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function V(q,j){const Y=nn(q.value),J=yi(q.value),ie=q.value!==null?q.value:j;if(l){if(Y!==l)return[new it(q.key,ie,`${Y} stop domain type must match previous stop domain type ${l}`)]}else l=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean")return[new it(q.key,ie,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&n!=="categorical"){let de=`number expected, ${Y} found`;return Mo(t)&&n===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(q.key,ie,de)]}return n!=="categorical"||Y!=="number"||isFinite(J)&&Math.floor(J)===J?n!=="categorical"&&Y==="number"&&d!==void 0&&J<d?[new it(q.key,ie,"stop domain values must appear in ascending order")]:(d=J,n==="categorical"&&J in _?[new it(q.key,ie,"stop domain values must be unique")]:(_[J]=!0,[])):[new it(q.key,ie,`integer expected, found ${J}`)]}}function Ts(i){const t=(i.expressionContext==="property"?Ca:Wl)(Zr(i.value),i.valueSpec);if(t.result==="error")return t.value.map((l=>new it(`${i.key}${l.key}`,i.value,l.message)));const n=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new it(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!tl(n))return[new it(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!tl(n))return[new it(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!nl(n,["zoom","feature-state"]))return[new it(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Hs(n))return[new it(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function js(i){const t=i.key,n=i.value,l=nn(n);return l!=="string"?[new it(t,n,`color expected, ${l} found`)]:rn.parse(String(n))?[]:[new it(t,n,`color expected, "${n}" found`)]}function Ys(i){const t=i.key,n=i.value,l=i.valueSpec,d=[];return Array.isArray(l.values)?l.values.indexOf(yi(n))===-1&&d.push(new it(t,n,`expected one of [${l.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(l.values).indexOf(yi(n))===-1&&d.push(new it(t,n,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(n)} found`)),d}function Io(i){return vs(Zr(i.value))?Ts(zi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ss(i)}function Ss(i){const t=i.value,n=i.key;if(nn(t)!=="array")return[new it(n,t,`array expected, ${nn(t)} found`)];const l=i.styleSpec;let d,g=[];if(t.length<1)return[new it(n,t,"filter array must have at least 1 element")];switch(g=g.concat(Ys({key:`${n}[0]`,value:t[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),yi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&yi(t[1])==="$type"&&g.push(new it(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new it(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(d=nn(t[1]),d!=="string"&&g.push(new it(`${n}[1]`,t[1],`string expected, ${d} found`)));for(let _=2;_<t.length;_++)d=nn(t[_]),yi(t[1])==="$type"?g=g.concat(Ys({key:`${n}[${_}]`,value:t[_],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&g.push(new it(`${n}[${_}]`,t[_],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)g=g.concat(Ss({key:`${n}[${_}]`,value:t[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=nn(t[1]),t.length!==2?g.push(new it(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):d!=="string"&&g.push(new it(`${n}[1]`,t[1],`string expected, ${d} found`))}return g}function Xs(i,t){const n=i.key,l=i.validateSpec,d=i.style,g=i.styleSpec,_=i.value,w=i.objectKey,A=g[`${t}_${i.layerType}`];if(!A)return[];const D=w.match(/^(.*)-transition$/);if(t==="paint"&&D&&A[D[1]]&&A[D[1]].transition)return l({key:n,value:_,valueSpec:g.transition,style:d,styleSpec:g});const N=i.valueSpec||A[w];if(!N)return[new it(n,_,`unknown property "${w}"`)];let O;if(nn(_)==="string"&&Mo(N)&&!N.tokens&&(O=/^{([^}]+)}$/.exec(_)))return[new it(n,_,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const V=[];return i.layerType==="symbol"&&w==="text-font"&&Uc(Zr(_))&&yi(_.type)==="identity"&&V.push(new it(n,_,'"text-font" does not support identity functions')),V.concat(l({key:i.key,value:_,valueSpec:N,style:d,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:w}))}function Es(i){return Xs(i,"paint")}function Hc(i){return Xs(i,"layout")}function Zc(i){let t=[];const n=i.value,l=i.key,d=i.style,g=i.styleSpec;if(nn(n)!=="object")return[new it(l,n,`object expected, ${nn(n)} found`)];n.type||n.ref||t.push(new it(l,n,'either "type" or "ref" is required'));let _=yi(n.type);const w=yi(n.ref);if(n.id){const A=yi(n.id);for(let D=0;D<i.arrayIndex;D++){const N=d.layers[D];yi(N.id)===A&&t.push(new it(l,n.id,`duplicate layer id "${n.id}", previously used at line ${N.id.__line__}`))}}if("ref"in n){let A;["type","source","source-layer","filter","layout"].forEach((D=>{D in n&&t.push(new it(l,n[D],`"${D}" is prohibited for ref layers`))})),d.layers.forEach((D=>{yi(D.id)===w&&(A=D)})),A?A.ref?t.push(new it(l,n.ref,"ref cannot reference another ref layer")):_=yi(A.type):t.push(new it(l,n.ref,`ref layer "${w}" not found`))}else if(_!=="background")if(n.source){const A=d.sources&&d.sources[n.source],D=A&&yi(A.type);A?D==="vector"&&_==="raster"?t.push(new it(l,n.source,`layer "${n.id}" requires a raster source`)):D!=="raster-dem"&&_==="hillshade"||D!=="raster-dem"&&_==="color-relief"?t.push(new it(l,n.source,`layer "${n.id}" requires a raster-dem source`)):D==="raster"&&_!=="raster"?t.push(new it(l,n.source,`layer "${n.id}" requires a vector source`)):D!=="vector"||n["source-layer"]?D==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?t.push(new it(l,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!n.paint||!n.paint["line-gradient"]||D==="geojson"&&A.lineMetrics||t.push(new it(l,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new it(l,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new it(l,n.source,`source "${n.source}" not found`))}else t.push(new it(l,n,'missing required property "source"'));return t=t.concat($r({key:l,value:n,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:n.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:Io,layout:A=>$r({layer:n,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":D=>Hc(zi({layerType:_},D))}}),paint:A=>$r({layer:n,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":D=>Es(zi({layerType:_},D))}})}})),t}function fo(i){const t=i.value,n=i.key,l=nn(t);return l!=="string"?[new it(n,t,`string expected, ${l} found`)]:[]}const Ql={promoteId:function({key:i,value:t}){if(nn(t)==="string")return fo({key:i,value:t});{const n=[];for(const l in t)n.push(...fo({key:`${i}.${l}`,value:t[l]}));return n}}};function Js(i){const t=i.value,n=i.key,l=i.styleSpec,d=i.style,g=i.validateSpec;if(!t.type)return[new it(n,t,'"type" is required')];const _=yi(t.type);let w;switch(_){case"vector":case"raster":return w=$r({key:n,value:t,valueSpec:l[`source_${_.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:Ql,validateSpec:g}),w;case"raster-dem":return w=(function(A){var D;const N=(D=A.sourceName)!==null&&D!==void 0?D:"",O=A.value,V=A.styleSpec,q=V.source_raster_dem,j=A.style;let Y=[];const J=nn(O);if(O===void 0)return Y;if(J!=="object")return Y.push(new it("source_raster_dem",O,`object expected, ${J} found`)),Y;const ie=yi(O.encoding)==="custom",de=["redFactor","greenFactor","blueFactor","baseShift"],re=A.value.encoding?`"${A.value.encoding}"`:"Default";for(const ae in O)!ie&&de.includes(ae)?Y.push(new it(ae,O[ae],`In "${N}": "${ae}" is only valid when "encoding" is set to "custom". ${re} encoding found`)):q[ae]?Y=Y.concat(A.validateSpec({key:ae,value:O[ae],valueSpec:q[ae],validateSpec:A.validateSpec,style:j,styleSpec:V})):Y.push(new it(ae,O[ae],`unknown property "${ae}"`));return Y})({sourceName:n,value:t,style:i.style,styleSpec:l,validateSpec:g}),w;case"geojson":if(w=$r({key:n,value:t,valueSpec:l.source_geojson,style:d,styleSpec:l,validateSpec:g,objectElementValidators:Ql}),t.cluster)for(const A in t.clusterProperties){const[D,N]=t.clusterProperties[A],O=typeof D=="string"?[D,["accumulated"],["get",A]]:D;w.push(...Ts({key:`${n}.${A}.map`,value:N,expressionContext:"cluster-map"})),w.push(...Ts({key:`${n}.${A}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return w;case"video":return $r({key:n,value:t,valueSpec:l.source_video,style:d,validateSpec:g,styleSpec:l});case"image":return $r({key:n,value:t,valueSpec:l.source_image,style:d,validateSpec:g,styleSpec:l});case"canvas":return[new it(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ys({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Vi(i){const t=i.value,n=i.styleSpec,l=n.light,d=i.style;let g=[];const _=nn(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new it("light",t,`object expected, ${_} found`)]),g;for(const w in t){const A=w.match(/^(.*)-transition$/);g=g.concat(A&&l[A[1]]&&l[A[1]].transition?i.validateSpec({key:w,value:t[w],valueSpec:n.transition,validateSpec:i.validateSpec,style:d,styleSpec:n}):l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],validateSpec:i.validateSpec,style:d,styleSpec:n}):[new it(w,t[w],`unknown property "${w}"`)])}return g}function Ju(i){const t=i.value,n=i.styleSpec,l=n.sky,d=i.style,g=nn(t);if(t===void 0)return[];if(g!=="object")return[new it("sky",t,`object expected, ${g} found`)];let _=[];for(const w in t)_=_.concat(l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],style:d,styleSpec:n}):[new it(w,t[w],`unknown property "${w}"`)]);return _}function $c(i){const t=i.value,n=i.styleSpec,l=n.terrain,d=i.style;let g=[];const _=nn(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new it("terrain",t,`object expected, ${_} found`)]),g;for(const w in t)g=g.concat(l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],validateSpec:i.validateSpec,style:d,styleSpec:n}):[new it(w,t[w],`unknown property "${w}"`)]);return g}function Gh(i){let t=[];const n=i.value,l=i.key;if(Array.isArray(n)){const d=[],g=[];for(const _ in n)n[_].id&&d.includes(n[_].id)&&t.push(new it(l,n,`all the sprites' ids must be unique, but ${n[_].id} is duplicated`)),d.push(n[_].id),n[_].url&&g.includes(n[_].url)&&t.push(new it(l,n,`all the sprites' URLs must be unique, but ${n[_].url} is duplicated`)),g.push(n[_].url),t=t.concat($r({key:`${l}[${_}]`,value:n[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return fo({key:l,value:n})}function rf(i){return!!i&&i.constructor===Object}function qh(i){return rf(i.value)?[]:[new it(i.key,i.value,`object expected, ${nn(i.value)} found`)]}const Ni={"*":()=>[],array:Xu,boolean:function(i){const t=i.value,n=i.key,l=nn(t);return l!=="boolean"?[new it(n,t,`boolean expected, ${l} found`)]:[]},number:bs,color:js,constants:ho,enum:Ys,filter:Io,function:ws,layer:Zc,object:$r,source:Js,light:Vi,sky:Ju,terrain:$c,projection:function(i){const t=i.value,n=i.styleSpec,l=n.projection,d=i.style,g=nn(t);if(t===void 0)return[];if(g!=="object")return[new it("projection",t,`object expected, ${g} found`)];let _=[];for(const w in t)_=_.concat(l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],style:d,styleSpec:n}):[new it(w,t[w],`unknown property "${w}"`)]);return _},projectionDefinition:function(i){const t=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const l=nn(n);return l!=="array"||(function(d){return Array.isArray(d)&&d.length===3&&typeof d[0]=="string"&&typeof d[1]=="string"&&typeof d[2]=="number"})(n)||(function(d){return!!["interpolate","step","literal"].includes(d[0])})(n)?["array","string"].includes(l)?[]:[new it(t,n,`projection expected, invalid type "${l}" found`)]:[new it(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:fo,formatted:function(i){return fo(i).length===0?[]:Ts(i)},resolvedImage:function(i){return fo(i).length===0?[]:Ts(i)},padding:function(i){const t=i.key,n=i.value;if(nn(n)==="array"){if(n.length<1||n.length>4)return[new it(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const l={type:"number"};let d=[];for(let g=0;g<n.length;g++)d=d.concat(i.validateSpec({key:`${t}[${g}]`,value:n[g],validateSpec:i.validateSpec,valueSpec:l}));return d}return bs({key:t,value:n,valueSpec:{}})},numberArray:function(i){const t=i.key,n=i.value;if(nn(n)==="array"){const l={type:"number"};if(n.length<1)return[new it(t,n,"array length at least 1 expected, length 0 found")];let d=[];for(let g=0;g<n.length;g++)d=d.concat(i.validateSpec({key:`${t}[${g}]`,value:n[g],validateSpec:i.validateSpec,valueSpec:l}));return d}return bs({key:t,value:n,valueSpec:{}})},colorArray:function(i){const t=i.key,n=i.value;if(nn(n)==="array"){if(n.length<1)return[new it(t,n,"array length at least 1 expected, length 0 found")];let l=[];for(let d=0;d<n.length;d++)l=l.concat(js({key:`${t}[${d}]`,value:n[d]}));return l}return js({key:t,value:n})},variableAnchorOffsetCollection:function(i){const t=i.key,n=i.value,l=nn(n),d=i.styleSpec;if(l!=="array"||n.length<1||n.length%2!=0)return[new it(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<n.length;_+=2)g=g.concat(Ys({key:`${t}[${_}]`,value:n[_],valueSpec:d.layout_symbol["text-anchor"]})),g=g.concat(Xu({key:`${t}[${_+1}]`,value:n[_+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:d}));return g},sprite:Gh,state:qh,fontFaces:function(i){const t=i.key,n=i.value,l=i.validateSpec,d=i.styleSpec,g=i.style;if(!rf(n))return[new it(t,n,`object expected, ${nn(n)} found`)];const _=[];for(const w in n){const A=n[w],D=nn(A);if(D==="string")_.push(...fo({key:`${t}.${w}`,value:A}));else if(D==="array"){const N={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[O,V]of A.entries())_.push(...$r({key:`${t}.${w}[${O}]`,value:V,valueSpec:N,styleSpec:d,style:g,validateSpec:l}))}else _.push(new it(`${t}.${w}`,A,`string or array expected, ${D} found`))}return _}};function Cs(i){const t=i.value,n=i.valueSpec,l=i.styleSpec;return i.validateSpec=Cs,n.expression&&Uc(yi(t))?ws(i):n.expression&&Sa(Zr(t))?Ts(i):n.type&&Ni[n.type]?Ni[n.type](i):$r(zi({},i,{valueSpec:n.type?l[n.type]:n}))}function eu(i){const t=i.value,n=i.key,l=fo(i);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new it(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new it(n,t,'"glyphs" url must include a "{range}" token'))),l}function Cr(i,t=Ce){let n=[];return n=n.concat(Cs({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:Cs,objectElementValidators:{glyphs:eu,"*":()=>[]}})),i.constants&&(n=n.concat(ho({key:"constants",value:i.constants}))),ol(n)}function po(i){return function(t){return i(Object.assign({},t,{validateSpec:Cs}))}}function ol(i){return[].concat(i).sort(((t,n)=>t.line-n.line))}function Ar(i){return function(...t){return ol(i.apply(this,t))}}Cr.source=Ar(po(Js)),Cr.sprite=Ar(po(Gh)),Cr.glyphs=Ar(po(eu)),Cr.light=Ar(po(Vi)),Cr.sky=Ar(po(Ju)),Cr.terrain=Ar(po($c)),Cr.state=Ar(po(qh)),Cr.layer=Ar(po(Zc)),Cr.filter=Ar(po(Io)),Cr.paintProperty=Ar(po(Es)),Cr.layoutProperty=Ar(po(Hc));const vp={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class tu{constructor(t,n){this._globalState=n,this.setValue(t)}evaluate(){var t;return(t=this._literalValue)!==null&&t!==void 0?t:this._compiledValue.evaluate({})}setValue(t){if(t==null||t==="visible"||t==="none")return this._literalValue=t==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const n=Wl(t,vp,this._globalState);if(n.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=n.value,this._globalStateRefs=ir(n.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const Wu=Ce,rr=Cr,Yo=rr.light,jc=rr.sky,Yc=rr.paintProperty,of=rr.layoutProperty;function Xo(i,t){let n=!1;if(t&&t.length)for(const l of t)i.fire(new $e(new Error(l.message))),n=!0;return n}class Ma{constructor(t,n,l){const d=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(n=_[1])+2*(l=_[2]);for(let A=0;A<this.d*this.d;A++){const D=_[3+A],N=_[3+A+1];d.push(D===N?null:_.subarray(D,N))}const w=_[3+d.length+1];this.keys=_.subarray(_[3+d.length],w),this.bboxes=_.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*l;for(let _=0;_<this.d*this.d;_++)d.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=l,this.scale=n/t,this.uid=0;const g=l/n*t;this.min=-g,this.max=t+g}insert(t,n,l,d,g){this._forEachCell(n,l,d,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,l,d,g,_){this.cells[g].push(_)}query(t,n,l,d,g){const _=this.min,w=this.max;if(t<=_&&n<=_&&w<=l&&w<=d&&!g)return Array.prototype.slice.call(this.keys);{const A=[];return this._forEachCell(t,n,l,d,this._queryCell,A,{},g),A}}_queryCell(t,n,l,d,g,_,w,A){const D=this.cells[g];if(D!==null){const N=this.keys,O=this.bboxes;for(let V=0;V<D.length;V++){const q=D[V];if(w[q]===void 0){const j=4*q;(A?A(O[j+0],O[j+1],O[j+2],O[j+3]):t<=O[j+2]&&n<=O[j+3]&&l>=O[j+0]&&d>=O[j+1])?(w[q]=!0,_.push(N[q])):w[q]=!1}}}}_forEachCell(t,n,l,d,g,_,w,A){const D=this._convertToCellCoord(t),N=this._convertToCellCoord(n),O=this._convertToCellCoord(l),V=this._convertToCellCoord(d);for(let q=D;q<=O;q++)for(let j=N;j<=V;j++){const Y=this.d*j+q;if((!A||A(this._convertFromCellCoord(q),this._convertFromCellCoord(j),this._convertFromCellCoord(q+1),this._convertFromCellCoord(j+1)))&&g.call(this,t,n,l,d,Y,_,w,A))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let l=0;for(let _=0;_<this.cells.length;_++)l+=this.cells[_].length;const d=new Int32Array(n+l+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let g=n;for(let _=0;_<t.length;_++){const w=t[_];d[3+_]=g,d.set(w,g),g+=w.length}return d[3+t.length]=g,d.set(this.keys,g),g+=this.keys.length,d[3+t.length+1]=g,d.set(this.bboxes,g),g+=this.bboxes.length,d.buffer}static serialize(t,n){const l=t.toArrayBuffer();return n&&n.push(l),{buffer:l}}static deserialize(t){return new Ma(t.buffer)}}const jr={};function Tt(i,t,n={}){if(jr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),jr[i]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Tt("Object",Object),Tt("Set",Set),Tt("TransferableGridIndex",Ma),Tt("Color",rn),Tt("Error",Error),Tt("AJAXError",me),Tt("ResolvedImage",Nr),Tt("StylePropertyFunction",il),Tt("StyleExpression",qc,{omit:["_evaluator"]}),Tt("ZoomDependentExpression",Ea),Tt("ZoomConstantExpression",Ur),Tt("CompoundExpression",ao,{omit:["_evaluate"]});for(const i in Xl)Xl[i]._classRegistryKey||Tt(`Expression_${i}`,Xl[i]);function Ku(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Xc(i){return i.$name||i.constructor._classRegistryKey}function Ro(i){return!(function(t){if(t===null||typeof t!="object")return!1;const n=Xc(t);return!(!n||n==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Ku(i)||ar(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Jo(i,t){if(Ro(i))return(Ku(i)||ar(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const g=[];for(const _ of i)g.push(Jo(_,t));return g}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=Xc(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!jr[n])throw new Error(`${n} is not registered.`);const{klass:l}=jr[n],d=l.serialize?l.serialize(i,t):{};if(l.serialize){if(t&&d===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in i){if(!i.hasOwnProperty(g)||jr[n].omit.indexOf(g)>=0)continue;const _=i[g];d[g]=jr[n].shallow.indexOf(g)>=0?_:Jo(_,t)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(d.$name=n),d}function nu(i){if(Ro(i))return i;if(Array.isArray(i))return i.map(nu);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Xc(i)||"Object";if(!jr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=jr[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i);const l=Object.create(n.prototype);for(const d of Object.keys(i)){if(d==="$name")continue;const g=i[d];l[d]=jr[t].shallow.indexOf(d)>=0?g:nu(g)}return l}class Jc{constructor(){this.first=!0}update(t,n){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}function As(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function sl(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function Qu(i){return/\s/u.test(String.fromCodePoint(i))}function Ms(i){for(const t of i)if(sl(t.codePointAt(0)))return!0;return!1}function Wc(i){for(const t of i)if(!Hh(t.codePointAt(0)))return!1;return!0}function ec(i){const t=i.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(t.join("|"),"u")}const Is=ec(["Arab","Dupl","Mong","Ougr","Syrc"]);function Hh(i){return!Is.test(String.fromCodePoint(i))}function Rs(i){return!(sl(i)||(t=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(t))));var t}const Kc=ec(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function tc(i){return Kc.test(String.fromCodePoint(i))}function Ps(i,t){return!(!t&&tc(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function Ws(i){for(const t of i)if(tc(t.codePointAt(0)))return!0;return!1}const Po=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Po.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,t){return c(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,l=new Promise((g=>{this.loadScriptResolve=g}));t(n);const d=new Promise((g=>setTimeout((()=>g()),this.TIMEOUT)));if(yield Promise.race([l,d]),this.isParsed()){const g={pluginStatus:"loaded",pluginURL:n};return this.setState(g),g}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class Un{constructor(t,n){this.isSupportedScript=Zh,this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new Jc,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Jc,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*n}}}function Zh(i){return(function(t,n){for(const l of t)if(!Ps(l.codePointAt(0),n))return!1;return!0})(i,Po.getRTLTextPluginStatus()==="loaded")}const Ks="-transition";class Ia{constructor(t,n,l){this.property=t,this.value=n,this.expression=(function(d,g,_){if(Uc(d))return new il(d,g);if(Sa(d)){const w=Ca(d,g,_);if(w.result==="error")throw new Error(w.value.map((A=>`${A.key}: ${A.message}`)).join(", "));return w.value}{let w=d;return g.type==="color"&&typeof d=="string"?w=rn.parse(d):g.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?g.type!=="numberArray"||typeof d!="number"&&!Array.isArray(d)?g.type!=="colorArray"||typeof d!="string"&&!Array.isArray(d)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(d)?w=Ti.parse(d):g.type==="projectionDefinition"&&typeof d=="string"&&(w=nr.parse(d)):w=qt.parse(d):w=ci.parse(d):w=Ui.parse(d),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>w}}})(n===void 0?t.specification.default:n,t.specification,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,l){return this.property.possiblyEvaluate(this,t,n,l)}}class nc{constructor(t,n){this.property=t,this.value=new Ia(t,void 0,n)}transitioned(t,n){return new al(this.property,this.value,n,Nt({},t.transition,this.transition),t.now)}untransitioned(){return new al(this.property,this.value,null,{},0)}}class Qc{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=n}getValue(t){return Pi(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new nc(this._values[t].property,this._globalState)),this._values[t].value=new Ia(this._values[t].property,n===null?void 0:Pi(n),this._globalState)}getTransition(t){return Pi(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new nc(this._values[t].property,this._globalState)),this._values[t].transition=Pi(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(t[n]=l);const d=this.getTransition(n);d!==void 0&&(t[`${n}${Ks}`]=d)}return t}transitioned(t,n){const l=new ic(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].transitioned(t,n._values[d]);return l}untransitioned(){const t=new ic(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class al{constructor(t,n,l,d,g){this.property=t,this.value=n,this.begin=g+d.delay||0,this.end=this.begin+d.duration||0,t.specification.transition&&(d.delay||d.duration)&&(this.prior=l)}possiblyEvaluate(t,n,l){const d=t.now||0,g=this.value.possiblyEvaluate(t,n,l),_=this.prior;if(_){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return _.possiblyEvaluate(t,n,l);{const w=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,n,l),g,Et(w))}}return g}}class ic{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,l){const d=new ll(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(t,n,l);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class $h{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=n}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Pi(this._values[t].value)}setValue(t,n){this._values[t]=new Ia(this._values[t].property,n===null?void 0:Pi(n),this._globalState)}serialize(){const t={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(t[n]=l)}return t}possiblyEvaluate(t,n,l){const d=new ll(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(t,n,l);return d}}class mo{constructor(t,n,l){this.property=t,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,l,d){return this.property.evaluate(this.value,this.parameters,t,n,l,d)}}class ll{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class St{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,l){const d=di[this.specification.type];return d?d(t,n,l):t}}class It{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,l,d){return new mo(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},l,d)}:t.expression,n)}interpolate(t,n,l){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new mo(this,{kind:"constant",value:void 0},t.parameters);const d=di[this.specification.type];if(d){const g=d(t.value.value,n.value.value,l);return new mo(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,n,l,d,g,_){return t.kind==="constant"?t.value:t.evaluate(n,l,d,g,_)}}class Do extends It{possiblyEvaluate(t,n,l,d){if(t.value===void 0)return new mo(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const g=t.expression.evaluate(n,null,{},l,d),_=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,w=this._calculate(_,_,_,n);return new mo(this,{kind:"constant",value:w},n)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new mo(this,{kind:"constant",value:g},n)}return new mo(this,t.expression,n)}evaluate(t,n,l,d,g,_){if(t.kind==="source"){const w=t.evaluate(n,l,d,g,_);return this._calculate(w,w,w,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},l,d),t.evaluate({zoom:Math.floor(n.zoom)},l,d),t.evaluate({zoom:Math.floor(n.zoom)+1},l,d),n):t.value}_calculate(t,n,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:l,to:n}}interpolate(t){return t}}class iu{constructor(t){this.specification=t}possiblyEvaluate(t,n,l,d){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(n,null,{},l,d);return this._calculate(g,g,g,n)}return this._calculate(t.expression.evaluate(new Un(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Un(Math.floor(n.zoom),n)),t.expression.evaluate(new Un(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:l,to:n}}interpolate(t){return t}}class rc{constructor(t){this.specification=t}possiblyEvaluate(t,n,l,d){return!!t.expression.evaluate(n,null,{},l,d)}interpolate(){return!1}}class ki{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const l=t[n];l.specification.overridable&&this.overridableProperties.push(n);const d=this.defaultPropertyValues[n]=new Ia(l,void 0,void 0),g=this.defaultTransitionablePropertyValues[n]=new nc(l,void 0);this.defaultTransitioningPropertyValues[n]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=d.possiblyEvaluate({})}}}Tt("DataDrivenProperty",It),Tt("DataConstantProperty",St),Tt("CrossFadedDataDrivenProperty",Do),Tt("CrossFadedProperty",iu),Tt("ColorRampProperty",rc);class vi extends ut{constructor(t,n,l){if(super(),this.id=t.id,this.type=t.type,this._globalState=l,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(d,g){return new tu(d,g)})(this.visibility,l),t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Hr(t.filter,l)),n.layout&&(this._unevaluatedLayout=new $h(n.layout,l)),n.paint)){this._transitionablePaint=new Qc(n.paint,l);for(const d in t.paint)this.setPaintProperty(d,t.paint[d],{validate:!1});for(const d in t.layout)this.setLayoutProperty(d,t.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ll(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=Hr(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;for(const n of this._visibilityExpression.getGlobalStateRefs())t.add(n);if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[n];for(const d of l.getGlobalStateRefs())t.add(d)}for(const n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}getPaintAffectingGlobalStateRefs(){var t;const n=new globalThis.Map;if(this._transitionablePaint)for(const l in this._transitionablePaint._values){const d=this._transitionablePaint._values[l].value;for(const g of d.getGlobalStateRefs()){const _=(t=n.get(g))!==null&&t!==void 0?t:[];_.push({name:l,value:d.value}),n.set(g,_)}}return n}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(t,n,l={}){if(n==null||!this._validate(of,`layers.${this.id}.layout.${t}`,t,n,l))return t==="visibility"?(this.visibility=n,this._visibilityExpression.setValue(n),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(t,n)}getPaintProperty(t){return t.endsWith(Ks)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,l={}){if(n!=null&&this._validate(Yc,`layers.${this.id}.paint.${t}`,t,n,l))return!1;if(t.endsWith(Ks))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const d=this._transitionablePaint._values[t],g=d.property.specification["property-type"]==="cross-faded-data-driven",_=d.value.isDataDriven(),w=d.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const A=this._transitionablePaint._values[t].value;return A.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(t,w,A)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,l){return!1}isHidden(t=this.minzoom,n=!1){return!!(this.minzoom&&t<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&t>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),bn(t,((n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length)))}_validate(t,n,l,d,g={}){return(!g||g.validate!==!1)&&Xo(this,t.call(rr,{key:n,layerType:this.type,objectKey:l,value:d,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof mo&&Mo(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let Ei;var oc={get paint(){return Ei=Ei||new ki({"raster-opacity":new St(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new St(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new St(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new St(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new St(Ce.paint_raster["raster-saturation"]),"raster-contrast":new St(Ce.paint_raster["raster-contrast"]),"raster-resampling":new St(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new St(Ce.paint_raster["raster-fade-duration"])})}};class Qs extends vi{constructor(t,n){super(t,oc,n)}}const ln={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bn{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class sn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function fi(i,t=1){let n=0,l=0;return{members:i.map((d=>{const g=ln[d.type].BYTES_PER_ELEMENT,_=n=zo(n,Math.max(t,g)),w=d.components||1;return l=Math.max(l,g),n+=g*w,{name:d.name,type:d.type,components:w,offset:_}})),size:zo(n,Math.max(l,t)),alignment:t}}function zo(i,t){return Math.ceil(i/t)*t}class Wo extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const l=this.length;return this.resize(l+1),this.emplace(l,t,n)}emplace(t,n,l){const d=2*t;return this.int16[d+0]=n,this.int16[d+1]=l,t}}Wo.prototype.bytesPerElement=4,Tt("StructArrayLayout2i4",Wo);class ul extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,l)}emplace(t,n,l,d){const g=3*t;return this.int16[g+0]=n,this.int16[g+1]=l,this.int16[g+2]=d,t}}ul.prototype.bytesPerElement=6,Tt("StructArrayLayout3i6",ul);class cl extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,l,d)}emplace(t,n,l,d,g){const _=4*t;return this.int16[_+0]=n,this.int16[_+1]=l,this.int16[_+2]=d,this.int16[_+3]=g,t}}cl.prototype.bytesPerElement=8,Tt("StructArrayLayout4i8",cl);class ea extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,d,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,l,d,g,_)}emplace(t,n,l,d,g,_,w){const A=6*t;return this.int16[A+0]=n,this.int16[A+1]=l,this.int16[A+2]=d,this.int16[A+3]=g,this.int16[A+4]=_,this.int16[A+5]=w,t}}ea.prototype.bytesPerElement=12,Tt("StructArrayLayout2i4i12",ea);class jh extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,d,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,l,d,g,_)}emplace(t,n,l,d,g,_,w){const A=4*t,D=8*t;return this.int16[A+0]=n,this.int16[A+1]=l,this.uint8[D+4]=d,this.uint8[D+5]=g,this.uint8[D+6]=_,this.uint8[D+7]=w,t}}jh.prototype.bytesPerElement=8,Tt("StructArrayLayout2i4ub8",jh);class ai extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const l=this.length;return this.resize(l+1),this.emplace(l,t,n)}emplace(t,n,l){const d=2*t;return this.float32[d+0]=n,this.float32[d+1]=l,t}}ai.prototype.bytesPerElement=8,Tt("StructArrayLayout2f8",ai);class Ko extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l,d,g,_,w,A,D,N){const O=this.length;return this.resize(O+1),this.emplace(O,t,n,l,d,g,_,w,A,D,N)}emplace(t,n,l,d,g,_,w,A,D,N,O){const V=10*t;return this.uint16[V+0]=n,this.uint16[V+1]=l,this.uint16[V+2]=d,this.uint16[V+3]=g,this.uint16[V+4]=_,this.uint16[V+5]=w,this.uint16[V+6]=A,this.uint16[V+7]=D,this.uint16[V+8]=N,this.uint16[V+9]=O,t}}Ko.prototype.bytesPerElement=20,Tt("StructArrayLayout10ui20",Ko);class ru extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l,d,g,_,w,A){const D=this.length;return this.resize(D+1),this.emplace(D,t,n,l,d,g,_,w,A)}emplace(t,n,l,d,g,_,w,A,D){const N=8*t;return this.uint16[N+0]=n,this.uint16[N+1]=l,this.uint16[N+2]=d,this.uint16[N+3]=g,this.uint16[N+4]=_,this.uint16[N+5]=w,this.uint16[N+6]=A,this.uint16[N+7]=D,t}}ru.prototype.bytesPerElement=16,Tt("StructArrayLayout8ui16",ru);class ou extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l,d,g,_,w,A,D,N,O,V){const q=this.length;return this.resize(q+1),this.emplace(q,t,n,l,d,g,_,w,A,D,N,O,V)}emplace(t,n,l,d,g,_,w,A,D,N,O,V,q){const j=12*t;return this.int16[j+0]=n,this.int16[j+1]=l,this.int16[j+2]=d,this.int16[j+3]=g,this.uint16[j+4]=_,this.uint16[j+5]=w,this.uint16[j+6]=A,this.uint16[j+7]=D,this.int16[j+8]=N,this.int16[j+9]=O,this.int16[j+10]=V,this.int16[j+11]=q,t}}ou.prototype.bytesPerElement=24,Tt("StructArrayLayout4i4ui4i24",ou);class sc extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,l)}emplace(t,n,l,d){const g=3*t;return this.float32[g+0]=n,this.float32[g+1]=l,this.float32[g+2]=d,t}}sc.prototype.bytesPerElement=12,Tt("StructArrayLayout3f12",sc);class ac extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}ac.prototype.bytesPerElement=4,Tt("StructArrayLayout1ul4",ac);class lc extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l,d,g,_,w,A,D){const N=this.length;return this.resize(N+1),this.emplace(N,t,n,l,d,g,_,w,A,D)}emplace(t,n,l,d,g,_,w,A,D,N){const O=10*t,V=5*t;return this.int16[O+0]=n,this.int16[O+1]=l,this.int16[O+2]=d,this.int16[O+3]=g,this.int16[O+4]=_,this.int16[O+5]=w,this.uint32[V+3]=A,this.uint16[O+8]=D,this.uint16[O+9]=N,t}}lc.prototype.bytesPerElement=20,Tt("StructArrayLayout6i1ul2ui20",lc);class Ra extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,d,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,l,d,g,_)}emplace(t,n,l,d,g,_,w){const A=6*t;return this.int16[A+0]=n,this.int16[A+1]=l,this.int16[A+2]=d,this.int16[A+3]=g,this.int16[A+4]=_,this.int16[A+5]=w,t}}Ra.prototype.bytesPerElement=12,Tt("StructArrayLayout2i2i2i12",Ra);class ta extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,l,d,g)}emplace(t,n,l,d,g,_){const w=4*t,A=8*t;return this.float32[w+0]=n,this.float32[w+1]=l,this.float32[w+2]=d,this.int16[A+6]=g,this.int16[A+7]=_,t}}ta.prototype.bytesPerElement=16,Tt("StructArrayLayout2f1f2i16",ta);class xr extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,l,d,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,l,d,g,_)}emplace(t,n,l,d,g,_,w){const A=16*t,D=4*t,N=8*t;return this.uint8[A+0]=n,this.uint8[A+1]=l,this.float32[D+1]=d,this.float32[D+2]=g,this.int16[N+6]=_,this.int16[N+7]=w,t}}xr.prototype.bytesPerElement=16,Tt("StructArrayLayout2ub2f2i16",xr);class pi extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,l)}emplace(t,n,l,d){const g=3*t;return this.uint16[g+0]=n,this.uint16[g+1]=l,this.uint16[g+2]=d,t}}pi.prototype.bytesPerElement=6,Tt("StructArrayLayout3ui6",pi);class Ds extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l,d,g,_,w,A,D,N,O,V,q,j,Y,J,ie){const de=this.length;return this.resize(de+1),this.emplace(de,t,n,l,d,g,_,w,A,D,N,O,V,q,j,Y,J,ie)}emplace(t,n,l,d,g,_,w,A,D,N,O,V,q,j,Y,J,ie,de){const re=24*t,ae=12*t,pe=48*t;return this.int16[re+0]=n,this.int16[re+1]=l,this.uint16[re+2]=d,this.uint16[re+3]=g,this.uint32[ae+2]=_,this.uint32[ae+3]=w,this.uint32[ae+4]=A,this.uint16[re+10]=D,this.uint16[re+11]=N,this.uint16[re+12]=O,this.float32[ae+7]=V,this.float32[ae+8]=q,this.uint8[pe+36]=j,this.uint8[pe+37]=Y,this.uint8[pe+38]=J,this.uint32[ae+10]=ie,this.int16[re+22]=de,t}}Ds.prototype.bytesPerElement=48,Tt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ds);class hl extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l,d,g,_,w,A,D,N,O,V,q,j,Y,J,ie,de,re,ae,pe,be,Fe,Ke,Xe,rt,yt,ht){const je=this.length;return this.resize(je+1),this.emplace(je,t,n,l,d,g,_,w,A,D,N,O,V,q,j,Y,J,ie,de,re,ae,pe,be,Fe,Ke,Xe,rt,yt,ht)}emplace(t,n,l,d,g,_,w,A,D,N,O,V,q,j,Y,J,ie,de,re,ae,pe,be,Fe,Ke,Xe,rt,yt,ht,je){const He=32*t,wt=16*t;return this.int16[He+0]=n,this.int16[He+1]=l,this.int16[He+2]=d,this.int16[He+3]=g,this.int16[He+4]=_,this.int16[He+5]=w,this.int16[He+6]=A,this.int16[He+7]=D,this.uint16[He+8]=N,this.uint16[He+9]=O,this.uint16[He+10]=V,this.uint16[He+11]=q,this.uint16[He+12]=j,this.uint16[He+13]=Y,this.uint16[He+14]=J,this.uint16[He+15]=ie,this.uint16[He+16]=de,this.uint16[He+17]=re,this.uint16[He+18]=ae,this.uint16[He+19]=pe,this.uint16[He+20]=be,this.uint16[He+21]=Fe,this.uint16[He+22]=Ke,this.uint32[wt+12]=Xe,this.float32[wt+13]=rt,this.float32[wt+14]=yt,this.uint16[He+30]=ht,this.uint16[He+31]=je,t}}hl.prototype.bytesPerElement=64,Tt("StructArrayLayout8i15ui1ul2f2ui64",hl);class dl extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}dl.prototype.bytesPerElement=4,Tt("StructArrayLayout1f4",dl);class su extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,l)}emplace(t,n,l,d){const g=3*t;return this.uint16[6*t+0]=n,this.float32[g+1]=l,this.float32[g+2]=d,t}}su.prototype.bytesPerElement=12,Tt("StructArrayLayout1ui2f12",su);class Qo extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,l){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,l)}emplace(t,n,l,d){const g=4*t;return this.uint32[2*t+0]=n,this.uint16[g+2]=l,this.uint16[g+3]=d,t}}Qo.prototype.bytesPerElement=8,Tt("StructArrayLayout1ul2ui8",Qo);class v extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const l=this.length;return this.resize(l+1),this.emplace(l,t,n)}emplace(t,n,l){const d=2*t;return this.uint16[d+0]=n,this.uint16[d+1]=l,t}}v.prototype.bytesPerElement=4,Tt("StructArrayLayout2ui4",v);class e extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}e.prototype.bytesPerElement=2,Tt("StructArrayLayout1ui2",e);class o extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,l,d)}emplace(t,n,l,d,g){const _=4*t;return this.float32[_+0]=n,this.float32[_+1]=l,this.float32[_+2]=d,this.float32[_+3]=g,t}}o.prototype.bytesPerElement=16,Tt("StructArrayLayout4f16",o);class h extends Bn{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new F(this.anchorPointX,this.anchorPointY)}}h.prototype.size=20;class m extends lc{get(t){return new h(this,t)}}Tt("CollisionBoxArray",m);class b extends Bn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}b.prototype.size=48;class C extends Ds{get(t){return new b(this,t)}}Tt("PlacedSymbolArray",C);class R extends Bn{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}R.prototype.size=64;class z extends hl{get(t){return new R(this,t)}}Tt("SymbolInstanceArray",z);class B extends dl{getoffsetX(t){return this.float32[1*t+0]}}Tt("GlyphOffsetArray",B);class U extends ul{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Tt("SymbolLineVertexArray",U);class Z extends Bn{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Z.prototype.size=12;class H extends su{get(t){return new Z(this,t)}}Tt("TextAnchorOffsetArray",H);class X extends Bn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}X.prototype.size=8;class te extends Qo{get(t){return new X(this,t)}}Tt("FeatureIndexArray",te);class le extends Wo{}class ce extends Wo{}class ue extends Wo{}class fe extends ea{}class xe extends jh{}class he extends ai{}class ve extends Ko{}class Te extends ru{}class ge extends ou{}class Ae extends sc{}class Ve extends ac{}class ke extends Ra{}class Oe extends xr{}class Ue extends pi{}class pt extends v{}const mt=fi([{name:"a_pos",components:2,type:"Int16"}],4),{members:ot}=mt;class vt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,l,d){const g=this.segments[this.segments.length-1];return t>vt.MAX_VERTEX_ARRAY_LENGTH&&wn(`Max vertices per segment is ${vt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${vt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!g||g.vertexLength+t>vt.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d?this.createNewSegment(n,l,d):g}createNewSegment(t,n,l){const d={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(d.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(d),d}getOrCreateLatestSegment(t,n,l){return this.prepareSegment(0,t,n,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,l,d){return new vt([{vertexOffset:t,primitiveOffset:n,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])}}function Wt(i,t){return 256*(i=Vt(Math.floor(i),0,255))+Vt(Math.floor(t),0,255)}vt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tt("SegmentVector",vt);const On=fi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ti=fi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Jn,li,Hn,xi={exports:{}},ui={exports:{}},cr={exports:{}},Ci=(function(){if(Hn)return xi.exports;Hn=1;var i=(Jn||(Jn=1,ui.exports=function(n,l){var d,g,_,w,A,D,N,O;for(g=n.length-(d=3&n.length),_=l,A=3432918353,D=461845907,O=0;O<g;)N=255&n.charCodeAt(O)|(255&n.charCodeAt(++O))<<8|(255&n.charCodeAt(++O))<<16|(255&n.charCodeAt(++O))<<24,++O,_=27492+(65535&(w=5*(65535&(_=(_^=N=(65535&(N=(N=(65535&N)*A+(((N>>>16)*A&65535)<<16)&4294967295)<<15|N>>>17))*D+(((N>>>16)*D&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(N=0,d){case 3:N^=(255&n.charCodeAt(O+2))<<16;case 2:N^=(255&n.charCodeAt(O+1))<<8;case 1:_^=N=(65535&(N=(N=(65535&(N^=255&n.charCodeAt(O)))*A+(((N>>>16)*A&65535)<<16)&4294967295)<<15|N>>>17))*D+(((N>>>16)*D&65535)<<16)&4294967295}return _^=n.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),ui.exports),t=(li||(li=1,cr.exports=function(n,l){for(var d,g=n.length,_=l^g,w=0;g>=4;)d=1540483477*(65535&(d=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24))+((1540483477*(d>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++w;switch(g){case 3:_^=(255&n.charCodeAt(w+2))<<16;case 2:_^=(255&n.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&n.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),cr.exports);return xi.exports=i,xi.exports.murmur3=i,xi.exports.murmur2=t,xi.exports})(),Ai=k(Ci);class hr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,l,d){this.ids.push(zs(t)),this.positions.push(n,l,d)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=zs(t);let l=0,d=this.ids.length-1;for(;l<d;){const _=l+d>>1;this.ids[_]>=n?d=_:l=_+1}const g=[];for(;this.ids[l]===n;)g.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return g}static serialize(t,n){const l=new Float64Array(t.ids),d=new Uint32Array(t.positions);return Ls(l,d,0,l.length-1),n&&n.push(l.buffer,d.buffer),{ids:l,positions:d}}static deserialize(t){const n=new hr;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function zs(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ai(String(i))}function Ls(i,t,n,l){for(;n<l;){const d=i[n+l>>1];let g=n-1,_=l+1;for(;;){do g++;while(i[g]<d);do _--;while(i[_]>d);if(g>=_)break;es(i,g,_),es(t,3*g,3*_),es(t,3*g+1,3*_+1),es(t,3*g+2,3*_+2)}_-n<l-_?(Ls(i,t,n,_),n=_+1):(Ls(i,t,_+1,l),l=_)}}function es(i,t,n){const l=i[t];i[t]=i[n],i[n]=l}Tt("FeaturePositionMap",hr);class Yr{constructor(t,n){this.gl=t.gl,this.location=n}}class fl extends Yr{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class au extends Yr{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ts extends Yr{constructor(t,n){super(t,n),this.current=rn.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Xr=new Float32Array(16);function go(i){return[Wt(255*i.r,255*i.g),Wt(255*i.b,255*i.a)]}class Lo{constructor(t,n,l){this.value=t,this.uniformNames=n.map((d=>`u_${d}`)),this.type=l}setUniform(t,n,l){t.set(l.constantOr(this.value))}getBinding(t,n,l){return this.type==="color"?new ts(t,n):new fl(t,n)}}class No{constructor(t,n){this.uniformNames=n.map((l=>`u_${l}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,n){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(t,n,l,d){let g=null;d==="u_pattern_to"?g=this.patternTo:d==="u_pattern_from"?g=this.patternFrom:d==="u_dasharray_to"?g=this.dashTo:d==="u_dasharray_from"?g=this.dashFrom:d==="u_pixel_ratio_to"?g=this.pixelRatioTo:d==="u_pixel_ratio_from"&&(g=this.pixelRatioFrom),g!==null&&t.set(g)}getBinding(t,n,l){return l.substr(0,9)==="u_pattern"||l.substr(0,12)==="u_dasharray_"?new au(t,n):new fl(t,n)}}class Vn{constructor(t,n,l,d){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map((g=>({name:`a_${g}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new d}populatePaintArray(t,n,l){const d=this.paintVertexArray.length,g=this.expression.evaluate(new Un(0,l),n,{},l.canonical,[],l.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(d,t,g)}updatePaintArray(t,n,l,d,g){const _=this.expression.evaluate(new Un(0,g),l,d);this._setPaintValue(t,n,_)}_setPaintValue(t,n,l){if(this.type==="color"){const d=go(l);for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,d[0],d[1])}else{for(let d=t;d<n;d++)this.paintVertexArray.emplace(d,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wn{constructor(t,n,l,d,g,_){this.expression=t,this.uniformNames=n.map((w=>`u_${w}_t`)),this.type=l,this.useIntegerZoom=d,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map((w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(t,n,l){const d=this.expression.evaluate(new Un(this.zoom,l),n,{},l.canonical,[],l.formattedSection),g=this.expression.evaluate(new Un(this.zoom+1,l),n,{},l.canonical,[],l.formattedSection),_=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(_,t,d,g)}updatePaintArray(t,n,l,d,g){const _=this.expression.evaluate(new Un(this.zoom,g),l,d),w=this.expression.evaluate(new Un(this.zoom+1,g),l,d);this._setPaintValue(t,n,_,w)}_setPaintValue(t,n,l,d){if(this.type==="color"){const g=go(l),_=go(d);for(let w=t;w<n;w++)this.paintVertexArray.emplace(w,g[0],g[1],_[0],_[1])}else{for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const l=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,d=Vt(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(d)}getBinding(t,n,l){return new fl(t,n)}}class Gi{constructor(t,n,l,d,g,_){this.expression=t,this.type=n,this.useIntegerZoom=l,this.zoom=d,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,n,l){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(d,t,this.getPositionIds(n),l)}updatePaintArray(t,n,l,d,g){this._setPaintValues(t,n,this.getPositionIds(l),g)}_setPaintValues(t,n,l,d){const g=this.getPositions(d);if(!g||!l)return;const _=g[l.min],w=g[l.mid],A=g[l.max];if(_&&w&&A)for(let D=t;D<n;D++)this.emplace(this.zoomInPaintVertexArray,D,w,_),this.emplace(this.zoomOutPaintVertexArray,D,w,A)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Wi extends Gi{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return On.members}emplace(t,n,l,d){t.emplace(n,l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],d.tlbr[0],d.tlbr[1],d.tlbr[2],d.tlbr[3],l.pixelRatio,d.pixelRatio)}}class eh extends Gi{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return ti.members}emplace(t,n,l,d){t.emplace(n,0,l.y,l.height,l.width,0,d.y,d.height,d.width)}}class th{constructor(t,n,l){this.binders={},this._buffers=[];const d=[];for(const g in t.paint._values){if(!l(g))continue;const _=t.paint.get(g);if(!(_ instanceof mo&&Mo(_.property.specification)))continue;const w=sf(g,t.type),A=_.value,D=_.property.specification.type,N=_.property.useIntegerZoom,O=_.property.specification["property-type"],V=O==="cross-faded"||O==="cross-faded-data-driven";if(A.kind==="constant")this.binders[g]=V?new No(A.value,w):new Lo(A.value,w,D),d.push(`/u_${g}`);else if(A.kind==="source"||V){const q=Da(g,D,"source");this.binders[g]=V?g==="line-dasharray"?new eh(A,D,N,n,q,t.id):new Wi(A,D,N,n,q,t.id):new Vn(A,w,D,q),d.push(`/a_${g}`)}else{const q=Da(g,D,"composite");this.binders[g]=new Wn(A,w,D,N,n,q),d.push(`/z_${g}`)}}this.cacheKey=d.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Vn||n instanceof Wn?n.maxValue:0}populatePaintArrays(t,n,l){for(const d in this.binders){const g=this.binders[d];(g instanceof Vn||g instanceof Wn||g instanceof Gi)&&g.populatePaintArray(t,n,l)}}setConstantPatternPositions(t,n){for(const l in this.binders){const d=this.binders[l];d instanceof No&&d.setConstantPatternPositions(t,n)}}setConstantDashPositions(t,n){for(const l in this.binders){const d=this.binders[l];d instanceof No&&d.setConstantDashPositions(t,n)}}updatePaintArrays(t,n,l,d,g){let _=!1;for(const w in t){const A=n.getPositions(w);for(const D of A){const N=l.feature(D.index);for(const O in this.binders){const V=this.binders[O];if((V instanceof Vn||V instanceof Wn||V instanceof Gi)&&V.expression.isStateDependent===!0){const q=d.paint.get(O);V.expression=q.value,V.updatePaintArray(D.start,D.end,N,t[w],g),_=!0}}}}return _}defines(){const t=[];for(const n in this.binders){const l=this.binders[n];(l instanceof Lo||l instanceof No)&&t.push(...l.uniformNames.map((d=>`#define HAS_UNIFORM_${d}`)))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Vn||l instanceof Wn)for(let d=0;d<l.paintVertexAttributes.length;d++)t.push(l.paintVertexAttributes[d].name);else if(l instanceof Gi){const d=l.getVertexAttributes();for(const g of d)t.push(g.name)}}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Lo||l instanceof No||l instanceof Wn)for(const d of l.uniformNames)t.push(d)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const l=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof Lo||g instanceof No||g instanceof Wn){for(const _ of g.uniformNames)if(n[_]){const w=g.getBinding(t,n[_],_);l.push({name:_,property:d,binding:w})}}}return l}setUniforms(t,n,l,d){for(const{name:g,property:_,binding:w}of n)this.binders[_].setUniform(w,d,l.get(_),g)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const l=this.binders[n];if(t&&l instanceof Gi){const d=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(l instanceof Vn||l instanceof Wn)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const n in this.binders){const l=this.binders[n];(l instanceof Vn||l instanceof Wn||l instanceof Gi)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Vn||n instanceof Wn||n instanceof Gi)&&n.destroy()}}}class Pa{constructor(t,n,l=()=>!0){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new th(d,n,l);this.needsUpload=!1,this._featureMap=new hr,this._bufferOffset=0}populatePaintArrays(t,n,l,d){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(t,n,d);n.id!==void 0&&this._featureMap.add(n.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,l,d){for(const g of l)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,n,g,d)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function sf(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function Da(i,t,n){const l={color:{source:ai,composite:o},number:{source:dl,composite:ai}},d=(function(g){return{"line-pattern":{source:ve,composite:ve},"fill-pattern":{source:ve,composite:ve},"fill-extrusion-pattern":{source:ve,composite:ve},"line-dasharray":{source:Te,composite:Te}}[g]})(i);return d&&d[n]||l[t][n]}Tt("ConstantBinder",Lo),Tt("CrossFadedConstantBinder",No),Tt("SourceExpressionBinder",Vn),Tt("CrossFadedPatternBinder",Wi),Tt("CrossFadedDasharrayBinder",eh),Tt("CompositeExpressionBinder",Wn),Tt("ProgramConfiguration",th,{omit:["_buffers"]}),Tt("ProgramConfigurationSet",Pa);const nh=Math.pow(2,14)-1,na=-nh-1;function ia(i){const t=Lt/i.extent,n=i.loadGeometry();for(let l=0;l<n.length;l++){const d=n[l];for(let g=0;g<d.length;g++){const _=d[g],w=Math.round(_.x*t),A=Math.round(_.y*t);_.x=Vt(w,na,nh),_.y=Vt(A,na,nh),(w<_.x||w>_.x+1||A<_.y||A>_.y+1)&&wn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function ns(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?ia(i):[]}}const ih=-32768;function uc(i,t,n,l,d){i.emplaceBack(ih+8*t+l,ih+8*n+d)}class cc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new ce,this.indexArray=new Ue,this.segments=new vt,this.programConfigurations=new Pa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,l){const d=this.layers[0],g=[];let _=null,w=!1,A=d.type==="heatmap";if(d.type==="circle"){const N=d;_=N.layout.get("circle-sort-key"),w=!_.isConstant(),A=A||N.paint.get("circle-pitch-alignment")==="map"}const D=A?n.subdivisionGranularity.circle:1;for(const{feature:N,id:O,index:V,sourceLayerIndex:q}of t){const j=this.layers[0]._featureFilter.needGeometry,Y=ns(N,j);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),Y,l))continue;const J=w?_.evaluate(Y,{},l):void 0,ie={id:O,properties:N.properties,type:N.type,sourceLayerIndex:q,index:V,geometry:j?Y.geometry:ia(N),patterns:{},sortKey:J};g.push(ie)}w&&g.sort(((N,O)=>N.sortKey-O.sortKey));for(const N of g){const{geometry:O,index:V,sourceLayerIndex:q}=N,j=t[V].feature;this.addFeature(N,O,V,l,D),n.featureIndex.insert(j,O,V,q,this.index)}}update(t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ot),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,l,d,g=1){let _;switch(g){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${g}; valid values are 1, 3, 5, 7.`)}const w=_.length;for(const A of n)for(const D of A){const N=D.x,O=D.y;if(N<0||N>=Lt||O<0||O>=Lt)continue;const V=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,t.sortKey),q=V.vertexLength;for(let j=0;j<w;j++)for(let Y=0;Y<w;Y++)uc(this.layoutVertexArray,N,O,_[Y],_[j]);for(let j=0;j<w-1;j++)for(let Y=0;Y<w-1;Y++){const J=q+j*w+Y,ie=q+(j+1)*w+Y;this.indexArray.emplaceBack(J,ie+1,J+1),this.indexArray.emplaceBack(J,ie,ie+1)}V.vertexLength+=w*w,V.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{imagePositions:{},canonical:d})}}function hc(i,t){for(let n=0;n<i.length;n++)if(za(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(za(i,t[n]))return!0;return!!br(i,t)}function af(i,t,n){return!!za(i,t)||!!uf(t,i,n)}function lf(i,t){if(i.length===1)return bp(t,i[0]);for(let n=0;n<t.length;n++){const l=t[n];for(let d=0;d<l.length;d++)if(za(i,l[d]))return!0}for(let n=0;n<i.length;n++)if(bp(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(br(i,t[n]))return!0;return!1}function dr(i,t,n){if(i.length>1){if(br(i,t))return!0;for(let l=0;l<t.length;l++)if(uf(t[l],i,n))return!0}for(let l=0;l<i.length;l++)if(uf(i[l],t,n))return!0;return!1}function br(i,t){if(i.length===0||t.length===0)return!1;for(let n=0;n<i.length-1;n++){const l=i[n],d=i[n+1];for(let g=0;g<t.length-1;g++)if(Mm(l,d,t[g],t[g+1]))return!0}return!1}function Mm(i,t,n,l){return ji(i,n,l)!==ji(t,n,l)&&ji(i,t,n)!==ji(i,t,l)}function uf(i,t,n){const l=n*n;if(t.length===1)return i.distSqr(t[0])<l;for(let d=1;d<t.length;d++)if(xp(i,t[d-1],t[d])<l)return!0;return!1}function xp(i,t,n){const l=t.distSqr(n);if(l===0)return i.distSqr(t);const d=((i.x-t.x)*(n.x-t.x)+(i.y-t.y)*(n.y-t.y))/l;return i.distSqr(d<0?t:d>1?n:n.sub(t)._mult(d)._add(t))}function bp(i,t){let n,l,d,g=!1;for(let _=0;_<i.length;_++){n=i[_];for(let w=0,A=n.length-1;w<n.length;A=w++)l=n[w],d=n[A],l.y>t.y!=d.y>t.y&&t.x<(d.x-l.x)*(t.y-l.y)/(d.y-l.y)+l.x&&(g=!g)}return g}function za(i,t){let n=!1;for(let l=0,d=i.length-1;l<i.length;d=l++){const g=i[l],_=i[d];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(n=!n)}return n}function Im(i,t,n){const l=n[0],d=n[2];if(i.x<l.x&&t.x<l.x||i.x>d.x&&t.x>d.x||i.y<l.y&&t.y<l.y||i.y>d.y&&t.y>d.y)return!1;const g=ji(i,t,n[0]);return g!==ji(i,t,n[1])||g!==ji(i,t,n[2])||g!==ji(i,t,n[3])}function pl(i,t,n){const l=t.paint.get(i).value;return l.kind==="constant"?l.value:n.programConfigurations.get(t.id).getMaxValue(i)}function Yh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function cf(i,t,n,l,d){if(!t[0]&&!t[1])return i;const g=F.convert(t)._mult(d);n==="viewport"&&g._rotate(-l);const _=[];for(let w=0;w<i.length;w++)_.push(i[w].sub(g));return _}function hf(i){const t=[];for(let n=0;n<i.length;n++){const l=i[n],d=t.at(-1);(n===0||d&&!l.equals(d))&&t.push(l)}return t}function wp({queryGeometry:i,size:t},n){return af(i,n,t)}function Rm({queryGeometry:i,size:t,transform:n,unwrappedTileID:l,getElevation:d},g){return af(i,g,t*(n.projectTileCoordinates(g.x,g.y,l,d).signedDistanceFromCamera/n.cameraToCenterDistance))}function Pm({queryGeometry:i,size:t,transform:n,unwrappedTileID:l,getElevation:d},g){const _=n.projectTileCoordinates(g.x,g.y,l,d).signedDistanceFromCamera,w=t*(n.cameraToCenterDistance/_);return af(i,Xh(g,n,l,d),w)}function Dm({queryGeometry:i,size:t,transform:n,unwrappedTileID:l,getElevation:d},g){return af(i,Xh(g,n,l,d),t)}function df({queryGeometry:i,size:t,transform:n,unwrappedTileID:l,getElevation:d,pitchAlignment:g="map",pitchScale:_="map"},w){const A=g==="map"?_==="map"?wp:Rm:_==="map"?Pm:Dm,D={queryGeometry:i,size:t,transform:n,unwrappedTileID:l,getElevation:d};for(const N of w)for(const O of N)if(A(D,O))return!0;return!1}function Xh(i,t,n,l){const d=t.projectTileCoordinates(i.x,i.y,n,l).point;return new F((.5*d.x+.5)*t.width,(.5*-d.y+.5)*t.height)}let ff,Tp;Tt("CircleBucket",cc,{omit:["layers"]});var Sp={get paint(){return Tp=Tp||new ki({"circle-radius":new It(Ce.paint_circle["circle-radius"]),"circle-color":new It(Ce.paint_circle["circle-color"]),"circle-blur":new It(Ce.paint_circle["circle-blur"]),"circle-opacity":new It(Ce.paint_circle["circle-opacity"]),"circle-translate":new St(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new St(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new St(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new St(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new It(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new It(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new It(Ce.paint_circle["circle-stroke-opacity"])})},get layout(){return ff=ff||new ki({"circle-sort-key":new It(Ce.layout_circle["circle-sort-key"])})}};class pf extends vi{constructor(t,n){super(t,Sp,n)}createBucket(t){return new cc(t)}queryRadius(t){const n=t;return pl("circle-radius",this,n)+pl("circle-stroke-width",this,n)+Yh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:l,geometry:d,transform:g,pixelsToTileUnits:_,unwrappedTileID:w,getElevation:A}){const D=cf(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-g.bearingInRadians,_),N=this.paint.get("circle-radius").evaluate(n,l)+this.paint.get("circle-stroke-width").evaluate(n,l),O=this.paint.get("circle-pitch-scale"),V=this.paint.get("circle-pitch-alignment");let q,j;return V==="map"?(q=D,j=N*_):(q=(function(Y,J,ie,de){return Y.map((re=>Xh(re,J,ie,de)))})(D,g,w,A),j=N),df({queryGeometry:q,size:j,transform:g,unwrappedTileID:w,getElevation:A,pitchAlignment:V,pitchScale:O},d)}}class mf extends cc{}let Ep;Tt("HeatmapBucket",mf,{omit:["layers"]});var Cp={get paint(){return Ep=Ep||new ki({"heatmap-radius":new It(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new It(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new St(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rc(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new St(Ce.paint_heatmap["heatmap-opacity"])})}};function gf(i,{width:t,height:n},l,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*n*l)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${t*n*l}`)}else d=new Uint8Array(t*n*l);return i.width=t,i.height=n,i.data=d,i}function La(i,{width:t,height:n},l){if(t===i.width&&n===i.height)return;const d=gf({},{width:t,height:n},l);Jh(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,n)},l),i.width=t,i.height=n,i.data=d.data}function Jh(i,t,n,l,d,g){if(d.width===0||d.height===0)return t;if(d.width>i.width||d.height>i.height||n.x>i.width-d.width||n.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||l.x>t.width-d.width||l.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,w=t.data;if(_===w)throw new Error("srcData equals dstData, so image is already copied");for(let A=0;A<d.height;A++){const D=((n.y+A)*i.width+n.x)*g,N=((l.y+A)*t.width+l.x)*g;for(let O=0;O<d.width*g;O++)w[N+O]=_[D+O]}return t}class Wh{constructor(t,n){gf(this,t,1,n)}resize(t){La(this,t,1)}clone(){return new Wh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,l,d,g){Jh(t,n,l,d,g,1)}}class Jr{constructor(t,n){gf(this,t,4,n)}resize(t){La(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Jr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,l,d,g){Jh(t,n,l,d,g,4)}setPixel(t,n,l){const d=4*(t*this.width+n);this.data[d+0]=Math.round(255*l.r/l.a),this.data[d+1]=Math.round(255*l.g/l.a),this.data[d+2]=Math.round(255*l.b/l.a),this.data[d+3]=Math.round(255*l.a)}}function Na(i){const t={},n=i.resolution||256,l=i.clips?i.clips.length:1,d=i.image||new Jr({width:n,height:l});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const g=(_,w,A)=>{t[i.evaluationKey]=A;const D=i.expression.evaluate(t);d.setPixel(_/4/n,w/4,D)};if(i.clips)for(let _=0,w=0;_<l;++_,w+=4*n)for(let A=0,D=0;A<n;A++,D+=4){const N=A/(n-1),{start:O,end:V}=i.clips[_];g(w,D,O*(1-N)+V*N)}else for(let _=0,w=0;_<n;_++,w+=4)g(0,w,_/(n-1));return d}Tt("AlphaImage",Wh),Tt("RGBAImage",Jr);const Kh="big-fb";class zm extends vi{createBucket(t){return new mf(t)}constructor(t,n){super(t,Cp,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Na({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Kh)&&this.heatmapFbos.delete(Kh)}queryRadius(t){return pl("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:l,geometry:d,transform:g,pixelsToTileUnits:_,unwrappedTileID:w,getElevation:A}){return df({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(n,l)*_,transform:g,unwrappedTileID:w,getElevation:A},d)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let Qh;var ed={get paint(){return Qh=Qh||new ki({"hillshade-illumination-direction":new St(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new St(Ce.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new St(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new St(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new St(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new St(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new St(Ce.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new St(Ce.paint_hillshade["hillshade-method"])})}};class Mi extends vi{constructor(t,n){super(t,ed,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,d=this.paint.get("hillshade-shadow-color").values;const g=Math.max(t.length,n.length,l.length,d.length);t=t.concat(Array(g-t.length).fill(t.at(-1))),n=n.concat(Array(g-n.length).fill(n.at(-1))),l=l.concat(Array(g-l.length).fill(l.at(-1))),d=d.concat(Array(g-d.length).fill(d.at(-1)));const _=n.map(Di);return{directionRadians:t.map(Di),altitudeRadians:_,shadowColor:d,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let Lm;var Kg={get paint(){return Lm=Lm||new ki({"color-relief-opacity":new St(Ce["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new rc(Ce["paint_color-relief"]["color-relief-color"])})}};class _f{constructor(t,n,l,d){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(n,d)}update(t,n,l){const{width:d,height:g}=t,_=!(this.size&&this.size[0]===d&&this.size[1]===g||l),{context:w}=this,{gl:A}=w;if(this.useMipmap=!!(n&&n.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!n||n.premultiply!==!1)),_)this.size=[d,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ar(t)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,t):A.texImage2D(A.TEXTURE_2D,0,this.format,d,g,0,this.format,A.UNSIGNED_BYTE,t.data);else{const{x:D,y:N}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ar(t)?A.texSubImage2D(A.TEXTURE_2D,0,D,N,A.RGBA,A.UNSIGNED_BYTE,t):A.texSubImage2D(A.TEXTURE_2D,0,D,N,d,g,A.RGBA,A.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,l){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),l!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,l||t),this.filter=t),n!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class rh{constructor(t,n,l,d=1,g=1,_=1,w=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void wn(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const A=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=g,this.blueFactor=_,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<A;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(A,D)]=this.data[this._idx(A-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,A)]=this.data[this._idx(D,A-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(A,-1)]=this.data[this._idx(A-1,0)],this.data[this._idx(-1,A)]=this.data[this._idx(0,A-1)],this.data[this._idx(A,A)]=this.data[this._idx(A-1,A-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<A;D++)for(let N=0;N<A;N++){const O=this.get(D,N);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(t,n){const l=new Uint8Array(this.data.buffer),d=4*this._idx(t,n);return this.unpack(l[d],l[d+1],l[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${t}, y: ${n}, dim: ${this.dim}`);return(n+1)*this.stride+(t+1)}unpack(t,n,l){return t*this.redFactor+n*this.greenFactor+l*this.blueFactor-this.baseShift}pack(t){return ml(t,this.getUnpackVector())}getPixels(){return new Jr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=n*this.dim,g=n*this.dim+this.dim,_=l*this.dim,w=l*this.dim+this.dim;switch(n){case-1:d=g-1;break;case 1:g=d+1}switch(l){case-1:_=w-1;break;case 1:w=_+1}const A=-n*this.dim,D=-l*this.dim;for(let N=_;N<w;N++)for(let O=d;O<g;O++)this.data[this._idx(O,N)]=t.data[this._idx(O+A,N+D)]}}function ml(i,t){const n=t[0],l=t[1],d=t[2],g=t[3],_=Math.min(n,l,d),w=Math.round((i+g)/_);return{r:Math.floor(w*_/n)%256,g:Math.floor(w*_/l)%256,b:Math.floor(w*_/d)%256}}Tt("DEMData",rh);class Nm extends vi{constructor(t,n){super(t,Kg,n)}_createColorRamp(t){const n={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof Ur&&l._styleExpression.expression instanceof Br){this.colorRampExpression=l;const _=l._styleExpression.expression;n.elevationStops=_.labels,n.colorStops=[];for(const w of n.elevationStops)n.colorStops.push(_.evaluate({globals:{elevation:w}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[rn.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;const d={elevationStops:[],colorStops:[]},g=(n.elevationStops.length-1)/(t-1);for(let _=0;_<n.elevationStops.length-.5;_+=g)d.elevationStops.push(n.elevationStops[Math.round(_)]),d.colorStops.push(n.colorStops[Math.round(_)]);return wn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${t}, provided: ${n.elevationStops.length}`),d}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const d=this._createColorRamp(n),g=new Jr({width:d.colorStops.length,height:1}),_=new Jr({width:d.colorStops.length,height:1});for(let w=0;w<d.elevationStops.length;w++){const A=ml(d.elevationStops[w],l);_.setPixel(0,w,new rn(A.r/255,A.g/255,A.b/255,1)),g.setPixel(0,w,d.colorStops[w])}return this.colorRampTextures={elevationTexture:new _f(t,_,t.gl.RGBA),colorTexture:new _f(t,g,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const km=fi([{name:"a_pos",components:2,type:"Int16"}],4),{members:td}=km;function is(i,t,n){const l=n.patternDependencies;let d=!1;for(const g of t){const _=g.paint.get(`${i}-pattern`);_.isConstant()||(d=!0);const w=_.constantOr(null);w&&(d=!0,l[w.to]=!0,l[w.from]=!0)}return d}function yf(i,t,n,l,d){const{zoom:g}=l,_=d.patternDependencies;for(const w of t){const A=w.paint.get(`${i}-pattern`).value;if(A.kind!=="constant"){let D=A.evaluate({zoom:g-1},n,{},d.availableImages),N=A.evaluate({zoom:g},n,{},d.availableImages),O=A.evaluate({zoom:g+1},n,{},d.availableImages);D=D&&D.name?D.name:D,N=N&&N.name?N.name:N,O=O&&O.name?O.name:O,_[D]=!0,_[N]=!0,_[O]=!0,n.patterns[w.id]={min:D,mid:N,max:O}}}return n}function vf(i,t,n,l,d){let g;if(d===(function(_,w,A,D){let N=0;for(let O=w,V=A-D;O<A;O+=D)N+=(_[V]-_[O])*(_[O+1]+_[V+1]),V=O;return N})(i,t,n,l)>0)for(let _=t;_<n;_+=l)g=_o(_/l|0,i[_],i[_+1],g);else for(let _=n-l;_>=t;_-=l)g=_o(_/l|0,i[_],i[_+1],g);return g&&ko(g,g.next)&&(yo(g),g=g.next),g}function lu(i,t){if(!i)return i;t||(t=i);let n,l=i;do if(n=!1,l.steiner||!ko(l,l.next)&&zn(l.prev,l,l.next)!==0)l=l.next;else{if(yo(l),l=t=l.prev,l===l.next)break;n=!0}while(n||l!==t);return t}function dc(i,t,n,l,d,g,_){if(!i)return;!_&&g&&(function(A,D,N,O){let V=A;do V.z===0&&(V.z=pr(V.x,V.y,D,N,O)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==A);V.prevZ.nextZ=null,V.prevZ=null,(function(q){let j,Y=1;do{let J,ie=q;q=null;let de=null;for(j=0;ie;){j++;let re=ie,ae=0;for(let be=0;be<Y&&(ae++,re=re.nextZ,re);be++);let pe=Y;for(;ae>0||pe>0&&re;)ae!==0&&(pe===0||!re||ie.z<=re.z)?(J=ie,ie=ie.nextZ,ae--):(J=re,re=re.nextZ,pe--),de?de.nextZ=J:q=J,J.prevZ=de,de=J;ie=re}de.nextZ=null,Y*=2}while(j>1)})(V)})(i,l,d,g);let w=i;for(;i.prev!==i.next;){const A=i.prev,D=i.next;if(g?xf(i,l,d,g):Ap(i))t.push(A.i,i.i,D.i),yo(i),i=D.next,w=D.next;else if((i=D)===w){_?_===1?dc(i=Fm(lu(i),t),t,n,l,d,g,2):_===2&&gl(i,t,n,l,d,g):dc(lu(i),t,n,l,d,g,1);break}}}function Ap(i){const t=i.prev,n=i,l=i.next;if(zn(t,n,l)>=0)return!1;const d=t.x,g=n.x,_=l.x,w=t.y,A=n.y,D=l.y,N=Math.min(d,g,_),O=Math.min(w,A,D),V=Math.max(d,g,_),q=Math.max(w,A,D);let j=l.next;for(;j!==t;){if(j.x>=N&&j.x<=V&&j.y>=O&&j.y<=q&&oh(d,w,g,A,_,D,j.x,j.y)&&zn(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function xf(i,t,n,l){const d=i.prev,g=i,_=i.next;if(zn(d,g,_)>=0)return!1;const w=d.x,A=g.x,D=_.x,N=d.y,O=g.y,V=_.y,q=Math.min(w,A,D),j=Math.min(N,O,V),Y=Math.max(w,A,D),J=Math.max(N,O,V),ie=pr(q,j,t,n,l),de=pr(Y,J,t,n,l);let re=i.prevZ,ae=i.nextZ;for(;re&&re.z>=ie&&ae&&ae.z<=de;){if(re.x>=q&&re.x<=Y&&re.y>=j&&re.y<=J&&re!==d&&re!==_&&oh(w,N,A,O,D,V,re.x,re.y)&&zn(re.prev,re,re.next)>=0||(re=re.prevZ,ae.x>=q&&ae.x<=Y&&ae.y>=j&&ae.y<=J&&ae!==d&&ae!==_&&oh(w,N,A,O,D,V,ae.x,ae.y)&&zn(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;re&&re.z>=ie;){if(re.x>=q&&re.x<=Y&&re.y>=j&&re.y<=J&&re!==d&&re!==_&&oh(w,N,A,O,D,V,re.x,re.y)&&zn(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;ae&&ae.z<=de;){if(ae.x>=q&&ae.x<=Y&&ae.y>=j&&ae.y<=J&&ae!==d&&ae!==_&&oh(w,N,A,O,D,V,ae.x,ae.y)&&zn(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function Fm(i,t){let n=i;do{const l=n.prev,d=n.next.next;!ko(l,d)&&Rp(l,n,n.next,d)&&rd(l,d)&&rd(d,l)&&(t.push(l.i,n.i,d.i),yo(n),yo(n.next),n=i=d),n=n.next}while(n!==i);return lu(n)}function gl(i,t,n,l,d,g){let _=i;do{let w=_.next.next;for(;w!==_.prev;){if(_.i!==w.i&&Fi(_,w)){let A=od(_,w);return _=lu(_,_.next),A=lu(A,A.next),dc(_,t,n,l,d,g,0),void dc(A,t,n,l,d,g,0)}w=w.next}_=_.next}while(_!==i)}function fr(i,t){let n=i.x-t.x;return n===0&&(n=i.y-t.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function Mp(i,t){const n=(function(d,g){let _=g;const w=d.x,A=d.y;let D,N=-1/0;if(ko(d,_))return _;do{if(ko(d,_.next))return _.next;if(A<=_.y&&A>=_.next.y&&_.next.y!==_.y){const Y=_.x+(A-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(Y<=w&&Y>N&&(N=Y,D=_.x<_.next.x?_:_.next,Y===w))return D}_=_.next}while(_!==g);if(!D)return null;const O=D,V=D.x,q=D.y;let j=1/0;_=D;do{if(w>=_.x&&_.x>=V&&w!==_.x&&Ip(A<q?w:N,A,V,q,A<q?N:w,A,_.x,_.y)){const Y=Math.abs(A-_.y)/(w-_.x);rd(_,d)&&(Y<j||Y===j&&(_.x>D.x||_.x===D.x&&Bm(D,_)))&&(D=_,j=Y)}_=_.next}while(_!==O);return D})(i,t);if(!n)return t;const l=od(n,i);return lu(l,l.next),lu(n,n.next)}function Bm(i,t){return zn(i.prev,i,t.prev)<0&&zn(t.next,i,i.next)<0}function pr(i,t,n,l,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Qg(i){let t=i,n=i;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==i);return n}function Ip(i,t,n,l,d,g,_,w){return(d-_)*(t-w)>=(i-_)*(g-w)&&(i-_)*(l-w)>=(n-_)*(t-w)&&(n-_)*(g-w)>=(d-_)*(l-w)}function oh(i,t,n,l,d,g,_,w){return!(i===_&&t===w)&&Ip(i,t,n,l,d,g,_,w)}function Fi(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!(function(n,l){let d=n;do{if(d.i!==n.i&&d.next.i!==n.i&&d.i!==l.i&&d.next.i!==l.i&&Rp(d,d.next,n,l))return!0;d=d.next}while(d!==n);return!1})(i,t)&&(rd(i,t)&&rd(t,i)&&(function(n,l){let d=n,g=!1;const _=(n.x+l.x)/2,w=(n.y+l.y)/2;do d.y>w!=d.next.y>w&&d.next.y!==d.y&&_<(d.next.x-d.x)*(w-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==n);return g})(i,t)&&(zn(i.prev,i,t.prev)||zn(i,t.prev,t))||ko(i,t)&&zn(i.prev,i,i.next)>0&&zn(t.prev,t,t.next)>0)}function zn(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function ko(i,t){return i.x===t.x&&i.y===t.y}function Rp(i,t,n,l){const d=id(zn(i,t,n)),g=id(zn(i,t,l)),_=id(zn(n,l,i)),w=id(zn(n,l,t));return d!==g&&_!==w||!(d!==0||!nd(i,n,t))||!(g!==0||!nd(i,l,t))||!(_!==0||!nd(n,i,l))||!(w!==0||!nd(n,t,l))}function nd(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function id(i){return i>0?1:i<0?-1:0}function rd(i,t){return zn(i.prev,i,i.next)<0?zn(i,t,i.next)>=0&&zn(i,i.prev,t)>=0:zn(i,t,i.prev)<0||zn(i,i.next,t)<0}function od(i,t){const n=bf(i.i,i.x,i.y),l=bf(t.i,t.x,t.y),d=i.next,g=t.prev;return i.next=t,t.prev=i,n.next=d,d.prev=n,l.next=n,n.prev=l,g.next=l,l.prev=g,l}function _o(i,t,n,l){const d=bf(i,t,n);return l?(d.next=l.next,d.prev=l,l.next.prev=d,l.next=d):(d.prev=d,d.next=d),d}function yo(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function bf(i,t,n){return{i,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class wr{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class sd{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}sd.noSubdivision=new sd({fill:new wr(0,0),line:new wr(0,0),tile:new wr(0,0),stencil:new wr(0,0),circle:1}),Tt("SubdivisionGranularityExpression",wr),Tt("SubdivisionGranularitySetting",sd);const Fo=-32768,ra=32767;class _l{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=Lt/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(t),d=0|Math.round(n),g=this._getKey(l,d);if(this._vertexDictionary.has(g))return this._vertexDictionary.get(g);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(g,_),this._vertexBuffer.push(l,d),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(d,g){const _=[];for(let w=0;w<g.length;w+=3){const A=g[w],D=g[w+1],N=g[w+2],O=d[2*A],V=d[2*A+1];(d[2*D]-O)*(d[2*N+1]-V)-(d[2*D+1]-V)*(d[2*N]-O)>0?(_.push(A),_.push(N),_.push(D)):(_.push(A),_.push(D),_.push(N))}return _})(this._vertexBuffer,t);const n=[],l=t.length;for(let d=0;d<l;d+=3){const g=[t[d+0],t[d+1],t[d+2]],_=[this._vertexBuffer[2*t[d+0]+0],this._vertexBuffer[2*t[d+0]+1],this._vertexBuffer[2*t[d+1]+0],this._vertexBuffer[2*t[d+1]+1],this._vertexBuffer[2*t[d+2]+0],this._vertexBuffer[2*t[d+2]+1]];let w=1/0,A=1/0,D=-1/0,N=-1/0;for(let Y=0;Y<3;Y++){const J=_[2*Y],ie=_[2*Y+1];w=Math.min(w,J),D=Math.max(D,J),A=Math.min(A,ie),N=Math.max(N,ie)}if(w===D||A===N)continue;const O=Math.floor(w/this._granularityCellSize),V=Math.ceil(D/this._granularityCellSize),q=Math.floor(A/this._granularityCellSize),j=Math.ceil(N/this._granularityCellSize);if(O!==V||q!==j)for(let Y=q;Y<j;Y++){const J=this._scanlineGenerateVertexRingForCellRow(Y,_,g);oa(this._vertexBuffer,J,n)}else n.push(...g)}return n}_scanlineGenerateVertexRingForCellRow(t,n,l){const d=t*this._granularityCellSize,g=d+this._granularityCellSize,_=[];for(let w=0;w<3;w++){const A=n[2*w],D=n[2*w+1],N=n[2*(w+1)%6],O=n[(2*(w+1)+1)%6],V=n[2*(w+2)%6],q=n[(2*(w+2)+1)%6],j=N-A,Y=O-D,J=j===0,ie=Y===0,de=(d-D)/Y,re=(g-D)/Y,ae=Math.min(de,re),pe=Math.max(de,re);if(!ie&&(ae>=1||pe<=0)||ie&&(D<d||D>g)){O>=d&&O<=g&&_.push(l[(w+1)%3]);continue}!ie&&ae>0&&_.push(this._vertexToIndex(A+j*ae,D+Y*ae));const be=A+j*Math.max(ae,0),Fe=A+j*Math.min(pe,1);J||this._generateIntraEdgeVertices(_,A,D,N,O,be,Fe),!ie&&pe<1&&_.push(this._vertexToIndex(A+j*pe,D+Y*pe)),(ie||O>=d&&O<=g)&&_.push(l[(w+1)%3]),!ie&&(O<=d||O>=g)&&this._generateInterEdgeVertices(_,A,D,N,O,V,q,Fe,d,g)}return _}_generateIntraEdgeVertices(t,n,l,d,g,_,w){const A=d-n,D=g-l,N=D===0,O=N?Math.min(n,d):Math.min(_,w),V=N?Math.max(n,d):Math.max(_,w),q=Math.floor(O/this._granularityCellSize)+1,j=Math.ceil(V/this._granularityCellSize)-1;if(N?n<d:_<w)for(let Y=q;Y<=j;Y++){const J=Y*this._granularityCellSize;t.push(this._vertexToIndex(J,l+D*(J-n)/A))}else for(let Y=j;Y>=q;Y--){const J=Y*this._granularityCellSize;t.push(this._vertexToIndex(J,l+D*(J-n)/A))}}_generateInterEdgeVertices(t,n,l,d,g,_,w,A,D,N){const O=g-l,V=_-d,q=w-g,j=(D-g)/q,Y=(N-g)/q,J=Math.min(j,Y),ie=Math.max(j,Y),de=d+V*J;let re=Math.floor(Math.min(de,A)/this._granularityCellSize)+1,ae=Math.ceil(Math.max(de,A)/this._granularityCellSize)-1,pe=A<de;const be=q===0;if(be&&(w===D||w===N))return;if(be||J>=1||ie<=0){const Ke=l-w,Xe=_+(n-_)*Math.min((D-w)/Ke,(N-w)/Ke);re=Math.floor(Math.min(Xe,A)/this._granularityCellSize)+1,ae=Math.ceil(Math.max(Xe,A)/this._granularityCellSize)-1,pe=A<Xe}const Fe=O>0?N:D;if(pe)for(let Ke=re;Ke<=ae;Ke++)t.push(this._vertexToIndex(Ke*this._granularityCellSize,Fe));else for(let Ke=ae;Ke>=re;Ke--)t.push(this._vertexToIndex(Ke*this._granularityCellSize,Fe))}_generateOutline(t){const n=[];for(const l of t){const d=yl(l,this._granularity,!0),g=this._pointArrayToIndices(d),_=[];for(let w=1;w<g.length;w++)_.push(g[w-1]),_.push(g[w]);n.push(_)}return n}_handlePoles(t){let n=!1,l=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(n||l)&&this._fillPoles(t,n,l)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const l=t[n+1];l===Fo&&(t[n+1]=-32767),l===ra&&(t[n+1]=32766)}}_generatePoleQuad(t,n,l,d,g,_){d>g!=(_===Fo)?(t.push(n),t.push(l),t.push(this._vertexToIndex(d,_)),t.push(l),t.push(this._vertexToIndex(g,_)),t.push(this._vertexToIndex(d,_))):(t.push(l),t.push(n),t.push(this._vertexToIndex(d,_)),t.push(this._vertexToIndex(g,_)),t.push(l),t.push(this._vertexToIndex(d,_)))}_fillPoles(t,n,l){const d=this._vertexBuffer,g=Lt,_=t.length;for(let w=2;w<_;w+=3){const A=t[w-2],D=t[w-1],N=t[w],O=d[2*A],V=d[2*A+1],q=d[2*D],j=d[2*D+1],Y=d[2*N],J=d[2*N+1];n&&(V===0&&j===0&&this._generatePoleQuad(t,A,D,O,q,Fo),j===0&&J===0&&this._generatePoleQuad(t,D,N,q,Y,Fo),J===0&&V===0&&this._generatePoleQuad(t,N,A,Y,O,Fo)),l&&(V===g&&j===g&&this._generatePoleQuad(t,A,D,O,q,ra),j===g&&J===g&&this._generatePoleQuad(t,D,N,q,Y,ra),J===g&&V===g&&this._generatePoleQuad(t,N,A,Y,O,ra))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:d}=(function(w){const A=[],D=[];for(const N of w)if(N.length!==0){N!==w[0]&&A.push(D.length/2);for(let O=0;O<N.length;O++)D.push(N[O].x),D.push(N[O].y)}return{flattened:D,holeIndices:A}})(t);let g;this._initializeVertices(l);try{const w=(function(D,N,O=2){const V=N&&N.length,q=V?N[0]*O:D.length;let j=vf(D,0,q,O,!0);const Y=[];if(!j||j.next===j.prev)return Y;let J,ie,de;if(V&&(j=(function(re,ae,pe,be){const Fe=[];for(let Ke=0,Xe=ae.length;Ke<Xe;Ke++){const rt=vf(re,ae[Ke]*be,Ke<Xe-1?ae[Ke+1]*be:re.length,be,!1);rt===rt.next&&(rt.steiner=!0),Fe.push(Qg(rt))}Fe.sort(fr);for(let Ke=0;Ke<Fe.length;Ke++)pe=Mp(Fe[Ke],pe);return pe})(D,N,j,O)),D.length>80*O){J=D[0],ie=D[1];let re=J,ae=ie;for(let pe=O;pe<q;pe+=O){const be=D[pe],Fe=D[pe+1];be<J&&(J=be),Fe<ie&&(ie=Fe),be>re&&(re=be),Fe>ae&&(ae=Fe)}de=Math.max(re-J,ae-ie),de=de!==0?32767/de:0}return dc(j,Y,O,J,ie,de,0),Y})(l,d),A=this._convertIndices(l,w);g=this._subdivideTrianglesScanline(A)}catch(w){console.error(w)}let _=[];return n&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(g),{verticesFlattened:this._vertexBuffer,indicesTriangles:g,indicesLineList:_}}_convertIndices(t,n){const l=[];for(let d=0;d<n.length;d++)l.push(this._vertexToIndex(t[2*n[d]],t[2*n[d]+1]));return l}_pointArrayToIndices(t){const n=[];for(let l=0;l<t.length;l++){const d=t[l];n.push(this._vertexToIndex(d.x,d.y))}return n}}function wf(i,t,n,l=!0){return new _l(n,t).subdividePolygonInternal(i,l)}function yl(i,t,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const l=i[0],d=i[i.length-1],g=n&&(l.x!==d.x||l.y!==d.y);if(t<2)return g?[...i,i[0]]:[...i];const _=Math.floor(Lt/t),w=[];w.push(new F(i[0].x,i[0].y));const A=i.length,D=g?A:A-1;for(let N=0;N<D;N++){const O=i[N],V=N<A-1?i[N+1]:i[0],q=O.x,j=O.y,Y=V.x,J=V.y,ie=q!==Y,de=j!==J;if(!ie&&!de)continue;const re=Y-q,ae=J-j,pe=Math.abs(re),be=Math.abs(ae);let Fe=q,Ke=j;for(;;){const rt=re>0?(Math.floor(Fe/_)+1)*_:(Math.ceil(Fe/_)-1)*_,yt=ae>0?(Math.floor(Ke/_)+1)*_:(Math.ceil(Ke/_)-1)*_,ht=Math.abs(Fe-rt),je=Math.abs(Ke-yt),He=Math.abs(Fe-Y),wt=Math.abs(Ke-J),xt=ie?ht/pe:Number.POSITIVE_INFINITY,Ct=de?je/be:Number.POSITIVE_INFINITY;if((He<=ht||!ie)&&(wt<=je||!de))break;if(xt<Ct&&ie||!de){Fe=rt,Ke+=ae*xt;const bt=new F(Fe,Math.round(Ke));w[w.length-1].x===bt.x&&w[w.length-1].y===bt.y||w.push(bt)}else{Fe+=re*Ct,Ke=yt;const bt=new F(Math.round(Fe),Ke);w[w.length-1].x===bt.x&&w[w.length-1].y===bt.y||w.push(bt)}}const Xe=new F(Y,J);w[w.length-1].x===Xe.x&&w[w.length-1].y===Xe.y||w.push(Xe)}return w}function oa(i,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,d=i[2*t[0]];for(let A=1;A<t.length;A++){const D=i[2*t[A]];D<d&&(d=D,l=A)}const g=t.length;let _=l,w=(_+1)%g;for(;;){const A=_-1>=0?_-1:g-1,D=(w+1)%g,N=i[2*t[A]],O=i[2*t[D]],V=i[2*t[_]],q=i[2*t[_]+1],j=i[2*t[w]+1];let Y=!1;if(N<O)Y=!0;else if(N>O)Y=!1;else{const J=j-q,ie=-(i[2*t[w]]-V),de=q<j?1:-1;((N-V)*J+(i[2*t[A]+1]-q)*ie)*de>((O-V)*J+(i[2*t[D]+1]-q)*ie)*de&&(Y=!0)}if(Y){const J=t[A],ie=t[_],de=t[w];J!==ie&&J!==de&&ie!==de&&n.push(de,ie,J),_--,_<0&&(_=g-1)}else{const J=t[D],ie=t[_],de=t[w];J!==ie&&J!==de&&ie!==de&&n.push(de,ie,J),w++,w>=g&&(w=0)}if(A===D)break}}function Pp(i,t,n,l,d,g,_,w,A){const D=d.length/2,N=_&&w&&A;if(D<vt.MAX_VERTEX_ARRAY_LENGTH){const O=t.prepareSegment(D,n,l),V=O.vertexLength;for(let Y=0;Y<g.length;Y+=3)l.emplaceBack(V+g[Y],V+g[Y+1],V+g[Y+2]);let q,j;O.vertexLength+=D,O.primitiveLength+=g.length/3,N&&(j=_.prepareSegment(D,n,w),q=j.vertexLength,j.vertexLength+=D);for(let Y=0;Y<d.length;Y+=2)i(d[Y],d[Y+1]);if(N)for(let Y=0;Y<A.length;Y++){const J=A[Y];for(let ie=1;ie<J.length;ie+=2)w.emplaceBack(q+J[ie-1],q+J[ie]);j.primitiveLength+=J.length/2}}else(function(O,V,q,j,Y,J){const ie=[];for(let be=0;be<j.length/2;be++)ie.push(-1);const de={count:0};let re=0,ae=O.getOrCreateLatestSegment(V,q),pe=ae.vertexLength;for(let be=2;be<Y.length;be+=3){const Fe=Y[be-2],Ke=Y[be-1],Xe=Y[be];let rt=ie[Fe]<re,yt=ie[Ke]<re,ht=ie[Xe]<re;ae.vertexLength+((rt?1:0)+(yt?1:0)+(ht?1:0))>vt.MAX_VERTEX_ARRAY_LENGTH&&(ae=O.createNewSegment(V,q),re=de.count,rt=!0,yt=!0,ht=!0,pe=0);const je=ka(ie,j,J,de,Fe,rt,ae),He=ka(ie,j,J,de,Ke,yt,ae),wt=ka(ie,j,J,de,Xe,ht,ae);q.emplaceBack(pe+je-re,pe+He-re,pe+wt-re),ae.primitiveLength++}})(t,n,l,d,g,i),N&&(function(O,V,q,j,Y,J){const ie=[];for(let be=0;be<j.length/2;be++)ie.push(-1);const de={count:0};let re=0,ae=O.getOrCreateLatestSegment(V,q),pe=ae.vertexLength;for(let be=0;be<Y.length;be++){const Fe=Y[be];for(let Ke=1;Ke<Y[be].length;Ke+=2){const Xe=Fe[Ke-1],rt=Fe[Ke];let yt=ie[Xe]<re,ht=ie[rt]<re;ae.vertexLength+((yt?1:0)+(ht?1:0))>vt.MAX_VERTEX_ARRAY_LENGTH&&(ae=O.createNewSegment(V,q),re=de.count,yt=!0,ht=!0,pe=0);const je=ka(ie,j,J,de,Xe,yt,ae),He=ka(ie,j,J,de,rt,ht,ae);q.emplaceBack(pe+je-re,pe+He-re),ae.primitiveLength++}}})(_,n,w,d,A,i),t.forceNewSegmentOnNextPrepare(),_==null||_.forceNewSegmentOnNextPrepare()}function ka(i,t,n,l,d,g,_){if(g){const w=l.count;return n(t[2*d],t[2*d+1]),i[d]=l.count,l.count++,_.vertexLength++,w}return i[d]}class fc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ue,this.indexArray=new Ue,this.indexArray2=new pt,this.programConfigurations=new Pa(t.layers,t.zoom),this.segments=new vt,this.segments2=new vt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,l){this.hasDependencies=is("fill",this.layers,n);const d=this.layers[0].layout.get("fill-sort-key"),g=!d.isConstant(),_=[];for(const{feature:w,id:A,index:D,sourceLayerIndex:N}of t){const O=this.layers[0]._featureFilter.needGeometry,V=ns(w,O);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),V,l))continue;const q=g?d.evaluate(V,{},l,n.availableImages):void 0,j={id:A,properties:w.properties,type:w.type,sourceLayerIndex:N,index:D,geometry:O?V.geometry:ia(w),patterns:{},sortKey:q};_.push(j)}g&&_.sort(((w,A)=>w.sortKey-A.sortKey));for(const w of _){const{geometry:A,index:D,sourceLayerIndex:N}=w;if(this.hasDependencies){const O=yf("fill",this.layers,w,{zoom:this.zoom},n);this.patternFeatures.push(O)}else this.addFeature(w,A,D,l,{},n.subdivisionGranularity);n.featureIndex.insert(t[D].feature,A,D,N,this.index)}}update(t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:l})}addFeatures(t,n,l){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,n,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,td),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,l,d,g,_){for(const w of Ou(n,500)){const A=wf(w,d,_.fill.getGranularityForZoomLevel(d.z)),D=this.layoutVertexArray;Pp(((N,O)=>{D.emplaceBack(N,O)}),this.segments,this.layoutVertexArray,this.indexArray,A.verticesFlattened,A.indicesTriangles,this.segments2,this.indexArray2,A.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{imagePositions:g,canonical:d})}}let sh,pc;Tt("FillBucket",fc,{omit:["layers","patternFeatures"]});var Om={get paint(){return pc=pc||new ki({"fill-antialias":new St(Ce.paint_fill["fill-antialias"]),"fill-opacity":new It(Ce.paint_fill["fill-opacity"]),"fill-color":new It(Ce.paint_fill["fill-color"]),"fill-outline-color":new It(Ce.paint_fill["fill-outline-color"]),"fill-translate":new St(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new St(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new Do(Ce.paint_fill["fill-pattern"])})},get layout(){return sh=sh||new ki({"fill-sort-key":new It(Ce.layout_fill["fill-sort-key"])})}};class Um extends vi{constructor(t,n){super(t,Om,n)}recalculate(t,n){super.recalculate(t,n);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new fc(t)}queryRadius(){return Yh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:l,pixelsToTileUnits:d}){return lf(cf(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,d),n)}isTileClipped(){return!0}}const ad=fi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Vm=fi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Tf}=ad;class ah{constructor(t,n,l,d,g){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=d,this._values=g,t.readFields(e_,this,n)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos,l=[];let d,g=1,_=0,w=0,A=0;for(;t.pos<n;){if(_<=0){const D=t.readVarint();g=7&D,_=D>>3}if(_--,g===1||g===2)w+=t.readSVarint(),A+=t.readSVarint(),g===1&&(d&&l.push(d),d=[]),d&&d.push(new F(w,A));else{if(g!==7)throw new Error(`unknown command ${g}`);d&&d.push(d[0].clone())}}return d&&l.push(d),l}bbox(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos;let l=1,d=0,g=0,_=0,w=1/0,A=-1/0,D=1/0,N=-1/0;for(;t.pos<n;){if(d<=0){const O=t.readVarint();l=7&O,d=O>>3}if(d--,l===1||l===2)g+=t.readSVarint(),_+=t.readSVarint(),g<w&&(w=g),g>A&&(A=g),_<D&&(D=_),_>N&&(N=_);else if(l!==7)throw new Error(`unknown command ${l}`)}return[w,D,A,N]}toGeoJSON(t,n,l){const d=this.extent*Math.pow(2,l),g=this.extent*t,_=this.extent*n,w=this.loadGeometry();function A(V){return[360*(V.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(V.y+_)/d)*Math.PI))-90]}function D(V){return V.map(A)}let N;if(this.type===1){const V=[];for(const j of w)V.push(j[0]);const q=D(V);N=V.length===1?{type:"Point",coordinates:q[0]}:{type:"MultiPoint",coordinates:q}}else if(this.type===2){const V=w.map(D);N=V.length===1?{type:"LineString",coordinates:V[0]}:{type:"MultiLineString",coordinates:V}}else{if(this.type!==3)throw new Error("unknown feature type");{const V=Gm(w),q=[];for(const j of V)q.push(j.map(D));N=q.length===1?{type:"Polygon",coordinates:q[0]}:{type:"MultiPolygon",coordinates:q}}}const O={type:"Feature",geometry:N,properties:this.properties};return this.id!=null&&(O.id=this.id),O}}function e_(i,t,n){i===1?t.id=n.readVarint():i===2?(function(l,d){const g=l.readVarint()+l.pos;for(;l.pos<g;){const _=d._keys[l.readVarint()],w=d._values[l.readVarint()];d.properties[_]=w}})(n,t):i===3?t.type=n.readVarint():i===4&&(t._geometry=n.pos)}function Gm(i){const t=i.length;if(t<=1)return[i];const n=[];let l,d;for(let g=0;g<t;g++){const _=Kn(i[g]);_!==0&&(d===void 0&&(d=_<0),d===_<0?(l&&n.push(l),l=[i[g]]):l&&l.push(i[g]))}return l&&n.push(l),n}function Kn(i){let t=0;for(let n,l,d=0,g=i.length,_=g-1;d<g;_=d++)n=i[d],l=i[_],t+=(l.x-n.x)*(n.y+l.y);return t}ah.types=["Unknown","Point","LineString","Polygon"];class mi{constructor(t,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Mn,this,n),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const n=this._pbf.readVarint()+this._pbf.pos;return new ah(this._pbf,n,this.extent,this._keys,this._values)}}function Mn(i,t,n){i===15?t.version=n.readVarint():i===1?t.name=n.readString():i===5?t.extent=n.readVarint():i===2?t._features.push(n.pos):i===3?t._keys.push(n.readString()):i===4&&t._values.push((function(l){let d=null;const g=l.readVarint()+l.pos;for(;l.pos<g;){const _=l.readVarint()>>3;d=_===1?l.readString():_===2?l.readFloat():_===3?l.readDouble():_===4?l.readVarint64():_===5?l.readVarint():_===6?l.readSVarint():_===7?l.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(n))}class In{constructor(t,n){this.layers=t.readFields(ri,{},n)}}function ri(i,t,n){if(i===3){const l=new mi(n,n.readVarint()+n.pos);l.length&&(t[l.name]=l)}}const vo=Math.pow(2,13);function Ns(i,t,n,l,d,g,_,w){i.emplaceBack(t,n,2*Math.floor(l*vo)+_,d*vo*2,g*vo*2,Math.round(w))}class uu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new fe,this.centroidVertexArray=new le,this.indexArray=new Ue,this.programConfigurations=new Pa(t.layers,t.zoom),this.segments=new vt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,l){this.features=[],this.hasDependencies=is("fill-extrusion",this.layers,n);for(const{feature:d,id:g,index:_,sourceLayerIndex:w}of t){const A=this.layers[0]._featureFilter.needGeometry,D=ns(d,A);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),D,l))continue;const N={id:g,sourceLayerIndex:w,index:_,geometry:A?D.geometry:ia(d),properties:d.properties,type:d.type,patterns:{}};this.hasDependencies?this.features.push(yf("fill-extrusion",this.layers,N,{zoom:this.zoom},n)):this.addFeature(N,N.geometry,_,l,{},n.subdivisionGranularity),n.featureIndex.insert(d,N.geometry,_,w,this.index,!0)}}addFeatures(t,n,l){for(const d of this.features){const{geometry:g}=d;this.addFeature(d,g,d.index,n,l,t.subdivisionGranularity)}}update(t,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Tf),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Vm.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,l,d,g,_){for(const w of Ou(n,500)){const A={x:0,y:0,sampleCount:0},D=this.layoutVertexArray.length;this.processPolygon(A,d,t,w,_);const N=this.layoutVertexArray.length-D,O=Math.floor(A.x/A.sampleCount),V=Math.floor(A.y/A.sampleCount);for(let q=0;q<N;q++)this.centroidVertexArray.emplaceBack(O,V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{imagePositions:g,canonical:d})}processPolygon(t,n,l,d,g){if(d.length<1||qi(d[0]))return;for(const O of d)O.length!==0&&Dp(t,O);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=g.fill.getGranularityForZoomLevel(n.z),A=ah.types[l.type]==="Polygon";for(const O of d){if(O.length===0||qi(O))continue;const V=yl(O,w,A);this._generateSideFaces(V,_)}if(!A)return;const D=wf(d,n,w,!1),N=this.layoutVertexArray;Pp(((O,V)=>{Ns(N,O,V,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles)}_generateSideFaces(t,n){let l=0;for(let d=1;d<t.length;d++){const g=t[d],_=t[d-1];if(vl(g,_))continue;n.segment.vertexLength+4>vt.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=g.sub(_)._perp()._unit(),A=_.dist(g);l+A>32768&&(l=0),Ns(this.layoutVertexArray,g.x,g.y,w.x,w.y,0,0,l),Ns(this.layoutVertexArray,g.x,g.y,w.x,w.y,0,1,l),l+=A,Ns(this.layoutVertexArray,_.x,_.y,w.x,w.y,0,0,l),Ns(this.layoutVertexArray,_.x,_.y,w.x,w.y,0,1,l);const D=n.segment.vertexLength;this.indexArray.emplaceBack(D,D+2,D+1),this.indexArray.emplaceBack(D+1,D+2,D+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function Dp(i,t){for(let n=0;n<t.length;n++){const l=t[n];n===t.length-1&&t[0].x===l.x&&t[0].y===l.y||(i.x+=l.x,i.y+=l.y,i.sampleCount++)}}function vl(i,t){return i.x===t.x&&(i.x<0||i.x>Lt)||i.y===t.y&&(i.y<0||i.y>Lt)}function qi(i){return i.every((t=>t.x<0))||i.every((t=>t.x>Lt))||i.every((t=>t.y<0))||i.every((t=>t.y>Lt))}let xl;Tt("FillExtrusionBucket",uu,{omit:["layers","features"]});var mc={get paint(){return xl=xl||new ki({"fill-extrusion-opacity":new St(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new It(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new St(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new St(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Do(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new It(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new It(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new St(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class zp extends vi{constructor(t,n){super(t,mc,n)}createBucket(t){return new uu(t)}queryRadius(){return Yh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:l,geometry:d,transform:g,pixelsToTileUnits:_,pixelPosMatrix:w}){const A=cf(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-g.bearingInRadians,_),D=this.paint.get("fill-extrusion-height").evaluate(n,l),N=this.paint.get("fill-extrusion-base").evaluate(n,l),O=(function(q,j){const Y=[];for(const J of q){const ie=[J.x,J.y,0,1];kn(ie,ie,j),Y.push(new F(ie[0]/ie[3],ie[1]/ie[3]))}return Y})(A,w),V=(function(q,j,Y,J){const ie=[],de=[],re=J[8]*j,ae=J[9]*j,pe=J[10]*j,be=J[11]*j,Fe=J[8]*Y,Ke=J[9]*Y,Xe=J[10]*Y,rt=J[11]*Y;for(const yt of q){const ht=[],je=[];for(const He of yt){const wt=He.x,xt=He.y,Ct=J[0]*wt+J[4]*xt+J[12],bt=J[1]*wt+J[5]*xt+J[13],Bt=J[2]*wt+J[6]*xt+J[14],Ln=J[3]*wt+J[7]*xt+J[15],_n=Bt+pe,Ii=Ln+be,eo=Ct+Fe,yr=bt+Ke,Ri=Bt+Xe,bi=Ln+rt,jn=new F((Ct+re)/Ii,(bt+ae)/Ii);jn.z=_n/Ii,ht.push(jn);const Hi=new F(eo/bi,yr/bi);Hi.z=Ri/bi,je.push(Hi)}ie.push(ht),de.push(je)}return[ie,de]})(d,N,D,w);return(function(q,j,Y){let J=1/0;lf(Y,j)&&(J=gc(Y,j[0]));for(let ie=0;ie<j.length;ie++){const de=j[ie],re=q[ie];for(let ae=0;ae<de.length-1;ae++){const pe=de[ae],be=[pe,de[ae+1],re[ae+1],re[ae],pe];hc(Y,be)&&(J=Math.min(J,gc(Y,be)))}}return J!==1/0&&J})(V[0],V[1],O)}}function Vr(i,t){return i.x*t.x+i.y*t.y}function gc(i,t){if(i.length===1){let n=0;const l=t[n++];let d;for(;!d||l.equals(d);)if(d=t[n++],!d)return 1/0;for(;n<t.length;n++){const g=t[n],_=i[0],w=d.sub(l),A=g.sub(l),D=_.sub(l),N=Vr(w,w),O=Vr(w,A),V=Vr(A,A),q=Vr(D,w),j=Vr(D,A),Y=N*V-O*O,J=(V*q-O*j)/Y,ie=(N*j-O*q)/Y,de=l.z*(1-J-ie)+d.z*J+g.z*ie;if(isFinite(de))return de}return 1/0}{let n=1/0;for(const l of t)n=Math.min(n,l.z);return n}}const ld=fi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Bo}=ld,Lp=fi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Sf}=Lp,qm=Math.cos(Math.PI/180*37.5),ud=Math.pow(2,14)/.5;class lh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new xe,this.layoutVertexArray2=new he,this.indexArray=new Ue,this.programConfigurations=new Pa(t.layers,t.zoom),this.segments=new vt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,l){this.hasDependencies=is("line",this.layers,n)||this.hasLineDasharray(this.layers);const d=this.layers[0].layout.get("line-sort-key"),g=!d.isConstant(),_=[];for(const{feature:w,id:A,index:D,sourceLayerIndex:N}of t){const O=this.layers[0]._featureFilter.needGeometry,V=ns(w,O);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),V,l))continue;const q=g?d.evaluate(V,{},l):void 0,j={id:A,properties:w.properties,type:w.type,sourceLayerIndex:N,index:D,geometry:O?V.geometry:ia(w),patterns:{},dashes:{},sortKey:q};_.push(j)}g&&_.sort(((w,A)=>w.sortKey-A.sortKey));for(const w of _){const{geometry:A,index:D,sourceLayerIndex:N}=w;this.hasDependencies?(is("line",this.layers,n)?yf("line",this.layers,w,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,w,this.zoom,n),this.patternFeatures.push(w)):this.addFeature(w,A,D,l,{},{},n.subdivisionGranularity),n.featureIndex.insert(t[D].feature,A,D,N,this.index)}}update(t,n,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:l,dashPositions:d})}addFeatures(t,n,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,n,l,d,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Sf)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,l,d,g,_,w){const A=this.layers[0].layout,D=A.get("line-join").evaluate(t,{}),N=A.get("line-cap"),O=A.get("line-miter-limit"),V=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const q of n)this.addLine(q,t,D,N,O,V,d,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{imagePositions:g,dashPositions:_,canonical:d})}addLine(t,n,l,d,g,_,w,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=yl(t,w?A.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<t.length-1;re++)this.totalDistance+=t[re].dist(t[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D=ah.types[n.type]==="Polygon";let N=t.length;for(;N>=2&&t[N-1].equals(t[N-2]);)N--;let O=0;for(;O<N-1&&t[O].equals(t[O+1]);)O++;if(N<(D?3:2))return;l==="bevel"&&(g=1.05);const V=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let j,Y,J,ie,de;this.e1=this.e2=-1,D&&(j=t[N-2],de=t[O].sub(j)._unit()._perp());for(let re=O;re<N;re++){if(J=re===N-1?D?t[O+1]:void 0:t[re+1],J&&t[re].equals(J))continue;de&&(ie=de),j&&(Y=j),j=t[re],de=J?J.sub(j)._unit()._perp():ie,ie=ie||de;let ae=ie.add(de);ae.x===0&&ae.y===0||ae._unit();const pe=ie.x*de.x+ie.y*de.y,be=ae.x*de.x+ae.y*de.y,Fe=be!==0?1/be:1/0,Ke=2*Math.sqrt(2-2*be),Xe=be<qm&&Y&&J,rt=ie.x*de.y-ie.y*de.x>0;if(Xe&&re>O){const je=j.dist(Y);if(je>2*V){const He=j.sub(j.sub(Y)._mult(V/je)._round());this.updateDistance(Y,He),this.addCurrentVertex(He,ie,0,0,q),Y=He}}const yt=Y&&J;let ht=yt?l:D?"butt":d;if(yt&&ht==="round"&&(Fe<_?ht="miter":Fe<=2&&(ht="fakeround")),ht==="miter"&&Fe>g&&(ht="bevel"),ht==="bevel"&&(Fe>2&&(ht="flipbevel"),Fe<g&&(ht="miter")),Y&&this.updateDistance(Y,j),ht==="miter")ae._mult(Fe),this.addCurrentVertex(j,ae,0,0,q);else if(ht==="flipbevel"){if(Fe>100)ae=de.mult(-1);else{const je=Fe*ie.add(de).mag()/ie.sub(de).mag();ae._perp()._mult(je*(rt?-1:1))}this.addCurrentVertex(j,ae,0,0,q),this.addCurrentVertex(j,ae.mult(-1),0,0,q)}else if(ht==="bevel"||ht==="fakeround"){const je=-Math.sqrt(Fe*Fe-1),He=rt?je:0,wt=rt?0:je;if(Y&&this.addCurrentVertex(j,ie,He,wt,q),ht==="fakeround"){const xt=Math.round(180*Ke/Math.PI/20);for(let Ct=1;Ct<xt;Ct++){let bt=Ct/xt;if(bt!==.5){const Ln=bt-.5;bt+=bt*Ln*(bt-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*Ln*Ln+(.848013+pe*(.215638*pe-1.06021)))}const Bt=de.sub(ie)._mult(bt)._add(ie)._unit()._mult(rt?-1:1);this.addHalfVertex(j,Bt.x,Bt.y,!1,rt,0,q)}}J&&this.addCurrentVertex(j,de,-He,-wt,q)}else if(ht==="butt")this.addCurrentVertex(j,ae,0,0,q);else if(ht==="square"){const je=Y?1:-1;this.addCurrentVertex(j,ae,je,je,q)}else ht==="round"&&(Y&&(this.addCurrentVertex(j,ie,0,0,q),this.addCurrentVertex(j,ie,1,1,q,!0)),J&&(this.addCurrentVertex(j,de,-1,-1,q,!0),this.addCurrentVertex(j,de,0,0,q)));if(Xe&&re<N-1){const je=j.dist(J);if(je>2*V){const He=j.add(J.sub(j)._mult(V/je)._round());this.updateDistance(j,He),this.addCurrentVertex(He,de,0,0,q),j=He}}}}addCurrentVertex(t,n,l,d,g,_=!1){const w=n.y*d-n.x,A=-n.y-n.x*d;this.addHalfVertex(t,n.x+n.y*l,n.y-n.x*l,_,!1,l,g),this.addHalfVertex(t,w,A,_,!0,-d,g),this.distance>ud/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,l,d,g,_))}addHalfVertex({x:t,y:n},l,d,g,_,w,A){const D=.5*(this.lineClips?this.scaledDistance*(ud-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(n<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*d)+128,1+(w===0?0:w<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,N,this.e2),A.primitiveLength++),_?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}hasLineDasharray(t){for(const n of t){const l=n.paint.get("line-dasharray");if(l&&!l.isConstant())return!0}return!1}addLineDashDependencies(t,n,l,d){for(const g of t){const _=g.paint.get("line-dasharray");if(!_||_.value.kind==="constant")continue;const w=g.layout.get("line-cap")==="round",A={dasharray:_.value.evaluate({zoom:l-1},n,{}),round:w},D={dasharray:_.value.evaluate({zoom:l},n,{}),round:w},N={dasharray:_.value.evaluate({zoom:l+1},n,{}),round:w},O=`${A.dasharray.join(",")},${A.round}`,V=`${D.dasharray.join(",")},${D.round}`,q=`${N.dasharray.join(",")},${N.round}`;d.dashDependencies[O]=A,d.dashDependencies[V]=D,d.dashDependencies[q]=N,n.dashes[g.id]={min:O,mid:V,max:q}}}}let bl,mr;Tt("LineBucket",lh,{omit:["layers","patternFeatures"]});var wl={get paint(){return mr=mr||new ki({"line-opacity":new It(Ce.paint_line["line-opacity"]),"line-color":new It(Ce.paint_line["line-color"]),"line-translate":new St(Ce.paint_line["line-translate"]),"line-translate-anchor":new St(Ce.paint_line["line-translate-anchor"]),"line-width":new It(Ce.paint_line["line-width"]),"line-gap-width":new It(Ce.paint_line["line-gap-width"]),"line-offset":new It(Ce.paint_line["line-offset"]),"line-blur":new It(Ce.paint_line["line-blur"]),"line-dasharray":new Do(Ce.paint_line["line-dasharray"]),"line-pattern":new Do(Ce.paint_line["line-pattern"]),"line-gradient":new rc(Ce.paint_line["line-gradient"])})},get layout(){return bl=bl||new ki({"line-cap":new St(Ce.layout_line["line-cap"]),"line-join":new It(Ce.layout_line["line-join"]),"line-miter-limit":new St(Ce.layout_line["line-miter-limit"]),"line-round-limit":new St(Ce.layout_line["line-round-limit"]),"line-sort-key":new It(Ce.layout_line["line-sort-key"])})}};class uh extends It{possiblyEvaluate(t,n){return n=new Un(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,l,d){return n=Nt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,l,d)}}let ks;class Np extends vi{constructor(t,n){super(t,wl,n),this.gradientVersion=0,ks||(ks=new uh(wl.paint.properties["line-width"].specification),ks.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(l){return l._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof _a,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=ks.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new lh(t)}queryRadius(t){const n=t,l=Ef(pl("line-width",this,n),pl("line-gap-width",this,n)),d=pl("line-offset",this,n);return l/2+Math.abs(d)+Yh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:l,geometry:d,transform:g,pixelsToTileUnits:_}){const w=cf(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-g.bearingInRadians,_),A=_/2*Ef(this.paint.get("line-width").evaluate(n,l),this.paint.get("line-gap-width").evaluate(n,l)),D=this.paint.get("line-offset").evaluate(n,l);return D&&(d=(function(N,O){const V=[];for(let q=0;q<N.length;q++){const j=hf(N[q]),Y=[];for(let J=0;J<j.length;J++){const ie=j[J],de=j[J-1],re=j[J+1],ae=J===0?new F(0,0):ie.sub(de)._unit()._perp(),pe=J===j.length-1?new F(0,0):re.sub(ie)._unit()._perp(),be=ae._add(pe)._unit(),Fe=be.x*pe.x+be.y*pe.y;Fe!==0&&be._mult(1/Fe),Y.push(be._mult(O)._add(ie))}V.push(Y)}return V})(d,D*_)),(function(N,O,V){for(let q=0;q<O.length;q++){const j=O[q];if(N.length>=3){for(let Y=0;Y<j.length;Y++)if(za(N,j[Y]))return!0}if(dr(N,j,V))return!0}return!1})(w,d,A)}isTileClipped(){return!0}}function Ef(i,t){return t>0?t+2*i:i}const Hm=fi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),cd=fi([{name:"a_projected_pos",components:3,type:"Float32"}],4);fi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const kp=fi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);fi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Oo=fi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Zm=fi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Uo(i,t,n){return i.sections.forEach((l=>{l.text=(function(d,g,_){const w=g.layout.get("text-transform").evaluate(_,{});return w==="uppercase"?d=d.toLocaleUpperCase():w==="lowercase"&&(d=d.toLocaleLowerCase()),Po.applyArabicShaping&&(d=Po.applyArabicShaping(d)),d})(l.text,t,n)})),i}fi([{name:"triangle",components:3,type:"Uint16"}]),fi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),fi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),fi([{type:"Float32",name:"offsetX"}]),fi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),fi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var or=24;const ch={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},t_={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},cu={40:!0};function hd(i,t,n,l,d,g){if("fontStack"in t){const _=n[t.fontStack],w=_&&_[i];return w?w.metrics.advance*t.scale+d:0}{const _=l[t.imageName];return _?_.displaySize[0]*t.scale*or/g+d:0}}function Cf(i,t,n,l){const d=Math.pow(i-t,2);return l?i<t?d/2:2*d:d+Math.abs(n)*n}function hh(i,t,n){let l=0;return i===10&&(l-=1e4),n&&(l+=150),i!==40&&i!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function Fp(i,t,n,l,d,g){let _=null,w=Cf(t,n,d,g);for(const A of l){const D=Cf(t-A.x,n,d,g)+A.badness;D<=w&&(_=A,w=D)}return{index:i,x:t,priorBreak:_,badness:w}}function Bp(i){return i?Bp(i.priorBreak).concat(i.index):[]}class _c{constructor(t="",n=[],l=[]){this.text=t,this.sections=n,this.sectionIndex=l,this.imageSectionID=null}static fromFeature(t,n){const l=new _c;for(let d=0;d<t.sections.length;d++){const g=t.sections[d];g.image?l.addImageSection(g):l.addTextSection(g,n)}return l}length(){return[...this.text].length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}verticalizePunctuation(){this.text=(function(t){let n="",l={premature:!0,value:void 0};const d=t[Symbol.iterator]();let g=d.next();const _=t[Symbol.iterator]();_.next();let w=_.next();for(;!g.done;)n+=!w.done&&Rs(w.value.codePointAt(0))&&!ch[w.value]||!l.premature&&Rs(l.value.codePointAt(0))&&!ch[l.value]||!ch[g.value]?g.value:ch[g.value],l={value:g.value,premature:!1},g=d.next(),w=_.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const t=this.text.match(/^\s*/),n=t?t[0].length:0,l=this.text.match(/\S\s*$/),d=l?l[0].length-1:0;this.text=this.text.substring(n,this.text.length-d),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-d)}substring(t,n){const l=[...this.text].slice(t,n).join(""),d=this.sectionIndex.slice(t,n);return new _c(l,this.sections,d)}toCodeUnitIndex(t){return[...this.text].slice(0,t).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,n)=>Math.max(t,this.sections[n].scale)),0)}getMaxImageSize(t){let n=0,l=0;for(let d=0;d<this.length();d++){const g=this.getSection(d);if("imageName"in g){const _=t[g.imageName];if(!_)continue;const w=_.displaySize;n=Math.max(n,w[0]),l=Math.max(l,w[1])}}return{maxImageWidth:n,maxImageHeight:l}}addTextSection(t,n){this.text+=t.text,this.sections.push({scale:t.scale||1,verticalAlign:t.verticalAlign||"bottom",fontStack:t.fontStack||n});const l=this.sections.length-1;this.sectionIndex.push(...[...t.text].map((()=>l)))}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void wn("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push({scale:1,verticalAlign:t.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):wn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(t,n,l,d,g){const _=[],w=this.determineAverageLineWidth(t,n,l,d,g),A=this.hasZeroWidthSpaces();let D=0,N=0;const O=this.text[Symbol.iterator]();let V=O.next();const q=this.text[Symbol.iterator]();q.next();let j=q.next();const Y=this.text[Symbol.iterator]();Y.next(),Y.next();let J=Y.next();for(;!V.done;){const ie=this.getSection(N),de=V.value.codePointAt(0);if(Qu(de)||(D+=hd(de,ie,l,d,t,g)),!j.done){const re=As(de),ae=j.value.codePointAt(0);(t_[de]||re||"imageName"in ie||!J.done&&cu[ae])&&_.push(Fp(N+1,D,w,_,hh(de,ae,re&&A),!1))}N++,V=O.next(),j=q.next(),J=Y.next()}return Bp(Fp(this.length(),D,w,_,0,!0))}determineAverageLineWidth(t,n,l,d,g){let _=0,w=0;for(const A of this.text){const D=this.getSection(w);_+=hd(A.codePointAt(0),D,l,d,t,g),w++}return _/Math.max(1,Math.ceil(_/n))}}const Af=4294967296,dd=1/Af,Mf=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class If{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,n,l=this.length){for(;this.pos<l;){const d=this.readVarint(),g=d>>3,_=this.pos;this.type=7&d,t(g,n,this),this.pos===_&&this.skip(d)}return n}readMessage(t,n){return this.readFields(t,n,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Af;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Af;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const n=this.buf;let l,d;return d=n[this.pos++],l=127&d,d<128?l:(d=n[this.pos++],l|=(127&d)<<7,d<128?l:(d=n[this.pos++],l|=(127&d)<<14,d<128?l:(d=n[this.pos++],l|=(127&d)<<21,d<128?l:(d=n[this.pos],l|=(15&d)<<28,(function(g,_,w){const A=w.buf;let D,N;if(N=A[w.pos++],D=(112&N)>>4,N<128||(N=A[w.pos++],D|=(127&N)<<3,N<128)||(N=A[w.pos++],D|=(127&N)<<10,N<128)||(N=A[w.pos++],D|=(127&N)<<17,N<128)||(N=A[w.pos++],D|=(127&N)<<24,N<128)||(N=A[w.pos++],D|=(1&N)<<31,N<128))return dh(g,D,_);throw new Error("Expected varint not more than 10 bytes")})(l,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&Mf?Mf.decode(this.buf.subarray(n,t)):(function(l,d,g){let _="",w=d;for(;w<g;){const A=l[w];let D,N,O,V=null,q=A>239?4:A>223?3:A>191?2:1;if(w+q>g)break;q===1?A<128&&(V=A):q===2?(D=l[w+1],(192&D)==128&&(V=(31&A)<<6|63&D,V<=127&&(V=null))):q===3?(D=l[w+1],N=l[w+2],(192&D)==128&&(192&N)==128&&(V=(15&A)<<12|(63&D)<<6|63&N,(V<=2047||V>=55296&&V<=57343)&&(V=null))):q===4&&(D=l[w+1],N=l[w+2],O=l[w+3],(192&D)==128&&(192&N)==128&&(192&O)==128&&(V=(15&A)<<18|(63&D)<<12|(63&N)<<6|63&O,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,q=1):V>65535&&(V-=65536,_+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),_+=String.fromCharCode(V),w+=q}return _})(this.buf,n,t)}readBytes(){const t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n}readPackedVarint(t=[],n){const l=this.readPackedEnd();for(;this.pos<l;)t.push(this.readVarint(n));return t}readPackedSVarint(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const n=7&t;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(t,n){this.writeVarint(t<<3|n)}realloc(t){let n=this.length||16;for(;n<this.pos+t;)n*=2;if(n!==this.length){const l=new Uint8Array(n);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*dd),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*dd),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(n,l){let d,g;if(n>=0?(d=n%4294967296|0,g=n/4294967296|0):(d=~(-n%4294967296),g=~(-n/4294967296),4294967295^d?d=d+1|0:(d=0,g=g+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(_,w,A){A.buf[A.pos++]=127&_|128,_>>>=7,A.buf[A.pos++]=127&_|128,_>>>=7,A.buf[A.pos++]=127&_|128,_>>>=7,A.buf[A.pos++]=127&_|128,A.buf[A.pos]=127&(_>>>=7)})(d,0,l),(function(_,w){const A=(7&_)<<4;w.buf[w.pos++]|=A|((_>>>=3)?128:0),_&&(w.buf[w.pos++]=127&_|((_>>>=7)?128:0),_&&(w.buf[w.pos++]=127&_|((_>>>=7)?128:0),_&&(w.buf[w.pos++]=127&_|((_>>>=7)?128:0),_&&(w.buf[w.pos++]=127&_|((_>>>=7)?128:0),_&&(w.buf[w.pos++]=127&_)))))})(g,l)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const n=this.pos;this.pos=(function(d,g,_){for(let w,A,D=0;D<g.length;D++){if(w=g.charCodeAt(D),w>55295&&w<57344){if(!A){w>56319||D+1===g.length?(d[_++]=239,d[_++]=191,d[_++]=189):A=w;continue}if(w<56320){d[_++]=239,d[_++]=191,d[_++]=189,A=w;continue}w=A-55296<<10|w-56320|65536,A=null}else A&&(d[_++]=239,d[_++]=191,d[_++]=189,A=null);w<128?d[_++]=w:(w<2048?d[_++]=w>>6|192:(w<65536?d[_++]=w>>12|224:(d[_++]=w>>18|240,d[_++]=w>>12&63|128),d[_++]=w>>6&63|128),d[_++]=63&w|128)}return _})(this.buf,t,this.pos);const l=this.pos-n;l>=128&&$m(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const n=t.length;this.writeVarint(n),this.realloc(n);for(let l=0;l<n;l++)this.buf[this.pos++]=t[l]}writeRawMessage(t,n){this.pos++;const l=this.pos;t(n,this);const d=this.pos-l;d>=128&&$m(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d}writeMessage(t,n,l){this.writeTag(t,2),this.writeRawMessage(n,l)}writePackedVarint(t,n){n.length&&this.writeMessage(t,jm,n)}writePackedSVarint(t,n){n.length&&this.writeMessage(t,Ym,n)}writePackedBoolean(t,n){n.length&&this.writeMessage(t,Xm,n)}writePackedFloat(t,n){n.length&&this.writeMessage(t,fh,n)}writePackedDouble(t,n){n.length&&this.writeMessage(t,Rf,n)}writePackedFixed32(t,n){n.length&&this.writeMessage(t,Jm,n)}writePackedSFixed32(t,n){n.length&&this.writeMessage(t,Wm,n)}writePackedFixed64(t,n){n.length&&this.writeMessage(t,Km,n)}writePackedSFixed64(t,n){n.length&&this.writeMessage(t,Qm,n)}writeBytesField(t,n){this.writeTag(t,2),this.writeBytes(n)}writeFixed32Field(t,n){this.writeTag(t,5),this.writeFixed32(n)}writeSFixed32Field(t,n){this.writeTag(t,5),this.writeSFixed32(n)}writeFixed64Field(t,n){this.writeTag(t,1),this.writeFixed64(n)}writeSFixed64Field(t,n){this.writeTag(t,1),this.writeSFixed64(n)}writeVarintField(t,n){this.writeTag(t,0),this.writeVarint(n)}writeSVarintField(t,n){this.writeTag(t,0),this.writeSVarint(n)}writeStringField(t,n){this.writeTag(t,2),this.writeString(n)}writeFloatField(t,n){this.writeTag(t,5),this.writeFloat(n)}writeDoubleField(t,n){this.writeTag(t,1),this.writeDouble(n)}writeBooleanField(t,n){this.writeVarintField(t,+n)}}function dh(i,t,n){return n?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function $m(i,t,n){const l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(l);for(let d=n.pos-1;d>=i;d--)n.buf[d+l]=n.buf[d]}function jm(i,t){for(let n=0;n<i.length;n++)t.writeVarint(i[n])}function Ym(i,t){for(let n=0;n<i.length;n++)t.writeSVarint(i[n])}function fh(i,t){for(let n=0;n<i.length;n++)t.writeFloat(i[n])}function Rf(i,t){for(let n=0;n<i.length;n++)t.writeDouble(i[n])}function Xm(i,t){for(let n=0;n<i.length;n++)t.writeBoolean(i[n])}function Jm(i,t){for(let n=0;n<i.length;n++)t.writeFixed32(i[n])}function Wm(i,t){for(let n=0;n<i.length;n++)t.writeSFixed32(i[n])}function Km(i,t){for(let n=0;n<i.length;n++)t.writeFixed64(i[n])}function Qm(i,t){for(let n=0;n<i.length;n++)t.writeSFixed64(i[n])}function eg(i,t,n){i===1&&n.readMessage(Pf,t)}function Pf(i,t,n){if(i===3){const{id:l,bitmap:d,width:g,height:_,left:w,top:A,advance:D}=n.readMessage(tg,{});t.push({id:l,bitmap:new Wh({width:g+6,height:_+6},d),metrics:{width:g,height:_,left:w,top:A,advance:D}})}}function tg(i,t,n){i===1?t.id=n.readVarint():i===2?t.bitmap=n.readBytes():i===3?t.width=n.readVarint():i===4?t.height=n.readVarint():i===5?t.left=n.readSVarint():i===6?t.top=n.readSVarint():i===7&&(t.advance=n.readVarint())}function Op(i){let t=0,n=0;for(const _ of i)t+=_.w*_.h,n=Math.max(n,_.w);i.sort(((_,w)=>w.h-_.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let d=0,g=0;for(const _ of i)for(let w=l.length-1;w>=0;w--){const A=l[w];if(!(_.w>A.w||_.h>A.h)){if(_.x=A.x,_.y=A.y,g=Math.max(g,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===A.w&&_.h===A.h){const D=l.pop();D&&w<l.length&&(l[w]=D)}else _.h===A.h?(A.x+=_.w,A.w-=_.w):_.w===A.w?(A.y+=_.h,A.h-=_.h):(l.push({x:A.x+_.w,y:A.y,w:A.w-_.w,h:_.h}),A.y+=_.h,A.h-=_.h);break}}return{w:d,h:g,fill:t/(d*g)||0}}class Qn{constructor(t,{pixelRatio:n,version:l,stretchX:d,stretchY:g,content:_,textFitWidth:w,textFitHeight:A}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=d,this.stretchY=g,this.content=_,this.version=l,this.textFitWidth=w,this.textFitHeight=A}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Df{constructor(t,n){const l={},d={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,l,g),this.addImages(n,d,g);const{w:_,h:w}=Op(g),A=new Jr({width:_||1,height:w||1});for(const D in t){const N=t[D],O=l[D].paddedRect;Jr.copy(N.data,A,{x:0,y:0},{x:O.x+1,y:O.y+1},N.data)}for(const D in n){const N=n[D],O=d[D].paddedRect,V=O.x+1,q=O.y+1,j=N.data.width,Y=N.data.height;Jr.copy(N.data,A,{x:0,y:0},{x:V,y:q},N.data),Jr.copy(N.data,A,{x:0,y:Y-1},{x:V,y:q-1},{width:j,height:1}),Jr.copy(N.data,A,{x:0,y:0},{x:V,y:q+Y},{width:j,height:1}),Jr.copy(N.data,A,{x:j-1,y:0},{x:V-1,y:q},{width:1,height:Y}),Jr.copy(N.data,A,{x:0,y:0},{x:V+j,y:q},{width:1,height:Y})}this.image=A,this.iconPositions=l,this.patternPositions=d}addImages(t,n,l){for(const d in t){const g=t[d],_={x:0,y:0,w:g.data.width+2,h:g.data.height+2};l.push(_),n[d]=new Qn(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),n),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),n)}patchUpdatedImage(t,n,l){if(!t||!n||t.version===n.version)return;t.version=n.version;const[d,g]=t.tl;l.update(n.data,void 0,{x:d,y:g})}}var hu;function fd(i,t,n,l,d,g,_,w,A,D,N,O,V,q,j){const Y=_c.fromFeature(i,d);let J;O===S.az.vertical&&Y.verticalizePunctuation();let ie=Y.determineLineBreaks(D,g,t,l,q);const{processBidirectionalText:de,processStyledBidirectionalText:re}=Po;if(de&&Y.sections.length===1){J=[],ie=ie.map((Fe=>Y.toCodeUnitIndex(Fe)));const be=de(Y.toString(),ie);for(const Fe of be){const Ke=[...Fe].map((()=>0));J.push(new _c(Fe,Y.sections,Ke))}}else if(re){J=[],ie=ie.map((Xe=>Y.toCodeUnitIndex(Xe)));let be=0;const Fe=[];for(const Xe of Y.text)Fe.push(...Array(Xe.length).fill(Y.sectionIndex[be])),be++;const Ke=re(Y.text,Fe,ie);for(const Xe of Ke){const rt=[];let yt="";for(const ht of Xe[0])rt.push(Xe[1][yt.length]),yt+=ht;J.push(new _c(Xe[0],Y.sections,rt))}}else J=(function(be,Fe){const Ke=[];let Xe=0;for(const rt of Fe)Ke.push(be.substring(Xe,rt)),Xe=rt;return Xe<be.length()&&Ke.push(be.substring(Xe,be.length())),Ke})(Y,ie);const ae=[],pe={positionedLines:ae,text:Y.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:O,iconsInText:!1,verticalizable:!1};return(function(be,Fe,Ke,Xe,rt,yt,ht,je,He,wt,xt,Ct){let bt=0,Bt=0,Ln=0,_n=0;const Ii=je==="right"?1:je==="left"?0:.5,eo=or/Ct;let yr=0;for(const jn of rt){jn.trim();const Hi=jn.getMaxScale(),Qi={positionedGlyphs:[],lineOffset:0};be.positionedLines[yr]=Qi;const gi=Qi.positionedGlyphs;let ss=0;if(!jn.length()){Bt+=yt,++yr;continue}const to=n_(Xe,jn,eo);let as=0;for(const Rr of jn.text){const Bi=jn.getSection(as),vr=Rr.codePointAt(0),Zi=zf(He,xt,vr),Pr={glyph:vr,imageName:null,x:bt,y:Bt+-17,vertical:Zi,scale:1,fontStack:"",sectionIndex:jn.getSectionIndex(as),metrics:null,rect:null};let bc;if("fontStack"in Bi){if(bc=ph(Bi,vr,Zi,to,Fe,Ke),!bc)continue;Pr.fontStack=Bi.fontStack}else{if(be.iconsInText=!0,Bi.scale*=eo,bc=Vp(Bi,Zi,Hi,to,Xe),!bc)continue;ss=Math.max(ss,bc.imageOffset),Pr.imageName=Bi.imageName}const{rect:Ml,metrics:bm,baselineOffset:Sh}=bc;Pr.y+=Sh,Pr.scale=Bi.scale,Pr.metrics=bm,Pr.rect=Ml,gi.push(Pr),Zi?(be.verticalizable=!0,bt+=("imageName"in Bi?bm.advance:or)*Bi.scale+wt):bt+=bm.advance*Bi.scale+wt,as++}gi.length!==0&&(Ln=Math.max(bt-wt,Ln),Lf(gi,0,gi.length-1,Ii)),bt=0,Qi.lineOffset=Math.max(ss,(Hi-1)*or);const Oa=yt*Hi+ss;Bt+=Oa,_n=Math.max(Oa,_n),++yr}const{horizontalAlign:Ri,verticalAlign:bi}=Up(ht);(function(jn,Hi,Qi,gi,ss,to,as,Oa,Rr){const Bi=(Hi-Qi)*ss;let vr=0;vr=to!==as?-Oa*gi- -17:-gi*Rr*as+.5*as;for(const Zi of jn)for(const Pr of Zi.positionedGlyphs)Pr.x+=Bi,Pr.y+=vr})(be.positionedLines,Ii,Ri,bi,Ln,_n,yt,Bt,rt.length),be.top+=-bi*Bt,be.bottom=be.top+Bt,be.left+=-Ri*Ln,be.right=be.left+Ln})(pe,t,n,l,J,_,w,A,O,D,V,j),!(function(be){for(const Fe of be)if(Fe.positionedGlyphs.length!==0)return!1;return!0})(ae)&&pe}function Up(i){let t=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function n_(i,t,n){const l=t.getMaxScale()*or,{maxImageWidth:d,maxImageHeight:g}=t.getMaxImageSize(i),_=Math.max(l,g*n);return{verticalLineContentWidth:Math.max(l,d*n),horizontalLineContentHeight:_}}function ng(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function zf(i,t,n){return!(i===S.az.horizontal||!t&&!sl(n)||t&&(Qu(n)||(l=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function ph(i,t,n,l,d,g){const _=g[i.fontStack],w=(function(D,N,O,V){if(D&&D.rect)return D;const q=N[O.fontStack],j=q&&q[V];return j?{rect:null,metrics:j.metrics}:null})(_&&_[t],d,i,t);if(w===null)return null;let A;if(n)A=l.verticalLineContentWidth-i.scale*or;else{const D=ng(i.verticalAlign);A=(l.horizontalLineContentHeight-i.scale*or)*D}return{rect:w.rect,metrics:w.metrics,baselineOffset:A}}function Vp(i,t,n,l,d){const g=d[i.imageName];if(!g)return null;const _=g.paddedRect,w=g.displaySize,A={width:w[0],height:w[1],left:1,top:-3,advance:t?w[1]:w[0]};let D;if(t)D=l.verticalLineContentWidth-w[1]*i.scale;else{const N=ng(i.verticalAlign);D=(l.horizontalLineContentHeight-w[1]*i.scale)*N}return{rect:_,metrics:A,baselineOffset:D,imageOffset:(t?w[0]:w[1])*i.scale-or*n}}function Lf(i,t,n,l){if(l===0)return;const d=i[n],g=(i[n].x+d.metrics.advance*d.scale)*l;for(let _=t;_<=n;_++)i[_].x-=g}function Gp(i,t,n){const{horizontalAlign:l,verticalAlign:d}=Up(n),g=t[0]-i.displaySize[0]*l,_=t[1]-i.displaySize[1]*d;return{image:i,top:_,bottom:_+i.displaySize[1],left:g,right:g+i.displaySize[0]}}function Tl(i){var t,n;let l=i.left,d=i.top,g=i.right-l,_=i.bottom-d;const w=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",A=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",D=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(A==="proportional"){if(w==="stretchOnly"&&g/_<D||w==="proportional"){const N=Math.ceil(_*D);l*=N/g,g=N}}else if(w==="proportional"&&A==="stretchOnly"&&D!==0&&g/_>D){const N=Math.ceil(g/D);d*=N/_,_=N}return{x1:l,y1:d,x2:l+g,y2:d+_}}function sa(i,t,n,l,d,g){const _=i.image;let w;if(_.content){const J=_.content,ie=_.pixelRatio||1;w=[J[0]/ie,J[1]/ie,_.displaySize[0]-J[2]/ie,_.displaySize[1]-J[3]/ie]}const A=t.left*g,D=t.right*g;let N,O,V,q;n==="width"||n==="both"?(q=d[0]+A-l[3],O=d[0]+D+l[1]):(q=d[0]+(A+D-_.displaySize[0])/2,O=q+_.displaySize[0]);const j=t.top*g,Y=t.bottom*g;return n==="height"||n==="both"?(N=d[1]+j-l[0],V=d[1]+Y+l[2]):(N=d[1]+(j+Y-_.displaySize[1])/2,V=N+_.displaySize[1]),{image:_,top:N,right:O,bottom:V,left:q,collisionPadding:w}}Tt("ImagePosition",Qn),Tt("ImageAtlas",Df),S.az=void 0,(hu=S.az||(S.az={}))[hu.none=0]="none",hu[hu.horizontal=1]="horizontal",hu[hu.vertical=2]="vertical",hu[hu.horizontalOnly=3]="horizontalOnly";const rs=128,du=32640;function qp(i,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Un(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:d}=n;let g=0;for(;g<l.length&&l[g]<=i;)g++;g=Math.max(0,g-1);let _=g;for(;_<l.length&&l[_]<i+1;)_++;_=Math.min(l.length-1,_);const w=l[g],A=l[_];return n.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:A,interpolationType:d}:{kind:"camera",minZoom:w,maxZoom:A,minSize:n.evaluate(new Un(w)),maxSize:n.evaluate(new Un(A)),interpolationType:d}}}function Nf(i,t,n){let l="never";const d=i.get(t);return d?l=d:i.get(n)&&(l="always"),l}const ig=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function pd(i,t,n,l,d,g,_,w,A,D,N,O,V){const q=w?Math.min(du,Math.round(w[0])):0,j=w?Math.min(du,Math.round(w[1])):0;i.emplaceBack(t,n,Math.round(32*l),Math.round(32*d),g,_,(q<<1)+(A?1:0),j,16*D,16*N,256*O,256*V)}function Hp(i,t,n){i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n)}function Zp(i){for(const t of i.sections)if(Ws(t.text))return!0;return!1}class kf{constructor(t){this.layoutVertexArray=new ge,this.indexArray=new Ue,this.programConfigurations=t,this.segments=new vt,this.dynamicLayoutVertexArray=new Ae,this.opacityVertexArray=new Ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new C}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,l,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Hm.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,cd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,ig,!0),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Tt("SymbolBuffers",kf);class Ff{constructor(t,n,l){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new l,this.segments=new vt,this.collisionVertexArray=new Oe}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,kp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Tt("CollisionBuffers",Ff);class mh{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((_=>_.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qp(this.zoom,n["text-size"]),this.iconSizeData=qp(this.zoom,n["icon-size"]);const l=this.layers[0].layout,d=l.get("symbol-sort-key"),g=l.get("symbol-z-order");this.canOverlap=Nf(l,"text-overlap","text-allow-overlap")!=="never"||Nf(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map((_=>S.az[_]))),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=t.sourceID}createArrays(){this.text=new kf(new Pa(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new kf(new Pa(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new B,this.lineVertexArray=new U,this.symbolInstances=new z,this.textAnchorOffsets=new H}calculateGlyphDependencies(t,n,l,d,g){for(const _ of t)if(n[_.codePointAt(0)]=!0,(l||d)&&g){const w=ch[_];w&&(n[w.codePointAt(0)]=!0)}}populate(t,n,l){const d=this.layers[0],g=d.layout,_=g.get("text-font"),w=g.get("text-field"),A=g.get("icon-image"),D=(w.value.kind!=="constant"||w.value.value instanceof tr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),N=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,O=g.get("symbol-sort-key");if(this.features=[],!D&&!N)return;const V=n.iconDependencies,q=n.glyphDependencies,j=n.availableImages,Y=new Un(this.zoom);for(const{feature:J,id:ie,index:de,sourceLayerIndex:re}of t){const ae=d._featureFilter.needGeometry,pe=ns(J,ae);if(!d._featureFilter.filter(Y,pe,l))continue;let be,Fe;if(ae||(pe.geometry=ia(J)),D){const Xe=d.getValueAndResolveTokens("text-field",pe,l,j),rt=tr.factory(Xe),yt=this.hasRTLText=this.hasRTLText||Zp(rt);(!yt||Po.getRTLTextPluginStatus()==="unavailable"||yt&&Po.isParsed())&&(be=Uo(rt,d,pe))}if(N){const Xe=d.getValueAndResolveTokens("icon-image",pe,l,j);Fe=Xe instanceof Nr?Xe:Nr.fromString(Xe)}if(!be&&!Fe)continue;const Ke=this.sortFeaturesByKey?O.evaluate(pe,{},l):void 0;if(this.features.push({id:ie,text:be,icon:Fe,index:de,sourceLayerIndex:re,geometry:pe.geometry,properties:J.properties,type:ah.types[J.type],sortKey:Ke}),Fe&&(V[Fe.name]=!0),be){const Xe=_.evaluate(pe,{},l).join(","),rt=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.az.vertical)>=0;for(const yt of be.sections)if(yt.image)V[yt.image.name]=!0;else{const ht=Ms(be.toString()),je=yt.fontStack||Xe,He=q[je]=q[je]||{};this.calculateGlyphDependencies(yt.text,He,rt,this.allowVerticalPlacement,ht)}}}g.get("symbol-placement")==="line"&&(this.features=(function(J){const ie={},de={},re=[];let ae=0;function pe(Xe){re.push(J[Xe]),ae++}function be(Xe,rt,yt){const ht=de[Xe];return delete de[Xe],de[rt]=ht,re[ht].geometry[0].pop(),re[ht].geometry[0]=re[ht].geometry[0].concat(yt[0]),ht}function Fe(Xe,rt,yt){const ht=ie[rt];return delete ie[rt],ie[Xe]=ht,re[ht].geometry[0].shift(),re[ht].geometry[0]=yt[0].concat(re[ht].geometry[0]),ht}function Ke(Xe,rt,yt){const ht=yt?rt[0][rt[0].length-1]:rt[0][0];return`${Xe}:${ht.x}:${ht.y}`}for(let Xe=0;Xe<J.length;Xe++){const rt=J[Xe],yt=rt.geometry,ht=rt.text?rt.text.toString():null;if(!ht){pe(Xe);continue}const je=Ke(ht,yt),He=Ke(ht,yt,!0);if(je in de&&He in ie&&de[je]!==ie[He]){const wt=Fe(je,He,yt),xt=be(je,He,re[wt].geometry);delete ie[je],delete de[He],de[Ke(ht,re[xt].geometry,!0)]=xt,re[wt].geometry=null}else je in de?be(je,He,yt):He in ie?Fe(je,He,yt):(pe(Xe),ie[je]=ae-1,de[He]=ae-1)}return re.filter((Xe=>Xe.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((J,ie)=>J.sortKey-ie.sortKey))}update(t,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:l}),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:l}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const l=this.lineVertexArray.length;if(t.segment!==void 0){let d=t.dist(n[t.segment+1]),g=t.dist(n[t.segment]);const _={};for(let w=t.segment+1;w<n.length;w++)_[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:d},w<n.length-1&&(d+=n[w+1].dist(n[w]));for(let w=t.segment||0;w>=0;w--)_[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:g},w>0&&(g+=n[w-1].dist(n[w]));for(let w=0;w<n.length;w++){const A=_[w];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,n,l,d,g,_,w,A,D,N,O,V){const q=t.indexArray,j=t.layoutVertexArray,Y=t.segments.prepareSegment(4*n.length,j,q,this.canOverlap?_.sortKey:void 0),J=this.glyphOffsetArray.length,ie=Y.vertexLength,de=this.allowVerticalPlacement&&w===S.az.vertical?Math.PI/2:0,re=_.text&&_.text.sections;for(let ae=0;ae<n.length;ae++){const{tl:pe,tr:be,bl:Fe,br:Ke,tex:Xe,pixelOffsetTL:rt,pixelOffsetBR:yt,minFontScaleX:ht,minFontScaleY:je,glyphOffset:He,isSDF:wt,sectionIndex:xt}=n[ae],Ct=Y.vertexLength,bt=He[1];pd(j,A.x,A.y,pe.x,bt+pe.y,Xe.x,Xe.y,l,wt,rt.x,rt.y,ht,je),pd(j,A.x,A.y,be.x,bt+be.y,Xe.x+Xe.w,Xe.y,l,wt,yt.x,rt.y,ht,je),pd(j,A.x,A.y,Fe.x,bt+Fe.y,Xe.x,Xe.y+Xe.h,l,wt,rt.x,yt.y,ht,je),pd(j,A.x,A.y,Ke.x,bt+Ke.y,Xe.x+Xe.w,Xe.y+Xe.h,l,wt,yt.x,yt.y,ht,je),Hp(t.dynamicLayoutVertexArray,A,de),q.emplaceBack(Ct,Ct+2,Ct+1),q.emplaceBack(Ct+1,Ct+2,Ct+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(He[0]),ae!==n.length-1&&xt===n[ae+1].sectionIndex||t.programConfigurations.populatePaintArrays(j.length,_,_.index,{imagePositions:{},canonical:V,formattedSection:re&&re[xt]})}t.placedSymbolArray.emplaceBack(A.x,A.y,J,this.glyphOffsetArray.length-J,ie,D,N,A.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],w,0,!1,0,O)}_addCollisionDebugVertex(t,n,l,d,g,_){return n.emplaceBack(0,0),t.emplaceBack(l.x,l.y,d,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,n,l,d,g,_,w){const A=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),D=A.vertexLength,N=g.layoutVertexArray,O=g.collisionVertexArray,V=w.anchorX,q=w.anchorY;this._addCollisionDebugVertex(N,O,_,V,q,new F(t,n)),this._addCollisionDebugVertex(N,O,_,V,q,new F(l,n)),this._addCollisionDebugVertex(N,O,_,V,q,new F(l,d)),this._addCollisionDebugVertex(N,O,_,V,q,new F(t,d)),A.vertexLength+=4;const j=g.indexArray;j.emplaceBack(D,D+1),j.emplaceBack(D+1,D+2),j.emplaceBack(D+2,D+3),j.emplaceBack(D+3,D),A.primitiveLength+=4}addDebugCollisionBoxes(t,n,l,d){for(let g=t;g<n;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,d?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ff(ke,Oo.members,pt),this.iconCollisionBox=new Ff(ke,Oo.members,pt);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,l,d,g,_,w,A,D){const N={};for(let O=n;O<l;O++){const V=t.get(O);N.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},N.textFeatureIndex=V.featureIndex;break}for(let O=d;O<g;O++){const V=t.get(O);N.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},N.verticalTextFeatureIndex=V.featureIndex;break}for(let O=_;O<w;O++){const V=t.get(O);N.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},N.iconFeatureIndex=V.featureIndex;break}for(let O=A;O<D;O++){const V=t.get(O);N.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},N.verticalIconFeatureIndex=V.featureIndex;break}return N}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const l=t.placedSymbolArray.get(n),d=l.vertexStartIndex+4*l.numGlyphs;for(let g=l.vertexStartIndex;g<d;g+=4)t.indexArray.emplaceBack(g,g+2,g+1),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),l=Math.cos(t),d=[],g=[],_=[];for(let w=0;w<this.symbolInstances.length;++w){_.push(w);const A=this.symbolInstances.get(w);d.push(0|Math.round(n*A.anchorX+l*A.anchorY)),g.push(A.featureIndex)}return _.sort(((w,A)=>d[w]-d[A]||g[A]-g[w])),_}addToSortKeyRanges(t,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(((d,g,_)=>{d>=0&&_.indexOf(d)===g&&this.addIndicesForPlacedSymbol(this.text,d)})),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Bf,Of;Tt("SymbolBucket",mh,{omit:["layers","collisionBoxArray","features","compareText"]}),mh.MAX_GLYPHS=65535,mh.addDynamicAttributes=Hp;var $p={get paint(){return Of=Of||new ki({"icon-opacity":new It(Ce.paint_symbol["icon-opacity"]),"icon-color":new It(Ce.paint_symbol["icon-color"]),"icon-halo-color":new It(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new It(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new It(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new St(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new St(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new It(Ce.paint_symbol["text-opacity"]),"text-color":new It(Ce.paint_symbol["text-color"],{runtimeType:ro,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new It(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new It(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new It(Ce.paint_symbol["text-halo-blur"]),"text-translate":new St(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new St(Ce.paint_symbol["text-translate-anchor"])})},get layout(){return Bf=Bf||new ki({"symbol-placement":new St(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new St(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new St(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new It(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new St(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new St(Ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new St(Ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new St(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new St(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new St(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new It(Ce.layout_symbol["icon-size"]),"icon-text-fit":new St(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new St(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new It(Ce.layout_symbol["icon-image"]),"icon-rotate":new It(Ce.layout_symbol["icon-rotate"]),"icon-padding":new It(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new St(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new It(Ce.layout_symbol["icon-offset"]),"icon-anchor":new It(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new St(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new St(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new St(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new It(Ce.layout_symbol["text-field"]),"text-font":new It(Ce.layout_symbol["text-font"]),"text-size":new It(Ce.layout_symbol["text-size"]),"text-max-width":new It(Ce.layout_symbol["text-max-width"]),"text-line-height":new St(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new It(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new It(Ce.layout_symbol["text-justify"]),"text-radial-offset":new It(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new St(Ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new It(Ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new It(Ce.layout_symbol["text-anchor"]),"text-max-angle":new St(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new St(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new It(Ce.layout_symbol["text-rotate"]),"text-padding":new St(Ce.layout_symbol["text-padding"]),"text-keep-upright":new St(Ce.layout_symbol["text-keep-upright"]),"text-transform":new It(Ce.layout_symbol["text-transform"]),"text-offset":new It(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new St(Ce.layout_symbol["text-allow-overlap"]),"text-overlap":new St(Ce.layout_symbol["text-overlap"]),"text-ignore-placement":new St(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new St(Ce.layout_symbol["text-optional"])})}};class rg{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:vn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tt("FormatSectionOverride",rg,{omit:["defaultValue"]});class fu extends vi{constructor(t,n){super(t,$p,n)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const d=[];for(const g of l)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,l,d){const g=this.layout.get(t).evaluate(n,{},l,d),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||Sa(_.value)||!g?g:(function(w,A){return A.replace(/{([^{}]+)}/g,((D,N)=>w&&N in w?String(w[N]):""))})(n.properties,g)}createBucket(t){return new mh(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of $p.paint.overridableProperties){if(!fu.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),l=new rg(n),d=new qc(l,n.property.specification);let g=null;g=n.value.kind==="constant"||n.value.kind==="source"?new Ur("source",d):new Ea("composite",d,n.value.zoomStops),this.paint._values[t]=new mo(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&fu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const l=t.get("text-field"),d=$p.paint.properties[n];let g=!1;const _=w=>{for(const A of w)if(d.overrides&&d.overrides.hasOverride(A))return void(g=!0)};if(l.value.kind==="constant"&&l.value.value instanceof tr)_(l.value.value.sections);else if(l.value.kind==="source"||l.value.kind==="composite"){const w=D=>{g||(D instanceof so&&hi(D.value)===hs?_(D.value.sections):D instanceof Nu?_(D.sections):D.eachChild(w))},A=l.value;A._styleExpression&&w(A._styleExpression.expression)}return g}}let og;var sg={get paint(){return og=og||new ki({"background-color":new St(Ce.paint_background["background-color"]),"background-pattern":new iu(Ce.paint_background["background-pattern"]),"background-opacity":new St(Ce.paint_background["background-opacity"])})}};class Rn extends vi{constructor(t,n){super(t,sg,n)}}class jp extends vi{constructor(t,n){super(t,{},n),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Uf{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Yp={once:!0},Vf=63710088e-1;class Fa{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Fa(mn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,l=this.lat*n,d=t.lat*n,g=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((t.lng-this.lng)*n);return Vf*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof Fa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Fa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Fa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const gh=2*Math.PI*Vf;function md(i){return gh*Math.cos(i*Math.PI/180)}function ag(i){return(180+i)/360}function Xp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function lg(i,t){return i/md(t)}function ug(i){return 360*i-180}function gd(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Jp(i,t){return i*md(gd(t))}class Zn{constructor(t,n,l=0){this.x=+t,this.y=+n,this.z=+l}static fromLngLat(t,n=0){const l=Fa.convert(t);return new Zn(ag(l.lng),Xp(l.lat),lg(n,l.lat))}toLngLat(){return new Fa(ug(this.x),gd(this.y))}toAltitude(){return Jp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/gh*(t=gd(this.y),1/Math.cos(t*Math.PI/180));var t}}function Gf(i,t,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[i*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class Tr{constructor(t,n,l){if(!(function(d,g,_){return!(d<0||d>25||_<0||_>=Math.pow(2,d)||g<0||g>=Math.pow(2,d))})(t,n,l))throw new Error(`x=${n}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=l,this.key=_h(0,t,t,n,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,l){const d=(_=this.y,w=this.z,A=Gf(256*(g=this.x),256*(_=Math.pow(2,w)-_-1),w),D=Gf(256*(g+1),256*(_+1),w),A[0]+","+A[1]+","+D[0]+","+D[1]);var g,_,w,A,D;const N=(function(O,V,q){let j,Y="";for(let J=O;J>0;J--)j=1<<J-1,Y+=(V&j?1:0)+(q&j?2:0);return Y})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,d)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new F((t.x*n-this.x)*Lt,(t.y*n-this.y)*Lt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class cg{constructor(t,n){this.wrap=t,this.canonical=n,this.key=_h(t,n.z,n.z,n.x,n.y)}}class Vo{constructor(t,n,l,d,g){if(this.terrainRttPosMatrix32f=null,t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Tr(l,+d,+g),this.key=_h(n,t,l,d,g)}clone(){return new Vo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new Vo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vo(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?_h(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):_h(this.wrap*+n,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-t.canonical.z;return!(n<0)&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Vo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new Vo(n,this.wrap,n,l,d),new Vo(n,this.wrap,n,l+1,d),new Vo(n,this.wrap,n,l,d+1),new Vo(n,this.wrap,n,l+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Vo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Vo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new cg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Zn(t.x-this.wrap,t.y))}}function _h(i,t,n,l,d){(i*=2)<0&&(i=-1*i-1);const g=1<<n;return(g*g*i+g*d+l).toString(36)+n.toString(36)+t.toString(36)}function _d(i,t){return t?i.properties[t]:i.id}function Wp(i,t){const n={id:i.id};if(t.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete t.removeProperties),t.removeProperties)for(const l of t.removeProperties){const d=i.addOrUpdateProperties.findIndex((g=>g.key===l));d>-1&&i.addOrUpdateProperties.splice(d,1)}return(i.removeAllProperties||t.removeAllProperties)&&(n.removeAllProperties=!0),(i.removeProperties||t.removeProperties)&&(n.removeProperties=[...i.removeProperties||[],...t.removeProperties||[]]),(i.addOrUpdateProperties||t.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...t.addOrUpdateProperties||[]]),(i.newGeometry||t.newGeometry)&&(n.newGeometry=t.newGeometry||i.newGeometry),n}function yd(i){var t,n;if(!i)return{};const l={};return l.removeAll=i.removeAll,l.remove=new Set(i.remove||[]),l.add=new Map((t=i.add)===null||t===void 0?void 0:t.map((d=>[d.id,d]))),l.update=new Map((n=i.update)===null||n===void 0?void 0:n.map((d=>[d.id,d]))),l}Tt("CanonicalTileID",Tr),Tt("OverscaledTileID",Vo,{omit:["terrainRttPosMatrix32f"]});class pu{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const n=new pu;return n.extend(t(new F(this.minX,this.minY))),n.extend(t(new F(this.maxX,this.minY))),n.extend(t(new F(this.minX,this.maxY))),n.extend(t(new F(this.maxX,this.maxY))),n}static fromPoints(t){const n=new pu;for(const l of t)n.extend(l);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Kp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const l=t[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class qf{constructor(t,n,l,d,g){this.type="Feature",this._vectorTileFeature=t,this._x=l,this._y=d,this._z=n,this.properties=t.properties,this.id=g}projectPoint(t,n,l,d){return[360*(t.x+n)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(t.y+l)/d)*Math.PI))-90]}projectLine(t,n,l,d){return t.map((g=>this.projectPoint(g,n,l,d)))}get geometry(){if(this._geometry)return this._geometry;const t=this._vectorTileFeature,n=t.extent*Math.pow(2,this._z),l=t.extent*this._x,d=t.extent*this._y,g=t.loadGeometry();switch(t.type){case 1:{const _=[];for(const A of g)_.push(A[0]);const w=this.projectLine(_,l,d,n);this._geometry=_.length===1?{type:"Point",coordinates:w[0]}:{type:"MultiPoint",coordinates:w};break}case 2:{const _=g.map((w=>this.projectLine(w,l,d,n)));this._geometry=_.length===1?{type:"LineString",coordinates:_[0]}:{type:"MultiLineString",coordinates:_};break}case 3:{const _=Gm(g),w=[];for(const A of _)w.push(A.map((D=>this.projectLine(D,l,d,n))));this._geometry=w.length===1?{type:"Polygon",coordinates:w[0]}:{type:"MultiPolygon",coordinates:w};break}default:throw new Error(`unknown feature type: ${t.type}`)}return this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&n!=="_x"&&n!=="_y"&&n!=="_z"&&(t[n]=this[n]);return t}}class mu{constructor(t,n,l){Kt(this,"_name");Kt(this,"dataBuffer");Kt(this,"nullabilityBuffer");Kt(this,"_size");this._name=t,this.dataBuffer=n,typeof l=="number"?this._size=l:(this.nullabilityBuffer=l,this._size=l.size())}getValue(t){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(t)?null:this.getValueFromBuffer(t)}has(t){return this.nullabilityBuffer&&this.nullabilityBuffer.get(t)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Hf extends mu{}class Zf extends Hf{getValueFromBuffer(t){return this.dataBuffer[t]}}class Qp extends Hf{getValueFromBuffer(t){return this.dataBuffer[t]}}class em extends mu{constructor(n,l,d,g){super(n,l,g);Kt(this,"delta");this.delta=d}}class tm extends em{constructor(t,n,l,d){super(t,Int32Array.of(n),l,d)}getValueFromBuffer(t){return this.dataBuffer[0]+t*this.delta}}class nm extends mu{constructor(t,n,l){super(t,Int32Array.of(n),l)}getValueFromBuffer(t){return this.dataBuffer[0]}}class gu{constructor(t,n,l,d,g=4096){Kt(this,"_name");Kt(this,"_geometryVector");Kt(this,"_idVector");Kt(this,"_propertyVectors");Kt(this,"_extent");Kt(this,"propertyVectorsMap");this._name=t,this._geometryVector=n,this._idVector=l,this._propertyVectors=d,this._extent=g}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(t){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(t)}*[Symbol.iterator](){const t=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const d=t==null?void 0:t.next().value,g={};for(const _ of this.propertyVectors){if(!_)continue;const w=_.name,A=_.getValue(n);A!==null&&(g[w]=A)}n++,yield{id:l,geometry:d,properties:g}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const t=[],n=this.geometryVector.getGeometries();for(let l=0;l<this.numFeatures;l++){let d;this.idVector&&(d=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));const g={coordinates:n[l],type:this.geometryVector.geometryType(l)},_={};for(const w of this.propertyVectors){if(!w)continue;const A=w.name,D=w.getValue(l);D!==null&&(_[A]=D)}t.push({id:d,geometry:g,properties:_})}return t}containsMaxSaveIntegerValues(t){return t instanceof Zf||t instanceof nm&&t instanceof tm||t instanceof Qp}}class hg{constructor(t){Kt(this,"value");this.value=t}get(){return this.value}set(t){this.value=t}increment(){return this.value++}add(t){this.value+=t}}var hn,aa,Mr,la,_u,Wr,Ki,gr,os,xo;function _r(i,t,n){const l=new Int32Array(n);let d=0,g=t.get();for(let _=0;_<l.length;_++){let w=i[g++],A=127&w;w<128||(w=i[g++],A|=(127&w)<<7,w<128||(w=i[g++],A|=(127&w)<<14,w<128||(w=i[g++],A|=(127&w)<<21,w<128||(w=i[g++],A|=(15&w)<<28)))),l[d++]=A}return t.set(g),l}function vd(i,t,n){const l=new BigInt64Array(n);for(let d=0;d<l.length;d++)l[d]=$f(i,t);return l}function dg(i,t){let n,l;return l=i[t.get()],t.increment(),n=127&l,l<128?n:(l=i[t.get()],t.increment(),n|=(127&l)<<7,l<128?n:(l=i[t.get()],t.increment(),n|=(127&l)<<14,l<128?n:(l=i[t.get()],t.increment(),n|=(127&l)<<21,l<128?n:(l=i[t.get()],n|=(15&l)<<28,(function(d,g,_){let w,A;if(A=g[_.get()],_.increment(),w=(112&A)>>4,A<128||(A=g[_.get()],_.increment(),w|=(127&A)<<3,A<128)||(A=g[_.get()],_.increment(),w|=(127&A)<<10,A<128)||(A=g[_.get()],_.increment(),w|=(127&A)<<17,A<128)||(A=g[_.get()],_.increment(),w|=(127&A)<<24,A<128)||(A=g[_.get()],_.increment(),w|=(1&A)<<31,A<128))return 4294967296*w+(d>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,i,t)))))}function yh(i,t,n,l){throw new Error("FastPFor is not implemented yet.")}function Ir(i){return i>>>1^-(1&i)}function yc(i){return i>>1n^-(1n&i)}function $f(i,t){let n=0n,l=0,d=t.get();for(;d<i.length;){const g=i[d++];if(n|=BigInt(127&g)<<BigInt(l),!(128&g))break;if(l+=7,l>=64)throw new Error("Varint too long")}return t.set(d),n}function Ba(i,t,n){const l=new Int32Array(n);let d=0;for(let g=0;g<t;g++){const _=i[g];l.fill(i[g+t],d,d+_),d+=_}return l}function fg(i,t,n){const l=new BigInt64Array(n);let d=0;for(let g=0;g<t;g++){const _=Number(i[g]);l.fill(i[g+t],d,d+_),d+=_}return l}function pg(i,t,n){const l=new Float64Array(n);let d=0;for(let g=0;g<t;g++){const _=i[g];l.fill(i[g+t],d,d+_),d+=_}return l}function yu(i){const t=i.length/4*4;let n=1;if(t>=4)for(let l=i[0];n<t-4;n+=4)l=i[n]+=l,l=i[n+1]+=l,l=i[n+2]+=l,l=i[n+3]+=l;for(;n!=i.length;)i[n]+=i[n-1],++n}function im(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const t=i.length/4*4;let n=2;if(t>=4)for(;n<t-4;n+=4){const l=i[n],d=i[n+1],g=i[n+2],_=i[n+3];i[n]=(l>>>1^-(1&l))+i[n-2],i[n+1]=(d>>>1^-(1&d))+i[n-1],i[n+2]=(g>>>1^-(1&g))+i[n],i[n+3]=(_>>>1^-(1&_))+i[n+1]}for(;n!=i.length;n+=2)i[n]=(i[n]>>>1^-(1&i[n]))+i[n-2],i[n+1]=(i[n+1]>>>1^-(1&i[n+1]))+i[n-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(hn||(hn={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(aa||(aa={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(Mr||(Mr={}));class rm{constructor(t,n,l){Kt(this,"_dictionaryType");Kt(this,"_offsetType");Kt(this,"_lengthType");this._dictionaryType=t,this._offsetType=n,this._lengthType=l}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Kr(i,t){const n=(function(l,d){const g=l[d.get()],_=Object.values(Mr)[g>>4];let w=null;switch(_){case Mr.DATA:w=new rm(Object.values(la)[15&g]);break;case Mr.OFFSET:w=new rm(null,Object.values(_u)[15&g]);break;case Mr.LENGTH:w=new rm(null,null,Object.values(Wr)[15&g])}d.increment();const A=l[d.get()],D=Object.values(hn)[A>>5],N=Object.values(hn)[A>>2&7],O=Object.values(aa)[3&A];d.increment();const V=_r(l,d,2),q=V[0];return{physicalStreamType:_,logicalStreamType:w,logicalLevelTechnique1:D,logicalLevelTechnique2:N,physicalLevelTechnique:O,numValues:q,byteLength:V[1],decompressedCount:q}})(i,t);return n.logicalLevelTechnique1===hn.MORTON?(function(l,d,g){const _=_r(d,g,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:l.decompressedCount,numBits:_[0],coordinateShift:_[1]}})(n,i,t):hn.RLE!==n.logicalLevelTechnique1&&hn.RLE!==n.logicalLevelTechnique2||aa.NONE===n.physicalLevelTechnique?n:(function(l,d,g){const _=_r(d,g,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:_[1],runs:_[0],numRleValues:_[1]}})(n,i,t)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(la||(la={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(_u||(_u={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(Wr||(Wr={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Ki||(Ki={}));class ua{constructor(t,n){Kt(this,"values");Kt(this,"_size");this.values=t,this._size=n}get(t){const n=Math.floor(t/8);return(this.values[n]>>t%8&1)==1}set(t,n){const l=Math.floor(t/8);this.values[l]=this.values[l]|(n?1:0)<<t%8}getInt(t){const n=Math.floor(t/8);return this.values[n]>>t%8&1}size(){return this._size}getBuffer(){return this.values}}function Qr(i,t,n,l,d){return(function(g,_,w){switch(_.logicalLevelTechnique1){case hn.DELTA:return _.logicalLevelTechnique2===hn.RLE?(function(A,D,N){const O=new Int32Array(N);let V=0,q=0;for(let j=0;j<D;j++){const Y=A[j],J=Ir(A[j+D]);for(let ie=0;ie<Y;ie++)q+=J,O[V++]=q}return O})(g,_.runs,_.numRleValues):((function(A){A[0]=A[0]>>>1^-(1&A[0]);const D=A.length/4*4;let N=1;if(D>=4)for(;N<D-4;N+=4){const O=A[N],V=A[N+1],q=A[N+2],j=A[N+3];A[N]=(O>>>1^-(1&O))+A[N-1],A[N+1]=(V>>>1^-(1&V))+A[N],A[N+2]=(q>>>1^-(1&q))+A[N+1],A[N+3]=(j>>>1^-(1&j))+A[N+2]}for(;N!=A.length;++N)A[N]=(A[N]>>>1^-(1&A[N]))+A[N-1]})(g),g);case hn.RLE:return(function(A,D,N){return N?(function(O,V,q){const j=new Int32Array(q);let Y=0;for(let J=0;J<V;J++){const ie=O[J];let de=O[J+V];de=de>>>1^-(1&de),j.fill(de,Y,Y+ie),Y+=ie}return j})(A,D.runs,D.numRleValues):Ba(A,D.runs,D.numRleValues)})(g,_,w);case hn.MORTON:return yu(g),g;case hn.COMPONENTWISE_DELTA:return im(g),g;case hn.NONE:return w&&(function(A){for(let D=0;D<A.length;D++){const N=A[D];A[D]=N>>>1^-(1&N)}})(g),g;default:throw new Error(`The specified Logical level technique is not supported: ${_.logicalLevelTechnique1}`)}})(jf(i,t,n),n,l)}function vu(i,t,n){return(function(l,d){if(d.logicalLevelTechnique1===hn.DELTA&&d.logicalLevelTechnique2===hn.NONE)return(function(_){const w=new Int32Array(_.length+1);w[0]=0,w[1]=Ir(_[0]);let A=w[1],D=2;for(;D!=w.length;++D){const N=_[D-1];A+=N>>>1^-(1&N),w[D]=w[D-1]+A}return w})(l);if(d.logicalLevelTechnique1===hn.RLE&&d.logicalLevelTechnique2===hn.NONE)return(function(_,w,A){const D=new Int32Array(A+1);D[0]=0;let N=1,O=D[0];for(let V=0;V<w;V++){const q=_[V],j=_[V+w];for(let Y=N;Y<N+q;Y++)D[Y]=j+O,O=D[Y];N+=q}return D})(l,d.runs,d.numRleValues);if(d.logicalLevelTechnique1===hn.NONE&&d.logicalLevelTechnique2===hn.NONE){(function(_){let w=0;for(let A=0;A<_.length;A++)_[A]+=w,w=_[A]})(l);const g=new Int32Array(d.numValues+1);return g[0]=0,g.set(l,1),g}if(d.logicalLevelTechnique1===hn.DELTA&&d.logicalLevelTechnique2===hn.RLE){const g=(function(_,w,A){const D=new Int32Array(A+1);D[0]=0;let N=1,O=D[0];for(let V=0;V<w;V++){const q=_[V];let j=_[V+w];j=j>>>1^-(1&j);for(let Y=N;Y<N+q;Y++)D[Y]=j+O,O=D[Y];N+=q}return D})(l,d.runs,d.numRleValues);return yu(g),g}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(jf(i,t,n),n)}function jf(i,t,n){const l=n.physicalLevelTechnique;if(l===aa.FAST_PFOR)return yh();if(l===aa.VARINT)return _r(i,t,n.numValues);if(l===aa.NONE){const d=t.get();t.add(n.byteLength);const g=i.subarray(d,t.get());return new Int32Array(g)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function om(i,t,n,l){const d=jf(i,t,n);if(d.length===1){const g=d[0];return l?Ir(g):g}return l?(function(g){return Ir(g[1])})(d):(function(g){return g[1]})(d)}function sm(i,t,n){return(function(l){if(l.length==2){const d=Ir(l[1]);return[d,d]}return[Ir(l[2]),Ir(l[3])]})(jf(i,t,n))}function vc(i,t,n){return(function(l){if(l.length==2){const d=yc(l[1]);return[d,d]}return[yc(l[2]),yc(l[3])]})(vd(i,t,n.numValues))}function vh(i,t,n,l){return(function(d,g,_){switch(g.logicalLevelTechnique1){case hn.DELTA:return g.logicalLevelTechnique2===hn.RLE?(function(w,A,D){const N=new BigInt64Array(D);let O=0,V=0n;for(let q=0;q<A;q++){const j=Number(w[q]),Y=yc(w[q+A]);for(let J=0;J<j;J++)V+=Y,N[O++]=V}return N})(d,g.runs,g.numRleValues):((function(w){w[0]=w[0]>>1n^-(1n&w[0]);const A=w.length/4*4;let D=1;if(A>=4)for(;D<A-4;D+=4){const N=w[D],O=w[D+1],V=w[D+2],q=w[D+3];w[D]=(N>>1n^-(1n&N))+w[D-1],w[D+1]=(O>>1n^-(1n&O))+w[D],w[D+2]=(V>>1n^-(1n&V))+w[D+1],w[D+3]=(q>>1n^-(1n&q))+w[D+2]}for(;D!=w.length;++D)w[D]=(w[D]>>1n^-(1n&w[D]))+w[D-1]})(d),d);case hn.RLE:return(function(w,A,D){return D?(function(N,O,V){const q=new BigInt64Array(V);let j=0;for(let Y=0;Y<O;Y++){const J=Number(N[Y]);let ie=N[Y+O];ie=ie>>1n^-(1n&ie),q.fill(ie,j,j+J),j+=J}return q})(w,A.runs,A.numRleValues):fg(w,A.runs,A.numRleValues)})(d,g,_);case hn.NONE:return _&&(function(w){for(let A=0;A<w.length;A++){const D=w[A];w[A]=D>>1n^-(1n&D)}})(d),d;default:throw new Error(`The specified Logical level technique is not supported: ${g.logicalLevelTechnique1}`)}})(vd(i,t,n.numValues),n,l)}function am(i,t,n,l){const d=vd(i,t,n.numValues);if(d.length===1){const g=d[0];return l?yc(g):g}return l?(function(g){return yc(g[1])})(d):(function(g){return g[1]})(d)}function lm(i,t,n,l,d){return(function(g,_,w,A){switch(_.logicalLevelTechnique1){case hn.DELTA:return _.logicalLevelTechnique2===hn.RLE&&(g=Ba(g,_.runs,_.numRleValues)),(function(D,N){const O=new Int32Array(D.size());let V=0;D.get(0)?(O[0]=D.get(0)?N[0]>>>1^-(1&N[0]):0,V=1):O[0]=0;let q=1;for(;q!=O.length;++q)O[q]=D.get(q)?O[q-1]+(N[V]>>>1^-(1&N[V++])):O[q-1];return O})(A,g);case hn.RLE:return(function(D,N,O,V){const q=N;return O?(function(j,Y,J){const ie=new Int32Array(j.size());let de=0;for(let re=0;re<J;re++){const ae=Y[re];let pe=Y[re+J];pe=pe>>>1^-(1&pe);for(let be=de;be<de+ae;be++)j.get(be)?ie[be]=pe:(ie[be]=0,de++);de+=ae}return ie})(V,D,q.runs):(function(j,Y,J){const ie=new Int32Array(j.size());let de=0;for(let re=0;re<J;re++){const ae=Y[re],pe=Y[re+J];for(let be=de;be<de+ae;be++)j.get(be)?ie[be]=pe:(ie[be]=0,de++);de+=ae}return ie})(V,D,q.runs)})(g,_,w,A);case hn.MORTON:return yu(g),g;case hn.COMPONENTWISE_DELTA:return im(g),g;case hn.NONE:return g=w?(function(D,N){const O=new Int32Array(D.size());let V=0,q=0;for(;q!=O.length;++q)if(D.get(q)){const j=N[V++];O[q]=j>>>1^-(1&j)}else O[q]=0;return O})(A,g):(function(D,N){const O=new Int32Array(D.size());let V=0,q=0;for(;q!=O.length;++q)O[q]=D.get(q)?N[V++]:0;return O})(A,g),g;default:throw new Error("The specified Logical level technique is not supported")}})(n.physicalLevelTechnique===aa.FAST_PFOR?yh():_r(i,t,n.numValues),n,l,d)}function Sl(i,t,n,l){const d=i.logicalLevelTechnique1;if(d===hn.RLE)return i.runs===1?Ki.CONST:Ki.FLAT;const g=t instanceof ua?t.size():t;if(d===hn.DELTA&&i.logicalLevelTechnique2===hn.RLE){const _=i.runs,w=2;if(i.numRleValues!==g)return Ki.FLAT;if(_===1)return Ki.SEQUENCE;if(_===2){const A=l.get();let D;if(i.physicalLevelTechnique===aa.VARINT)D=_r(n,l,4);else{const N=l.get();D=new Int32Array(n.buffer,n.byteOffset+N,4)}if(l.set(A),D[2]===w&&D[3]===w)return Ki.SEQUENCE}}return i.numValues===1?Ki.CONST:Ki.FLAT}class xh extends Hf{getValueFromBuffer(t){return this.dataBuffer[t]}}class um extends em{constructor(t,n,l,d){super(t,BigInt64Array.of(n),l,d)}getValueFromBuffer(t){return this.dataBuffer[0]+BigInt(t)*this.delta}}class El{constructor(t,n,l){Kt(this,"_geometryOffsets");Kt(this,"_partOffsets");Kt(this,"_ringOffsets");this._geometryOffsets=t,this._partOffsets=n,this._ringOffsets=l}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function xd(i,t,n){return{x:Yf(i,t)-n,y:Yf(i>>1,t)-n}}function Yf(i,t){let n=0;for(let l=0;l<t;l++)n|=(i&1<<2*l)>>l;return n}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(gr||(gr={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(os||(os={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(xo||(xo={}));class Xf{createPoint(t){return[[t]]}createMultiPoint(t){return t.map((n=>[n]))}createLineString(t){return[t]}createMultiLineString(t){return t}createPolygon(t,n){return[t].concat(n)}createMultiPolygon(t){return t.flat()}}function cm(i){const t=new Array(i.numGeometries);let n=1,l=1,d=1,g=0;const _=new Xf;let w=0,A=0;const D=i.mortonSettings,N=i.topologyVector,O=N.geometryOffsets,V=N.partOffsets,q=N.ringOffsets,j=i.vertexOffsets,Y=i.containsPolygonGeometry(),J=i.vertexBuffer;for(let ie=0;ie<i.numGeometries;ie++){const de=i.geometryType(ie);if(de===gr.POINT){if(j&&j.length!==0)if(i.vertexBufferType===xo.VEC_2){const re=2*j[A++],ae=new F(J[re],J[re+1]);t[g++]=_.createPoint(ae)}else{const re=xd(J[j[A++]],D.numBits,D.coordinateShift),ae=new F(re.x,re.y);t[g++]=_.createPoint(ae)}else{const re=new F(J[w++],J[w++]);t[g++]=_.createPoint(re)}O&&d++,V&&n++,q&&l++}else if(de===gr.MULTIPOINT){const re=O[d]-O[d-1];d++;const ae=new Array(re);if(j&&j.length!==0){for(let pe=0;pe<re;pe++){const be=2*j[A++];ae[pe]=new F(J[be],J[be+1])}t[g++]=_.createMultiPoint(ae)}else{for(let pe=0;pe<re;pe++){const be=J[w++],Fe=J[w++];ae[pe]=new F(be,Fe)}t[g++]=_.createMultiPoint(ae)}}else if(de===gr.LINESTRING){let re,ae=0;Y?(ae=q[l]-q[l-1],l++):ae=V[n]-V[n-1],n++,j&&j.length!==0?(re=i.vertexBufferType===xo.VEC_2?Td(J,j,A,ae,!1):dm(J,j,A,ae,!1,D),A+=ae):(re=hm(J,w,ae,!1),w+=2*ae),t[g++]=_.createLineString(re),O&&d++}else if(de===gr.POLYGON){const re=V[n]-V[n-1];n++;const ae=new Array(re-1);let pe=q[l]-q[l-1];if(l++,j&&j.length!==0){const be=i.vertexBufferType===xo.VEC_2?Jf(J,j,A,pe):wd(J,j,A,pe,0,D);A+=pe;for(let Fe=0;Fe<ae.length;Fe++)pe=q[l]-q[l-1],l++,ae[Fe]=i.vertexBufferType===xo.VEC_2?Jf(J,j,A,pe):wd(J,j,A,pe,0,D),A+=pe;t[g++]=_.createPolygon(be,ae)}else{const be=bd(J,w,pe);w+=2*pe;for(let Fe=0;Fe<ae.length;Fe++)pe=q[l]-q[l-1],l++,ae[Fe]=bd(J,w,pe),w+=2*pe;t[g++]=_.createPolygon(be,ae)}O&&d++}else if(de===gr.MULTILINESTRING){const re=O[d]-O[d-1];d++;const ae=new Array(re);if(j&&j.length!==0){for(let pe=0;pe<re;pe++){let be=0;Y?(be=q[l]-q[l-1],l++):be=V[n]-V[n-1],n++;const Fe=i.vertexBufferType===xo.VEC_2?Td(J,j,A,be,!1):dm(J,j,A,be,!1,D);ae[pe]=Fe,A+=be}t[g++]=_.createMultiLineString(ae)}else{for(let pe=0;pe<re;pe++){let be=0;Y?(be=q[l]-q[l-1],l++):be=V[n]-V[n-1],n++,ae[pe]=hm(J,w,be,!1),w+=2*be}t[g++]=_.createMultiLineString(ae)}}else{if(de!==gr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const re=O[d]-O[d-1];d++;const ae=new Array(re);let pe=0;if(j&&j.length!==0){for(let be=0;be<re;be++){const Fe=V[n]-V[n-1];n++;const Ke=new Array(Fe-1);pe=q[l]-q[l-1],l++;const Xe=i.vertexBufferType===xo.VEC_2?Jf(J,j,A,pe):wd(J,j,A,pe,0,D);A+=pe;for(let rt=0;rt<Ke.length;rt++)pe=q[l]-q[l-1],l++,Ke[rt]=i.vertexBufferType===xo.VEC_2?Jf(J,j,A,pe):wd(J,j,A,pe,0,D),A+=pe;ae[be]=_.createPolygon(Xe,Ke)}t[g++]=_.createMultiPolygon(ae)}else{for(let be=0;be<re;be++){const Fe=V[n]-V[n-1];n++;const Ke=new Array(Fe-1);pe=q[l]-q[l-1],l++;const Xe=bd(J,w,pe);w+=2*pe;for(let rt=0;rt<Ke.length;rt++){const yt=q[l]-q[l-1];l++,Ke[rt]=bd(J,w,yt),w+=2*yt}ae[be]=_.createPolygon(Xe,Ke)}t[g++]=_.createMultiPolygon(ae)}}}}return t}function bd(i,t,n){return hm(i,t,n,!0)}function Jf(i,t,n,l){return Td(i,t,n,l,!0)}function wd(i,t,n,l,d,g){return dm(i,t,n,l,!0,g)}function hm(i,t,n,l){const d=new Array(l?n+1:n);for(let g=0;g<2*n;g+=2)d[g/2]=new F(i[t+g],i[t+g+1]);return l&&(d[d.length-1]=d[0]),d}function Td(i,t,n,l,d){const g=new Array(d?l+1:l);for(let _=0;_<2*l;_+=2){const w=2*t[n+_/2];g[_/2]=new F(i[w],i[w+1])}return d&&(g[g.length-1]=g[0]),g}function dm(i,t,n,l,d,g){const _=new Array(d?l+1:l);for(let w=0;w<l;w++){const A=xd(i[t[n+w]],g.numBits,g.coordinateShift);_[w]=new F(A.x,A.y)}return d&&(_[_.length-1]=_[0]),_}class Sd{constructor(t,n,l,d,g){Kt(this,"_vertexBufferType");Kt(this,"_topologyVector");Kt(this,"_vertexOffsets");Kt(this,"_vertexBuffer");Kt(this,"_mortonSettings");this._vertexBufferType=t,this._topologyVector=n,this._vertexOffsets=l,this._vertexBuffer=d,this._mortonSettings=g}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const t=cm(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:t[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(t){const n=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(t){if(this.vertexOffsets&&this.mortonSettings){const l=xd(this.vertexBuffer[this.vertexOffsets[t]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[l.x,l.y]}const n=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return cm(this)}get mortonSettings(){return this._mortonSettings}}class Ed extends Sd{constructor(n,l,d,g,_,w,A){super(d,g,_,w,A);Kt(this,"_numGeometries");Kt(this,"_geometryType");this._numGeometries=n,this._geometryType=l}geometryType(n){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===gr.POLYGON||this._geometryType===gr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Cd extends Sd{constructor(n,l,d,g,_,w){super(n,d,g,_,w);Kt(this,"_geometryTypes");this._geometryTypes=l}geometryType(n){return this._geometryTypes[n]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let n=0;n<this.numGeometries;n++)if(this.geometryType(n)===gr.POLYGON||this.geometryType(n)===gr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class mg{constructor(t,n,l,d){Kt(this,"_triangleOffsets");Kt(this,"_indexBuffer");Kt(this,"_vertexBuffer");Kt(this,"_topologyVector");this._triangleOffsets=t,this._indexBuffer=n,this._vertexBuffer=l,this._topologyVector=d}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const t=new Array(this.numGeometries),n=this._topologyVector,l=n.partOffsets,d=n.ringOffsets,g=n.geometryOffsets;let _=0,w=1,A=1,D=1;for(let N=0;N<this.numGeometries;N++)switch(this.geometryType(N)){case gr.POLYGON:{const O=l[w]-l[w-1];w++;const V=[];for(let q=0;q<O;q++){const j=d[A]-d[A-1];A++;const Y=[];for(let J=0;J<j;J++){const ie=this._vertexBuffer[_++],de=this._vertexBuffer[_++];Y.push(new F(ie,de))}Y.length>0&&Y.push(Y[0]),V.push(Y)}t[N]=V,g&&D++}break;case gr.MULTIPOLYGON:{const O=g[D]-g[D-1];D++;const V=[];for(let q=0;q<O;q++){const j=l[w]-l[w-1];w++;for(let Y=0;Y<j;Y++){const J=d[A]-d[A-1];A++;const ie=[];for(let de=0;de<J;de++){const re=this._vertexBuffer[_++],ae=this._vertexBuffer[_++];ie.push(new F(re,ae))}ie.length>0&&ie.push(ie[0]),V.push(ie)}}t[N]=V}}return t}[Symbol.iterator](){return null}}function bh(i,t,n,l,d,g){return new i_(i,t,n,l,d,g)}class i_ extends mg{constructor(n,l,d,g,_,w){super(d,g,_,w);Kt(this,"_numGeometries");Kt(this,"_geometryType");this._numGeometries=n,this._geometryType=l}geometryType(n){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function fm(i,t,n,l,d){return new gg(i,t,n,l,d)}class gg extends mg{constructor(n,l,d,g,_){super(l,d,g,_);Kt(this,"_geometryTypes");this._geometryTypes=n}geometryType(n){return this._geometryTypes[n]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function _g(i,t,n,l,d){const g=Kr(i,n);let _=null,w=null,A=null,D=null,N=null,O=null,V=null,q=null;if(Sl(g,l,i,n)===Ki.CONST){const Y=om(i,n,g,!1);for(let J=0;J<t-1;J++){const ie=Kr(i,n);switch(ie.physicalStreamType){case Mr.LENGTH:switch(ie.logicalStreamType.lengthType){case Wr.GEOMETRIES:_=vu(i,n,ie);break;case Wr.PARTS:w=vu(i,n,ie);break;case Wr.RINGS:A=vu(i,n,ie);break;case Wr.TRIANGLES:V=vu(i,n,ie)}break;case Mr.OFFSET:switch(ie.logicalStreamType.offsetType){case _u.VERTEX:D=Qr(i,n,ie,!1);break;case _u.INDEX:q=Qr(i,n,ie,!1)}break;case Mr.DATA:la.VERTEX===ie.logicalStreamType.dictionaryType?N=Qr(i,n,ie,!0):(O={numBits:ie.numBits,coordinateShift:ie.coordinateShift},N=Qr(i,n,ie,!1))}}return q!==null?_!=null||w!=null?bh(l,Y,V,q,N,new El(_,w,A)):bh(l,Y,V,q,N):O===null?(function(J,ie,de,re,ae){return new Ed(J,ie,xo.VEC_2,de,re,ae)})(l,Y,new El(_,w,A),D,N):(function(J,ie,de,re,ae,pe){return new Ed(J,ie,xo.MORTON,de,re,ae,pe)})(l,Y,new El(_,w,A),D,N,O)}const j=Qr(i,n,g,!1);for(let Y=0;Y<t-1;Y++){const J=Kr(i,n);switch(J.physicalStreamType){case Mr.LENGTH:switch(J.logicalStreamType.lengthType){case Wr.GEOMETRIES:_=Qr(i,n,J,!1);break;case Wr.PARTS:w=Qr(i,n,J,!1);break;case Wr.RINGS:A=Qr(i,n,J,!1);break;case Wr.TRIANGLES:V=vu(i,n,J)}break;case Mr.OFFSET:switch(J.logicalStreamType.offsetType){case _u.VERTEX:D=Qr(i,n,J,!1);break;case _u.INDEX:q=Qr(i,n,J,!1)}break;case Mr.DATA:la.VERTEX===J.logicalStreamType.dictionaryType?N=Qr(i,n,J,!0):(O={numBits:J.numBits,coordinateShift:J.coordinateShift},N=Qr(i,n,J,!1))}}return q!==null&&w===null?fm(j,V,q,N):(_!==null?(_=Wf(j,_,2),w!==null&&A!==null?(w=Kf(j,_,w,!1),A=(function(Y,J,ie,de){const re=new Int32Array(ie[ie.length-1]+1);let ae=0;re[0]=ae;let pe=1,be=1,Fe=0;for(let Ke=0;Ke<Y.length;Ke++){const Xe=Y[Ke],rt=J[Ke+1]-J[Ke];if(Xe!==0&&Xe!==3)for(let yt=0;yt<rt;yt++){const ht=ie[pe]-ie[pe-1];pe++;for(let je=0;je<ht;je++)ae=re[be++]=ae+de[Fe++]}else for(let yt=0;yt<rt;yt++)re[be++]=++ae,pe++}return re})(j,_,w,A)):w!==null&&(w=(function(Y,J,ie){const de=new Int32Array(J[J.length-1]+1);let re=0;de[0]=re;let ae=1,pe=0;for(let be=0;be<Y.length;be++){const Fe=Y[be],Ke=J[be+1]-J[be];if(Fe===4||Fe===1)for(let Xe=0;Xe<Ke;Xe++)re=de[ae++]=re+ie[pe++];else for(let Xe=0;Xe<Ke;Xe++)de[ae++]=++re}return de})(j,_,w))):w!==null&&A!==null?(w=Wf(j,w,1),A=Kf(j,w,A,!0)):w!==null&&(w=Wf(j,w,0)),q!==null?fm(j,V,q,N,new El(_,w,A)):O===null?(function(Y,J,ie,de){return new Cd(xo.VEC_2,Y,J,ie,de)})(j,new El(_,w,A),D,N):(function(Y,J,ie,de,re){return new Cd(xo.MORTON,Y,J,ie,de,re)})(j,new El(_,w,A),D,N,O))}function Wf(i,t,n){const l=new Int32Array(i.length+1);let d=0;l[0]=d;let g=0;for(let _=0;_<i.length;_++)d=l[_+1]=d+(i[_]>n?t[g++]:1);return l}function Kf(i,t,n,l){const d=new Int32Array(t[t.length-1]+1);let g=0;d[0]=g;let _=1,w=0;for(let A=0;A<i.length;A++){const D=i[A],N=t[A+1]-t[A];if(D===5||D===2||l&&(D===4||D===1))for(let O=0;O<N;O++)g=d[_++]=g+n[w++];else for(let O=0;O<N;O++)d[_++]=++g}return d}class yg extends mu{constructor(n,l,d){super(n,l.getBuffer(),d);Kt(this,"dataVector");this.dataVector=l}getValueFromBuffer(n){return this.dataVector.get(n)}}class vg extends Hf{getValueFromBuffer(t){return this.dataBuffer[t]}}class Ad extends mu{constructor(t,n,l){super(t,BigInt64Array.of(n),l)}getValueFromBuffer(t){return this.dataBuffer[0]}}function Md(i,t,n){return xg(i,Math.ceil(t/8),n)}function xg(i,t,n){const l=new Uint8Array(t);let d=0;for(;d<t;){const g=i[n.increment()];if(g<=127){const _=g+3,w=i[n.increment()],A=d+_;l.fill(w,d,A),d=A}else{const _=256-g;for(let w=0;w<_;w++)l[d++]=i[n.increment()]}}return l}const pm=new TextDecoder;function Id(i,t,n){return n-t>=12?pm.decode(i.subarray(t,n)):(function(l,d,g){let _="",w=d;for(;w<g;){const A=l[w];let D,N,O,V=null,q=A>239?4:A>223?3:A>191?2:1;if(w+q>g)break;q===1?A<128&&(V=A):q===2?(D=l[w+1],(192&D)==128&&(V=(31&A)<<6|63&D,V<=127&&(V=null))):q===3?(D=l[w+1],N=l[w+2],(192&D)==128&&(192&N)==128&&(V=(15&A)<<12|(63&D)<<6|63&N,(V<=2047||V>=55296&&V<=57343)&&(V=null))):q===4&&(D=l[w+1],N=l[w+2],O=l[w+3],(192&D)==128&&(192&N)==128&&(192&O)==128&&(V=(15&A)<<18|(63&D)<<12|(63&N)<<6|63&O,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,q=1):V>65535&&(V-=65536,_+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),_+=String.fromCharCode(V),w+=q}return _})(i,t,n)}class wh extends mu{constructor(n,l,d,g){super(n,d,g);Kt(this,"offsetBuffer");this.offsetBuffer=l}}class Qf extends wh{constructor(n,l,d,g){super(n,l,d,g??l.length-1);Kt(this,"textEncoder");this.textEncoder=new TextEncoder}getValueFromBuffer(n){return Id(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class xc extends wh{constructor(n,l,d,g,_){super(n,d,g,_??l.length);Kt(this,"indexBuffer");Kt(this,"textEncoder");this.indexBuffer=l,this.indexBuffer=l,this.textEncoder=new TextEncoder}getValueFromBuffer(n){const l=this.indexBuffer[n];return Id(this.dataBuffer,this.offsetBuffer[l],this.offsetBuffer[l+1])}}class ep extends wh{constructor(n,l,d,g,_,w,A){super(n,d,g,A);Kt(this,"indexBuffer");Kt(this,"symbolOffsetBuffer");Kt(this,"symbolTableBuffer");Kt(this,"textEncoder");Kt(this,"symbolLengthBuffer");Kt(this,"lengthBuffer");Kt(this,"decodedDictionary");this.indexBuffer=l,this.symbolOffsetBuffer=_,this.symbolTableBuffer=w,this.textEncoder=new TextEncoder}getValueFromBuffer(n){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(d,g,_){const w=[],A=new Array(g.length).fill(0);for(let D=1;D<g.length;D++)A[D]=A[D-1]+g[D-1];for(let D=0;D<_.length;D++)if(_[D]===255)w.push(_[++D]);else{const N=g[_[D]],O=A[_[D]];for(let V=0;V<N;V++)w.push(d[O+V])}return new Uint8Array(w)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const l=this.indexBuffer[n];return Id(this.decodedDictionary,this.offsetBuffer[l],this.offsetBuffer[l+1])}offsetToLengthBuffer(n){const l=new Uint32Array(n.length-1);let d=n[0];for(let g=1;g<n.length;g++){const _=n[g];l[g-1]=_-d,d=_}return l}}function xu(i,t,n,l,d,g){return n.type==="scalarType"?(function(_,w,A,D,N,O){let V=null,q=0;if(_===0)return null;if(O.nullable){const Y=Kr(w,A);q=Y.numValues;const J=A.get(),ie=Md(w,q,A);A.set(J+Y.byteLength),V=new ua(ie,Y.numValues)}const j=V??D;switch(N.physicalType){case 4:case 3:return(function(Y,J,ie,de,re){const ae=Kr(Y,J),pe=Sl(ae,re,Y,J),be=de.physicalType===3;if(pe===Ki.FLAT){const Fe=Fs(re)?lm(Y,J,ae,be,re):Qr(Y,J,ae,be);return new Zf(ie.name,Fe,re)}if(pe===Ki.SEQUENCE){const Fe=sm(Y,J,ae);return new tm(ie.name,Fe[0],Fe[1],ae.numRleValues)}{const Fe=om(Y,J,ae,be);return new nm(ie.name,Fe,re)}})(w,A,O,N,j);case 9:return(function(Y,J,ie,de,re){let ae=null,pe=null,be=null,Fe=null,Ke=null,Xe=null,rt=null,yt=null;for(let ht=0;ht<de;ht++){const je=Kr(J,ie);if(je.byteLength!==0)switch(je.physicalStreamType){case Mr.PRESENT:{const He=Md(J,je.numValues,ie);Xe=new ua(He,je.numValues);break}case Mr.OFFSET:pe=re!=null||Xe!=null?lm(J,ie,je,!1,re??Xe):Qr(J,ie,je,!1);break;case Mr.LENGTH:{const He=vu(J,ie,je);Wr.DICTIONARY===je.logicalStreamType.lengthType?ae=He:Wr.SYMBOL===je.logicalStreamType.lengthType?Fe=He:rt=He;break}case Mr.DATA:{const He=J.subarray(ie.get(),ie.get()+je.byteLength);ie.add(je.byteLength);const wt=je.logicalStreamType.dictionaryType;la.FSST===wt?Ke=He:la.SINGLE===wt||la.SHARED===wt?be=He:la.NONE===wt&&(yt=He);break}}}return(function(ht,je,He,wt,xt,Ct,bt){return je?new ep(ht,He,wt,xt,Ct,je,bt):null})(Y,Ke,pe,ae,be,Fe,re??Xe)??(function(ht,je,He,wt,xt){return je?xt?new xc(ht,He,wt,je,xt):new xc(ht,He,wt,je):null})(Y,be,pe,ae,re??Xe)??(function(ht,je,He,wt,xt){if(!je||!He)return null;if(wt)return xt?new xc(ht,wt,je,He,xt):new xc(ht,wt,je,He);if(xt&&xt.size()!==je.length-1){const Ct=new Int32Array(xt.size());let bt=0;for(let Bt=0;Bt<xt.size();Bt++)Ct[Bt]=xt.get(Bt)?bt++:0;return new xc(ht,Ct,je,He,xt)}return xt?new Qf(ht,je,He,xt):new Qf(ht,je,He)})(Y,rt,yt,pe,re??Xe)})(O.name,w,A,O.nullable?_-1:_,V);case 0:return(function(Y,J,ie,de,re){const ae=Kr(Y,J),pe=ae.numValues,be=J.get(),Fe=Fs(re)?(function(Xe,rt,yt,ht){const je=xg(Xe,Math.ceil(rt/8),yt),He=new ua(je,rt),wt=ht.size(),xt=new ua(new Uint8Array(wt),wt);let Ct=0;for(let bt=0;bt<ht.size();bt++){const Bt=!!ht.get(bt)&&He.get(Ct++);xt.set(bt,Bt)}return xt.getBuffer()})(Y,pe,J,re):Md(Y,pe,J);J.set(be+ae.byteLength);const Ke=new ua(Fe,pe);return new yg(ie.name,Ke,re)})(w,A,O,0,j);case 6:case 5:return(function(Y,J,ie,de,re){const ae=Kr(Y,J),pe=Sl(ae,de,Y,J),be=re.physicalType===5;if(pe===Ki.FLAT){const Fe=Fs(de)?(function(Ke,Xe,rt,yt,ht){return(function(je,He,wt,xt){switch(He.logicalLevelTechnique1){case hn.DELTA:return He.logicalLevelTechnique2===hn.RLE&&(je=fg(je,He.runs,He.numRleValues)),(function(Ct,bt){const Bt=new BigInt64Array(Ct.size());let Ln=0;Ct.get(0)?(Bt[0]=Ct.get(0)?bt[0]>>1n^-(1n&bt[0]):0n,Ln=1):Bt[0]=0n;let _n=1;for(;_n!=Bt.length;++_n)Bt[_n]=Ct.get(_n)?Bt[_n-1]+(bt[Ln]>>1n^-(1n&bt[Ln++])):Bt[_n-1];return Bt})(xt,je);case hn.RLE:return(function(Ct,bt,Bt,Ln){const _n=bt;return Bt?(function(Ii,eo,yr){const Ri=new BigInt64Array(Ii.size());let bi=0;for(let jn=0;jn<yr;jn++){const Hi=Number(eo[jn]);let Qi=eo[jn+yr];Qi=Qi>>1n^-(1n&Qi);for(let gi=bi;gi<bi+Hi;gi++)Ii.get(gi)?Ri[gi]=Qi:(Ri[gi]=0n,bi++);bi+=Hi}return Ri})(Ln,Ct,_n.runs):(function(Ii,eo,yr){const Ri=new BigInt64Array(Ii.size());let bi=0;for(let jn=0;jn<yr;jn++){const Hi=Number(eo[jn]),Qi=eo[jn+yr];for(let gi=bi;gi<bi+Hi;gi++)Ii.get(gi)?Ri[gi]=Qi:(Ri[gi]=0n,bi++);bi+=Hi}return Ri})(Ln,Ct,_n.runs)})(je,He,wt,xt);case hn.NONE:return je=wt?(function(Ct,bt){const Bt=new BigInt64Array(Ct.size());let Ln=0,_n=0;for(;_n!=Bt.length;++_n)if(Ct.get(_n)){const Ii=bt[Ln++];Bt[_n]=Ii>>1n^-(1n&Ii)}else Bt[_n]=0n;return Bt})(xt,je):(function(Ct,bt){const Bt=new BigInt64Array(Ct.size());let Ln=0,_n=0;for(;_n!=Bt.length;++_n)Bt[_n]=Ct.get(_n)?bt[Ln++]:0n;return Bt})(xt,je),je;default:throw new Error("The specified Logical level technique is not supported")}})(vd(Ke,Xe,rt.numValues),rt,yt,ht)})(Y,J,ae,be,de):vh(Y,J,ae,be);return new xh(ie.name,Fe,de)}if(pe===Ki.SEQUENCE){const Fe=vc(Y,J,ae);return new um(ie.name,Fe[0],Fe[1],ae.numRleValues)}{const Fe=am(Y,J,ae,be);return new Ad(ie.name,Fe,de)}})(w,A,O,j,N);case 7:return(function(Y,J,ie,de){const re=Kr(Y,J),ae=Fs(de)?(function(pe,be,Fe,Ke){const Xe=be.get(),rt=Xe+Ke*Float32Array.BYTES_PER_ELEMENT,yt=new Uint8Array(pe.subarray(Xe,rt)).buffer,ht=new Float32Array(yt);be.set(rt);const je=Fe.size(),He=new Float32Array(je);let wt=0;for(let xt=0;xt<je;xt++)He[xt]=Fe.get(xt)?ht[wt++]:0;return He})(Y,J,de,re.numValues):(function(pe,be,Fe){const Ke=be.get(),Xe=Ke+Fe*Float32Array.BYTES_PER_ELEMENT,rt=new Uint8Array(pe.subarray(Ke,Xe)).buffer,yt=new Float32Array(rt);return be.set(Xe),yt})(Y,J,re.numValues);return new vg(ie.name,ae,de)})(w,A,O,j);case 8:return(function(Y,J,ie,de){const re=Kr(Y,J),ae=Fs(de)?(function(pe,be,Fe,Ke){const Xe=be.get(),rt=Xe+Ke*Float64Array.BYTES_PER_ELEMENT,yt=new Uint8Array(pe.subarray(Xe,rt)).buffer,ht=new Float64Array(yt);be.set(rt);const je=Fe.size(),He=new Float64Array(je);let wt=0;for(let xt=0;xt<je;xt++)He[xt]=Fe.get(xt)?ht[wt++]:0;return He})(Y,J,de,re.numValues):(function(pe,be,Fe){const Ke=be.get(),Xe=Ke+Fe*Float64Array.BYTES_PER_ELEMENT,rt=new Uint8Array(pe.subarray(Ke,Xe)).buffer,yt=new Float64Array(rt);return be.set(Xe),yt})(Y,J,re.numValues);return new Qp(ie.name,ae,de)})(w,A,O,j);default:throw new Error(`The specified data type for the field is currently not supported: ${N}`)}})(l,i,t,d,n.scalarType,n):l!=1?null:(function(_,w,A,D){let N=null,O=null,V=null,q=null,j=!1;for(;!j;){const de=Kr(_,w);switch(de.physicalStreamType){case Mr.LENGTH:Wr.DICTIONARY===de.logicalStreamType.lengthType?N=vu(_,w,de):V=vu(_,w,de);break;case Mr.DATA:la.SINGLE===de.logicalStreamType.dictionaryType||la.SHARED===de.logicalStreamType.dictionaryType?(O=_.subarray(w.get(),w.get()+de.byteLength),j=!0):q=_.subarray(w.get(),w.get()+de.byteLength),w.add(de.byteLength)}}const Y=A.complexType.children,J=[];let ie=0;for(const de of Y){const re=_r(_,w,1)[0];if(re==0)continue;const ae=`${A.name}${de.name==="default"?"":":"+de.name}`;if(re!==2||de.type!=="scalarField"||de.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const pe=Kr(_,w),be=Md(_,pe.numValues,w),Fe=Kr(_,w),Ke=Fe.decompressedCount!==D?lm(_,w,Fe,!1,new ua(be,pe.numValues)):Qr(_,w,Fe,!1);J[ie++]=q?new ep(ae,Ke,N,O,V,q,new ua(be,pe.numValues)):new xc(ae,Ke,N,O,new ua(be,pe.numValues))}return J})(i,t,n,d)}function Fs(i){return i instanceof ua}function bu(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const t=i.scalarType;if(t.type==="physicalType")switch(t.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(t.type==="logicalType")return!1}else if(i.type==="complexType"){const t=i.complexType;if(t.type==="physicalType")switch(t.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const Rd=new TextDecoder;function Th(i,t){const n=_r(i,t,1)[0];if(n===0)return"";const l=t.get(),d=i.subarray(l,l+n);return t.add(n),Rd.decode(d)}function Cl(i,t){const n=_r(i,t,1)[0]>>>0,l=!!(4&n),d=!!(2&n),g=_r(i,t,1)[0]>>>0,_={};if(1&n&&(_.nullable=!0),d){const w={};if(l?(w.type="logicalType",w.logicalType=g):(w.type="physicalType",w.physicalType=g),8&n){const A=_r(i,t,1)[0]>>>0;w.children=new Array(A);for(let D=0;D<A;D++)w.children[D]=Cl(i,t)}_.type="complexField",_.complexField=w}else{const w={};l?(w.type="logicalType",w.logicalType=g):(w.type="physicalType",w.physicalType=g),_.type="scalarField",_.scalarField=w}return _}function r_(i,t){const n=_r(i,t,1)[0]>>>0,l=(function(d){switch(d){case 0:case 1:case 2:case 3:{const g={};g.nullable=!!(1&d),g.columnScope=0;const _={};return _.physicalType=d>1?6:4,_.type="physicalType",g.scalarType=_,g.type="scalarType",g}case 4:{const g={nullable:!1,columnScope:0},_={type:"physicalType",physicalType:0};return g.type="complexType",g.complexType=_,g}case 30:{const g={nullable:!1,columnScope:0},_={type:"physicalType",physicalType:1};return g.type="complexType",g.complexType=_,g}default:return(function(g){let _=null;switch(g){case 10:case 11:_=0;break;case 12:case 13:_=1;break;case 14:case 15:_=2;break;case 16:case 17:_=3;break;case 18:case 19:_=4;break;case 20:case 21:_=5;break;case 22:case 23:_=6;break;case 24:case 25:_=7;break;case 26:case 27:_=8;break;case 28:case 29:_=9;break;default:return null}const w={};w.nullable=!!(1&g),w.columnScope=0;const A={type:"physicalType"};return A.physicalType=_,w.type="scalarType",w.scalarType=A,w})(d)}})(n);if(!l)throw new Error(`Unsupported column type code: ${n}`);if((function(d){return d>=10})(n)?l.name=Th(i,t):n>=0&&n<=3?l.name="id":n===4&&(l.name="geometry"),(function(d){return d===30})(n)){const d=_r(i,t,1)[0]>>>0,g=l.complexType;g.children=new Array(d);for(let _=0;_<d;_++)g.children[_]=Cl(i,t)}return l}function bg(i,t){const n={featureTables:[]},l={};l.name=Th(i,t);const d=_r(i,t,1)[0]>>>0,g=_r(i,t,1)[0]>>>0;l.columns=new Array(g);for(let _=0;_<g;_++)l.columns[_]=r_(i,t);return n.featureTables.push(l),[n,d]}function Pd(i,t,n,l,d,g,_=!1){const w=t.scalarType.physicalType,A=Sl(d,g,i,n);if(w===4)switch(A){case Ki.FLAT:{const D=Qr(i,n,d,!1);return new Zf(l,D,g)}case Ki.SEQUENCE:{const D=sm(i,n,d);return new tm(l,D[0],D[1],d.numRleValues)}case Ki.CONST:{const D=om(i,n,d,!1);return new nm(l,D,g)}}else switch(A){case Ki.FLAT:{if(_){const N=(function(O,V,q,j){const Y=(function(J,ie,de){const re=new Float64Array(ie);for(let ae=0;ae<ie;ae++)re[ae]=dg(J,de);return re})(O,q.numValues,V);return(function(J,ie,de){switch(ie.logicalLevelTechnique1){case hn.DELTA:return ie.logicalLevelTechnique2===hn.RLE&&(J=pg(J,ie.runs,ie.numRleValues)),(function(re){re[0]=re[0]%2==1?(re[0]+1)/-2:re[0]/2;const ae=re.length/4*4;let pe=1;if(ae>=4)for(;pe<ae-4;pe+=4){const be=re[pe],Fe=re[pe+1],Ke=re[pe+2],Xe=re[pe+3];re[pe]=(be%2==1?(be+1)/-2:be/2)+re[pe-1],re[pe+1]=(Fe%2==1?(Fe+1)/-2:Fe/2)+re[pe],re[pe+2]=(Ke%2==1?(Ke+1)/-2:Ke/2)+re[pe+1],re[pe+3]=(Xe%2==1?(Xe+1)/-2:Xe/2)+re[pe+2]}for(;pe!=re.length;++pe)re[pe]=(re[pe]%2==1?(re[pe]+1)/-2:re[pe]/2)+re[pe-1]})(J),J;case hn.RLE:return(function(re,ae,pe){return pg(re,ae.runs,ae.numRleValues)})(J,ie);case hn.NONE:return J;default:throw new Error(`The specified Logical level technique is not supported: ${ie.logicalLevelTechnique1}`)}})(Y,q)})(i,n,d);return new Qp(l,N,g)}const D=vh(i,n,d,!1);return new xh(l,D,g)}case Ki.SEQUENCE:{const D=vc(i,n,d);return new um(l,D[0],D[1],d.numRleValues)}case Ki.CONST:{const D=am(i,n,d,!1);return new Ad(l,D,g)}}throw new Error("Vector type not supported for id column.")}class o_{constructor(t,n){var l;switch(this._featureData=t,this.properties=this._featureData.properties||{},(l=this._featureData.geometry)===null||l===void 0?void 0:l.type){case gr.POINT:case gr.MULTIPOINT:this.type=1;break;case gr.LINESTRING:case gr.MULTILINESTRING:this.type=2;break;case gr.POLYGON:case gr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}loadGeometry(){const t=[];for(const n of this._featureData.geometry.coordinates){const l=[];for(const d of n)l.push(new F(d.x,d.y));t.push(l)}return t}}class wg{constructor(t){this.features=[],this.featureTable=t,this.name=t.name,this.extent=t.extent,this.version=2,this.features=t.getFeatures(),this.length=this.features.length}feature(t){return new o_(this.features[t],this.extent)}}class Dd{constructor(t){this.layers={};const n=(function(l,d,g=!0){const _=new hg(0),w=[];for(;_.get()<l.length;){const A=_r(l,_,1)[0]>>>0,D=_.get()+A;if(D>l.length)throw new Error(`Block overruns tile: ${D} > ${l.length}`);if(_r(l,_,1)[0]>>>0!=1){_.set(D);continue}const N=bg(l,_),O=N[1],V=N[0].featureTables[0];let q=null,j=null;const Y=[];let J=0;for(const de of V.columns){const re=de.name;if(re==="id"){let ae=null;if(de.nullable){const be=Kr(l,_),Fe=_.get(),Ke=Md(l,be.numValues,_);_.set(Fe+be.byteLength),ae=new ua(Ke,be.numValues)}const pe=Kr(l,_);J=pe.decompressedCount,q=Pd(l,de,_,re,pe,ae??J,g)}else if(re==="geometry"){const ae=_r(l,_,1)[0];if(J===0){const pe=_.get();J=Kr(l,_).decompressedCount,_.set(pe)}j=_g(l,ae,_,J)}else{const ae=bu(de)?_r(l,_,1)[0]:1;if(ae===0&&de.type==="scalarType")continue;const pe=xu(l,_,de,ae,J);if(pe)if(Array.isArray(pe))for(const be of pe)Y.push(be);else Y.push(pe)}}const ie=new gu(V.name,j,q,Y,O);w.push(ie),_.set(D)}return w})(new Uint8Array(t));this.layers=n.reduce(((l,d)=>Object.assign(Object.assign({},l),{[d.name]:new wg(d)})),{})}}class Tg{constructor(t,n){this.feature=t,this.type=t.type,this.properties=t.tags?t.tags:{},this.extent=n,"id"in t&&(typeof t.id=="string"?this.id=parseInt(t.id,10):typeof t.id!="number"||isNaN(t.id)||(this.id=t.id))}loadGeometry(){const t=[],n=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const l of n){const d=[];for(const g of l)d.push(new F(g[0],g[1]));t.push(d)}return t}}const zd="_geojsonTileLayer";function tp(i,t){t.writeVarintField(15,i.version||1),t.writeStringField(1,i.name||""),t.writeVarintField(5,i.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let g=0;g<i.length;g++)n.feature=i.feature(g),t.writeMessage(2,np,n);const l=n.keys;for(const g of l)t.writeStringField(3,g);const d=n.values;for(const g of d)t.writeMessage(4,ip,g)}function np(i,t){if(!i.feature)return;const n=i.feature;n.id!==void 0&&t.writeVarintField(1,n.id),t.writeMessage(2,Sg,i),t.writeVarintField(3,n.type),t.writeMessage(4,gm,n)}function Sg(i,t){var n;for(const l in(n=i.feature)==null?void 0:n.properties){let d=i.feature.properties[l],g=i.keycache[l];if(d==null)continue;g===void 0&&(i.keys.push(l),g=i.keys.length-1,i.keycache[l]=g),t.writeVarint(g),typeof d!="string"&&typeof d!="boolean"&&typeof d!="number"&&(d=JSON.stringify(d));const _=typeof d+":"+d;let w=i.valuecache[_];w===void 0&&(i.values.push(d),w=i.values.length-1,i.valuecache[_]=w),t.writeVarint(w)}}function wu(i,t){return(t<<3)+(7&i)}function mm(i){return i<<1^i>>31}function gm(i,t){const n=i.loadGeometry(),l=i.type;let d=0,g=0;for(const _ of n){let w=1;l===1&&(w=_.length),t.writeVarint(wu(1,w));const A=l===3?_.length-1:_.length;for(let D=0;D<A;D++){D===1&&l!==1&&t.writeVarint(wu(2,A-1));const N=_[D].x-d,O=_[D].y-g;t.writeVarint(mm(N)),t.writeVarint(mm(O)),d+=N,g+=O}i.type===3&&t.writeVarint(wu(7,1))}}function ip(i,t){const n=typeof i;n==="string"?t.writeStringField(1,i):n==="boolean"?t.writeBooleanField(7,i):n==="number"&&(i%1!=0?t.writeDoubleField(3,i):i<0?t.writeSVarintField(6,i):t.writeVarintField(5,i))}class _m{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ma(Lt,16,0),this.grid3D=new Ma(Lt,16,0),this.featureIndexArray=new te,this.promoteId=n}insert(t,n,l,d,g,_){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,g);const A=_?this.grid3D:this.grid;for(let D=0;D<n.length;D++){const N=n[D],O=[1/0,1/0,-1/0,-1/0];for(let V=0;V<N.length;V++){const q=N[V];O[0]=Math.min(O[0],q.x),O[1]=Math.min(O[1],q.y),O[2]=Math.max(O[2],q.x),O[3]=Math.max(O[3],q.y)}O[0]<Lt&&O[1]<Lt&&O[2]>=0&&O[3]>=0&&A.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new In(new If(this.rawTileData)).layers:new Dd(this.rawTileData).layers,this.sourceLayerCoder=new Kp(this.vtLayers?Object.keys(this.vtLayers).sort():[zd])),this.vtLayers}query(t,n,l,d){this.loadVTLayers();const g=t.params,_=Lt/t.tileSize/t.scale,w=Hr(g.filter,g.globalState),A=t.queryGeometry,D=t.queryPadding*_,N=pu.fromPoints(A),O=this.grid.query(N.minX-D,N.minY-D,N.maxX+D,N.maxY+D),V=pu.fromPoints(t.cameraQueryGeometry).expandBy(D),q=this.grid3D.query(V.minX,V.minY,V.maxX,V.maxY,((J,ie,de,re)=>(function(ae,pe,be,Fe,Ke){for(const rt of ae)if(pe<=rt.x&&be<=rt.y&&Fe>=rt.x&&Ke>=rt.y)return!0;const Xe=[new F(pe,be),new F(pe,Ke),new F(Fe,Ke),new F(Fe,be)];if(ae.length>2){for(const rt of Xe)if(za(ae,rt))return!0}for(let rt=0;rt<ae.length-1;rt++)if(Im(ae[rt],ae[rt+1],Xe))return!0;return!1})(t.cameraQueryGeometry,J-D,ie-D,de+D,re+D)));for(const J of q)O.push(J);O.sort(rp);const j={};let Y;for(let J=0;J<O.length;J++){const ie=O[J];if(ie===Y)continue;Y=ie;const de=this.featureIndexArray.get(ie);let re=null;this.loadMatchingFeature(j,de.bucketIndex,de.sourceLayerIndex,de.featureIndex,w,g.layers,g.availableImages,n,l,d,((ae,pe,be)=>(re||(re=ia(ae)),pe.queryIntersectsFeature({queryGeometry:A,feature:ae,featureState:be,geometry:re,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return j}loadMatchingFeature(t,n,l,d,g,_,w,A,D,N,O){const V=this.bucketLayerIDs[n];if(_&&!V.some((J=>_.has(J))))return;const q=this.sourceLayerCoder.decode(l),j=this.vtLayers[q].feature(d);if(g.needGeometry){const J=ns(j,!0);if(!g.filter(new Un(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!g.filter(new Un(this.tileID.overscaledZ),j))return;const Y=this.getId(j,q);for(let J=0;J<V.length;J++){const ie=V[J];if(_&&!_.has(ie))continue;const de=A[ie];if(!de)continue;let re={};Y&&N&&(re=N.getState(de.sourceLayer||zd,Y));const ae=Nt({},D[ie]);ae.paint=Eg(ae.paint,de.paint,j,re,w),ae.layout=Eg(ae.layout,de.layout,j,re,w);const pe=!O||O(j,de,re);if(!pe)continue;const be=new qf(j,this.z,this.x,this.y,Y);be.layer=ae;let Fe=t[ie];Fe===void 0&&(Fe=t[ie]=[]),Fe.push({featureIndex:d,feature:be,intersectionZ:pe})}}lookupSymbolFeatures(t,n,l,d,g,_,w,A){const D={};this.loadVTLayers();const N=Hr(g.filterSpec,g.globalState);for(const O of t)this.loadMatchingFeature(D,l,d,O,N,_,w,A,n);return D}hasLayer(t){for(const n of this.bucketLayerIDs)for(const l of n)if(t===l)return!0;return!1}getId(t,n){var l;let d=t.id;return this.promoteId&&(d=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof d=="boolean"&&(d=Number(d)),d===void 0&&(!((l=t.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(d=Number(t.properties.cluster_id))),d}}function Eg(i,t,n,l,d){return ei(i,((g,_)=>{const w=t instanceof ll?t.get(_):null;return w&&w.evaluate?w.evaluate(n,l,d):w}))}function rp(i,t){return t-i}function r(i,t,n,l,d){const g=[];for(let _=0;_<i.length;_++){const w=i[_];let A;for(let D=0;D<w.length-1;D++){let N=w[D],O=w[D+1];N.x<t&&O.x<t||(N.x<t?N=new F(t,N.y+(t-N.x)/(O.x-N.x)*(O.y-N.y))._round():O.x<t&&(O=new F(t,N.y+(t-N.x)/(O.x-N.x)*(O.y-N.y))._round()),N.y<n&&O.y<n||(N.y<n?N=new F(N.x+(n-N.y)/(O.y-N.y)*(O.x-N.x),n)._round():O.y<n&&(O=new F(N.x+(n-N.y)/(O.y-N.y)*(O.x-N.x),n)._round()),N.x>=l&&O.x>=l||(N.x>=l?N=new F(l,N.y+(l-N.x)/(O.x-N.x)*(O.y-N.y))._round():O.x>=l&&(O=new F(l,N.y+(l-N.x)/(O.x-N.x)*(O.y-N.y))._round()),N.y>=d&&O.y>=d||(N.y>=d?N=new F(N.x+(d-N.y)/(O.y-N.y)*(O.x-N.x),d)._round():O.y>=d&&(O=new F(N.x+(d-N.y)/(O.y-N.y)*(O.x-N.x),d)._round()),A&&N.equals(A[A.length-1])||(A=[N],g.push(A)),A.push(O)))))}}return g}function s(i,t,n,l,d){switch(t){case 1:return(function(g,_,w,A){const D=[];for(const N of g)for(const O of N){const V=A===0?O.x:O.y;V>=_&&V<=w&&D.push([O])}return D})(i,n,l,d);case 2:return x(i,n,l,d,!1);case 3:return x(i,n,l,d,!0)}return[]}function p(i,t,n,l,d){const g=l===0?P:L;let _=[];const w=[];for(let N=0;N<i.length-1;N++){const O=i[N],V=i[N+1],q=l===0?O.x:O.y,j=l===0?V.x:V.y;let Y=!1;q<t?j>t&&_.push(g(O,V,t)):q>n?j<n&&_.push(g(O,V,n)):_.push(O),j<t&&q>=t&&(_.push(g(O,V,t)),Y=!0),j>n&&q<=n&&(_.push(g(O,V,n)),Y=!0),!d&&Y&&(w.push(_),_=[])}const A=i.length-1,D=l===0?i[A].x:i[A].y;return D>=t&&D<=n&&_.push(i[A]),d&&_.length>0&&!_[0].equals(_[_.length-1])&&_.push(new F(_[0].x,_[0].y)),_.length>0&&w.push(_),w}function x(i,t,n,l,d){const g=[];for(const _ of i){const w=p(_,t,n,l,d);w.length>0&&g.push(...w)}return g}function P(i,t,n){return new F(n,i.y+(n-i.x)/(t.x-i.x)*(t.y-i.y))}function L(i,t,n){return new F(i.x+(n-i.y)/(t.y-i.y)*(t.x-i.x),n)}Tt("FeatureIndex",_m,{omit:["rawTileData","sourceLayerCoder"]});class $ extends F{constructor(t,n,l,d){super(t,n),this.angle=l,d!==void 0&&(this.segment=d)}clone(){return new $(this.x,this.y,this.angle,this.segment)}}function oe(i,t,n,l,d){if(t.segment===void 0||n===0)return!0;let g=t,_=t.segment+1,w=0;for(;w>-n/2;){if(_--,_<0)return!1;w-=i[_].dist(g),g=i[_]}w+=i[_].dist(i[_+1]),_++;const A=[];let D=0;for(;w<n/2;){const N=i[_],O=i[_+1];if(!O)return!1;let V=i[_-1].angleTo(N)-N.angleTo(O);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:w,angleDelta:V}),D+=V;w-A[0].distance>l;)D-=A.shift().angleDelta;if(D>d)return!1;_++,w+=N.dist(O)}return!0}function Se(i){let t=0;for(let n=0;n<i.length-1;n++)t+=i[n].dist(i[n+1]);return t}function qe(i,t,n){return i?.6*t*n:0}function tt(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function ct(i,t,n,l,d,g){const _=qe(n,d,g),w=tt(n,l)*g;let A=0;const D=Se(i)/2;for(let N=0;N<i.length-1;N++){const O=i[N],V=i[N+1],q=O.dist(V);if(A+q>D){const j=(D-A)/q,Y=di.number(O.x,V.x,j),J=di.number(O.y,V.y,j),ie=new $(Y,J,V.angleTo(O),N);return ie._round(),!_||oe(i,ie,w,_,t)?ie:void 0}A+=q}}function Ze(i,t,n,l,d,g,_,w,A){const D=qe(l,g,_),N=tt(l,d),O=N*_,V=i[0].x===0||i[0].x===A||i[0].y===0||i[0].y===A;return t-O<t/4&&(t=O+t/4),Je(i,V?t/2*w%t:(N/2+2*g)*_*w%t,t,D,n,O,V,!1,A)}function Je(i,t,n,l,d,g,_,w,A){const D=g/2,N=Se(i);let O=0,V=t-n,q=[];for(let j=0;j<i.length-1;j++){const Y=i[j],J=i[j+1],ie=Y.dist(J),de=J.angleTo(Y);for(;V+n<O+ie;){V+=n;const re=(V-O)/ie,ae=di.number(Y.x,J.x,re),pe=di.number(Y.y,J.y,re);if(ae>=0&&ae<A&&pe>=0&&pe<A&&V-D>=0&&V+D<=N){const be=new $(ae,pe,de,j);be._round(),l&&!oe(i,be,g,l,d)||q.push(be)}}O+=ie}return w||q.length||_||(q=Je(i,O/2,n,l,d,g,_,!0,A)),q}function kt(i,t,n,l){const d=[],g=i.image,_=g.pixelRatio,w=g.paddedRect.w-2,A=g.paddedRect.h-2;let D={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const N=g.stretchX||[[0,w]],O=g.stretchY||[[0,A]],V=(He,wt)=>He+wt[1]-wt[0],q=N.reduce(V,0),j=O.reduce(V,0),Y=w-q,J=A-j;let ie=0,de=q,re=0,ae=j,pe=0,be=Y,Fe=0,Ke=J;if(g.content&&l){const He=g.content,wt=He[2]-He[0],xt=He[3]-He[1];(g.textFitWidth||g.textFitHeight)&&(D=Tl(i)),ie=Yt(N,0,He[0]),re=Yt(O,0,He[1]),de=Yt(N,He[0],He[2]),ae=Yt(O,He[1],He[3]),pe=He[0]-ie,Fe=He[1]-re,be=wt-de,Ke=xt-ae}const Xe=D.x1,rt=D.y1,yt=D.x2-Xe,ht=D.y2-rt,je=(He,wt,xt,Ct)=>{const bt=ze(He.stretch-ie,de,yt,Xe),Bt=Ie(He.fixed-pe,be,He.stretch,q),Ln=ze(wt.stretch-re,ae,ht,rt),_n=Ie(wt.fixed-Fe,Ke,wt.stretch,j),Ii=ze(xt.stretch-ie,de,yt,Xe),eo=Ie(xt.fixed-pe,be,xt.stretch,q),yr=ze(Ct.stretch-re,ae,ht,rt),Ri=Ie(Ct.fixed-Fe,Ke,Ct.stretch,j),bi=new F(bt,Ln),jn=new F(Ii,Ln),Hi=new F(Ii,yr),Qi=new F(bt,yr),gi=new F(Bt/_,_n/_),ss=new F(eo/_,Ri/_),to=t*Math.PI/180;if(to){const Rr=Math.sin(to),Bi=Math.cos(to),vr=[Bi,-Rr,Rr,Bi];bi._matMult(vr),jn._matMult(vr),Qi._matMult(vr),Hi._matMult(vr)}const as=He.stretch+He.fixed,Oa=wt.stretch+wt.fixed;return{tl:bi,tr:jn,bl:Qi,br:Hi,tex:{x:g.paddedRect.x+1+as,y:g.paddedRect.y+1+Oa,w:xt.stretch+xt.fixed-as,h:Ct.stretch+Ct.fixed-Oa},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gi,pixelOffsetBR:ss,minFontScaleX:be/_/yt,minFontScaleY:Ke/_/ht,isSDF:n}};if(l&&(g.stretchX||g.stretchY)){const He=oi(N,Y,q),wt=oi(O,J,j);for(let xt=0;xt<He.length-1;xt++){const Ct=He[xt],bt=He[xt+1];for(let Bt=0;Bt<wt.length-1;Bt++)d.push(je(Ct,wt[Bt],bt,wt[Bt+1]))}}else d.push(je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:A+1}));return d}function Yt(i,t,n){let l=0;for(const d of i)l+=Math.max(t,Math.min(n,d[1]))-Math.max(t,Math.min(n,d[0]));return l}function oi(i,t,n){const l=[{fixed:-1,stretch:0}];for(const[d,g]of i){const _=l[l.length-1];l.push({fixed:d-_.stretch,stretch:_.stretch}),l.push({fixed:d-_.stretch,stretch:_.stretch+(g-d)})}return l.push({fixed:t+1,stretch:n}),l}function ze(i,t,n,l){return i/t*n+l}function Ie(i,t,n,l){return i-t*n/l}Tt("Anchor",$);class Ge{constructor(t,n,l,d,g,_,w,A,D,N){var O;if(this.boxStartIndex=t.length,D){let V=_.top,q=_.bottom;const j=_.collisionPadding;j&&(V-=j[1],q+=j[3]);let Y=q-V;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{const V=!((O=_.image)===null||O===void 0)&&O.content&&(_.image.textFitWidth||_.image.textFitHeight)?Tl(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};V.y1=V.y1*w-A[0],V.y2=V.y2*w+A[2],V.x1=V.x1*w-A[3],V.x2=V.x2*w+A[1];const q=_.collisionPadding;if(q&&(V.x1-=q[0]*w,V.y1-=q[1]*w,V.x2+=q[2]*w,V.y2+=q[3]*w),N){const j=new F(V.x1,V.y1),Y=new F(V.x2,V.y1),J=new F(V.x1,V.y2),ie=new F(V.x2,V.y2),de=N*Math.PI/180;j._rotate(de),Y._rotate(de),J._rotate(de),ie._rotate(de),V.x1=Math.min(j.x,Y.x,J.x,ie.x),V.x2=Math.max(j.x,Y.x,J.x,ie.x),V.y1=Math.min(j.y,Y.y,J.y,ie.y),V.y2=Math.max(j.y,Y.y,J.y,ie.y)}t.emplaceBack(n.x,n.y,V.x1,V.y1,V.x2,V.y2,l,d,g)}this.boxEndIndex=t.length}}class lt{constructor(t=[],n=(l,d)=>l<d?-1:l>d?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:l}=this,d=n[t];for(;t>0;){const g=t-1>>1,_=n[g];if(l(d,_)>=0)break;n[t]=_,t=g}n[t]=d}_down(t){const{data:n,compare:l}=this,d=this.length>>1,g=n[t];for(;t<d;){let _=1+(t<<1);const w=_+1;if(w<this.length&&l(n[w],n[_])<0&&(_=w),l(n[_],g)>=0)break;n[t]=n[_],t=_}n[t]=g}}function Zt(i,t=1,n=!1){const l=pu.fromPoints(i[0]),d=Math.min(l.width(),l.height());let g=d/2;const _=new lt([],$n),{minX:w,minY:A,maxX:D,maxY:N}=l;if(d===0)return new F(w,A);for(let q=w;q<D;q+=d)for(let j=A;j<N;j+=d)_.push(new Ft(q+g,j+g,g,i));let O=(function(q){let j=0,Y=0,J=0;const ie=q[0];for(let de=0,re=ie.length,ae=re-1;de<re;ae=de++){const pe=ie[de],be=ie[ae],Fe=pe.x*be.y-be.x*pe.y;Y+=(pe.x+be.x)*Fe,J+=(pe.y+be.y)*Fe,j+=3*Fe}return new Ft(Y/j,J/j,0,q)})(i),V=_.length;for(;_.length;){const q=_.pop();(q.d>O.d||!O.d)&&(O=q,n&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,V)),q.max-O.d<=t||(g=q.h/2,_.push(new Ft(q.p.x-g,q.p.y-g,g,i)),_.push(new Ft(q.p.x+g,q.p.y-g,g,i)),_.push(new Ft(q.p.x-g,q.p.y+g,g,i)),_.push(new Ft(q.p.x+g,q.p.y+g,g,i)),V+=4)}return n&&(console.log(`num probes: ${V}`),console.log(`best distance: ${O.d}`)),O.p}function $n(i,t){return t.max-i.max}function Ft(i,t,n,l){this.p=new F(i,t),this.h=n,this.d=(function(d,g){let _=!1,w=1/0;for(let A=0;A<g.length;A++){const D=g[A];for(let N=0,O=D.length,V=O-1;N<O;V=N++){const q=D[N],j=D[V];q.y>d.y!=j.y>d.y&&d.x<(j.x-q.x)*(d.y-q.y)/(j.y-q.y)+q.x&&(_=!_),w=Math.min(w,xp(d,q,j))}}return(_?1:-1)*Math.sqrt(w)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}var Gt;S.aP=void 0,(Gt=S.aP||(S.aP={}))[Gt.center=1]="center",Gt[Gt.left=2]="left",Gt[Gt.right=3]="right",Gt[Gt.top=4]="top",Gt[Gt.bottom=5]="bottom",Gt[Gt["top-left"]=6]="top-left",Gt[Gt["top-right"]=7]="top-right",Gt[Gt["bottom-left"]=8]="bottom-left",Gt[Gt["bottom-right"]=9]="bottom-right";const Cn=Number.POSITIVE_INFINITY;function Gn(i,t){return t[1]!==Cn?(function(n,l,d){let g=0,_=0;switch(l=Math.abs(l),d=Math.abs(d),n){case"top-right":case"top-left":case"top":_=d-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-d}switch(n){case"top-right":case"bottom-right":case"right":g=-l;break;case"top-left":case"bottom-left":case"left":g=l}return[g,_]})(i,t[0],t[1]):(function(n,l){let d=0,g=0;l<0&&(l=0);const _=l/Math.SQRT2;switch(n){case"top-right":case"top-left":g=_-7;break;case"bottom-right":case"bottom-left":g=7-_;break;case"bottom":g=7-l;break;case"top":g=l-7}switch(n){case"top-right":case"bottom-right":d=-_;break;case"top-left":case"bottom-left":d=_;break;case"left":d=l;break;case"right":d=-l}return[d,g]})(i,t[0])}function Al(i,t,n){var l;const d=i.layout,g=(l=d.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},n);if(g){const w=g.values,A=[];for(let D=0;D<w.length;D+=2){const N=A[D]=w[D],O=w[D+1].map((V=>V*or));N.startsWith("top")?O[1]-=7:N.startsWith("bottom")&&(O[1]+=7),A[D+1]=O}return new Ti(A)}const _=d.get("text-variable-anchor");if(_){let w;w=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(t,{},n)*or,Cn]:d.get("text-offset").evaluate(t,{},n).map((D=>D*or));const A=[];for(const D of _)A.push(D,Gn(D,w));return new Ti(A)}return null}function ym(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ix(i,t,n,l,d,g,_,w,A,D,N,O){let V=g.textMaxSize.evaluate(t,{});V===void 0&&(V=_);const q=i.layers[0].layout,j=q.get("icon-offset").evaluate(t,{},N),Y=ey(n.horizontal),J=_/24,ie=i.tilePixelRatio*J,de=i.tilePixelRatio*V/24,re=i.tilePixelRatio*w,ae=i.tilePixelRatio*q.get("symbol-spacing"),pe=q.get("text-padding")*i.tilePixelRatio,be=(function(xt,Ct,bt,Bt=1){const Ln=xt.get("icon-padding").evaluate(Ct,{},bt),_n=Ln&&Ln.values;return[_n[0]*Bt,_n[1]*Bt,_n[2]*Bt,_n[3]*Bt]})(q,t,N,i.tilePixelRatio),Fe=q.get("text-max-angle")/180*Math.PI,Ke=q.get("text-rotation-alignment")!=="viewport"&&q.get("symbol-placement")!=="point",Xe=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",rt=q.get("symbol-placement"),yt=ae/2,ht=q.get("icon-text-fit");let je;l&&ht!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(je=sa(l,n.vertical,ht,q.get("icon-text-fit-padding"),j,J)),Y&&(l=sa(l,Y,ht,q.get("icon-text-fit-padding"),j,J)));const He=N?O.line.getGranularityForZoomLevel(N.z):1,wt=(xt,Ct)=>{Ct.x<0||Ct.x>=Lt||Ct.y<0||Ct.y>=Lt||(function(bt,Bt,Ln,_n,Ii,eo,yr,Ri,bi,jn,Hi,Qi,gi,ss,to,as,Oa,Rr,Bi,vr,Zi,Pr,bc,Ml,bm){const Sh=bt.addToLineVertexArray(Bt,Ln);let Ld,op,sp,ap,ry=0,oy=0,sy=0,ay=0,f_=-1,p_=-1;const wc={};let ly=Ai("");if(bt.allowVerticalPlacement&&_n.vertical){const bo=Ri.layout.get("text-rotate").evaluate(Zi,{},Ml)+90;sp=new Ge(bi,Bt,jn,Hi,Qi,_n.vertical,gi,ss,to,bo),yr&&(ap=new Ge(bi,Bt,jn,Hi,Qi,yr,Oa,Rr,to,bo))}if(Ii){const bo=Ri.layout.get("icon-rotate").evaluate(Zi,{}),ca=Ri.layout.get("icon-text-fit")!=="none",Nd=kt(Ii,bo,bc,ca),Rl=yr?kt(yr,bo,bc,ca):void 0;op=new Ge(bi,Bt,jn,Hi,Qi,Ii,Oa,Rr,!1,bo),ry=4*Nd.length;const kd=bt.iconSizeData;let Tu=null;kd.kind==="source"?(Tu=[rs*Ri.layout.get("icon-size").evaluate(Zi,{})],Tu[0]>du&&wn(`${bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):kd.kind==="composite"&&(Tu=[rs*Pr.compositeIconSizes[0].evaluate(Zi,{},Ml),rs*Pr.compositeIconSizes[1].evaluate(Zi,{},Ml)],(Tu[0]>du||Tu[1]>du)&&wn(`${bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),bt.addSymbols(bt.icon,Nd,Tu,vr,Bi,Zi,S.az.none,Bt,Sh.lineStartIndex,Sh.lineLength,-1,Ml),f_=bt.icon.placedSymbolArray.length-1,Rl&&(oy=4*Rl.length,bt.addSymbols(bt.icon,Rl,Tu,vr,Bi,Zi,S.az.vertical,Bt,Sh.lineStartIndex,Sh.lineLength,-1,Ml),p_=bt.icon.placedSymbolArray.length-1)}const uy=Object.keys(_n.horizontal);for(const bo of uy){const ca=_n.horizontal[bo];if(!Ld){ly=Ai(ca.text);const Rl=Ri.layout.get("text-rotate").evaluate(Zi,{},Ml);Ld=new Ge(bi,Bt,jn,Hi,Qi,ca,gi,ss,to,Rl)}const Nd=ca.positionedLines.length===1;if(sy+=Q_(bt,Bt,ca,eo,Ri,to,Zi,as,Sh,_n.vertical?S.az.horizontal:S.az.horizontalOnly,Nd?uy:[bo],wc,f_,Pr,Ml),Nd)break}_n.vertical&&(ay+=Q_(bt,Bt,_n.vertical,eo,Ri,to,Zi,as,Sh,S.az.vertical,["vertical"],wc,p_,Pr,Ml));const sx=Ld?Ld.boxStartIndex:bt.collisionBoxArray.length,ax=Ld?Ld.boxEndIndex:bt.collisionBoxArray.length,lx=sp?sp.boxStartIndex:bt.collisionBoxArray.length,ux=sp?sp.boxEndIndex:bt.collisionBoxArray.length,cx=op?op.boxStartIndex:bt.collisionBoxArray.length,hx=op?op.boxEndIndex:bt.collisionBoxArray.length,dx=ap?ap.boxStartIndex:bt.collisionBoxArray.length,fx=ap?ap.boxEndIndex:bt.collisionBoxArray.length;let Il=-1;const Ag=(bo,ca)=>bo&&bo.circleDiameter?Math.max(bo.circleDiameter,ca):ca;Il=Ag(Ld,Il),Il=Ag(sp,Il),Il=Ag(op,Il),Il=Ag(ap,Il);const cy=Il>-1?1:0;cy&&(Il*=bm/or),bt.glyphOffsetArray.length>=mh.MAX_GLYPHS&&wn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zi.sortKey!==void 0&&bt.addToSortKeyRanges(bt.symbolInstances.length,Zi.sortKey);const px=Al(Ri,Zi,Ml),[mx,gx]=(function(bo,ca){const Nd=bo.length,Rl=ca==null?void 0:ca.values;if((Rl==null?void 0:Rl.length)>0)for(let kd=0;kd<Rl.length;kd+=2){const Tu=Rl[kd+1];bo.emplaceBack(S.aP[Rl[kd]],Tu[0],Tu[1])}return[Nd,bo.length]})(bt.textAnchorOffsets,px);bt.symbolInstances.emplaceBack(Bt.x,Bt.y,wc.right>=0?wc.right:-1,wc.center>=0?wc.center:-1,wc.left>=0?wc.left:-1,wc.vertical||-1,f_,p_,ly,sx,ax,lx,ux,cx,hx,dx,fx,jn,sy,ay,ry,oy,cy,0,gi,Il,mx,gx)})(i,Ct,xt,n,l,d,je,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,ie,[pe,pe,pe,pe],Ke,A,re,be,Xe,j,t,g,D,N,_)};if(rt==="line")for(const xt of r(t.geometry,0,0,Lt,Lt)){const Ct=yl(xt,He),bt=Ze(Ct,ae,Fe,n.vertical||Y,l,24,de,i.overscaling,Lt);for(const Bt of bt)Y&&rx(i,Y.text,yt,Bt)||wt(Ct,Bt)}else if(rt==="line-center"){for(const xt of t.geometry)if(xt.length>1){const Ct=yl(xt,He),bt=ct(Ct,Fe,n.vertical||Y,l,24,de);bt&&wt(Ct,bt)}}else if(t.type==="Polygon")for(const xt of Ou(t.geometry,0)){const Ct=Zt(xt,16);wt(yl(xt[0],He,!0),new $(Ct.x,Ct.y,0))}else if(t.type==="LineString")for(const xt of t.geometry){const Ct=yl(xt,He);wt(Ct,new $(Ct[0].x,Ct[0].y,0))}else if(t.type==="Point")for(const xt of t.geometry)for(const Ct of xt)wt([Ct],new $(Ct.x,Ct.y,0))}function Q_(i,t,n,l,d,g,_,w,A,D,N,O,V,q,j){const Y=(function(de,re,ae,pe,be,Fe,Ke,Xe){const rt=pe.layout.get("text-rotate").evaluate(Fe,{})*Math.PI/180,yt=[];for(const ht of re.positionedLines)for(const je of ht.positionedGlyphs){if(!je.rect)continue;const He=je.rect||{};let wt=4,xt=!0,Ct=1,bt=0;const Bt=(be||Xe)&&je.vertical,Ln=je.metrics.advance*je.scale/2;if(Xe&&re.verticalizable&&(bt=ht.lineOffset/2-(je.imageName?-(or-je.metrics.width*je.scale)/2:(je.scale-1)*or)),je.imageName){const Rr=Ke[je.imageName];xt=Rr.sdf,Ct=Rr.pixelRatio,wt=1/Ct}const _n=be?[je.x+Ln,je.y]:[0,0];let Ii=be?[0,0]:[je.x+Ln+ae[0],je.y+ae[1]-bt],eo=[0,0];Bt&&(eo=Ii,Ii=[0,0]);const yr=je.metrics.isDoubleResolution?2:1,Ri=(je.metrics.left-wt)*je.scale-Ln+Ii[0],bi=(-je.metrics.top-wt)*je.scale+Ii[1],jn=Ri+He.w/yr*je.scale/Ct,Hi=bi+He.h/yr*je.scale/Ct,Qi=new F(Ri,bi),gi=new F(jn,bi),ss=new F(Ri,Hi),to=new F(jn,Hi);if(Bt){const Rr=new F(-Ln,Ln- -17),Bi=-Math.PI/2,vr=12-Ln,Zi=new F(22-vr,-(je.imageName?vr:0)),Pr=new F(...eo);Qi._rotateAround(Bi,Rr)._add(Zi)._add(Pr),gi._rotateAround(Bi,Rr)._add(Zi)._add(Pr),ss._rotateAround(Bi,Rr)._add(Zi)._add(Pr),to._rotateAround(Bi,Rr)._add(Zi)._add(Pr)}if(rt){const Rr=Math.sin(rt),Bi=Math.cos(rt),vr=[Bi,-Rr,Rr,Bi];Qi._matMult(vr),gi._matMult(vr),ss._matMult(vr),to._matMult(vr)}const as=new F(0,0),Oa=new F(0,0);yt.push({tl:Qi,tr:gi,bl:ss,br:to,tex:He,writingMode:re.writingMode,glyphOffset:_n,sectionIndex:je.sectionIndex,isSDF:xt,pixelOffsetTL:as,pixelOffsetBR:Oa,minFontScaleX:0,minFontScaleY:0})}return yt})(0,n,w,d,g,_,l,i.allowVerticalPlacement),J=i.textSizeData;let ie=null;J.kind==="source"?(ie=[rs*d.layout.get("text-size").evaluate(_,{})],ie[0]>du&&wn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):J.kind==="composite"&&(ie=[rs*q.compositeTextSizes[0].evaluate(_,{},j),rs*q.compositeTextSizes[1].evaluate(_,{},j)],(ie[0]>du||ie[1]>du)&&wn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,Y,ie,w,g,_,D,t,A.lineStartIndex,A.lineLength,V,j);for(const de of N)O[de]=i.text.placedSymbolArray.length-1;return 4*Y.length}function ey(i){for(const t in i)return i[t];return null}function rx(i,t,n,l){const d=i.compareText;if(t in d){const g=d[t];for(let _=g.length-1;_>=0;_--)if(l.dist(g[_])<n)return!0}else d[t]=[];return d[t].push(l),!1}const ty=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class s_{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=l>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=ty[15&l];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new s_(w,_,g,t)}constructor(t,n=64,l=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=ty.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-w%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${l}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+A,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+w+A),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+A,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=n,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return a_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:w}=this,A=[0,g.length-1,0],D=[];for(;A.length;){const N=A.pop()||0,O=A.pop()||0,V=A.pop()||0;if(O-V<=w){for(let J=V;J<=O;J++){const ie=_[2*J],de=_[2*J+1];ie>=t&&ie<=l&&de>=n&&de<=d&&D.push(g[J])}continue}const q=V+O>>1,j=_[2*q],Y=_[2*q+1];j>=t&&j<=l&&Y>=n&&Y<=d&&D.push(g[q]),(N===0?t<=j:n<=Y)&&(A.push(V),A.push(q-1),A.push(1-N)),(N===0?l>=j:d>=Y)&&(A.push(q+1),A.push(O),A.push(1-N))}return D}within(t,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:_}=this,w=[0,d.length-1,0],A=[],D=l*l;for(;w.length;){const N=w.pop()||0,O=w.pop()||0,V=w.pop()||0;if(O-V<=_){for(let J=V;J<=O;J++)iy(g[2*J],g[2*J+1],t,n)<=D&&A.push(d[J]);continue}const q=V+O>>1,j=g[2*q],Y=g[2*q+1];iy(j,Y,t,n)<=D&&A.push(d[q]),(N===0?t-l<=j:n-l<=Y)&&(w.push(V),w.push(q-1),w.push(1-N)),(N===0?t+l>=j:n+l>=Y)&&(w.push(q+1),w.push(O),w.push(1-N))}return A}}function a_(i,t,n,l,d,g){if(d-l<=n)return;const _=l+d>>1;ny(i,t,_,l,d,g),a_(i,t,n,l,_-1,1-g),a_(i,t,n,_+1,d,1-g)}function ny(i,t,n,l,d,g){for(;d>l;){if(d-l>600){const D=d-l+1,N=n-l+1,O=Math.log(D),V=.5*Math.exp(2*O/3),q=.5*Math.sqrt(O*V*(D-V)/D)*(N-D/2<0?-1:1);ny(i,t,n,Math.max(l,Math.floor(n-N*V/D+q)),Math.min(d,Math.floor(n+(D-N)*V/D+q)),g)}const _=t[2*n+g];let w=l,A=d;for(vm(i,t,l,n),t[2*d+g]>_&&vm(i,t,l,d);w<A;){for(vm(i,t,w,A),w++,A--;t[2*w+g]<_;)w++;for(;t[2*A+g]>_;)A--}t[2*l+g]===_?vm(i,t,l,A):(A++,vm(i,t,A,d)),A<=n&&(l=A+1),n<=A&&(d=A-1)}}function vm(i,t,n,l){l_(i,n,l),l_(t,2*n,2*l),l_(t,2*n+1,2*l+1)}function l_(i,t,n){const l=i[t];i[t]=i[n],i[n]=l}function iy(i,t,n,l){const d=i-n,g=t-l;return d*d+g*g}var u_;S.cI=void 0,(u_=S.cI||(S.cI={})).create="create",u_.load="load",u_.fullLoad="fullLoad";let Cg=null,xm=[];const c_=1e3/60,h_="loadTime",d_="fullLoadTime",ox={mark(i){performance.mark(i)},frame(i){const t=i;Cg!=null&&xm.push(t-Cg),Cg=t},clearMetrics(){Cg=null,xm=[],performance.clearMeasures(h_),performance.clearMeasures(d_);for(const i in S.cI)performance.clearMarks(S.cI[i])},getPerformanceMetrics(){performance.measure(h_,S.cI.create,S.cI.load),performance.measure(d_,S.cI.create,S.cI.fullLoad);const i=performance.getEntriesByName(h_)[0].duration,t=performance.getEntriesByName(d_)[0].duration,n=xm.length,l=1/(xm.reduce(((g,_)=>g+_),0)/n/1e3),d=xm.filter((g=>g>c_)).reduce(((g,_)=>g+(_-c_)/c_),0);return{loadTime:i,fullLoadTime:t,fps:l,percentDroppedFrames:d/(n+d)*100,totalFrames:n}}};S.$=se,S.A=We,S.B=Xo,S.C=rr,S.D=St,S.E=ut,S.F=function([i,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(n),y:i*Math.sin(t)*Math.sin(n),z:i*Math.cos(n)}},S.G=di,S.H=Un,S.I=Qn,S.J=jc,S.K=function(i){if(un==null){const t=i.navigator?i.navigator.userAgent:null;un=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return un},S.L=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Uf((()=>this.process())),this.subscription=Bs(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=sr(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,t){return new Promise(((n,l)=>{const d=Math.round(1e18*Math.random()).toString(36).substring(0,10),g=t?Bs(t.signal,"abort",(()=>{g==null||g.unsubscribe(),delete this.resolveRejects[d];const A={id:d,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(A)}),Yp):null;this.resolveRejects[d]={resolve:A=>{g==null||g.unsubscribe(),n(A)},reject:A=>{g==null||g.unsubscribe(),l(A)}};const _=[],w=Object.assign(Object.assign({},i),{id:d,sourceMapId:this.mapId,origin:location.origin,data:Jo(i.data,_)});this.target.postMessage(w,{transfer:_})}))}receive(i){const t=i.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const l=this.abortControllers[n];return delete this.abortControllers[n],void(l&&l.abort())}if(sr(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,(function*(){if(t.type==="<response>"){const d=this.resolveRejects[i];return delete this.resolveRejects[i],d?void(t.error?d.reject(nu(t.error)):d.resolve(nu(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=nu(t.data),l=new AbortController;this.abortControllers[i]=l;try{const d=yield this.messageHandlers[t.type](t.sourceMapId,n,l);this.completeTask(i,null,d)}catch(d){this.completeTask(i,d)}}))}completeTask(i,t,n){const l=[];delete this.abortControllers[i];const d={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Jo(t):null,data:Jo(n,l)};this.target.postMessage(d,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.M=ne,S.N=function(){var i=new We(16);return We!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},S.O=function(i,t,n){var l,d,g,_,w,A,D,N,O,V,q,j,Y=n[0],J=n[1],ie=n[2];return t===i?(i[12]=t[0]*Y+t[4]*J+t[8]*ie+t[12],i[13]=t[1]*Y+t[5]*J+t[9]*ie+t[13],i[14]=t[2]*Y+t[6]*J+t[10]*ie+t[14],i[15]=t[3]*Y+t[7]*J+t[11]*ie+t[15]):(d=t[1],g=t[2],_=t[3],w=t[4],A=t[5],D=t[6],N=t[7],O=t[8],V=t[9],q=t[10],j=t[11],i[0]=l=t[0],i[1]=d,i[2]=g,i[3]=_,i[4]=w,i[5]=A,i[6]=D,i[7]=N,i[8]=O,i[9]=V,i[10]=q,i[11]=j,i[12]=l*Y+w*J+O*ie+t[12],i[13]=d*Y+A*J+V*ie+t[13],i[14]=g*Y+D*J+q*ie+t[14],i[15]=_*Y+N*J+j*ie+t[15]),i},S.P=F,S.Q=function(i,t,n){var l=n[0],d=n[1],g=n[2];return i[0]=t[0]*l,i[1]=t[1]*l,i[2]=t[2]*l,i[3]=t[3]*l,i[4]=t[4]*d,i[5]=t[5]*d,i[6]=t[6]*d,i[7]=t[7]*d,i[8]=t[8]*g,i[9]=t[9]*g,i[10]=t[10]*g,i[11]=t[11]*g,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},S.R=Jr,S.S=function(i,t,n){var l=t[0],d=t[1],g=t[2],_=t[3],w=t[4],A=t[5],D=t[6],N=t[7],O=t[8],V=t[9],q=t[10],j=t[11],Y=t[12],J=t[13],ie=t[14],de=t[15],re=n[0],ae=n[1],pe=n[2],be=n[3];return i[0]=re*l+ae*w+pe*O+be*Y,i[1]=re*d+ae*A+pe*V+be*J,i[2]=re*g+ae*D+pe*q+be*ie,i[3]=re*_+ae*N+pe*j+be*de,i[4]=(re=n[4])*l+(ae=n[5])*w+(pe=n[6])*O+(be=n[7])*Y,i[5]=re*d+ae*A+pe*V+be*J,i[6]=re*g+ae*D+pe*q+be*ie,i[7]=re*_+ae*N+pe*j+be*de,i[8]=(re=n[8])*l+(ae=n[9])*w+(pe=n[10])*O+(be=n[11])*Y,i[9]=re*d+ae*A+pe*V+be*J,i[10]=re*g+ae*D+pe*q+be*ie,i[11]=re*_+ae*N+pe*j+be*de,i[12]=(re=n[12])*l+(ae=n[13])*w+(pe=n[14])*O+(be=n[15])*Y,i[13]=re*d+ae*A+pe*V+be*J,i[14]=re*g+ae*D+pe*q+be*ie,i[15]=re*_+ae*N+pe*j+be*de,i},S.T=_f,S.U=function(i,t){const n={};for(let l=0;l<t.length;l++){const d=t[l];d in i&&(n[d]=i[d])}return n},S.V=Fa,S.W=mn,S.X=Xp,S.Y=ag,S.Z=Re,S._=c,S.a=Nl,S.a$=Xt,S.a0=Ye,S.a1=Ho,S.a2=Vo,S.a3=ug,S.a4=gd,S.a5=Lt,S.a6=function(i,t,n){if(!i)return t||{};if(!t)return i||{};const l=yd(i),d=yd(t);(function(_,w){w.removeAll&&(_.add.clear(),_.update.clear(),_.remove.clear(),w.remove.clear());for(const A of w.remove)_.add.delete(A),_.update.delete(A);for(const[A,D]of w.update){const N=_.update.get(A);N&&(w.update.set(A,Wp(N,D)),_.update.delete(A))}})(l,d);const g={};if((l.removeAll||d.removeAll)&&(g.removeAll=!0),g.remove=new Set([...l.remove,...d.remove]),g.add=new Map([...l.add,...d.add]),g.update=new Map([...l.update,...d.update]),g.remove.size&&g.add.size)for(const _ of g.add.keys())g.remove.delete(_);return(function(_){const w={};return _.removeAll&&(w.removeAll=_.removeAll),_.remove&&(w.remove=Array.from(_.remove)),_.add&&(w.add=Array.from(_.add.values())),_.update&&(w.update=Array.from(_.update.values())),w})(g)},S.a7=function(i,t){const n=new Map;if(i==null||i.type==null)return n;if(i.type==="Feature"){const l=_d(i,t);return l==null?void 0:(n.set(l,i),n)}if(i.type==="FeatureCollection"){const l=new Set;for(const d of i.features){const g=_d(d,t);if(g==null||l.has(g))return;l.add(g),n.set(g,d)}return n}},S.a8=function(i,t,n){var l,d;const g=[];if(t.removeAll)i.clear();else if(t.remove)for(const _ of t.remove){const w=i.get(_);w&&(g.push(w.geometry),i.delete(_))}if(t.add)for(const _ of t.add){const w=_d(_,n);if(w==null)continue;const A=i.get(w);A&&g.push(A.geometry),g.push(_.geometry),i.set(w,_)}if(t.update)for(const _ of t.update){const w=i.get(_.id);if(!w)continue;const A=!!_.newGeometry,D=_.removeAllProperties||((l=_.removeProperties)===null||l===void 0?void 0:l.length)>0||((d=_.addOrUpdateProperties)===null||d===void 0?void 0:d.length)>0;if(!A&&!D)continue;g.push(w.geometry);const N=Object.assign({},w);if(i.set(_.id,N),A&&(g.push(_.newGeometry),N.geometry=_.newGeometry),D){if(N.properties=_.removeAllProperties?{}:Object.assign({},N.properties||{}),_.removeProperties)for(const O of _.removeProperties)delete N.properties[O];if(_.addOrUpdateProperties)for(const{key:O,value:V}of _.addOrUpdateProperties)N.properties[O]=V}}return g},S.a9=Zn,S.aA=function(i,{uSize:t,uSizeT:n},{lowerSize:l,upperSize:d}){return i.kind==="source"?l/rs:i.kind==="composite"?di.number(l/rs,d/rs,n):t},S.aB=function(i,t){var n=t[0],l=t[1],d=t[2],g=t[3],_=t[4],w=t[5],A=t[6],D=t[7],N=t[8],O=t[9],V=t[10],q=t[11],j=t[12],Y=t[13],J=t[14],ie=t[15],de=n*w-l*_,re=n*A-d*_,ae=n*D-g*_,pe=l*A-d*w,be=l*D-g*w,Fe=d*D-g*A,Ke=N*Y-O*j,Xe=N*J-V*j,rt=N*ie-q*j,yt=O*J-V*Y,ht=O*ie-q*Y,je=V*ie-q*J,He=de*je-re*ht+ae*yt+pe*rt-be*Xe+Fe*Ke;return He?(i[0]=(w*je-A*ht+D*yt)*(He=1/He),i[1]=(d*ht-l*je-g*yt)*He,i[2]=(Y*Fe-J*be+ie*pe)*He,i[3]=(V*be-O*Fe-q*pe)*He,i[4]=(A*rt-_*je-D*Xe)*He,i[5]=(n*je-d*rt+g*Xe)*He,i[6]=(J*ae-j*Fe-ie*re)*He,i[7]=(N*Fe-V*ae+q*re)*He,i[8]=(_*ht-w*rt+D*Ke)*He,i[9]=(l*rt-n*ht-g*Ke)*He,i[10]=(j*be-Y*ae+ie*de)*He,i[11]=(O*ae-N*be-q*de)*He,i[12]=(w*Xe-_*yt-A*Ke)*He,i[13]=(n*yt-l*Xe+d*Ke)*He,i[14]=(Y*re-j*pe-J*de)*He,i[15]=(N*pe-O*re+V*de)*He,i):null},S.aC=ft,S.aD=function(i){var t=i[0],n=i[1];return Math.sqrt(t*t+n*n)},S.aE=function(i){return i[0]=0,i[1]=0,i},S.aF=function(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i},S.aG=Hp,S.aH=kn,S.aI=function(i,t,n,l){const d=t.y-i.y,g=t.x-i.x,_=l.y-n.y,w=l.x-n.x,A=_*g-w*d;if(A===0)return null;const D=(w*(i.y-n.y)-_*(i.x-n.x))/A;return new F(i.x+D*g,i.y+D*d)},S.aJ=r,S.aK=hc,S.aL=function(i){let t=1/0,n=1/0,l=-1/0,d=-1/0;for(const g of i)t=Math.min(t,g.x),n=Math.min(n,g.y),l=Math.max(l,g.x),d=Math.max(d,g.y);return[t,n,l,d]},S.aM=or,S.aN=yn,S.aO=function(i,t,n,l,d=!1){if(!n[0]&&!n[1])return[0,0];const g=d?l==="map"?-i.bearingInRadians:0:l==="viewport"?i.bearingInRadians:0;if(g){const _=Math.sin(g),w=Math.cos(g);n=[n[0]*w-n[1]*_,n[0]*_+n[1]*w]}return[d?n[0]:yn(t,n[0],i.zoom),d?n[1]:yn(t,n[1],i.zoom)]},S.aQ=Nf,S.aR=ym,S.aS=Up,S.aT=s_,S.aU=fi,S.aV=sd,S.aW=le,S.aX=vt,S.aY=Ue,S.aZ=Sr,S.a_=Jp,S.aa=pu,S.ab=25,S.ac=Tr,S.ad=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((n=>{t.onloadstart=()=>{n(t)};for(const l of i){const d=window.document.createElement("source");Be(l)||(t.crossOrigin="Anonymous"),d.src=l,t.appendChild(d)}}))},S.ae=it,S.af=function(){return gn++},S.ag=m,S.ah=mh,S.ai=zd,S.aj=Hr,S.ak=ns,S.al=qf,S.am=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,l,d,g)=>{const _=d||g;return t[l]=!_||_.toLowerCase(),""})),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},S.an=Vt,S.ao=85.051129,S.ap=Di,S.aq=function(i){return Math.pow(2,i)},S.ar=nt,S.as=lg,S.at=function(i){return Math.log(i)/Math.LN2},S.au=function(i){var t=i[0],n=i[1];return t*t+n*n},S.av=function(i){if(!i.length)return new Set;const t=Math.max(...i.map((A=>A.canonical.z)));let n=1/0,l=-1/0,d=1/0,g=-1/0;const _=[];for(const A of i){const{x:D,y:N,z:O}=A.canonical,V=Math.pow(2,t-O),q=D*V,j=N*V;_.push({id:A,x:q,y:j}),q<n&&(n=q),q>l&&(l=q),j<d&&(d=j),j>g&&(g=j)}const w=new Set;for(const A of _)A.x!==n&&A.x!==l&&A.y!==d&&A.y!==g||w.add(A.id);return w},S.aw=function(i,t){const n=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return i.overscaledZ-t.overscaledZ||l-n||t.canonical.y-i.canonical.y||t.canonical.x-i.canonical.x},S.ax=class{constructor(i,t){this.max=i,this.onRemove=t,this.reset()}reset(){for(const i in this.data)for(const t of this.data[i])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(i,t,n){const l=i.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const d={value:t,timeout:void 0};if(n!==void 0&&(d.timeout=setTimeout((()=>{this.remove(i,d)}),n)),this.data[l].push(d),this.order.push(l),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const t=this.data[i].shift();return t.timeout&&clearTimeout(t.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),t.value}getByKey(i){const t=this.data[i];return t?t[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,t){if(!this.has(i))return this;const n=i.wrapped().key,l=t===void 0?0:this.data[n].indexOf(t),d=this.data[n][l];return this.data[n].splice(l,1),d.timeout&&clearTimeout(d.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(d.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(i){const t=[];for(const n in this.data)for(const l of this.data[n])i(l.value)||t.push(l);for(const n of t)this.remove(n.value.tileID,n)}},S.ay=function(i,t){let n=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:d,minZoom:g,maxZoom:_}=i,w=d?Vt(Br.interpolationFactor(d,t,g,_),0,1):0;i.kind==="camera"?l=di.number(i.minSize,i.maxSize,w):n=w}return{uSizeT:n,uSize:l}},S.b=ar,S.b$=ts,S.b0=At,S.b1=function(i){var t=new We(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t},S.b2=function(i,t,n){return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],i},S.b3=function(i,t){var n=t[0],l=t[1],d=t[2],g=n*n+l*l+d*d;return g>0&&(g=1/Math.sqrt(g)),i[0]=t[0]*g,i[1]=t[1]*g,i[2]=t[2]*g,i},S.b4=tn,S.b5=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]},S.b6=function(i,t,n){return i[0]=t[0]*n[0],i[1]=t[1]*n[1],i[2]=t[2]*n[2],i[3]=t[3]*n[3],i},S.b7=_t,S.b8=function(i,t,n){const l=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return l===0?null:(-(i[0]*n[0]+i[1]*n[1]+i[2]*n[2])-n[3])/l},S.b9=An,S.bA=function(){return new Float64Array(3)},S.bB=Qe,S.bC=function(i,t,n){var l=n[0],d=n[1],g=n[2],_=n[3],w=t[0],A=t[1],D=t[2],N=d*D-g*A,O=g*w-l*D,V=l*A-d*w;return i[0]=w+_*(N+=N)+d*(V+=V)-g*(O+=O),i[1]=A+_*O+g*N-l*V,i[2]=D+_*V+l*O-d*N,i},S.bD=function(i,t,n){const l=(d=[i[0],i[1],i[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((N=d[8])*(_=d[4])-(w=d[5])*(D=d[7]))+d[1]*(-N*(g=d[3])+w*(A=d[6]))+d[2]*(D*g-_*A);var d,g,_,w,A,D,N;if(l===0)return null;const O=tn([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),V=tn([],[n[0],n[1],n[2]],[i[0],i[1],i[2]]),q=tn([],[i[0],i[1],i[2]],[t[0],t[1],t[2]]),j=Xt([],O,-i[3]);return At(j,j,Xt([],V,-t[3])),At(j,j,Xt([],q,-n[3])),Xt(j,j,1/l),j},S.bE=Vf,S.bF=function(){return new Float64Array(4)},S.bG=function(i,t,n,l){var d=[],g=[];return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],g[0]=d[0]*Math.cos(l)-d[1]*Math.sin(l),g[1]=d[0]*Math.sin(l)+d[1]*Math.cos(l),g[2]=d[2],i[0]=g[0]+n[0],i[1]=g[1]+n[1],i[2]=g[2]+n[2],i},S.bH=function(i,t,n,l){var d=[],g=[];return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],g[0]=d[0],g[1]=d[1]*Math.cos(l)-d[2]*Math.sin(l),g[2]=d[1]*Math.sin(l)+d[2]*Math.cos(l),i[0]=g[0]+n[0],i[1]=g[1]+n[1],i[2]=g[2]+n[2],i},S.bI=function(i,t,n,l){var d=[],g=[];return d[0]=t[0]-n[0],d[1]=t[1]-n[1],d[2]=t[2]-n[2],g[0]=d[2]*Math.sin(l)+d[0]*Math.cos(l),g[1]=d[1],g[2]=d[2]*Math.cos(l)-d[0]*Math.sin(l),i[0]=g[0]+n[0],i[1]=g[1]+n[1],i[2]=g[2]+n[2],i},S.bJ=function(i,t,n){var l=Math.sin(n),d=Math.cos(n),g=t[0],_=t[1],w=t[2],A=t[3],D=t[8],N=t[9],O=t[10],V=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=g*d-D*l,i[1]=_*d-N*l,i[2]=w*d-O*l,i[3]=A*d-V*l,i[8]=g*l+D*d,i[9]=_*l+N*d,i[10]=w*l+O*d,i[11]=A*l+V*d,i},S.bK=function(i,t){const n=Me(i,360),l=Me(t,360),d=l-n,g=l>n?d-360:d+360;return Math.abs(d)<Math.abs(g)?d:g},S.bL=function(i){return i[0]=0,i[1]=0,i[2]=0,i},S.bM=function(i,t,n,l){const d=Math.sqrt(i*i+t*t),g=Math.sqrt(n*n+l*l);i/=d,t/=d,n/=g,l/=g;const _=Math.acos(i*n+t*l);return-t*n+i*l>0?_:-_},S.bN=function(i,t){const n=Me(i,2*Math.PI),l=Me(t,2*Math.PI);return Math.min(Math.abs(n-l),Math.abs(n-l+2*Math.PI),Math.abs(n-l-2*Math.PI))},S.bO=function(){const i={},t=Ce.$version;for(const n in Ce.$root){const l=Ce.$root[n];if(l.required){let d=null;d=n==="version"?t:l.type==="array"?[]:{},d!=null&&(i[n]=d)}}return i},S.bP=we,S.bQ=Jc,S.bR=function i(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let l=0;l<t.length;l++)if(!i(t[l],n[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const l in t)if(!i(t[l],n[l]))return!1;return!0}return t===n},S.bS=function(i){i=i.slice();const t=Object.create(null);for(let n=0;n<i.length;n++)t[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Fn(i[n],t[i[n].ref]));return i},S.bT=function(i,t){if(i.type==="custom")return new jp(i,t);switch(i.type){case"background":return new Rn(i,t);case"circle":return new pf(i,t);case"color-relief":return new Nm(i,t);case"fill":return new Um(i,t);case"fill-extrusion":return new zp(i,t);case"heatmap":return new zm(i,t);case"hillshade":return new Mi(i,t);case"line":return new Np(i,t);case"raster":return new Qs(i,t);case"symbol":return new fu(i,t)}},S.bU=i=>i.type==="raster",S.bV=Pi,S.bW=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let n=[];try{if(!Mt(i.version,t.version))return[{command:"setStyle",args:[t]}];Mt(i.center,t.center)||n.push({command:"setCenter",args:[t.center]}),Mt(i.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),Mt(i.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Mt(i.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),Mt(i.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),Mt(i.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),Mt(i.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),Mt(i.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),Mt(i.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),Mt(i.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),Mt(i.light,t.light)||n.push({command:"setLight",args:[t.light]}),Mt(i.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),Mt(i.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),Mt(i.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const l={},d=[];(function(_,w,A,D){let N;for(N in w=w||{},_=_||{})Object.prototype.hasOwnProperty.call(_,N)&&(Object.prototype.hasOwnProperty.call(w,N)||Nn(N,A,D));for(N in w)Object.prototype.hasOwnProperty.call(w,N)&&(Object.prototype.hasOwnProperty.call(_,N)?Mt(_[N],w[N])||(_[N].type==="geojson"&&w[N].type==="geojson"&&Yi(_,w,N)?Ot(A,{command:"setGeoJSONSourceData",args:[N,w[N].data]}):ii(N,w,A,D)):Jt(N,w,A))})(i.sources,t.sources,d,l);const g=[];i.layers&&i.layers.forEach((_=>{"source"in _&&l[_.source]?n.push({command:"removeLayer",args:[_.id]}):g.push(_)})),n=n.concat(d),(function(_,w,A){w=w||[];const D=(_=_||[]).map(_i),N=w.map(_i),O=_.reduce(Oi,{}),V=w.reduce(Oi,{}),q=D.slice(),j=Object.create(null);let Y,J,ie,de,re;for(let ae=0,pe=0;ae<D.length;ae++)Y=D[ae],Object.prototype.hasOwnProperty.call(V,Y)?pe++:(Ot(A,{command:"removeLayer",args:[Y]}),q.splice(q.indexOf(Y,pe),1));for(let ae=0,pe=0;ae<N.length;ae++)Y=N[N.length-1-ae],q[q.length-1-ae]!==Y&&(Object.prototype.hasOwnProperty.call(O,Y)?(Ot(A,{command:"removeLayer",args:[Y]}),q.splice(q.lastIndexOf(Y,q.length-pe),1)):pe++,de=q[q.length-ae],Ot(A,{command:"addLayer",args:[V[Y],de]}),q.splice(q.length-ae,0,Y),j[Y]=!0);for(let ae=0;ae<N.length;ae++)if(Y=N[ae],J=O[Y],ie=V[Y],!j[Y]&&!Mt(J,ie))if(Mt(J.source,ie.source)&&Mt(J["source-layer"],ie["source-layer"])&&Mt(J.type,ie.type)){for(re in Xi(J.layout,ie.layout,A,Y,null,"setLayoutProperty"),Xi(J.paint,ie.paint,A,Y,null,"setPaintProperty"),Mt(J.filter,ie.filter)||Ot(A,{command:"setFilter",args:[Y,ie.filter]}),Mt(J.minzoom,ie.minzoom)&&Mt(J.maxzoom,ie.maxzoom)||Ot(A,{command:"setLayerZoomRange",args:[Y,ie.minzoom,ie.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?Xi(J[re],ie[re],A,Y,re.slice(6),"setPaintProperty"):Mt(J[re],ie[re])||Ot(A,{command:"setLayerProperty",args:[Y,re,ie[re]]}));for(re in ie)Object.prototype.hasOwnProperty.call(ie,re)&&!Object.prototype.hasOwnProperty.call(J,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?Xi(J[re],ie[re],A,Y,re.slice(6),"setPaintProperty"):Mt(J[re],ie[re])||Ot(A,{command:"setLayerProperty",args:[Y,re,ie[re]]}))}else Ot(A,{command:"removeLayer",args:[Y]}),de=q[q.lastIndexOf(Y)+1],Ot(A,{command:"addLayer",args:[ie,de]})})(g,t.layers,n)}catch(l){console.warn("Unable to compute style diff:",l),n=[{command:"setStyle",args:[t]}]}return n},S.bX=function(i){const t=[],n=i.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},S.bY=ei,S.bZ=bn,S.b_=class extends Yr{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},S.ba=function(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i},S.bb=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]},S.bc=cg,S.bd=_h,S.be=function(i,t,n,l,d){var g=1/Math.tan(t/2);if(i[0]=g/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0){var _=1/(l-d);i[10]=(d+l)*_,i[14]=2*d*l*_}else i[10]=-1,i[14]=-2*l;return i},S.bf=function(i){var t=new We(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},S.bg=function(i,t,n){var l=Math.sin(n),d=Math.cos(n),g=t[0],_=t[1],w=t[2],A=t[3],D=t[4],N=t[5],O=t[6],V=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=g*d+D*l,i[1]=_*d+N*l,i[2]=w*d+O*l,i[3]=A*d+V*l,i[4]=D*d-g*l,i[5]=N*d-_*l,i[6]=O*d-w*l,i[7]=V*d-A*l,i},S.bh=function(i,t,n){var l=Math.sin(n),d=Math.cos(n),g=t[4],_=t[5],w=t[6],A=t[7],D=t[8],N=t[9],O=t[10],V=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=g*d+D*l,i[5]=_*d+N*l,i[6]=w*d+O*l,i[7]=A*d+V*l,i[8]=D*d-g*l,i[9]=N*d-_*l,i[10]=O*d-w*l,i[11]=V*d-A*l,i},S.bi=function(){const i=new Float32Array(16);return nt(i),i},S.bj=function(){const i=new Float64Array(16);return nt(i),i},S.bk=function(){return new Float64Array(16)},S.bl=function(i,t,n){const l=new Float64Array(4);return Qe(l,i,t-90,n),l},S.bm=function(i,t,n,l){var d,g,_,w,A,D=t[0],N=t[1],O=t[2],V=t[3],q=n[0],j=n[1],Y=n[2],J=n[3];return(g=D*q+N*j+O*Y+V*J)<0&&(g=-g,q=-q,j=-j,Y=-Y,J=-J),1-g>st?(d=Math.acos(g),_=Math.sin(d),w=Math.sin((1-l)*d)/_,A=Math.sin(l*d)/_):(w=1-l,A=l),i[0]=w*D+A*q,i[1]=w*N+A*j,i[2]=w*O+A*Y,i[3]=w*V+A*J,i},S.bn=function(i){const t=new Float64Array(9);var n,l,d,g,_,w,A,D,N,O,V,q,j,Y,J,ie,de,re;O=(d=(l=i)[0])*(A=d+d),V=(g=l[1])*A,j=(_=l[2])*A,Y=_*(D=g+g),ie=(w=l[3])*A,de=w*D,re=w*(N=_+_),(n=t)[0]=1-(q=g*D)-(J=_*N),n[3]=V-re,n[6]=j+de,n[1]=V+re,n[4]=1-O-J,n[7]=Y-ie,n[2]=j-de,n[5]=Y+ie,n[8]=1-O-q;const ae=Sr(-Math.asin(Vt(t[2],-1,1)));let pe,be;return Math.hypot(t[5],t[8])<.001?(pe=0,be=-Sr(Math.atan2(t[3],t[4]))):(pe=Sr(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),be=Sr(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:pe,pitch:ae+90,bearing:be}},S.bo=function(i,t){return i.roll==t.roll&&i.pitch==t.pitch&&i.bearing==t.bearing},S.bp=rn,S.bq=fl,S.br=Fo,S.bs=ra,S.bt=wr,S.bu=at,S.bv=Et,S.bw=nr,S.bx=function(i,t,n,l,d){return at(l,d,Vt((i-t)/(n-t),0,1))},S.by=function(i,t,n,l){return i[0]=t[0]+n[0]*l,i[1]=t[1]+n[1]*l,i[2]=t[2]+n[2]*l,i},S.bz=Me,S.c=W,S.c$=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},S.c0=class extends Yr{constructor(i,t){super(i,t),this.current=Xr}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},S.c1=au,S.c2=class extends Yr{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},S.c3=class extends Yr{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},S.c4=gt,S.c5=function(i,t){var n=Math.sin(t),l=Math.cos(t);return i[0]=l,i[1]=n,i[2]=0,i[3]=-n,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},S.c6=function(i,t,n){var l=t[0],d=t[1],g=t[2];return i[0]=l*n[0]+d*n[3]+g*n[6],i[1]=l*n[1]+d*n[4]+g*n[7],i[2]=l*n[2]+d*n[5]+g*n[8],i},S.c7=function(i,t,n,l,d,g,_){var w=1/(t-n),A=1/(l-d),D=1/(g-_);return i[0]=-2*w,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*A,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*D,i[11]=0,i[12]=(t+n)*w,i[13]=(d+l)*A,i[14]=(_+g)*D,i[15]=1,i},S.c8=class extends Yr{constructor(i,t){super(i,t),this.current=new Array}set(i){if(i!=this.current){this.current=i;const t=new Float32Array(4*i.length);for(let n=0;n<i.length;n++)t[4*n]=i[n].r,t[4*n+1]=i[n].g,t[4*n+2]=i[n].b,t[4*n+3]=i[n].a;this.gl.uniform4fv(this.location,t)}}},S.c9=class extends Yr{constructor(i,t){super(i,t),this.current=new Array}set(i){if(i!=this.current){this.current=i;const t=new Float32Array(i);this.gl.uniform1fv(this.location,t)}}},S.cA=function(i,t){var n;if(!Ll[t])return!1;const l=i==null?void 0:i.target,d=((n=l==null?void 0:l.ownerDocument)===null||n===void 0?void 0:n.defaultView)||window;return i instanceof d.MouseEvent||i instanceof d.WheelEvent},S.cB=function(i,t){return Os[t]&&"touches"in i},S.cC=function(i){return Os[i]||Ll[i]},S.cD=function(i,t,n){var l=t[0],d=t[1];return i[0]=n[0]*l+n[4]*d+n[12],i[1]=n[1]*l+n[5]*d+n[13],i},S.cE=function(i,t){const{x:n,y:l}=Zn.fromLngLat(t);return!(i<0||i>25||l<0||l>=1||n<0||n>=1)},S.cF=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},S.cG=class extends ul{},S.cH=ox,S.cJ=me,S.cK=function(i,t){W.REGISTERED_PROTOCOLS[i]=t},S.cL=function(i){delete W.REGISTERED_PROTOCOLS[i]},S.cM=function(i,t){const n={};for(let d=0;d<i.length;d++){const g=t&&t[i[d].id]||$s(i[d]);t&&(t[i[d].id]=g);let _=n[g];_||(_=n[g]=[]),_.push(i[d])}const l=[];for(const d in n)l.push(n[d]);return l},S.cN=Tt,S.cO=Kp,S.cP=_m,S.cQ=Df,S.cR=function(i){var t;i.bucket.createArrays(),i.bucket.tilePixelRatio=Lt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const n=i.bucket.layers[0],l=n.layout,d=n._unevaluatedLayout._values,g={layoutIconSize:d["icon-size"].possiblyEvaluate(new Un(i.bucket.zoom+1),i.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new Un(i.bucket.zoom+1),i.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new Un(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:O}=i.bucket.textSizeData;g.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Un(N),i.canonical),d["text-size"].possiblyEvaluate(new Un(O),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:O}=i.bucket.iconSizeData;g.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Un(N),i.canonical),d["icon-size"].possiblyEvaluate(new Un(O),i.canonical)]}const _=l.get("text-line-height")*or,w=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",A=l.get("text-keep-upright"),D=l.get("text-size");for(const N of i.bucket.features){const O=l.get("text-font").evaluate(N,{},i.canonical).join(","),V=D.evaluate(N,{},i.canonical),q=g.layoutTextSize.evaluate(N,{},i.canonical),j=g.layoutIconSize.evaluate(N,{},i.canonical),Y={horizontal:{},vertical:void 0},J=N.text;let ie,de=[0,0];if(J){const pe=J.toString(),be=l.get("text-letter-spacing").evaluate(N,{},i.canonical)*or,Fe=Wc(pe)?be:0,Ke=l.get("text-anchor").evaluate(N,{},i.canonical),Xe=Al(n,N,i.canonical);if(!Xe){const je=l.get("text-radial-offset").evaluate(N,{},i.canonical);de=je?Gn(Ke,[je*or,Cn]):l.get("text-offset").evaluate(N,{},i.canonical).map((He=>He*or))}let rt=w?"center":l.get("text-justify").evaluate(N,{},i.canonical);const yt=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(N,{},i.canonical)*or:1/0,ht=()=>{i.bucket.allowVerticalPlacement&&Ms(pe)&&(Y.vertical=fd(J,i.glyphMap,i.glyphPositions,i.imagePositions,O,yt,_,Ke,"left",Fe,de,S.az.vertical,!0,q,V))};if(!w&&Xe){const je=new Set;if(rt==="auto")for(let wt=0;wt<Xe.values.length;wt+=2)je.add(ym(Xe.values[wt]));else je.add(rt);let He=!1;for(const wt of je)if(!Y.horizontal[wt])if(He)Y.horizontal[wt]=Y.horizontal[0];else{const xt=fd(J,i.glyphMap,i.glyphPositions,i.imagePositions,O,yt,_,"center",wt,Fe,de,S.az.horizontal,!1,q,V);xt&&(Y.horizontal[wt]=xt,He=xt.positionedLines.length===1)}ht()}else{rt==="auto"&&(rt=ym(Ke));const je=fd(J,i.glyphMap,i.glyphPositions,i.imagePositions,O,yt,_,Ke,rt,Fe,de,S.az.horizontal,!1,q,V);je&&(Y.horizontal[rt]=je),ht(),Ms(pe)&&w&&A&&(Y.vertical=fd(J,i.glyphMap,i.glyphPositions,i.imagePositions,O,yt,_,Ke,rt,Fe,de,S.az.vertical,!1,q,V))}}let re=!1;if(N.icon&&N.icon.name){const pe=i.imageMap[N.icon.name];pe&&(ie=Gp(i.imagePositions[N.icon.name],l.get("icon-offset").evaluate(N,{},i.canonical),l.get("icon-anchor").evaluate(N,{},i.canonical)),re=!!pe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=re:i.bucket.sdfIcons!==re&&wn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pe.pixelRatio!==i.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ae=ey(Y.horizontal)||Y.vertical;(t=i.bucket).iconsInText||(t.iconsInText=!!ae&&ae.iconsInText),(ae||ie)&&ix(i.bucket,N,Y,ie,i.imageMap,g,q,j,de,re,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},S.cS=fc,S.cT=uu,S.cU=lh,S.cV=function(i){const t=new If;return(function(n,l){for(const d in n.layers)l.writeMessage(3,tp,n.layers[d])})(i,t),t.finish()},S.cW=function(i,t,n,l,d,g){let _=s(i,t,n,d,0);return _=s(_,t,l,g,1),_},S.cX=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const t=this.map.get(i);return t!==void 0&&(this.map.delete(i),this.map.set(i,t)),t}set(i,t){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(i,t)}clear(){this.map.clear()}},S.cY=In,S.cZ=If,S.c_=Dd,S.ca=class extends ta{},S.cb=Zm,S.cc=class extends pi{},S.cd=Kh,S.ce=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},S.cf=Na,S.cg=function(i,t,n){var l=t[0],d=t[1],g=t[2],_=n[3]*l+n[7]*d+n[11]*g+n[15];return i[0]=(n[0]*l+n[4]*d+n[8]*g+n[12])/(_=_||1),i[1]=(n[1]*l+n[5]*d+n[9]*g+n[13])/_,i[2]=(n[2]*l+n[6]*d+n[10]*g+n[14])/_,i},S.ch=class extends cl{},S.ci=class extends e{},S.cj=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},S.ck=function(i,t){var n=i[0],l=i[1],d=i[2],g=i[3],_=i[4],w=i[5],A=i[6],D=i[7],N=i[8],O=i[9],V=i[10],q=i[11],j=i[12],Y=i[13],J=i[14],ie=i[15],de=t[0],re=t[1],ae=t[2],pe=t[3],be=t[4],Fe=t[5],Ke=t[6],Xe=t[7],rt=t[8],yt=t[9],ht=t[10],je=t[11],He=t[12],wt=t[13],xt=t[14],Ct=t[15];return Math.abs(n-de)<=st*Math.max(1,Math.abs(n),Math.abs(de))&&Math.abs(l-re)<=st*Math.max(1,Math.abs(l),Math.abs(re))&&Math.abs(d-ae)<=st*Math.max(1,Math.abs(d),Math.abs(ae))&&Math.abs(g-pe)<=st*Math.max(1,Math.abs(g),Math.abs(pe))&&Math.abs(_-be)<=st*Math.max(1,Math.abs(_),Math.abs(be))&&Math.abs(w-Fe)<=st*Math.max(1,Math.abs(w),Math.abs(Fe))&&Math.abs(A-Ke)<=st*Math.max(1,Math.abs(A),Math.abs(Ke))&&Math.abs(D-Xe)<=st*Math.max(1,Math.abs(D),Math.abs(Xe))&&Math.abs(N-rt)<=st*Math.max(1,Math.abs(N),Math.abs(rt))&&Math.abs(O-yt)<=st*Math.max(1,Math.abs(O),Math.abs(yt))&&Math.abs(V-ht)<=st*Math.max(1,Math.abs(V),Math.abs(ht))&&Math.abs(q-je)<=st*Math.max(1,Math.abs(q),Math.abs(je))&&Math.abs(j-He)<=st*Math.max(1,Math.abs(j),Math.abs(He))&&Math.abs(Y-wt)<=st*Math.max(1,Math.abs(Y),Math.abs(wt))&&Math.abs(J-xt)<=st*Math.max(1,Math.abs(J),Math.abs(xt))&&Math.abs(ie-Ct)<=st*Math.max(1,Math.abs(ie),Math.abs(Ct))},S.cl=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},S.cm=i=>i.type==="symbol",S.cn=i=>i.type==="circle",S.co=i=>i.type==="heatmap",S.cp=i=>i.type==="line",S.cq=i=>i.type==="fill",S.cr=i=>i.type==="fill-extrusion",S.cs=i=>i.type==="hillshade",S.ct=i=>i.type==="color-relief",S.cu=i=>i.type==="background",S.cv=i=>i.type==="custom",S.cw=Rt,S.cx=function(i,t,n){if(t<=0)return i;const l=1/t;return n===void 0||Math.abs(n)<1e-10?Math.round(i*l)/l:(n>0?Math.ceil(i*l-1e-9):Math.floor(i*l+1e-10))/l},S.cy=function(i,t,n){const l=Dt(t.x-n.x,t.y-n.y),d=Dt(i.x-n.x,i.y-n.y);var g,_;return Sr(Math.atan2(l[0]*d[1]-l[1]*d[0],(g=l)[0]*(_=d)[0]+g[1]*_[1]))},S.cz=$t,S.d=Be,S.d0=function(i,t,n,l,d){return c(this,void 0,void 0,(function*(){if(Ye())try{return yield Ho(i,t,n,l,d)}catch{}return(function(g,_,w,A,D){const N=g.width,O=g.height;Dr&&io||(Dr=new OffscreenCanvas(N,O),io=Dr.getContext("2d",{willReadFrequently:!0})),Dr.width=N,Dr.height=O,io.drawImage(g,0,0,N,O);const V=io.getImageData(_,w,A,D);return io.clearRect(0,0,N,O),V.data})(i,t,n,l,d)}))},S.d1=rh,S.d2=k,S.d3=class{constructor(i,t){this.layers={[zd]:this},this.name=zd,this.version=t?t.version:1,this.extent=t?t.extent:4096,this.length=i.length,this.features=i}feature(i){return new Tg(this.features[i],this.extent)}},S.d4=Wl,S.d5=Po,S.e=Nt,S.f=i=>c(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),S.g=Q,S.h=i=>new Promise(((t,n)=>{const l=new Image;l.onload=()=>{t(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame((()=>{l.src=wo}))},l.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const d=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(d):wo})),S.i=sr,S.j=(i,t)=>Pe(Nt(i,{type:"json"}),t),S.k=$e,S.l=et,S.m=Pe,S.n=(i,t)=>Pe(Nt(i,{type:"arrayBuffer"}),t),S.o=function(i){return new If(i).readFields(eg,[])},S.p=Op,S.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},S.r=Wh,S.s=Bs,S.t=ki,S.u=Ce,S.v=Wu,S.w=wn,S.x=Qc,S.y=Yo,S.z=Ks})),T("worker",["./shared"],(function(S){class c{constructor(W,Q){this.keyCache={},W&&this.replace(W,Q)}replace(W,Q){this._layerConfigs={},this._layers={},this.update(W,[],Q)}update(W,Q,ne){for(const we of W){this._layerConfigs[we.id]=we;const Pe=this._layers[we.id]=S.bT(we,ne);Pe._featureFilter=S.aj(Pe.filter,ne),this.keyCache[we.id]&&delete this.keyCache[we.id]}for(const we of Q)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const me=S.cM(Object.values(this._layerConfigs),this.keyCache);for(const we of me){const Pe=we.map((ut=>this._layers[ut.id])),Be=Pe[0];if(Be.isHidden())continue;const Ee=Be.source||"";let De=this.familiesBySource[Ee];De||(De=this.familiesBySource[Ee]={});const et=Be.sourceLayer||S.ai;let $e=De[et];$e||($e=De[et]=[]),$e.push(Pe)}}}class F{constructor(W){const Q={},ne=[];for(const Be in W){const Ee=W[Be],De=Q[Be]={};for(const et in Ee){const $e=Ee[+et];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const ut={x:0,y:0,w:$e.bitmap.width+2,h:$e.bitmap.height+2};ne.push(ut),De[et]={rect:ut,metrics:$e.metrics}}}const{w:me,h:we}=S.p(ne),Pe=new S.r({width:me||1,height:we||1});for(const Be in W){const Ee=W[Be];for(const De in Ee){const et=Ee[+De];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const $e=Q[Be][De].rect;S.r.copy(et.bitmap,Pe,{x:0,y:0},{x:$e.x+1,y:$e.y+1},et.bitmap)}}this.image=Pe,this.positions=Q}}S.cN("GlyphAtlas",F);class k{constructor(W){this.tileID=new S.a2(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,Q,ne,me,we){return S._(this,void 0,void 0,(function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new S.ag;const Pe=new S.cO(Object.keys(W.layers).sort()),Be=new S.cP(this.tileID,this.promoteId);Be.bucketLayerIDs=[];const Ee={},De={featureIndex:Be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ne,subdivisionGranularity:we},et=Q.familiesBySource[this.source];for(const it in et){const zi=W.layers[it];if(!zi)continue;zi.version===1&&S.w(`Vector tile source "${this.source}" layer "${it}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const zr=Pe.encode(it),Gr=[];for(let vn=0;vn<zi.length;vn++){const dt=zi.feature(vn),jt=Be.getId(dt,it);Gr.push({feature:dt,id:jt,index:vn,sourceLayerIndex:zr})}for(const vn of et[it]){const dt=vn[0];dt.source!==this.source&&S.w(`layer.source = ${dt.source} does not equal this.source = ${this.source}`),dt.isHidden(this.zoom,!0)||(G(vn,this.zoom,ne),(Ee[dt.id]=dt.createBucket({index:Be.bucketLayerIDs.length,layers:vn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:zr,sourceID:this.source})).populate(Gr,De,this.tileID.canonical),Be.bucketLayerIDs.push(vn.map((jt=>jt.id))))}}const $e=S.bY(De.glyphDependencies,(it=>Object.keys(it).map(Number)));this.inFlightDependencies.forEach((it=>it==null?void 0:it.abort())),this.inFlightDependencies=[];let ut=Promise.resolve({});if(Object.keys($e).length){const it=new AbortController;this.inFlightDependencies.push(it),ut=me.sendAsync({type:"GG",data:{stacks:$e,source:this.source,tileID:this.tileID,type:"glyphs"}},it)}const Ce=Object.keys(De.iconDependencies);let Ht=Promise.resolve({});if(Ce.length){const it=new AbortController;this.inFlightDependencies.push(it),Ht=me.sendAsync({type:"GI",data:{icons:Ce,source:this.source,tileID:this.tileID,type:"icons"}},it)}const Fn=Object.keys(De.patternDependencies);let Mt=Promise.resolve({});if(Fn.length){const it=new AbortController;this.inFlightDependencies.push(it),Mt=me.sendAsync({type:"GI",data:{icons:Fn,source:this.source,tileID:this.tileID,type:"patterns"}},it)}const Ot=De.dashDependencies;let Jt=Promise.resolve({});if(Object.keys(Ot).length){const it=new AbortController;this.inFlightDependencies.push(it),Jt=me.sendAsync({type:"GDA",data:{dashes:Ot}},it)}const[Nn,ii,Yi,Xi]=yield Promise.all([ut,Ht,Mt,Jt]),_i=new F(Nn),Oi=new S.cQ(ii,Yi);for(const it in Ee){const zi=Ee[it];zi instanceof S.ah?(G(zi.layers,this.zoom,ne),S.cR({bucket:zi,glyphMap:Nn,glyphPositions:_i.positions,imageMap:ii,imagePositions:Oi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:De.subdivisionGranularity})):zi.hasDependencies&&(zi instanceof S.cS||zi instanceof S.cT||zi instanceof S.cU)&&(G(zi.layers,this.zoom,ne),zi.addFeatures(De,this.tileID.canonical,Oi.patternPositions,Xi))}return this.status="done",{buckets:Object.values(Ee).filter((it=>!it.isEmpty())),featureIndex:Be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_i.image,imageAtlas:Oi,dashPositions:Xi,glyphMap:this.returnDependencies?Nn:null,iconMap:this.returnDependencies?ii:null,glyphPositions:this.returnDependencies?_i.positions:null}}))}}function G(Re,W,Q){const ne=new S.H(W);for(const me of Re)me.recalculate(ne,Q)}class K{constructor(W,Q,ne,me,we){this.type=W,this.properties=ne||{},this.extent=we,this.pointsArray=Q,this.id=me}loadGeometry(){return this.pointsArray.map((W=>W.map((Q=>new S.P(Q.x,Q.y)))))}}class ee{constructor(W,Q,ne){this.version=2,this._myFeatures=W,this.name=Q,this.length=W.length,this.extent=ne}feature(W){return this._myFeatures[W]}}class ye{constructor(){this.layers={}}addLayer(W){this.layers[W.name]=W}}function Le(Re){let W=S.cV(Re);return W.byteOffset===0&&W.byteLength===W.buffer.byteLength||(W=new Uint8Array(W)),{vectorTile:Re,rawData:W.buffer}}function Ne(Re,W,Q){const{extent:ne}=Re,me=Math.pow(2,Q.z-W.z),we=(Q.x-W.x*me)*ne,Pe=(Q.y-W.y*me)*ne,Be=[];for(let Ee=0;Ee<Re.length;Ee++){const De=Re.feature(Ee);let et=De.loadGeometry();for(const ut of et)for(const Ce of ut)Ce.x=Ce.x*me-we,Ce.y=Ce.y*me-Pe;const $e=128;et=S.cW(et,De.type,-$e,-$e,ne+$e,ne+$e),et.length!==0&&Be.push(new K(De.type,et,De.properties,De.id,ne))}return new ee(Be,Re.name,ne)}class se{constructor(W,Q,ne){this.actor=W,this.layerIndex=Q,this.availableImages=ne,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new S.cX(1e3)}loadVectorTile(W,Q){return S._(this,void 0,void 0,(function*(){const ne=yield S.n(W.request,Q);try{return{vectorTile:W.encoding!=="mlt"?new S.cY(new S.cZ(ne.data)):new S.c_(ne.data),rawData:ne.data,cacheControl:ne.cacheControl,expires:ne.expires}}catch(me){const we=new Uint8Array(ne.data);let Pe=`Unable to parse the tile at ${W.request.url}, `;throw Pe+=we[0]===31&&we[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${me.message}`,new Error(Pe)}}))}loadTile(W){return S._(this,void 0,void 0,(function*(){const{uid:Q,overzoomParameters:ne}=W;ne&&(W.request=ne.overzoomRequest);const me=!!(W&&W.request&&W.request.collectResourceTiming)&&new S.c$(W.request),we=new k(W);this.loading[Q]=we;const Pe=new AbortController;we.abort=Pe;try{const Be=yield this.loadVectorTile(W,Pe);if(delete this.loading[Q],!Be)return null;if(ne){const ut=this._getOverzoomTile(W,Be.vectorTile);Be.rawData=ut.rawData,Be.vectorTile=ut.vectorTile}const Ee=Be.rawData,De={};Be.expires&&(De.expires=Be.expires),Be.cacheControl&&(De.cacheControl=Be.cacheControl);const et={};if(me){const ut=me.finish();ut&&(et.resourceTiming=JSON.parse(JSON.stringify(ut)))}we.vectorTile=Be.vectorTile;const $e=we.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);this.loaded[Q]=we,this.fetching[Q]={rawTileData:Ee,cacheControl:De,resourceTiming:et};try{const ut=yield $e;return S.e({rawTileData:Ee.slice(0),encoding:W.encoding},ut,De,et)}finally{delete this.fetching[Q]}}catch(Be){throw delete this.loading[Q],we.status="done",this.loaded[Q]=we,Be}}))}_getOverzoomTile(W,Q){const{tileID:ne,source:me,overzoomParameters:we}=W,{maxZoomTileID:Pe}=we,Be=`${Pe.key}_${ne.key}`,Ee=this.overzoomedTileResultCache.get(Be);if(Ee)return Ee;const De=new ye,et=this.layerIndex.familiesBySource[me];for(const ut in et){const Ce=Q.layers[ut];if(!Ce)continue;const Ht=Ne(Ce,Pe,ne.canonical);Ht.length>0&&De.addLayer(Ht)}const $e=Le(De);return this.overzoomedTileResultCache.set(Be,$e),$e}reloadTile(W){return S._(this,void 0,void 0,(function*(){const Q=W.uid;if(!this.loaded||!this.loaded[Q])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ne=this.loaded[Q];if(ne.showCollisionBoxes=W.showCollisionBoxes,ne.status==="parsing"){const me=yield ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);let we;if(this.fetching[Q]){const{rawTileData:Pe,cacheControl:Be,resourceTiming:Ee}=this.fetching[Q];delete this.fetching[Q],we=S.e({rawTileData:Pe.slice(0),encoding:W.encoding},me,Be,Ee)}else we=me;return we}if(ne.status==="done"&&ne.vectorTile)return ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity)}))}abortTile(W){return S._(this,void 0,void 0,(function*(){const Q=this.loading,ne=W.uid;Q&&Q[ne]&&Q[ne].abort&&(Q[ne].abort.abort(),delete Q[ne])}))}removeTile(W){return S._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]}))}}class Ye{constructor(){this.loaded={}}loadTile(W){return S._(this,void 0,void 0,(function*(){const{uid:Q,encoding:ne,rawImageData:me,redFactor:we,greenFactor:Pe,blueFactor:Be,baseShift:Ee}=W,De=me.width+2,et=me.height+2,$e=S.b(me)?new S.R({width:De,height:et},yield S.d0(me,-1,-1,De,et)):me,ut=new S.d1(Q,$e,ne,we,Pe,Be,Ee);return this.loaded=this.loaded||{},this.loaded[Q]=ut,ut}))}removeTile(W){const Q=this.loaded,ne=W.uid;Q&&Q[ne]&&delete Q[ne]}}var st,We,gt=(function(){if(We)return st;function Re(Q,ne){if(Q.length!==0){W(Q[0],ne);for(var me=1;me<Q.length;me++)W(Q[me],!ne)}}function W(Q,ne){for(var me=0,we=0,Pe=0,Be=Q.length,Ee=Be-1;Pe<Be;Ee=Pe++){var De=(Q[Pe][0]-Q[Ee][0])*(Q[Ee][1]+Q[Pe][1]),et=me+De;we+=Math.abs(me)>=Math.abs(De)?me-et+De:De-et+me,me=et}me+we>=0!=!!ne&&Q.reverse()}return We=1,st=function Q(ne,me){var we,Pe=ne&&ne.type;if(Pe==="FeatureCollection")for(we=0;we<ne.features.length;we++)Q(ne.features[we],me);else if(Pe==="GeometryCollection")for(we=0;we<ne.geometries.length;we++)Q(ne.geometries[we],me);else if(Pe==="Feature")Q(ne.geometry,me);else if(Pe==="Polygon")Re(ne.coordinates,me);else if(Pe==="MultiPolygon")for(we=0;we<ne.coordinates.length;we++)Re(ne.coordinates[we],me);return ne}})(),nt=S.d2(gt);const zt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Re=>Re},_t=Math.fround||(Ut=new Float32Array(1),Re=>(Ut[0]=+Re,Ut[0]));var Ut;class At{constructor(W){this.options=Object.assign(Object.create(zt),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:Q,minZoom:ne,maxZoom:me}=this.options;Q&&console.time("total time");const we=`prepare ${W.length} points`;Q&&console.time(we),this.points=W;const Pe=[];for(let Ee=0;Ee<W.length;Ee++){const De=W[Ee];if(!De.geometry)continue;const[et,$e]=De.geometry.coordinates,ut=_t(an(et)),Ce=_t(An($e));Pe.push(ut,Ce,1/0,Ee,-1,1),this.options.reduce&&Pe.push(0)}let Be=this.trees[me+1]=this._createTree(Pe);Q&&console.timeEnd(we);for(let Ee=me;Ee>=ne;Ee--){const De=+Date.now();Be=this.trees[Ee]=this._createTree(this._cluster(Be,Ee)),Q&&console.log("z%d: %d clusters in %dms",Ee,Be.numItems,+Date.now()-De)}return Q&&console.timeEnd("total time"),this}getClusters(W,Q){let ne=((W[0]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,W[1]));let we=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)ne=-180,we=180;else if(ne>we){const $e=this.getClusters([ne,me,180,Pe],Q),ut=this.getClusters([-180,me,we,Pe],Q);return $e.concat(ut)}const Be=this.trees[this._limitZoom(Q)],Ee=Be.range(an(ne),An(Pe),an(we),An(me)),De=Be.data,et=[];for(const $e of Ee){const ut=this.stride*$e;et.push(De[ut+5]>1?Xt(De,ut,this.clusterProps):this.points[De[ut+3]])}return et}getChildren(W){const Q=this._getOriginId(W),ne=this._getOriginZoom(W),me="No cluster with the specified id.",we=this.trees[ne];if(!we)throw new Error(me);const Pe=we.data;if(Q*this.stride>=Pe.length)throw new Error(me);const Be=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),Ee=we.within(Pe[Q*this.stride],Pe[Q*this.stride+1],Be),De=[];for(const et of Ee){const $e=et*this.stride;Pe[$e+4]===W&&De.push(Pe[$e+5]>1?Xt(Pe,$e,this.clusterProps):this.points[Pe[$e+3]])}if(De.length===0)throw new Error(me);return De}getLeaves(W,Q,ne){const me=[];return this._appendLeaves(me,W,Q=Q||10,ne=ne||0,0),me}getTile(W,Q,ne){const me=this.trees[this._limitZoom(W)],we=Math.pow(2,W),{extent:Pe,radius:Be}=this.options,Ee=Be/Pe,De=(ne-Ee)/we,et=(ne+1+Ee)/we,$e={features:[]};return this._addTileFeatures(me.range((Q-Ee)/we,De,(Q+1+Ee)/we,et),me.data,Q,ne,we,$e),Q===0&&this._addTileFeatures(me.range(1-Ee/we,De,1,et),me.data,we,ne,we,$e),Q===we-1&&this._addTileFeatures(me.range(0,De,Ee/we,et),me.data,-1,ne,we,$e),$e.features.length?$e:null}getClusterExpansionZoom(W){let Q=this._getOriginZoom(W)-1;for(;Q<=this.options.maxZoom;){const ne=this.getChildren(W);if(Q++,ne.length!==1)break;W=ne[0].properties.cluster_id}return Q}_appendLeaves(W,Q,ne,me,we){const Pe=this.getChildren(Q);for(const Be of Pe){const Ee=Be.properties;if(Ee&&Ee.cluster?we+Ee.point_count<=me?we+=Ee.point_count:we=this._appendLeaves(W,Ee.cluster_id,ne,me,we):we<me?we++:W.push(Be),W.length===ne)break}return we}_createTree(W){const Q=new S.aT(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ne=0;ne<W.length;ne+=this.stride)Q.add(W[ne],W[ne+1]);return Q.finish(),Q.data=W,Q}_addTileFeatures(W,Q,ne,me,we,Pe){for(const Be of W){const Ee=Be*this.stride,De=Q[Ee+5]>1;let et,$e,ut;if(De)et=tn(Q,Ee,this.clusterProps),$e=Q[Ee],ut=Q[Ee+1];else{const Fn=this.points[Q[Ee+3]];et=Fn.properties;const[Mt,Ot]=Fn.geometry.coordinates;$e=an(Mt),ut=An(Ot)}const Ce={type:1,geometry:[[Math.round(this.options.extent*($e*we-ne)),Math.round(this.options.extent*(ut*we-me))]],tags:et};let Ht;Ht=De||this.options.generateId?Q[Ee+3]:this.points[Q[Ee+3]].id,Ht!==void 0&&(Ce.id=Ht),Pe.features.push(Ce)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,Q){const{radius:ne,extent:me,reduce:we,minPoints:Pe}=this.options,Be=ne/(me*Math.pow(2,Q)),Ee=W.data,De=[],et=this.stride;for(let $e=0;$e<Ee.length;$e+=et){if(Ee[$e+2]<=Q)continue;Ee[$e+2]=Q;const ut=Ee[$e],Ce=Ee[$e+1],Ht=W.within(Ee[$e],Ee[$e+1],Be),Fn=Ee[$e+5];let Mt=Fn;for(const Ot of Ht){const Jt=Ot*et;Ee[Jt+2]>Q&&(Mt+=Ee[Jt+5])}if(Mt>Fn&&Mt>=Pe){let Ot,Jt=ut*Fn,Nn=Ce*Fn,ii=-1;const Yi=($e/et<<5)+(Q+1)+this.points.length;for(const Xi of Ht){const _i=Xi*et;if(Ee[_i+2]<=Q)continue;Ee[_i+2]=Q;const Oi=Ee[_i+5];Jt+=Ee[_i]*Oi,Nn+=Ee[_i+1]*Oi,Ee[_i+4]=Yi,we&&(Ot||(Ot=this._map(Ee,$e,!0),ii=this.clusterProps.length,this.clusterProps.push(Ot)),we(Ot,this._map(Ee,_i)))}Ee[$e+4]=Yi,De.push(Jt/Mt,Nn/Mt,1/0,Yi,-1,Mt),we&&De.push(ii)}else{for(let Ot=0;Ot<et;Ot++)De.push(Ee[$e+Ot]);if(Mt>1)for(const Ot of Ht){const Jt=Ot*et;if(!(Ee[Jt+2]<=Q)){Ee[Jt+2]=Q;for(let Nn=0;Nn<et;Nn++)De.push(Ee[Jt+Nn])}}}}return De}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,Q,ne){if(W[Q+5]>1){const Pe=this.clusterProps[W[Q+6]];return ne?Object.assign({},Pe):Pe}const me=this.points[W[Q+3]].properties,we=this.options.map(me);return ne&&we===me?Object.assign({},we):we}}function Xt(Re,W,Q){return{type:"Feature",id:Re[W+3],properties:tn(Re,W,Q),geometry:{type:"Point",coordinates:[(ne=Re[W],360*(ne-.5)),kn(Re[W+1])]}};var ne}function tn(Re,W,Q){const ne=Re[W+5],me=ne>=1e4?`${Math.round(ne/1e3)}k`:ne>=1e3?Math.round(ne/100)/10+"k":ne,we=Re[W+6],Pe=we===-1?{}:Object.assign({},Q[we]);return Object.assign(Pe,{cluster:!0,cluster_id:Re[W+3],point_count:ne,point_count_abbreviated:me})}function an(Re){return Re/360+.5}function An(Re){const W=Math.sin(Re*Math.PI/180),Q=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Q<0?0:Q>1?1:Q}function kn(Re){const W=(180-360*Re)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function si(Re,W,Q,ne){let me=ne;const we=W+(Q-W>>1);let Pe,Be=Q-W;const Ee=Re[W],De=Re[W+1],et=Re[Q],$e=Re[Q+1];for(let ut=W+3;ut<Q;ut+=3){const Ce=Qe(Re[ut],Re[ut+1],Ee,De,et,$e);if(Ce>me)Pe=ut,me=Ce;else if(Ce===me){const Ht=Math.abs(ut-we);Ht<Be&&(Pe=ut,Be=Ht)}}me>ne&&(Pe-W>3&&si(Re,W,Pe,ne),Re[Pe+2]=me,Q-Pe>3&&si(Re,Pe,Q,ne))}function Qe(Re,W,Q,ne,me,we){let Pe=me-Q,Be=we-ne;if(Pe!==0||Be!==0){const Ee=((Re-Q)*Pe+(W-ne)*Be)/(Pe*Pe+Be*Be);Ee>1?(Q=me,ne=we):Ee>0&&(Q+=Pe*Ee,ne+=Be*Ee)}return Pe=Re-Q,Be=W-ne,Pe*Pe+Be*Be}function ft(Re,W,Q,ne){const me={type:W,geom:Q},we={id:Re??null,type:me.type,geometry:me.geom,tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(me.type){case"Point":case"MultiPoint":case"LineString":Dt(we,me.geom);break;case"Polygon":Dt(we,me.geom[0]);break;case"MultiLineString":for(const Pe of me.geom)Dt(we,Pe);break;case"MultiPolygon":for(const Pe of me.geom)Dt(we,Pe[0])}return we}function Dt(Re,W){for(let Q=0;Q<W.length;Q+=3)Re.minX=Math.min(Re.minX,W[Q]),Re.minY=Math.min(Re.minY,W[Q+1]),Re.maxX=Math.max(Re.maxX,W[Q]),Re.maxY=Math.max(Re.maxY,W[Q+1])}function Lt(Re,W){const Q=[];switch(Re.type){case"FeatureCollection":for(let ne=0;ne<Re.features.length;ne++)yn(Q,Re.features[ne],W,ne);break;case"Feature":yn(Q,Re,W);break;default:yn(Q,{geometry:Re,properties:void 0},W)}return Q}function yn(Re,W,Q,ne){var Be;if(!W.geometry)return;if(W.geometry.type==="GeometryCollection"){for(const Ee of W.geometry.geometries)yn(Re,{id:W.id,geometry:Ee,properties:W.properties},Q,ne);return}const me=W.geometry.coordinates;if(!(me!=null&&me.length))return;const we=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2);let Pe=W.id;switch(Q.promoteId?Pe=(Be=W.properties)==null?void 0:Be[Q.promoteId]:Q.generateId&&(Pe=ne||0),W.geometry.type){case"Point":{const Ee=[];return Me(W.geometry.coordinates,Ee),void Re.push(ft(Pe,W.geometry.type,Ee,W.properties))}case"MultiPoint":{const Ee=[];for(const De of W.geometry.coordinates)Me(De,Ee);return void Re.push(ft(Pe,W.geometry.type,Ee,W.properties))}case"LineString":{const Ee=[];return at(W.geometry.coordinates,Ee,we,!1),void Re.push(ft(Pe,W.geometry.type,Ee,W.properties))}case"MultiLineString":{if(Q.lineMetrics){for(const De of W.geometry.coordinates){const et=[];at(De,et,we,!1),Re.push(ft(Pe,"LineString",et,W.properties))}return}const Ee=[];return Et(W.geometry.coordinates,Ee,we,!1),void Re.push(ft(Pe,W.geometry.type,Ee,W.properties))}case"Polygon":{const Ee=[];return Et(W.geometry.coordinates,Ee,we,!0),void Re.push(ft(Pe,W.geometry.type,Ee,W.properties))}case"MultiPolygon":{const Ee=[];for(const De of W.geometry.coordinates){const et=[];Et(De,et,we,!0),Ee.push(et)}return void Re.push(ft(Pe,W.geometry.type,Ee,W.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function Me(Re,W){W.push(Rt(Re[0]),$t(Re[1]),0)}function at(Re,W,Q,ne){let me,we,Pe=0;for(let Ee=0;Ee<Re.length;Ee++){const De=Rt(Re[Ee][0]),et=$t(Re[Ee][1]);W.push(De,et,0),Ee>0&&(Pe+=ne?(me*et-De*we)/2:Math.sqrt(Math.pow(De-me,2)+Math.pow(et-we,2))),me=De,we=et}const Be=W.length-3;W[2]=1,Q>0&&si(W,0,Be,Q),W[Be+2]=1,W.size=Math.abs(Pe),W.start=0,W.end=W.size}function Et(Re,W,Q,ne){for(let me=0;me<Re.length;me++){const we=[];at(Re[me],we,Q,ne),W.push(we)}}function Rt(Re){return Re/360+.5}function $t(Re){const W=Math.sin(Re*Math.PI/180),Q=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Q<0?0:Q>1?1:Q}function Vt(Re,W,Q,ne,me,we,Pe,Be){if(ne/=W,we>=(Q/=W)&&Pe<ne)return Re;if(Pe<Q||we>=ne)return null;const Ee=[];for(const De of Re){const et=me===0?De.minX:De.minY,$e=me===0?De.maxX:De.maxY;if(et>=Q&&$e<ne)Ee.push(De);else if(!($e<Q||et>=ne))switch(De.type){case"Point":case"MultiPoint":{const ut=[];if(mn(De.geometry,ut,Q,ne,me),!ut.length)continue;Ee.push(ft(De.id,ut.length===3?"Point":"MultiPoint",ut,De.tags));continue}case"LineString":{const ut=[];if(Nt(De.geometry,ut,Q,ne,me,!1,Be.lineMetrics),!ut.length)continue;if(Be.lineMetrics){for(const Ce of ut)Ee.push(ft(De.id,De.type,Ce,De.tags));continue}if(ut.length>1){Ee.push(ft(De.id,"MultiLineString",ut,De.tags));continue}Ee.push(ft(De.id,De.type,ut[0],De.tags));continue}case"MultiLineString":{const ut=[];if(ei(De.geometry,ut,Q,ne,me,!1),!ut.length)continue;if(ut.length===1){Ee.push(ft(De.id,"LineString",ut[0],De.tags));continue}Ee.push(ft(De.id,De.type,ut,De.tags));continue}case"Polygon":{const ut=[];if(ei(De.geometry,ut,Q,ne,me,!0),!ut.length)continue;Ee.push(ft(De.id,De.type,ut,De.tags));continue}case"MultiPolygon":{const ut=[];for(const Ce of De.geometry){const Ht=[];ei(Ce,Ht,Q,ne,me,!0),Ht.length&&ut.push(Ht)}if(!ut.length)continue;Ee.push(ft(De.id,De.type,ut,De.tags));continue}}}return Ee.length?Ee:null}function mn(Re,W,Q,ne,me){for(let we=0;we<Re.length;we+=3){const Pe=Re[we+me];Pe>=Q&&Pe<=ne&&bn(W,Re[we],Re[we+1],Re[we+2])}}function Nt(Re,W,Q,ne,me,we,Pe){let Be=gn(Re);const Ee=me===0?Pi:er;let De,et,$e=Re.start;for(let Mt=0;Mt<Re.length-3;Mt+=3){const Ot=Re[Mt],Jt=Re[Mt+1],Nn=Re[Mt+2],ii=Re[Mt+3],Yi=Re[Mt+4],Xi=me===0?Ot:Jt,_i=me===0?ii:Yi;let Oi=!1;Pe&&(De=Math.sqrt(Math.pow(Ot-ii,2)+Math.pow(Jt-Yi,2))),Xi<Q?_i>Q&&(et=Ee(Be,Ot,Jt,ii,Yi,Q),Pe&&(Be.start=$e+De*et)):Xi>ne?_i<ne&&(et=Ee(Be,Ot,Jt,ii,Yi,ne),Pe&&(Be.start=$e+De*et)):bn(Be,Ot,Jt,Nn),_i<Q&&Xi>=Q&&(et=Ee(Be,Ot,Jt,ii,Yi,Q),Oi=!0),_i>ne&&Xi<=ne&&(et=Ee(Be,Ot,Jt,ii,Yi,ne),Oi=!0),!we&&Oi&&(Pe&&(Be.end=$e+De*et),W.push(Be),Be=gn(Re)),Pe&&($e+=De)}let ut=Re.length-3;const Ce=Re[ut],Ht=Re[ut+1],Fn=me===0?Ce:Ht;Fn>=Q&&Fn<=ne&&bn(Be,Ce,Ht,Re[ut+2]),ut=Be.length-3,we&&ut>=3&&(Be[ut]!==Be[0]||Be[ut+1]!==Be[1])&&bn(Be,Be[0],Be[1],Be[2]),Be.length&&W.push(Be)}function gn(Re){const W=[];return W.size=Re.size,W.start=Re.start,W.end=Re.end,W}function ei(Re,W,Q,ne,me,we){for(const Pe of Re)Nt(Pe,W,Q,ne,me,we,!1)}function bn(Re,W,Q,ne){Re.push(W,Q,ne)}function Pi(Re,W,Q,ne,me,we){const Pe=(we-W)/(ne-W);return bn(Re,we,Q+(me-Q)*Pe,1),Pe}function er(Re,W,Q,ne,me,we){const Pe=(we-Q)/(me-Q);return bn(Re,W+(ne-W)*Pe,we,1),Pe}function wn(Re,W){const Q=W.buffer/W.extent;let ne=Re;const me=Vt(Re,1,-1-Q,Q,0,-1,2,W),we=Vt(Re,1,1-Q,2+Q,0,-1,2,W);return(me||we)&&(ne=Vt(Re,1,-Q,1+Q,0,-1,2,W)||[],me&&(ne=ji(me,1).concat(ne)),we&&(ne=ne.concat(ji(we,-1)))),ne}function ji(Re,W){const Q=[];for(const ne of Re)switch(ne.type){case"Point":case"MultiPoint":case"LineString":{const me=sr(ne.geometry,W);Q.push(ft(ne.id,ne.type,me,ne.tags));continue}case"MultiLineString":case"Polygon":{const me=[];for(const we of ne.geometry)me.push(sr(we,W));Q.push(ft(ne.id,ne.type,me,ne.tags));continue}case"MultiPolygon":{const me=[];for(const we of ne.geometry){const Pe=[];for(const Be of we)Pe.push(sr(Be,W));me.push(Pe)}Q.push(ft(ne.id,ne.type,me,ne.tags));continue}}return Q}function sr(Re,W){const Q=[];Q.size=Re.size,Re.start!==void 0&&(Q.start=Re.start,Q.end=Re.end);for(let ne=0;ne<Re.length;ne+=3)Q.push(Re[ne]+W,Re[ne+1],Re[ne+2]);return Q}function un(Re,W){if(Re.transformed)return Re;const Q=1<<Re.z,ne=Re.x,me=Re.y;for(const we of Re.features){if(we.type===1){const Be=[];for(let Ee=0;Ee<we.geometry.length;Ee+=2)Be.push(ar(we.geometry[Ee],we.geometry[Ee+1],W,Q,ne,me));we.geometry=Be;continue}const Pe=[];for(const Be of we.geometry){const Ee=[];for(let De=0;De<Be.length;De+=2)Ee.push(ar(Be[De],Be[De+1],W,Q,ne,me));Pe.push(Ee)}we.geometry=Pe}return Re.transformed=!0,Re}function ar(Re,W,Q,ne,me,we){return[Math.round(Q*(Re*ne-me)),Math.round(Q*(W*ne-we))]}function wo(Re,W,Q,ne,me){const we=W===me.maxZoom?0:me.tolerance/((1<<W)*me.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:Re.length,source:null,x:Q,y:ne,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Be of Re)Ho(Pe,Be,we,me);return Pe}function Ho(Re,W,Q,ne){Re.minX=Math.min(Re.minX,W.minX),Re.minY=Math.min(Re.minY,W.minY),Re.maxX=Math.max(Re.maxX,W.maxX),Re.maxY=Math.max(Re.maxY,W.maxY);let me,we=W.tags||null;switch(W.type){case"Point":case"MultiPoint":{const Pe=[];for(let Be=0;Be<W.geometry.length;Be+=3)Pe.push(W.geometry[Be],W.geometry[Be+1]),Re.numPoints++,Re.numSimplified++;if(!Pe.length)return;me={type:1,tags:we,geometry:Pe};break}case"LineString":{const Pe=[];if(Dr(Pe,W.geometry,Re,Q,!1,!1),!Pe.length)return;if(ne.lineMetrics){we={};for(const Be in W.tags)we[Be]=W.tags[Be];we.mapbox_clip_start=W.geometry.start/W.geometry.size,we.mapbox_clip_end=W.geometry.end/W.geometry.size}me={type:2,tags:we,geometry:Pe};break}case"MultiLineString":case"Polygon":{const Pe=[];for(let Be=0;Be<W.geometry.length;Be++)Dr(Pe,W.geometry[Be],Re,Q,W.type==="Polygon",Be===0);if(!Pe.length)return;me={type:W.type==="Polygon"?3:2,tags:we,geometry:Pe};break}case"MultiPolygon":{const Pe=[];for(let Be=0;Be<W.geometry.length;Be++){const Ee=W.geometry[Be];for(let De=0;De<Ee.length;De++)Dr(Pe,Ee[De],Re,Q,!0,De===0)}if(!Pe.length)return;me={type:3,tags:we,geometry:Pe};break}}W.id!==null&&(me.id=W.id),Re.features.push(me)}function Dr(Re,W,Q,ne,me,we){const Pe=ne*ne;if(ne>0&&W.size<(me?Pe:ne))return void(Q.numPoints+=W.length/3);const Be=[];for(let Ee=0;Ee<W.length;Ee+=3)(ne===0||W[Ee+2]>Pe)&&(Q.numSimplified++,Be.push(W[Ee],W[Ee+1])),Q.numPoints++;me&&(function(Ee,De){let et=0;for(let $e=0,ut=Ee.length,Ce=ut-2;$e<ut;Ce=$e,$e+=2)et+=(Ee[$e]-Ee[Ce])*(Ee[$e+1]+Ee[Ce+1]);if(et>0===De)for(let $e=0,ut=Ee.length;$e<ut/2;$e+=2){const Ce=Ee[$e],Ht=Ee[$e+1];Ee[$e]=Ee[ut-2-$e],Ee[$e+1]=Ee[ut-1-$e],Ee[ut-2-$e]=Ce,Ee[ut-1-$e]=Ht}})(Be,we),Re.push(Be)}function io(Re,W,Q){var we,Pe;const ne=!!W.newGeometry,me=W.removeAllProperties||((we=W.removeProperties)==null?void 0:we.length)>0||((Pe=W.addOrUpdateProperties)==null?void 0:Pe.length)>0;if(ne){let Be=Lt({type:"FeatureCollection",features:[{type:"Feature",id:Re.id,geometry:W.newGeometry,properties:me?Bs(Re.tags,W):Re.tags}]},Q);return Be=wn(Be,Q),Be[0]}if(me){const Be={...Re};return Be.tags=Bs(Be.tags,W),Be}return null}function Bs(Re,W){if(W.removeAllProperties)return{};const Q={...Re||{}};if(W.removeProperties)for(const ne of W.removeProperties)delete Q[ne];if(W.addOrUpdateProperties)for(const{key:ne,value:me}of W.addOrUpdateProperties)Q[ne]=me;return Q}const Di={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class Sr{constructor(W,Q){Kt(this,"options");Kt(this,"tiles");Kt(this,"tileCoords");Kt(this,"stats",{});Kt(this,"total",0);Kt(this,"source");const ne=(Q=this.options=Object.assign({},Di,Q)).debug;if(ne&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let me=Lt(W,Q);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),me=wn(me,Q),me.length&&this.splitTile(me,0,0,0),Q.updateable&&(this.source=me),ne&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,Q,ne,me,we,Pe,Be){const Ee=[W,Q,ne,me],De=this.options,et=De.debug;for(;Ee.length;){me=Ee.pop(),ne=Ee.pop(),Q=Ee.pop(),W=Ee.pop();const $e=1<<Q,ut=Os(Q,ne,me);let Ce=this.tiles[ut];if(!Ce&&(et>1&&console.time("creation"),Ce=this.tiles[ut]=wo(W,Q,ne,me,De),this.tileCoords.push({z:Q,x:ne,y:me,id:ut}),et)){et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,ne,me,Ce.numFeatures,Ce.numPoints,Ce.numSimplified),console.timeEnd("creation"));const Oi=`z${Q}`;this.stats[Oi]=(this.stats[Oi]||0)+1,this.total++}if(Ce.source=W,we==null){if(Q===De.indexMaxZoom||Ce.numPoints<=De.indexMaxPoints)continue}else{if(Q===De.maxZoom||Q===we)continue;if(we!=null){const Oi=we-Q;if(ne!==Pe>>Oi||me!==Be>>Oi)continue}}if(Ce.source=null,!W.length)continue;et>1&&console.time("clipping");const Ht=.5*De.buffer/De.extent,Fn=.5-Ht,Mt=.5+Ht,Ot=1+Ht;let Jt=null,Nn=null,ii=null,Yi=null;const Xi=Vt(W,$e,ne-Ht,ne+Mt,0,Ce.minX,Ce.maxX,De),_i=Vt(W,$e,ne+Fn,ne+Ot,0,Ce.minX,Ce.maxX,De);Xi&&(Jt=Vt(Xi,$e,me-Ht,me+Mt,1,Ce.minY,Ce.maxY,De),Nn=Vt(Xi,$e,me+Fn,me+Ot,1,Ce.minY,Ce.maxY,De)),_i&&(ii=Vt(_i,$e,me-Ht,me+Mt,1,Ce.minY,Ce.maxY,De),Yi=Vt(_i,$e,me+Fn,me+Ot,1,Ce.minY,Ce.maxY,De)),et>1&&console.timeEnd("clipping"),Ee.push(Jt||[],Q+1,2*ne,2*me),Ee.push(Nn||[],Q+1,2*ne,2*me+1),Ee.push(ii||[],Q+1,2*ne+1,2*me),Ee.push(Yi||[],Q+1,2*ne+1,2*me+1)}}getTile(W,Q,ne){W=+W,Q=+Q,ne=+ne;const me=this.options,{extent:we,debug:Pe}=me;if(W<0||W>24)return null;const Be=1<<W,Ee=Os(W,Q=Q+Be&Be-1,ne);if(this.tiles[Ee])return un(this.tiles[Ee],we);Pe>1&&console.log("drilling down to z%d-%d-%d",W,Q,ne);let De,et=W,$e=Q,ut=ne;for(;!De&&et>0;)et--,$e>>=1,ut>>=1,De=this.tiles[Os(et,$e,ut)];return De!=null&&De.source?(Pe>1&&(console.log("found parent tile z%d-%d-%d",et,$e,ut),console.time("drilling down")),this.splitTile(De.source,et,$e,ut,W,Q,ne),Pe>1&&console.timeEnd("drilling down"),this.tiles[Ee]?un(this.tiles[Ee],we):null):null}invalidateTiles(W){const Q=this.options,{debug:ne}=Q;let me=1/0,we=-1/0,Pe=1/0,Be=-1/0;for(const et of W)me=Math.min(me,et.minX),we=Math.max(we,et.maxX),Pe=Math.min(Pe,et.minY),Be=Math.max(Be,et.maxY);const Ee=Q.buffer/Q.extent,De=new Set;for(const et in this.tiles){const $e=this.tiles[et],ut=1<<$e.z,Ce=($e.x-Ee)/ut,Ht=($e.x+1+Ee)/ut,Fn=($e.y-Ee)/ut,Mt=($e.y+1+Ee)/ut;if(we<Ce||me>=Ht||Be<Fn||Pe>=Mt)continue;let Ot=!1;for(const Jt of W)if(Jt.maxX>=Ce&&Jt.minX<Ht&&Jt.maxY>=Fn&&Jt.minY<Mt){Ot=!0;break}if(Ot){if(ne){ne>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$e.z,$e.x,$e.y,$e.numFeatures,$e.numPoints,$e.numSimplified);const Jt=`z${$e.z}`;this.stats[Jt]=(this.stats[Jt]||0)-1,this.total--}delete this.tiles[et],De.add(et)}}De.size&&(this.tileCoords=this.tileCoords.filter((et=>!De.has(et.id))))}updateData(W){const Q=this.options,ne=Q.debug;if(!Q.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");const{affected:me,source:we}=(function($e,ut,Ce){const Ht=(function(Mt){var Ot,Jt;return Mt?{removeAll:Mt.removeAll,remove:new Set(Mt.remove||[]),add:new Map((Ot=Mt.add)==null?void 0:Ot.map((Nn=>[Nn.id,Nn]))),update:new Map((Jt=Mt.update)==null?void 0:Jt.map((Nn=>[Nn.id,Nn])))}:{remove:new Set,add:new Map,update:new Map}})(ut);let Fn=[];if(Ht.removeAll&&(Fn=$e,$e=[]),Ht.remove.size||Ht.add.size){const Mt=[];for(const Ot of $e){const{id:Jt}=Ot;(Ht.remove.has(Jt)||Ht.add.has(Jt))&&Mt.push(Ot)}if(Mt.length){Fn.push(...Mt);const Ot=new Set(Mt.map((Jt=>Jt.id)));$e=$e.filter((Jt=>!Ot.has(Jt.id)))}if(Ht.add.size){let Ot=Lt({type:"FeatureCollection",features:Array.from(Ht.add.values())},Ce);Ot=wn(Ot,Ce),Fn.push(...Ot),$e.push(...Ot)}}if(Ht.update.size)for(const[Mt,Ot]of Ht.update){const Jt=$e.findIndex((Yi=>Yi.id===Mt));if(Jt===-1)continue;const Nn=$e[Jt],ii=io(Nn,Ot,Ce);ii&&(Fn.push(Nn,ii),$e[Jt]=ii)}return{affected:Fn,source:$e}})(this.source,W,Q);if(!me.length)return;this.source=we,ne>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(me),ne>1&&console.timeEnd("invalidating");const[Pe,Be,Ee]=[0,0,0],De=wo(this.source,Pe,Be,Ee,this.options);De.source=this.source;const et=Os(Pe,Be,Ee);if(this.tiles[et]=De,this.tileCoords.push({z:Pe,x:Be,y:Ee,id:et}),ne){const $e=`z${Pe}`;this.stats[$e]=(this.stats[$e]||0)+1,this.total++}}}function Os(Re,W,Q){return 32*((1<<Re)*Q+W)+Re}class Ll extends se{constructor(W,Q,ne,me=Us){super(W,Q,ne),this._dataUpdateable=new Map,this._createGeoJSONIndex=me}loadVectorTile(W,Q){return S._(this,void 0,void 0,(function*(){const ne=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const me=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);return me?Le(new S.d3(me.features,{version:2,extent:S.a5})):null}))}loadData(W){return S._(this,void 0,void 0,(function*(){var Q;(Q=this._pendingRequest)===null||Q===void 0||Q.abort();const ne=this._startPerformance(W);this._pendingRequest=new AbortController;try{(!this._pendingData||W.request||W.data||W.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest));const me=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(me,W),this.loaded={};const we={};return W.request&&(we.data=me),this._finishPerformance(ne,W,we),we}catch(me){if(delete this._pendingRequest,S.Z(me))return{abandoned:!0};throw me}}))}_startPerformance(W){var Q;if(!((Q=W==null?void 0:W.request)===null||Q===void 0)&&Q.collectResourceTiming)return new S.c$(W.request)}_finishPerformance(W,Q,ne){if(!W)return;const me=W.finish();me&&(ne.resourceTiming={},ne.resourceTiming[Q.source]=JSON.parse(JSON.stringify(me)))}getData(){return S._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(W){const Q=this.loaded;return Q&&Q[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,Q){return S._(this,void 0,void 0,(function*(){let ne;if(W.request?ne=yield this.loadGeoJSONFromUrl(W.request,W.promoteId,Q):W.data?ne=this._loadGeoJSONFromObject(W.data,W.promoteId):W.dataDiff&&(ne=this._loadGeoJSONFromDiff(W.dataDiff,W.promoteId,W.source)),delete this._pendingRequest,typeof ne!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);return nt(ne,!0),W.filter&&(ne=this._filterGeoJSON(ne,W.filter)),ne}))}loadGeoJSONFromUrl(W,Q,ne){return S._(this,void 0,void 0,(function*(){const me=yield S.j(W,ne);return this._dataUpdateable=S.a7(me.data,Q),me.data}))}_loadGeoJSONFromObject(W,Q){return this._dataUpdateable=S.a7(W,Q),W}_loadGeoJSONFromDiff(W,Q,ne){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ne}`);S.a8(this._dataUpdateable,W,Q);const me=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(me)}_filterGeoJSON(W,Q){const ne=S.d4(Q,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ne.result==="error")throw new Error(ne.value.map((we=>`${we.key}: ${we.message}`)).join(", "));const me=W.features.filter((we=>ne.value.evaluate({zoom:0},we)));return this._toFeatureCollection(me)}_toFeatureCollection(W){return{type:"FeatureCollection",features:W}}removeSource(W){return S._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}function Us(Re,W){return W.cluster?new At((function({superclusterOptions:Q,clusterProperties:ne}){if(!ne||!Q)return Q;const me={},we={},Pe={accumulated:null,zoom:0},Be={properties:null},Ee=Object.keys(ne);for(const De of Ee){const[et,$e]=ne[De],ut=S.d4($e),Ce=S.d4(typeof et=="string"?[et,["accumulated"],["get",De]]:et);me[De]=ut.value,we[De]=Ce.value}return Q.map=De=>{Be.properties=De;const et={};for(const $e of Ee)et[$e]=me[$e].evaluate(Pe,Be);return et},Q.reduce=(De,et)=>{Be.properties=et;for(const $e of Ee)Pe.accumulated=De[$e],De[$e]=we[$e].evaluate(Pe,Be)},Q})(W)).load(Re.features):(function(Q,ne){return new Sr(Q,ne)})(Re,W.geojsonVtOptions)}class Nl{constructor(W){this.self=W,this.actor=new S.L(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(Q,ne)=>{if(this.externalWorkerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.externalWorkerSourceTypes[Q]=ne},this.self.addProtocol=S.cK,this.self.removeProtocol=S.cL,this.self.registerRTLTextPlugin=Q=>{S.d5.setMethods(Q)},this.actor.registerMessageHandler("LDT",((Q,ne)=>this._getDEMWorkerSource(Q,ne.source).loadTile(ne))),this.actor.registerMessageHandler("RDT",((Q,ne)=>S._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(Q,ne.source).removeTile(ne)})))),this.actor.registerMessageHandler("GCEZ",((Q,ne)=>S._(this,void 0,void 0,(function*(){return this._getWorkerSource(Q,ne.type,ne.source).getClusterExpansionZoom(ne)})))),this.actor.registerMessageHandler("GCC",((Q,ne)=>S._(this,void 0,void 0,(function*(){return this._getWorkerSource(Q,ne.type,ne.source).getClusterChildren(ne)})))),this.actor.registerMessageHandler("GCL",((Q,ne)=>S._(this,void 0,void 0,(function*(){return this._getWorkerSource(Q,ne.type,ne.source).getClusterLeaves(ne)})))),this.actor.registerMessageHandler("LD",((Q,ne)=>this._getWorkerSource(Q,ne.type,ne.source).loadData(ne))),this.actor.registerMessageHandler("GD",((Q,ne)=>this._getWorkerSource(Q,ne.type,ne.source).getData())),this.actor.registerMessageHandler("LT",((Q,ne)=>this._getWorkerSource(Q,ne.type,ne.source).loadTile(ne))),this.actor.registerMessageHandler("RT",((Q,ne)=>this._getWorkerSource(Q,ne.type,ne.source).reloadTile(ne))),this.actor.registerMessageHandler("AT",((Q,ne)=>this._getWorkerSource(Q,ne.type,ne.source).abortTile(ne))),this.actor.registerMessageHandler("RMT",((Q,ne)=>this._getWorkerSource(Q,ne.type,ne.source).removeTile(ne))),this.actor.registerMessageHandler("RS",((Q,ne)=>S._(this,void 0,void 0,(function*(){if(!this.workerSources[Q]||!this.workerSources[Q][ne.type]||!this.workerSources[Q][ne.type][ne.source])return;const me=this.workerSources[Q][ne.type][ne.source];delete this.workerSources[Q][ne.type][ne.source],me.removeSource!==void 0&&me.removeSource(ne)})))),this.actor.registerMessageHandler("RM",(Q=>S._(this,void 0,void 0,(function*(){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.workerSources[Q],delete this.demWorkerSources[Q],this.globalStates.delete(Q)})))),this.actor.registerMessageHandler("SR",((Q,ne)=>S._(this,void 0,void 0,(function*(){this.referrer=ne})))),this.actor.registerMessageHandler("SRPS",((Q,ne)=>this._syncRTLPluginState(Q,ne))),this.actor.registerMessageHandler("IS",((Q,ne)=>S._(this,void 0,void 0,(function*(){this.self.importScripts(ne)})))),this.actor.registerMessageHandler("SI",((Q,ne)=>this._setImages(Q,ne))),this.actor.registerMessageHandler("UL",((Q,ne)=>S._(this,void 0,void 0,(function*(){this._getLayerIndex(Q).update(ne.layers,ne.removedIds,this._getGlobalState(Q))})))),this.actor.registerMessageHandler("UGS",((Q,ne)=>S._(this,void 0,void 0,(function*(){const me=this._getGlobalState(Q);for(const we in ne)me[we]=ne[we]})))),this.actor.registerMessageHandler("SL",((Q,ne)=>S._(this,void 0,void 0,(function*(){this._getLayerIndex(Q).replace(ne,this._getGlobalState(Q))}))))}_getGlobalState(W){let Q=this.globalStates.get(W);return Q||(Q={},this.globalStates.set(W,Q)),Q}_setImages(W,Q){return S._(this,void 0,void 0,(function*(){this.availableImages[W]=Q;for(const ne in this.workerSources[W]){const me=this.workerSources[W][ne];for(const we in me)me[we].availableImages=Q}}))}_syncRTLPluginState(W,Q){return S._(this,void 0,void 0,(function*(){return yield S.d5.syncState(Q,this.self.importScripts)}))}_getAvailableImages(W){let Q=this.availableImages[W];return Q||(Q=[]),Q}_getLayerIndex(W){let Q=this.layerIndexes[W];return Q||(Q=this.layerIndexes[W]=new c),Q}_getWorkerSource(W,Q,ne){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][Q]||(this.workerSources[W][Q]={}),!this.workerSources[W][Q][ne]){const me={sendAsync:(we,Pe)=>(we.targetMapId=W,this.actor.sendAsync(we,Pe))};switch(Q){case"vector":this.workerSources[W][Q][ne]=new se(me,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][Q][ne]=new Ll(me,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][Q][ne]=new this.externalWorkerSourceTypes[Q](me,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][Q][ne]}_getDEMWorkerSource(W,Q){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][Q]||(this.demWorkerSources[W][Q]=new Ye),this.demWorkerSources[W][Q]}}return S.i(self)&&(self.worker=new Nl(self)),Nl})),T("index",["exports","./shared"],(function(S,c){var F="5.17.0";function k(){var v=new c.A(4);return c.A!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v}let G,K,ee;const ye={frame(v,e,o,h){const m=h||window,b=m.requestAnimationFrame((R=>{C(),e(R)})),{unsubscribe:C}=c.s(v.signal,"abort",(()=>{C(),m.cancelAnimationFrame(b),o(new c.a(v.signal.reason))}),!1)},frameAsync(v,e){return new Promise(((o,h)=>{this.frame(v,o,h,e)}))},getImageData(v,e=0){return this.getImageCanvasContext(v).getImageData(-e,-e,v.width+2*e,v.height+2*e)},getImageCanvasContext(v){const e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=v.width,e.height=v.height,o.drawImage(v,0,0,v.width,v.height),o},resolveURL:v=>(G||(G=document.createElement("a")),G.href=v,G.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return ee!==void 0?ee:!!matchMedia&&(K==null&&(K=matchMedia("(prefers-reduced-motion: reduce)")),K.matches)},set prefersReducedMotion(v){ee=v}},Le=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(v){this._frozenAt=v}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function Ne(){return Le.getCurrentTime()}class se{static testProp(e){if(!se.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in se.docStyle)return e[o];return e[0]}static create(e,o,h){const m=window.document.createElement(e);return o!==void 0&&(m.className=o),h&&h.appendChild(m),m}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){se.docStyle&&se.selectProp&&(se.userSelect=se.docStyle[se.selectProp],se.docStyle[se.selectProp]="none")}static enableDrag(){se.docStyle&&se.selectProp&&(se.docStyle[se.selectProp]=se.userSelect)}static setTransform(e,o){e.style[se.transformProp]=o}static addEventListener(e,o,h,m={}){e.addEventListener(o,h,"passive"in m?m:m.capture)}static removeEventListener(e,o,h,m={}){e.removeEventListener(o,h,"passive"in m?m:m.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",se.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",se.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",se.suppressClickInternal,!0)}),0)}static getScale(e){const o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}static getPoint(e,o,h){const m=o.boundingClientRect;return new c.P((h.clientX-m.left)/o.x-e.clientLeft,(h.clientY-m.top)/o.y-e.clientTop)}static mousePos(e,o){const h=se.getScale(e);return se.getPoint(e,h,o)}static touchPos(e,o){const h=[],m=se.getScale(e);for(let b=0;b<o.length;b++)h.push(se.getPoint(e,m,o[b]));return h}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const o=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),h=o.querySelectorAll("script");for(const m of h)m.remove();return se.clean(o),o.innerHTML}static isPossiblyDangerous(e,o){const h=o.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!h.includes("javascript:")&&!h.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const o=e.children;for(const h of o)se.removeAttributes(h),se.clean(h)}static removeAttributes(e){for(const{name:o,value:h}of e.attributes)se.isPossiblyDangerous(o,h)&&e.removeAttribute(o)}}se.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,se.selectProp=se.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),se.transformProp=se.testProp(["transform","WebkitTransform"]);const Ye={supported:!1,testSupport:function(v){!gt&&We&&(nt?zt(v):st=v)}};let st,We,gt=!1,nt=!1;function zt(v){const e=v.createTexture();v.bindTexture(v.TEXTURE_2D,e);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,We),v.isContextLost())return;Ye.supported=!0}catch{}v.deleteTexture(e),gt=!0}var _t;typeof document<"u"&&(We=document.createElement("img"),We.onload=()=>{st&&zt(st),st=null,nt=!0},We.onerror=()=>{gt=!0,st=null},We.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(v){let e,o,h,m;v.resetRequestQueue=()=>{e=[],o=0,h=0,m={}},v.addThrottleControl=z=>{const B=h++;return m[B]=z,B},v.removeThrottleControl=z=>{delete m[z],C()},v.getImage=(z,B,U=!0)=>new Promise(((Z,H)=>{Ye.supported&&(z.headers||(z.headers={}),z.headers.accept="image/webp,*/*"),c.e(z,{type:"image"}),e.push({abortController:B,requestParameters:z,supportImageRefresh:U,state:"queued",onError:X=>{H(X)},onSuccess:X=>{Z(X)}}),C()}));const b=z=>c._(this,void 0,void 0,(function*(){z.state="running";const{requestParameters:B,supportImageRefresh:U,onError:Z,onSuccess:H,abortController:X}=z,te=U===!1&&!c.i(self)&&!c.g(B.url)&&(!B.headers||Object.keys(B.headers).reduce(((ue,fe)=>ue&&fe==="accept"),!0));o++;const le=te?R(B,X):c.m(B,X);try{const ue=yield le;delete z.abortController,z.state="completed",ue.data instanceof HTMLImageElement||c.b(ue.data)?H(ue):ue.data&&H({data:yield(ce=ue.data,typeof createImageBitmap=="function"?c.f(ce):c.h(ce)),cacheControl:ue.cacheControl,expires:ue.expires})}catch(ue){delete z.abortController,Z(ue)}finally{o--,C()}var ce})),C=()=>{const z=(()=>{for(const B of Object.keys(m))if(m[B]())return!0;return!1})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let B=o;B<z&&e.length>0;B++){const U=e.shift();U.abortController.signal.aborted?B--:b(U)}},R=(z,B)=>new Promise(((U,Z)=>{const H=new Image,X=z.url,te=z.credentials;te&&te==="include"?H.crossOrigin="use-credentials":(te&&te==="same-origin"||!c.d(X))&&(H.crossOrigin="anonymous"),B.signal.addEventListener("abort",(()=>{H.src="",Z(new c.a(B.signal.reason))})),H.fetchPriority="high",H.onload=()=>{H.onerror=H.onload=null,U({data:H})},H.onerror=()=>{H.onerror=H.onload=null,B.signal.aborted||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},H.src=X}))})(_t||(_t={})),_t.resetRequestQueue();class Ut{constructor(e){this._transformRequestFn=e??null}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function At(v){const e=[];if(typeof v=="string")e.push({id:"default",url:v});else if(v&&v.length>0){const o=[];for(const{id:h,url:m}of v){const b=`${h}${m}`;o.indexOf(b)===-1&&(o.push(b),e.push({id:h,url:m}))}}return e}function Xt(v,e,o){try{const h=new URL(v);return h.pathname+=`${e}${o}`,h.toString()}catch{throw new Error(`Invalid sprite URL "${v}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function tn(v){const{userImage:e}=v;return!!(e&&e.render&&e.render())&&(v.data.replace(new Uint8Array(e.data.buffer)),!0)}class an extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const e of Object.keys(this.images))this.removeImage(e);this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:o,promiseResolve:h}of this.requestors)h(this._getImagesForIds(o));this.requestors=[]}}getImage(e){const o=this.images[e];if(o&&!o.data&&o.spriteData){const h=o.spriteData;o.data=new c.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let h=!0;const m=o.data||o.spriteData;return this._validateStretch(o.stretchX,m&&m.width)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,m&&m.height)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "content" value`))),h=!1),h}_validateStretch(e,o){if(!e)return!0;let h=0;for(const m of e){if(m[0]<h||m[1]<m[0]||o<m[1])return!1;h=m[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;const h=o.spriteData,m=h&&h.width||o.data.width,b=h&&h.height||o.data.height;return!(e[0]<0||m<e[0]||e[1]<0||b<e[1]||e[2]<0||m<e[2]||e[3]<0||b<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,h=!0){const m=this.getImage(e);if(h&&(m.data.width!==o.data.width||m.data.height!==o.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=m.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){const o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((o,h)=>{let m=!0;if(!this.isLoaded())for(const b of e)this.images[b]||(m=!1);this.isLoaded()||m?o(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:o})}))}_getImagesForIds(e){const o={};for(const h of e){let m=this.getImage(h);m||(this.fire(new c.l("styleimagemissing",{id:h})),m=this.getImage(h)),m?o[h]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:c.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){const o=this.patterns[e],h=this.getImage(e);if(!h)return null;if(o&&o.position.version===h.version)return o.position;if(o)o.position.version=h.version;else{const m={w:h.data.width+2,h:h.data.height+2,x:0,y:0},b=new c.I(m,h);this.patterns[e]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const b in this.patterns)e.push(this.patterns[b].bin);const{w:o,h}=c.p(e),m=this.atlasImage;m.resize({width:o||1,height:h||1});for(const b in this.patterns){const{bin:C}=this.patterns[b],R=C.x+1,z=C.y+1,B=this.getImage(b).data,U=B.width,Z=B.height;c.R.copy(B,m,{x:0,y:0},{x:R,y:z},{width:U,height:Z}),c.R.copy(B,m,{x:0,y:Z-1},{x:R,y:z-1},{width:U,height:1}),c.R.copy(B,m,{x:0,y:0},{x:R,y:z+Z},{width:U,height:1}),c.R.copy(B,m,{x:U-1,y:0},{x:R-1,y:z},{width:1,height:Z}),c.R.copy(B,m,{x:0,y:0},{x:R+U,y:z},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const h=this.getImage(o);h||c.w(`Image with ID: "${o}" was not found`),tn(h)&&this.updateImage(o,h)}}cloneImages(){const e={};for(const o in this.images){const h=this.images[o];e[o]=Object.assign(Object.assign({},h),{data:h.data?h.data.clone():null})}return e}}const An=1e20;function kn(v,e,o,h,m,b,C,R,z){for(let B=e;B<e+h;B++)si(v,o*b+B,b,m,C,R,z);for(let B=o;B<o+m;B++)si(v,B*b+e,1,h,C,R,z)}function si(v,e,o,h,m,b,C){b[0]=0,C[0]=-An,C[1]=An,m[0]=v[e];for(let R=1,z=0,B=0;R<h;R++){m[R]=v[e+R*o];const U=R*R;do{const Z=b[z];B=(m[R]-m[Z]+U-Z*Z)/(R-Z)/2}while(B<=C[z]&&--z>-1);z++,b[z]=R,C[z]=B,C[z+1]=An}for(let R=0,z=0;R<h;R++){for(;C[z+1]<R;)z++;const B=b[z],U=R-B;v[e+R*o]=m[B]+U*U}}const Qe=c.v.layout_symbol["text-font"].default.join(",");class ft{constructor(e,o,h){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={},this.lang=h}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,(function*(){const o=[];for(const b in e)for(const C of e[b])o.push(this._getAndCacheGlyphsPromise(b,C));const h=yield Promise.all(o),m={};for(const{stack:b,id:C,glyph:R}of h)m[b]||(m[b]={}),m[b][C]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return m}))}_getAndCacheGlyphsPromise(e,o){return c._(this,void 0,void 0,(function*(){let h=this.entries[e];h||(h=this.entries[e]={glyphs:{},requests:{},ranges:{}});let m=h.glyphs[o];return m!==void 0?{stack:e,id:o,glyph:m}:!this.url||this._charUsesLocalIdeographFontFamily(o)?(m=h.glyphs[o]=this._drawGlyph(h,e,o),{stack:e,id:o,glyph:m}):yield this._downloadAndCacheRangePromise(e,o)}))}_downloadAndCacheRangePromise(e,o){return c._(this,void 0,void 0,(function*(){const h=this.entries[e],m=Math.floor(o/256);if(h.ranges[m])return{stack:e,id:o,glyph:null};if(!h.requests[m]){const b=ft.loadGlyphRange(e,m,this.url,this.requestManager);h.requests[m]=b}try{const b=yield h.requests[m];for(const C in b)h.glyphs[+C]=b[+C];return h.ranges[m]=!0,{stack:e,id:o,glyph:b[o]||null}}catch(b){const C=h.glyphs[o]=this._drawGlyph(h,e,o);return this._warnOnMissingGlyphRange(C,m,o,b),{stack:e,id:o,glyph:C}}}))}_warnOnMissingGlyphRange(e,o,h,m){const b=256*o,C=b+255,R=h.toString(16).padStart(4,"0").toUpperCase();c.w(`Unable to load glyph range ${o}, ${b}-${C}. Rendering codepoint U+${R} locally instead. ${m}`)}_charUsesLocalIdeographFontFamily(e){return!!this.localIdeographFontFamily&&c.q(e)}_drawGlyph(e,o,h){const m=o===Qe&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(h),b=m?"ideographTinySDF":"tinySDF";e[b]||(e[b]=this._createTinySDF(m?this.localIdeographFontFamily:o));const C=e[b].draw(String.fromCodePoint(h)),R=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(h));return{id:h,bitmap:new c.r({width:C.width||60,height:C.height||60},C.data),metrics:{width:R?0:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:R?0:C.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(e){const o=e?e.split(","):[];o.push("sans-serif");const h=o.map((m=>/[-\w]+/.test(m)?m:`'${CSS.escape(m)}'`)).join(",");return new ft.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:this._fontWeight(o[0]),fontStyle:this._fontStyle(o[0]),lang:this.lang})}_fontStyle(e){return/italic/i.test(e)?"italic":/oblique/i.test(e)?"oblique":"normal"}_fontWeight(e){const o={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let h;for(const[m,b]of Object.entries(o))new RegExp(`\\b${m}\\b`,"i").test(e)&&(h=`${b}`);return h}destroy(){for(const e in this.entries){const o=this.entries[e];o.tinySDF&&(o.tinySDF=null),o.ideographTinySDF&&(o.ideographTinySDF=null),o.glyphs={},o.requests={},o.ranges={}}this.entries={}}}ft.loadGlyphRange=function(v,e,o,h){return c._(this,void 0,void 0,(function*(){const m=256*e,b=m+255,C=h.transformRequest(o.replace("{fontstack}",v).replace("{range}",`${m}-${b}`),"Glyphs"),R=yield c.n(C,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${e}, ${m}-${b}`);const z={};for(const B of c.o(R.data))z[B.id]=B;return z}))},ft.TinySDF=class{constructor({fontSize:v=24,buffer:e=3,radius:o=8,cutoff:h=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:C="normal",lang:R=null}={}){this.buffer=e,this.cutoff=h,this.radius=o,this.lang=R;const z=this.size=v+4*e,B=this._createCanvas(z),U=this.ctx=B.getContext("2d",{willReadFrequently:!0});U.font=`${C} ${b} ${v}px ${m}`,U.textBaseline="alphabetic",U.textAlign="left",U.fillStyle="black",this.gridOuter=new Float64Array(z*z),this.gridInner=new Float64Array(z*z),this.f=new Float64Array(z),this.z=new Float64Array(z+1),this.v=new Uint16Array(z)}_createCanvas(v){const e=document.createElement("canvas");return e.width=e.height=v,e}draw(v){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:h,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(v),C=Math.ceil(o),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),z=Math.min(this.size-this.buffer,C+Math.ceil(h)),B=R+2*this.buffer,U=z+2*this.buffer,Z=Math.max(B*U,0),H=new Uint8ClampedArray(Z),X={data:H,width:B,height:U,glyphWidth:R,glyphHeight:z,glyphTop:C,glyphLeft:0,glyphAdvance:e};if(R===0||z===0)return X;const{ctx:te,buffer:le,gridInner:ce,gridOuter:ue}=this;this.lang&&(te.lang=this.lang),te.clearRect(le,le,R,z),te.fillText(v,le,le+C);const fe=te.getImageData(le,le,R,z);ue.fill(An,0,Z),ce.fill(0,0,Z);for(let xe=0;xe<z;xe++)for(let he=0;he<R;he++){const ve=fe.data[4*(xe*R+he)+3]/255;if(ve===0)continue;const Te=(xe+le)*B+he+le;if(ve===1)ue[Te]=0,ce[Te]=An;else{const ge=.5-ve;ue[Te]=ge>0?ge*ge:0,ce[Te]=ge<0?ge*ge:0}}kn(ue,0,0,B,U,B,this.f,this.v,this.z),kn(ce,le,le,R,z,B,this.f,this.v,this.z);for(let xe=0;xe<Z;xe++){const he=Math.sqrt(ue[xe])-Math.sqrt(ce[xe]);H[xe]=Math.round(255-255*(he/this.radius+this.cutoff))}return X}};class Dt{constructor(){this.specification=c.u.light.position}possiblyEvaluate(e,o){return c.F(e.expression.evaluate(o))}interpolate(e,o,h){return{x:c.G.number(e.x,o.x,h),y:c.G.number(e.y,o.y,h),z:c.G.number(e.z,o.z,h)}}}let Lt;class yn extends c.E{constructor(e){super(),Lt=Lt||new c.t({anchor:new c.D(c.u.light.anchor),position:new Dt,color:new c.D(c.u.light.color),intensity:new c.D(c.u.light.intensity)}),this._transitionable=new c.x(Lt,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(c.y,e,o))for(const h in e){const m=e[h];h.endsWith(c.z)?this._transitionable.setTransition(h.slice(0,-c.z.length),m):this._transitionable.setValue(h,m)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,h){return(!h||h.validate!==!1)&&c.B(this,e.call(c.C,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:c.u}))}}const Me=new c.t({"sky-color":new c.D(c.u.sky["sky-color"]),"horizon-color":new c.D(c.u.sky["horizon-color"]),"fog-color":new c.D(c.u.sky["fog-color"]),"fog-ground-blend":new c.D(c.u.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.u.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.u.sky["atmosphere-blend"])});class at extends c.E{constructor(e){super(),this._transitionable=new c.x(Me,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0))}setSky(e,o={}){if(!this._validate(c.J,e,o)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const h in e){const m=e[h];h.endsWith(c.z)?this._transitionable.setTransition(h.slice(0,-c.z.length),m):this._transitionable.setValue(h,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,h={}){return(h==null?void 0:h.validate)!==!1&&c.B(this,e.call(c.C,c.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:c.u})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Et{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){const h=e.join(",")+String(o);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(e,o)),this.dashEntry[h]}getDashRanges(e,o,h){const m=[];let b=e.length%2==1?-e[e.length-1]*h:0,C=e[0]*h,R=!0;m.push({left:b,right:C,isDash:R,zeroLength:e[0]===0});let z=e[0];for(let B=1;B<e.length;B++){R=!R;const U=e[B];b=z*h,z+=U,C=z*h,m.push({left:b,right:C,isDash:R,zeroLength:U===0})}return m}addRoundDash(e,o,h){const m=o/2;for(let b=-h;b<=h;b++){const C=this.width*(this.nextRow+h+b);let R=0,z=e[R];for(let B=0;B<this.width;B++){B/z.right>1&&(z=e[++R]);const U=Math.abs(B-z.left),Z=Math.abs(B-z.right),H=Math.min(U,Z);let X;const te=b/h*(m+1);if(z.isDash){const le=m-Math.abs(te);X=Math.sqrt(H*H+le*le)}else X=m-Math.sqrt(H*H+te*te);this.data[C+B]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(e){for(let R=e.length-1;R>=0;--R){const z=e[R],B=e[R+1];z.zeroLength?e.splice(R,1):B&&B.isDash===z.isDash&&(B.left=z.left,e.splice(R,1))}const o=e[0],h=e[e.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);const m=this.width*this.nextRow;let b=0,C=e[b];for(let R=0;R<this.width;R++){R/C.right>1&&(C=e[++b]);const z=Math.abs(R-C.left),B=Math.abs(R-C.right),U=Math.min(z,B);this.data[m+R]=Math.max(0,Math.min(255,(C.isDash?U:-U)+128))}}addDash(e,o){const h=o?7:0,m=2*h+1;if(this.nextRow+m>this.height)return c.w("LineAtlas out of space"),null;let b=0;for(let R=0;R<e.length;R++)b+=e[R];if(b!==0){const R=this.width/b,z=this.getDashRanges(e,this.width,R);o?this.addRoundDash(z,R,h):this.addRegularDash(z)}const C={y:this.nextRow+h,height:2*h,width:b};return this.nextRow+=m,this.dirty=!0,C}bind(e){const o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const Rt="maplibre_preloaded_worker_pool";class $t{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<$t.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((o=>{o.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Rt]}numActive(){return Object.keys(this.active).length}}const Vt=Math.floor(ye.hardwareConcurrency/2);let mn,Nt;function gn(){return mn||(mn=new $t),mn}$t.workerCount=c.K(globalThis)?Math.max(Math.min(Vt,3),1):1;class ei{constructor(e,o){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=o;const h=this.workerPool.acquire(o);for(let m=0;m<h.length;m++){const b=new c.L(h[m],o);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o){const h=[];for(const m of this.actors)h.push(m.sendAsync({type:e,data:o}));return Promise.all(h)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((o=>{o.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,o){for(const h of this.actors)h.registerMessageHandler(e,o)}unregisterMessageHandler(e){for(const o of this.actors)o.unregisterMessageHandler(e)}}function bn(){return Nt||(Nt=new ei(gn(),c.M),Nt.registerMessageHandler("GR",((v,e,o)=>c.m(e,o)))),Nt}function Pi(v,e){const o=c.N();return c.O(o,o,[1,1,0]),c.Q(o,o,[.5*v.width,.5*v.height,1]),v.calculatePosMatrix?c.S(o,o,v.calculatePosMatrix(e.toUnwrapped())):o}function er(v,e,o,h,m,b,C){var R;const z=(function(H,X,te){if(H)for(const le of H){const ce=X[le];if(ce&&ce.source===te&&ce.type==="fill-extrusion")return!0}else for(const le in X){const ce=X[le];if(ce.source===te&&ce.type==="fill-extrusion")return!0}return!1})((R=m==null?void 0:m.layers)!==null&&R!==void 0?R:null,e,v.id),B=b.maxPitchScaleFactor(),U=v.tilesIn(h,B,z);U.sort(wn);const Z=[];for(const H of U)Z.push({wrappedTileID:H.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(e,o,v.getState(),H.queryGeometry,H.cameraQueryGeometry,H.scale,m,b,B,Pi(b,H.tileID),C?(X,te)=>C(H.tileID,X,te):void 0)});return(function(H,X){for(const te in H)for(const le of H[te])ji(le,X);return H})((function(H){const X={},te={};for(const le of H){const ce=le.queryResults,ue=le.wrappedTileID,fe=te[ue]=te[ue]||{};for(const xe in ce){const he=ce[xe],ve=fe[xe]=fe[xe]||{},Te=X[xe]=X[xe]||[];for(const ge of he)ve[ge.featureIndex]||(ve[ge.featureIndex]=!0,Te.push(ge))}}return X})(Z),v)}function wn(v,e){const o=v.tileID,h=e.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}function ji(v,e){const o=v.feature,h=e.getFeatureState(o.layer["source-layer"],o.id);o.source=o.layer.source,o.layer["source-layer"]&&(o.sourceLayer=o.layer["source-layer"]),o.state=h}function sr(v,e,o,h){return c._(this,void 0,void 0,(function*(){let m=v;if(v.url?m=(yield c.j(e.transformRequest(v.url,"Source"),o)).data:yield ye.frameAsync(o,h),!m)return null;const b=c.U(c.e(m,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(b.vectorLayerIds=m.vector_layers.map((C=>C.id))),b}))}class un{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.V?new c.V(e.lng,e.lat):c.V.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.V?new c.V(e.lng,e.lat):c.V.convert(e),this}extend(e){const o=this._sw,h=this._ne;let m,b;if(e instanceof c.V)m=e,b=e;else{if(!(e instanceof un))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(un.convert(e)):this.extend(c.V.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.V.convert(e)):this;if(m=e._sw,b=e._ne,!m||!b)return this}return o||h?(o.lng=Math.min(m.lng,o.lng),o.lat=Math.min(m.lat,o.lat),h.lng=Math.max(b.lng,h.lng),h.lat=Math.max(b.lat,h.lat)):(this._sw=new c.V(m.lng,m.lat),this._ne=new c.V(b.lng,b.lat)),this}getCenter(){return new c.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.V(this.getWest(),this.getNorth())}getSouthEast(){return new c.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:h}=c.V.convert(e);let m=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&m}intersects(e){if(!((e=un.convert(e)).getNorth()>=this.getSouth()&&e.getSouth()<=this.getNorth()))return!1;const o=Math.abs(this.getEast()-this.getWest()),h=Math.abs(e.getEast()-e.getWest());if(o>=360||h>=360)return!0;const m=c.W(this.getWest(),-180,180),b=c.W(this.getEast(),-180,180),C=c.W(e.getWest(),-180,180),R=c.W(e.getEast(),-180,180),z=m>=b,B=C>=R;return!(!z||!B)||(z?R>=m||C<=b:B?b>=C||m<=R:C<=b&&R>=m)}static convert(e){return e instanceof un?e:e&&new un(e)}static fromLngLat(e,o=0){const h=360*o/40075017,m=h/Math.cos(Math.PI/180*e.lat);return new un(new c.V(e.lng-m,e.lat-h),new c.V(e.lng+m,e.lat+h))}adjustAntiMeridian(){const e=new c.V(this._sw.lng,this._sw.lat),o=new c.V(this._ne.lng,this._ne.lat);return new un(e,e.lng>o.lng?new c.V(o.lng+360,o.lat):o)}}class ar{constructor(e,o,h){this.bounds=un.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const o=Math.pow(2,e.z),h=Math.floor(c.Y(this.bounds.getWest())*o),m=Math.floor(c.X(this.bounds.getNorth())*o),b=Math.ceil(c.Y(this.bounds.getEast())*o),C=Math.ceil(c.X(this.bounds.getSouth())*o);return e.x>=h&&e.x<b&&e.y>=m&&e.y<C}}class wo extends c.E{constructor(e,o,h,m){if(super(),this.id=e,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.U(o,["url","scheme","tileSize","promoteId","encoding"])),this._options=c.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield sr(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new ar(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,c.Z(e)||this.fire(new c.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(o,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(e)};h.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((b,C)=>{e.reloadPromise={resolve:b,reject:C}}))}else e.actor=this.dispatcher.getActor(),m="LT";e.abortController=new AbortController;try{const b=yield e.actor.sendAsync({type:m,data:h},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,b)}catch(b){if(delete e.abortController,e.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(e,null)}}))}_getOverzoomParameters(e){if(e.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const o=e.tileID.scaledTo(this.maxzoom).canonical,h=o.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:o,overzoomRequest:this.map._requestManager.transformRequest(h,"Tile")}}_afterTileLoadWorkerResponse(e,o){if(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.reloadPromise){const h=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(h.resolve).catch(h.reject)}}abortTile(e){return c._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Ho extends c.E{constructor(e,o,h,m){super(),this.id=e,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},o),c.e(this,c.U(o,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield sr(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,o&&(c.e(this,o),o.bounds&&(this.tileBounds=new ar(o.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(o){this._tileJSONRequest=null,this._loaded=!0,c.Z(o)||this.fire(new c.k(o))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const h=yield _t.getImage(this.map._requestManager.transformRequest(o,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const m=this.map.painter.context,b=m.gl,C=h.data;e.texture=this.map.painter.getTileTexture(C.width),e.texture?e.texture.update(C,{useMipmap:!0}):(e.texture=new c.T(m,C,b.RGBA,{useMipmap:!0}),e.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}}))}abortTile(e){return c._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class Dr extends Ho{constructor(e,o,h,m){super(e,o,h,m),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e){return c._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(o,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const m=yield _t.getImage(h,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&e.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const C=c.b(b)&&c.$()?b:yield this.readImageNow(b),R={type:this.type,uid:e.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const z=yield e.actor.sendAsync({type:"LDT",data:R});e.dem=z,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(m){if(delete e.abortController,e.aborted)e.state="unloaded";else if(m)throw e.state="errored",m}}))}readImageNow(e){return c._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&c.a0()){const o=e.width+2,h=e.height+2;try{return new c.R({width:o,height:h},yield c.a1(e,-1,-1,o,h))}catch{}}return ye.getImageData(e,1)}))}_getNeighboringTiles(e){const o=e.canonical,h=Math.pow(2,o.z),m=(o.x-1+h)%h,b=o.x===0?e.wrap-1:e.wrap,C=(o.x+1+h)%h,R=o.x+1===h?e.wrap+1:e.wrap,z={};return z[new c.a2(e.overscaledZ,b,o.z,m,o.y).key]={backfilled:!1},z[new c.a2(e.overscaledZ,R,o.z,C,o.y).key]={backfilled:!1},o.y>0&&(z[new c.a2(e.overscaledZ,b,o.z,m,o.y-1).key]={backfilled:!1},z[new c.a2(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},z[new c.a2(e.overscaledZ,R,o.z,C,o.y-1).key]={backfilled:!1}),o.y+1<h&&(z[new c.a2(e.overscaledZ,b,o.z,m,o.y+1).key]={backfilled:!1},z[new c.a2(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},z[new c.a2(e.overscaledZ,R,o.z,C,o.y+1).key]={backfilled:!1}),z}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}function io(v){return v.type==="GeometryCollection"?v.geometries.map((e=>e.coordinates)).flat(1/0):v.coordinates.flat(1/0)}function Bs(v){const e=new un;let o;switch(v.type){case"FeatureCollection":o=v.features.map((h=>io(h.geometry))).flat(1/0);break;case"Feature":o=io(v.geometry);break;default:o=io(v)}if(o.length==0)return e;for(let h=0;h<o.length-1;h+=2)e.extend([o[h],o[h+1]]);return e}class Di extends c.E{constructor(e,o,h,m){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:o.data},this.actor=h.getActor(),this.setEventedParent(m),this._data=typeof o.data=="string"?{url:o.data}:{geojson:o.data},this._options=c.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId,o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(o.buffer!==void 0?o.buffer:128),tolerance:this._pixelsToTileUnits(o.tolerance!==void 0?o.tolerance:.375),extent:c.a5,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(o.clusterMaxZoom),minPoints:Math.max(2,o.clusterMinPoints||2),extent:c.a5,radius:this._pixelsToTileUnits(o.clusterRadius||50),log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(c.a5/this.tileSize)}_getClusterMaxZoom(e){const o=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${o}"`),o}load(){return c._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e,o){this._data=typeof e=="string"?{url:e}:{geojson:e},this._pendingWorkerUpdate={data:e};const h=this._updateWorkerData();return o?h:this}updateData(e,o){this._pendingWorkerUpdate.diff=c.a6(this._pendingWorkerUpdate.diff,e);const h=this._updateWorkerData();return o?h:this}getData(){return c._(this,void 0,void 0,(function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getBounds(){return c._(this,void 0,void 0,(function*(){return Bs(yield this.getData())}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,o,h){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:o,offset:h}})}_updateWorkerData(){return c._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void c.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:e,diff:o}=this._pendingWorkerUpdate,h=this._getLoadGeoJSONParameters(e,o);e!==void 0?this._pendingWorkerUpdate.data=void 0:o&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(h)}))}_getLoadGeoJSONParameters(e,o){const h=c.e({type:this.type},this.workerOptions);return typeof e=="string"?(h.request=this.map._requestManager.transformRequest(ye.resolveURL(e),"Source"),h.request.collectResourceTiming=this._collectResourceTiming,h):e!==void 0?(h.data=e,h):(o&&(h.dataDiff=o),h)}_dispatchWorkerUpdate(e){return c._(this,void 0,void 0,(function*(){this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const o=yield this.actor.sendAsync({type:"LD",data:e});if(this._isUpdatingWorker=!1,this._removed||o.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));o.data&&(this._data={geojson:o.data});const h=this._applyDiffToSource(e.dataDiff),m=this._getShouldReloadTileOptions(h),b={dataType:"source"};this._applyResourceTiming(b,o),this.fire(new c.l("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},b),{sourceDataType:"content",shouldReloadTileOptions:m})))}catch(o){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(o))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyResourceTiming(e,o){var h;if(!this._collectResourceTiming)return;const m=(h=o.resourceTiming)===null||h===void 0?void 0:h[this.id];if(!m)return;const b=m.slice(0);b!=null&&b.length&&c.e(e,{resourceTiming:b})}_applyDiffToSource(e){if(!e)return;const o=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const m=c.a7(this._data.geojson,o);if(!m)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:m}}if(!this._data.updateable)return;const h=c.a8(this._data.updateable,e,o);return e.removeAll||this._options.cluster?void 0:h}_getShouldReloadTileOptions(e){if(e)return{affectedBounds:e.filter(Boolean).map((o=>Bs(o)))}}shouldReloadTile(e,{affectedBounds:o}){if(e.state==="loading")return!0;if(e.state==="unloaded")return!1;const{buffer:h,extent:m}=this.workerOptions.geojsonVtOptions,b=(function({x:C,y:R,z},B=0){const U=c.a3((C-B)/Math.pow(2,z)),Z=c.a4((R+1+B)/Math.pow(2,z)),H=c.a3((C+1+B)/Math.pow(2,z)),X=c.a4((R-B)/Math.pow(2,z));return new un([U,Z],[H,X])})(e.tileID.canonical,h/m);for(const C of o)if(b.intersects(C))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return c._(this,void 0,void 0,(function*(){const o=e.actor?"RT":"LT";e.actor=this.actor;const h={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const m=yield this.actor.sendAsync({type:o,data:h},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(m,this.map.painter,o==="RT")}))}abortTile(e){return c._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return c._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Sr extends c.E{constructor(e,o,h,m){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=h,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=o}load(e){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield _t.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,e&&(this.coordinates=e),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,c.Z(o)||this.fire(new c.k(o))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const o=e.map(c.a9.fromLngLat);var h;return this.tileID=(function(m){const b=c.aa.fromPoints(m),C=b.width(),R=b.height(),z=Math.max(C,R),B=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),U=Math.pow(2,B);return new c.ac(B,Math.floor((b.minX+b.maxX)/2*U),Math.floor((b.minY+b.maxY)/2*U))})(o),this.terrainTileRanges=this._getOverlappingTileRanges(o),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=o.map((m=>this.tileID.getTilePoint(m)._round())),this.flippedWindingOrder=((h=this.tileCoords)[1].x-h[0].x)*(h[2].y-h[0].y)-(h[1].y-h[0].y)*(h[2].x-h[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,o=e.gl;this.texture||(this.texture=new c.T(e,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,h=!0)}h&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:o,minY:h,maxX:m,maxY:b}=c.aa.fromPoints(e),C={};for(let R=0;R<=c.ab;R++){const z=Math.pow(2,R),B=Math.floor(o*z),U=Math.floor(h*z),Z=Math.floor(m*z),H=Math.floor(b*z),X=(B%z+z)%z,te=Z%z,le=Math.floor(B/z),ce=Math.floor(Z/z);C[R]={minWrap:le,maxWrap:ce,minTileXWrapped:X,maxTileXWrapped:te,minTileY:U,maxTileY:H}}return C}}class Os extends Sr{constructor(e,o,h,m){super(e,o,h,m),this.roundZoom=!0,this.type="video",this.options=o}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const o of e.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield c.ad(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new c.k(o))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new c.k(new c.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,o=e.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(e,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,h=!0)}h&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ll extends Sr{constructor(e,o,h,m){super(e,o,h,m),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some((b=>!Array.isArray(b)||b.length!==2||b.some((C=>typeof C!="number"))))||this.fire(new c.k(new c.ae(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.ae(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new c.k(new c.ae(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.ae(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.ae(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,h=o.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new c.T(o,this.canvas,h.RGBA,{premultiply:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let m=!1;for(const b in this.tiles){const C=this.tiles[b];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,m=!0)}m&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Us={},Nl=v=>{switch(v){case"geojson":return Di;case"image":return Sr;case"raster":return Ho;case"raster-dem":return Dr;case"vector":return wo;case"video":return Os;case"canvas":return Ll}return Us[v]},Re="RTLPluginLoaded";class W extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=bn()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((o=>{throw this.status="error",o}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,(function*(o,h=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ye.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!h)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return c._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(Re))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Q=null;function ne(){return Q||(Q=new W),Q}var me,we;(function(v){v[v.Base=0]="Base",v[v.Parent=1]="Parent"})(me||(me={})),(function(v){v[v.Departing=0]="Departing",v[v.Incoming=1]="Incoming"})(we||(we={}));class Pe{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=c.af(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:o,fadingParentID:h,fadeEndTime:m}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=o,this.fadingParentID=h,this.fadeEndTime=m}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=Ne(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData,this.latestFeatureIndex.encoding=e.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(m,b){const C={};if(!b)return C;for(const R of m){const z=R.layerIds.map((B=>b.getLayer(B))).filter(Boolean);if(z.length!==0){R.layers=z,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map((B=>z.filter((U=>U.id===B))[0])));for(const B of z)C[B.id]=R}}return C})(e.buckets,o==null?void 0:o.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof c.ah){if(this.hasSymbolBuckets=!0,!h)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof c.ah&&b.hasRTLText){this.hasRTLText=!0,ne().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(m).queryRadius(b))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new c.ag}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const h in this.buckets){const m=this.buckets[h];m.uploadPending()&&m.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,h,m,b,C,R,z,B,U,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:C,tileSize:this.tileSize,pixelPosMatrix:U,transform:z,params:R,queryPadding:this.queryPadding*B,getElevation:Z},e,o,h):{}}querySourceFeatures(e,o){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const m=h.loadVTLayers(),b=o&&o.sourceLayer?o.sourceLayer:"",C=m[c.ai]||m[b];if(!C)return;const R=c.aj(o==null?void 0:o.filter,o==null?void 0:o.globalState),{z,x:B,y:U}=this.tileID.canonical,Z={z,x:B,y:U};for(let H=0;H<C.length;H++){const X=C.feature(H);if(R.needGeometry){const ce=c.ak(X,!0);if(!R.filter(new c.H(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!R.filter(new c.H(this.tileID.overscaledZ),X))continue;const te=h.getId(X,b),le=new c.al(X,z,B,U,te);le.tile=Z,e.push(le)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const h=c.am(e.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const h=Date.now();let m=!1;if(this.expirationTime>h)m=!1;else if(o)if(this.expirationTime<o)m=!0;else{const b=this.expirationTime-o;b?this.expirationTime=h+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!o.style.hasLayer(m))continue;const b=this.buckets[m],C=b.layers[0].sourceLayer||c.ai,R=h[C],z=e[C];if(!R||!z||Object.keys(z).length===0)continue;b.update(z,R,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const B=o&&o.style&&o.style.getLayer(m);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(b)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ne()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=Ne()+e}setDependencies(e,o){const h={};for(const m of o)h[m]=!0;this.dependencies[e]=h}hasDependency(e,o){for(const h of e){const m=this.dependencies[h];if(m){for(const b of o)if(m[b])return!0}}return!1}}class Be{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,h){const m=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][m]=this.stateChanges[e][m]||{},c.e(this.stateChanges[e][m],h),this.deletedStates[e]===null){this.deletedStates[e]={};for(const b in this.state[e])b!==m&&(this.deletedStates[e][b]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][m]===null){this.deletedStates[e][m]={};for(const b in this.state[e][m])h[b]||(this.deletedStates[e][m][b]=null)}else for(const b in h)this.deletedStates[e]&&this.deletedStates[e][m]&&this.deletedStates[e][m][b]===null&&delete this.deletedStates[e][m][b]}removeFeatureState(e,o,h){if(this.deletedStates[e]===null)return;const m=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},h&&o!==void 0)this.deletedStates[e][m]!==null&&(this.deletedStates[e][m]=this.deletedStates[e][m]||{},this.deletedStates[e][m][h]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][m])for(h in this.deletedStates[e][m]={},this.stateChanges[e][m])this.deletedStates[e][m][h]=null;else this.deletedStates[e][m]=null;else this.deletedStates[e]=null}getState(e,o){const h=String(o),m=c.e({},(this.state[e]||{})[h],(this.stateChanges[e]||{})[h]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const b=this.deletedStates[e][o];if(b===null)return{};for(const C in b)delete m[C]}return m}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const h={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const C in this.stateChanges[m])this.state[m][C]||(this.state[m][C]={}),c.e(this.state[m][C],this.stateChanges[m][C]),b[C]=this.state[m][C];h[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const C in this.state[m])b[C]={},this.state[m][C]={};else for(const C in this.deletedStates[m]){if(this.deletedStates[m][C]===null)this.state[m][C]={};else for(const R of Object.keys(this.deletedStates[m][C]))delete this.state[m][C][R];b[C]=this.state[m][C]}h[m]=h[m]||{},c.e(h[m],b)}this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0&&e.setFeatureState(h,o)}}const Ee=89.25;function De(v,e){const o=c.an(e.lat,-c.ao,c.ao);return new c.P(c.Y(e.lng)*v,c.X(o)*v)}function et(v,e){return new c.a9(e.x/v,e.y/v).toLngLat()}function $e(v){return v.cameraToCenterDistance*Math.min(.85*Math.tan(c.ap(90-v.pitch)),Math.tan(c.ap(Ee-v.pitch)))}function ut(v,e){const o=v.canonical,h=e/c.aq(o.z),m=o.x+Math.pow(2,o.z)*v.wrap,b=c.ar(new Float64Array(16));return c.O(b,b,[m*h,o.y*h,0]),c.Q(b,b,[h/c.a5,h/c.a5,1]),b}function Ce(v,e,o,h,m){const b=c.a9.fromLngLat(v,e),C=m*c.as(1,v.lat),{x:R,y:z,z:B}=Ht(o,h);return new c.a9(b.x+C*-R,b.y+C*-z,b.z+C*-B)}function Ht(v,e){const o=c.ap(v),h=c.ap(e),m=Math.cos(-o),b=Math.sin(o);return{x:b*Math.sin(h),y:-b*Math.cos(h),z:m}}function Fn(v,e,o){const h=e.intersectsFrustum(v);if(!o||h===0)return h;const m=e.intersectsPlane(o);return m===0?0:h===2&&m===2?2:1}function Mt(v,e,o){let h=0;const m=(o-e)/10;for(let b=0;b<10;b++)h+=m*Math.pow(Math.cos(e+(b+.5)/10*(o-e)),v);return h}function Ot(v,e){return function(o,h,m,b,C){const R=2*((v-1)/c.at(Math.cos(c.ap(Ee-C))/Math.cos(c.ap(Ee)))-1),z=Math.acos(m/b),B=2*Mt(R-1,0,c.ap(C/2)),U=Math.min(c.ap(Ee),z+c.ap(C/2)),Z=Mt(R-1,Math.min(U,z-c.ap(C/2)),U),H=Math.atan(h/m),X=Math.hypot(h,m);let te=o;return te+=c.at(b/X/Math.max(.5,Math.cos(c.ap(C/2)))),te+=R*c.at(Math.cos(H))/2,te-=c.at(Math.max(1,Z/B/e))/2,te}}const Jt=Ot(9.314,3);function Nn(v,e){const o=(e.roundZoom?Math.round:Math.floor)(v.zoom+c.at(v.tileSize/e.tileSize));return Math.max(0,o)}function ii(v,e){const o=v.getCameraFrustum(),h=v.getClippingPlane(),m=v.screenPointToMercatorCoordinate(v.getCameraPoint()),b=c.a9.fromLngLat(v.center,v.elevation);m.z=b.z+Math.cos(v.pitchInRadians)*v.cameraToCenterDistance/v.worldSize;const C=v.getCoveringTilesDetailsProvider(),R=C.allowVariableZoom(v,e),z=Nn(v,e),B=e.minzoom||0,U=e.maxzoom!==void 0?e.maxzoom:v.maxZoom,Z=Math.min(Math.max(0,z),U),H=Math.pow(2,Z),X=[H*m.x,H*m.y,0],te=[H*b.x,H*b.y,0],le=Math.hypot(b.x-m.x,b.y-m.y),ce=Math.abs(b.z-m.z),ue=Math.hypot(le,ce),fe=ve=>({zoom:0,x:0,y:0,wrap:ve,fullyVisible:!1}),xe=[],he=[];if(v.renderWorldCopies&&C.allowWorldCopies())for(let ve=1;ve<=3;ve++)xe.push(fe(-ve)),xe.push(fe(ve));for(xe.push(fe(0));xe.length>0;){const ve=xe.pop(),Te=ve.x,ge=ve.y;let Ae=ve.fullyVisible;const Ve={x:Te,y:ge,z:ve.zoom},ke=C.getTileBoundingVolume(Ve,ve.wrap,v.elevation,e);if(!Ae){const mt=Fn(o,ke,h);if(mt===0)continue;Ae=mt===2}const Oe=C.distanceToTile2d(m.x,m.y,Ve,ke);let Ue=z;R&&(Ue=(e.calculateTileZoom||Jt)(v.zoom+c.at(v.tileSize/e.tileSize),Oe,ce,ue,v.fov)),Ue=(e.roundZoom?Math.round:Math.floor)(Ue),Ue=Math.max(0,Ue);const pt=Math.min(Ue,U);if(ve.wrap=C.getWrap(b,Ve,ve.wrap),ve.zoom>=pt){if(ve.zoom<B)continue;const mt=Z-ve.zoom,ot=X[0]-.5-(Te<<mt),vt=X[1]-.5-(ge<<mt),Wt=e.reparseOverscaled?Math.max(ve.zoom,Ue):ve.zoom;he.push({tileID:new c.a2(ve.zoom===U?Wt:ve.zoom,ve.wrap,ve.zoom,Te,ge),distanceSq:c.au([te[0]-.5-Te,te[1]-.5-ge]),tileDistanceToCamera:Math.sqrt(ot*ot+vt*vt)})}else for(let mt=0;mt<4;mt++)xe.push({zoom:ve.zoom+1,x:(Te<<1)+mt%2,y:(ge<<1)+(mt>>1),wrap:ve.wrap,fullyVisible:Ae})}return he.sort(((ve,Te)=>ve.distanceSq-Te.distanceSq)).map((ve=>ve.tileID))}const Yi=c.aa.fromPoints([new c.P(0,0),new c.P(c.a5,c.a5)]);function Xi(v){return v==="raster"||v==="image"||v==="video"}function _i(v,e,o,h,m,b,C){if(!e.hasData())return!1;const{tileID:R,fadingRole:z,fadingDirection:B,fadingParentID:U}=e;if(z===me.Base&&B===we.Incoming&&U)return o[U.key]=U,!0;const Z=Math.max(R.overscaledZ-m,b);for(let H=R.overscaledZ-1;H>=Z;H--){const X=R.scaledTo(H),te=v.getLoadedTile(X);if(te)return e.setCrossFadeLogic({fadingRole:me.Base,fadingDirection:we.Incoming,fadingParentID:te.tileID,fadeEndTime:h+C}),te.setCrossFadeLogic({fadingRole:me.Parent,fadingDirection:we.Departing,fadeEndTime:h+C}),o[X.key]=X,!0}return!1}function Oi(v,e,o,h,m,b){if(!e.hasData())return!1;const C=e.tileID.children(m);let R=it(v,e,C,o,h,m,b);if(R)return!0;for(const z of C)it(v,e,z.children(m),o,h,m,b)&&(R=!0);return R}function it(v,e,o,h,m,b,C){if(o[0].overscaledZ>=b)return!1;let R=!1;for(const z of o){const B=v.getLoadedTile(z);if(!B)continue;const{fadingRole:U,fadingDirection:Z,fadingParentID:H}=B;U===me.Base&&Z===we.Departing&&H||(B.setCrossFadeLogic({fadingRole:me.Base,fadingDirection:we.Departing,fadingParentID:e.tileID,fadeEndTime:m+C}),e.setCrossFadeLogic({fadingRole:me.Parent,fadingDirection:we.Incoming,fadeEndTime:m+C})),h[z.key]=z,R=!0}return R}function zi(v,e,o,h){const m=v.tileID;return!!v.selfFading||!v.hasData()&&!!e.has(m)&&(v.setSelfFadeLogic(o+h),!0)}function zr(v,e){var o;v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let h=e.tileID.canonical.x-v.tileID.canonical.x;const m=e.tileID.canonical.y-v.tileID.canonical.y,b=Math.pow(2,v.tileID.canonical.z),C=e.tileID.key;h===0&&m===0||Math.abs(m)>1||(Math.abs(h)>1&&(Math.abs(h+b)===1?h+=b:Math.abs(h-b)===1&&(h-=b)),e.dem&&v.dem&&(v.dem.backfillBorder(e.dem,h,m),!((o=v.neighboringTiles)===null||o===void 0)&&o[C]&&(v.neighboringTiles[C].backfilled=!0)))}class Gr{constructor(){this._tiles={}}handleWrapJump(e){const o={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+e),o[m.tileID.key]=m}this._tiles=o}setFeatureState(e,o){for(const h in this._tiles)this._tiles[h].setFeatureState(e,o)}getAllTiles(){return Object.values(this._tiles)}getAllIds(e=!1){return e?Object.values(this._tiles).map((o=>o.tileID)).sort(c.aw).map((o=>o.key)):Object.keys(this._tiles)}getTileById(e){return this._tiles[e]}setTile(e,o){this._tiles[e]=o}deleteTileById(e){delete this._tiles[e]}getLoadedTile(e){const o=this.getTileById(e.key);return o!=null&&o.hasData()?o:null}isIdRenderable(e,o=!1){var h;return(h=this.getTileById(e))===null||h===void 0?void 0:h.isRenderable(o)}getRenderableIds(e=0,o){const h=[];for(const m of this.getAllIds())this.isIdRenderable(m,o)&&h.push(this.getTileById(m));return o?h.sort(((m,b)=>{const C=m.tileID,R=b.tileID,z=new c.P(C.canonical.x,C.canonical.y)._rotate(-e),B=new c.P(R.canonical.x,R.canonical.y)._rotate(-e);return C.overscaledZ-R.overscaledZ||B.y-z.y||B.x-z.x})).map((m=>m.tileID.key)):h.map((m=>m.tileID)).sort(c.aw).map((m=>m.key))}}class vn extends c.E{constructor(e,o,h){super(),this.id=e,this.dispatcher=h,this.on("data",(m=>this._dataHandler(m))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((m,b,C,R)=>{const z=new(Nl(b.type))(m,b,C,R);if(z.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${z.id}`);return z})(e,o,h,this),this._inViewTiles=new Gr,this._outOfViewCache=new c.ax(0,(m=>this._unloadTile(m))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Be,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){for(const o of this._inViewTiles.getAllTiles())o.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e),this._inViewTiles=new Gr}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e of this._inViewTiles.getAllTiles())if(e.state!=="loaded"&&e.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o,h){return c._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,o,h)}catch(m){e.state="errored",m.status!==404?this._source.fire(new c.k(m,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const o of this._inViewTiles.getAllTiles())o.upload(e),o.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(e){var o;return this._inViewTiles.getRenderableIds((o=this.transform)===null||o===void 0?void 0:o.bearingInRadians,e)}hasRenderableParent(e){const o=e.overscaledZ-1;if(o>=this._source.minzoom){const h=this.getLoadedTile(e.scaledTo(o));if(h)return this._inViewTiles.isIdRenderable(h.tileID.key)}return!1}reload(e,o=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const h of this._inViewTiles.getAllIds()){const m=this._inViewTiles.getTileById(h);o&&!this._source.shouldReloadTile(m,o)||(e?this._reloadTile(h,"expired"):m.state!=="errored"&&this._reloadTile(h,"reloading"))}}}_reloadTile(e,o){return c._(this,void 0,void 0,(function*(){const h=this._inViewTiles.getTileById(e);h&&(h.state!=="loading"&&(h.state=o),yield this._loadTile(h,e,o))}))}_tileLoaded(e,o,h){e.timeAdded=Ne(),e.selfFading&&(e.fadeEndTime=e.timeAdded+this._rasterFadeDuration),h==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&(function(m,b){var C,R;const z=b.getRenderableIds();for(const B of z){if(!m.neighboringTiles||!m.neighboringTiles[B])continue;const U=b.getTileById(B);m.neighboringTiles[B].backfilled||zr(m,U),!((R=(C=U.neighboringTiles)===null||C===void 0?void 0:C[m.tileID.key])===null||R===void 0)&&R.backfilled||zr(U,m)}})(e,this._inViewTiles),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:e,coord:e.tileID}))}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._inViewTiles.getTileById(e)}_retainLoadedChildren(e,o){const h=this._getLoadedDescendents(o),m=new Set;for(const b of o){const C=h[b.key];if(!(C!=null&&C.length)){m.add(b);continue}const R=b.overscaledZ+vn.maxOverzooming,z=C.filter((Z=>Z.tileID.overscaledZ<=R));if(!z.length){m.add(b);continue}const B=Math.min(...z.map((Z=>Z.tileID.overscaledZ))),U=z.filter((Z=>Z.tileID.overscaledZ===B)).map((Z=>Z.tileID));for(const Z of U)e[Z.key]=Z;this._areDescendentsComplete(U,B,b.overscaledZ)||m.add(b)}return m}_getLoadedDescendents(e){var o;const h={};for(const m of this._inViewTiles.getAllTiles().filter((b=>b.hasData())))for(const b of e)m.tileID.isChildOf(b)&&(h[o=b.key]||(h[o]=[])).push(m);return h}_areDescendentsComplete(e,o,h){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===o:Math.pow(4,o-h)===e.length}getLoadedTile(e){return this._inViewTiles.getLoadedTile(e)}updateCacheSize(e){const o=Math.ceil(e.width/this._source.tileSize)+1,h=Math.ceil(e.height/this._source.tileSize)+1,m=Math.floor(o*h*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._outOfViewCache.setMaxSize(b)}handleWrapJump(e){const o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);this._prevLng=e,o&&(this._inViewTiles.handleWrapJump(o),this._resetTileReloadTimers())}update(e,o){if(!this._sourceLoaded||this._paused)return;let h;this.transform=e,this.terrain=o,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((z=>new c.a2(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y))):(h=ii(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?e.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(h=h.filter((z=>this._source.hasTile(z))))):h=[],this.usedForTerrain&&(h=this._addTerrainIdealTiles(h));const m=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,m&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const b=Nn(e,this._source),C=this._updateRetainedTiles(h,b),R=Xi(this._source.type);R&&this._rasterFadeDuration>0&&!o&&(function(z,B,U,Z,H,X,te){const le=Ne(),ce=c.av(B);for(const ue of B){const fe=z.getTileById(ue.key);fe.fadingDirection!==we.Departing&&fe.fadeOpacity!==0||fe.resetFadeLogic(),_i(z,fe,U,le,Z,H,te)||Oi(z,fe,U,le,X,te)||zi(fe,ce,le,te)||fe.resetFadeLogic()}})(this._inViewTiles,h,C,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),R?this._cleanUpRasterTiles(C):this._cleanUpVectorTiles(C)}_cleanUpRasterTiles(e){for(const o of this._inViewTiles.getAllIds())e[o]||this._removeTile(o)}_cleanUpVectorTiles(e){for(const o of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(o);e[o]?h.clearSymbolFadeHold():h.hasSymbolBuckets?h.holdingForSymbolFade()?h.symbolFadeFinished()&&this._removeTile(o):h.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(o)}}_addTerrainIdealTiles(e){const o=[];for(const h of e)if(h.canonical.z>this._source.minzoom){const m=h.scaledTo(h.canonical.z-1);o.push(m);const b=h.scaledTo(Math.max(this._source.minzoom,Math.min(h.canonical.z,5)));o.push(b)}return e.concat(o)}releaseSymbolFadeTiles(){for(const e of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(e).holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){var h;const m=new Set;for(const B of e)this._addTile(B).hasData()||m.add(B);const b=e.reduce(((B,U)=>(B[U.key]=U,B)),{}),C=this._retainLoadedChildren(b,m),R={},z=Math.max(o-vn.maxUnderzooming,this._source.minzoom);for(const B of C){let U=this._inViewTiles.getTileById(B.key),Z=U==null?void 0:U.wasRequested();for(let H=B.overscaledZ-1;H>=z;--H){const X=B.scaledTo(H);if(R[X.key])break;if(R[X.key]=!0,U=this.getTile(X),!U&&Z&&(U=this._addTile(X)),U){const te=U.hasData();if((te||!(!((h=this.map)===null||h===void 0)&&h.cancelPendingTileRequestsWhileZooming)||Z)&&(b[X.key]=X),Z=U.wasRequested(),te)break}}}return b}_addTile(e){let o=this._inViewTiles.getTileById(e.key);if(o)return o;o=this._outOfViewCache.getAndRemove(e),o&&(o.resetFadeLogic(),this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null));const h=o;return o||(o=new Pe(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,e.key,o.state)),o.uses++,this._inViewTiles.setTile(e.key,o),h||this._source.fire(new c.l("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){this._clearTileReloadTimer(e);const h=o.getExpiryTimeout();h&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),h))}_clearTileReloadTimer(e){const o=this._timers[e];o&&(clearTimeout(o),delete this._timers[e])}_resetTileReloadTimers(){for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e of this._inViewTiles.getAllIds()){const o=this._inViewTiles.getTileById(e);this._setTileReloadTimer(e,o)}}refreshTiles(e){for(const o of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(o);(this._inViewTiles.isIdRenderable(o)||h.state=="errored")&&e.some((m=>m.equals(h.tileID.canonical)))&&this._reloadTile(o,"expired")}}_removeTile(e){const o=this._inViewTiles.getTileById(e);o&&(o.uses--,this._inViewTiles.deleteTileById(e),this._clearTileReloadTimer(e),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._outOfViewCache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(e){e.dataType==="source"&&(e.sourceDataType!=="metadata"?e.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged,e.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e of this._inViewTiles.getAllIds())this._removeTile(e);this._outOfViewCache.reset()}tilesIn(e,o,h){const m=[],b=this.transform;if(!b)return m;const C=b.getCoveringTilesDetailsProvider().allowWorldCopies(),R=h?b.getCameraQueryGeometry(e):e,z=X=>b.screenPointToMercatorCoordinate(X,this.terrain),B=this.transformBbox(e,z,!C),U=this.transformBbox(R,z,!C),Z=this.getIds(),H=c.aa.fromPoints(U);for(let X=0;X<Z.length;X++){const te=this._inViewTiles.getTileById(Z[X]);if(te.holdingForSymbolFade())continue;const le=C?[te.tileID]:[te.tileID.unwrapTo(-1),te.tileID.unwrapTo(0)],ce=Math.pow(2,b.zoom-te.tileID.overscaledZ),ue=o*te.queryPadding*c.a5/te.tileSize/ce;for(const fe of le){const xe=H.map((he=>fe.getTilePoint(new c.a9(he.x,he.y))));if(xe.expandBy(ue),xe.intersects(Yi)){const he=B.map((Te=>fe.getTilePoint(Te))),ve=U.map((Te=>fe.getTilePoint(Te)));m.push({tile:te,tileID:C?fe:fe.unwrapTo(0),queryGeometry:he,cameraQueryGeometry:ve,scale:ce})}}}return m}transformBbox(e,o,h){let m=e.map(o);if(h){const b=c.aa.fromPoints(e);b.shrinkBy(.001*Math.min(b.width(),b.height()));const C=b.map(o);c.aa.fromPoints(m).covers(C)||(m=m.map((R=>R.x>.5?new c.a9(R.x-1,R.y,R.z):R)))}return m}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map((h=>this._inViewTiles.getTileById(h).tileID));return this.transform&&this.transform.populateCache(o),o}hasTransition(){return!!this._source.hasTransition()||!(!Xi(this._source.type)||!(function(e,o){if(o<=0)return!1;const h=Ne();for(const m of e.getAllTiles())if(m.fadeEndTime>=h)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,o,h){this._state.updateState(e=e||c.ai,o,h)}removeFeatureState(e,o,h){this._state.removeFeatureState(e=e||c.ai,o,h)}getFeatureState(e,o){return this._state.getState(e=e||c.ai,o)}setDependencies(e,o,h){const m=this._inViewTiles.getTileById(e);m&&m.setDependencies(o,h)}reloadTilesForDependencies(e,o){for(const h of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(h).hasDependency(e,o)&&this._reloadTile(h,"reloading");this._outOfViewCache.filter((h=>!h.hasDependency(e,o)))}areTilesLoaded(){for(const e of this._inViewTiles.getAllTiles())if(e.state!=="loaded"&&e.state!=="errored")return!1;return!0}}vn.maxUnderzooming=10,vn.maxOverzooming=3;class dt{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.an(e,0,1);let o=1,h=this._distances[o];const m=e*this.paddedLength+this.padding;for(;h<m&&o<this._distances.length;)h=this._distances[++o];const b=o-1,C=this._distances[b],R=h-C,z=R>0?(m-C)/R:0;return this.points[b].mult(1-z).add(this.points[o].mult(z))}}function jt(v,e){let o=!0;return v==="always"||v!=="never"&&e!=="never"||(o=!1),o}class on{constructor(e,o,h){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(e/h),this.yCellCount=Math.ceil(o/h);for(let C=0;C<this.xCellCount*this.yCellCount;C++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,h,m,b){this._forEachCell(o,h,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(e,o,h,m){this._forEachCell(o-m,h-m,o+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(h),this.circles.push(m)}_insertBoxCell(e,o,h,m,b,C){this.boxCells[b].push(C)}_insertCircleCell(e,o,h,m,b,C){this.circleCells[b].push(C)}_query(e,o,h,m,b,C,R){if(h<0||e>this.width||m<0||o>this.height)return[];const z=[];if(e<=0&&o<=0&&this.width<=h&&this.height<=m){if(b)return[{key:null,x1:e,y1:o,x2:h,y2:m}];for(let B=0;B<this.boxKeys.length;B++)z.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const U=this.circles[3*B],Z=this.circles[3*B+1],H=this.circles[3*B+2];z.push({key:this.circleKeys[B],x1:U-H,y1:Z-H,x2:U+H,y2:Z+H})}}else this._forEachCell(e,o,h,m,this._queryCell,z,{hitTest:b,overlapMode:C,seenUids:{box:{},circle:{}}},R);return z}query(e,o,h,m){return this._query(e,o,h,m,!1,null)}hitTest(e,o,h,m,b,C){return this._query(e,o,h,m,!0,b,C).length>0}hitTestCircle(e,o,h,m,b){const C=e-h,R=e+h,z=o-h,B=o+h;if(R<0||C>this.width||B<0||z>this.height)return!1;const U=[];return this._forEachCell(C,z,R,B,this._queryCellCircle,U,{hitTest:!0,overlapMode:m,circle:{x:e,y:o,radius:h},seenUids:{box:{},circle:{}}},b),U.length>0}_queryCell(e,o,h,m,b,C,R,z){const{seenUids:B,hitTest:U,overlapMode:Z}=R,H=this.boxCells[b];if(H!==null){const te=this.bboxes;for(const le of H)if(!B.box[le]){B.box[le]=!0;const ce=4*le,ue=this.boxKeys[le];if(e<=te[ce+2]&&o<=te[ce+3]&&h>=te[ce+0]&&m>=te[ce+1]&&(!z||z(ue))&&(!U||!jt(Z,ue.overlapMode))&&(C.push({key:ue,x1:te[ce],y1:te[ce+1],x2:te[ce+2],y2:te[ce+3]}),U))return!0}}const X=this.circleCells[b];if(X!==null){const te=this.circles;for(const le of X)if(!B.circle[le]){B.circle[le]=!0;const ce=3*le,ue=this.circleKeys[le];if(this._circleAndRectCollide(te[ce],te[ce+1],te[ce+2],e,o,h,m)&&(!z||z(ue))&&(!U||!jt(Z,ue.overlapMode))){const fe=te[ce],xe=te[ce+1],he=te[ce+2];if(C.push({key:ue,x1:fe-he,y1:xe-he,x2:fe+he,y2:xe+he}),U)return!0}}}return!1}_queryCellCircle(e,o,h,m,b,C,R,z){const{circle:B,seenUids:U,overlapMode:Z}=R,H=this.boxCells[b];if(H!==null){const te=this.bboxes;for(const le of H)if(!U.box[le]){U.box[le]=!0;const ce=4*le,ue=this.boxKeys[le];if(this._circleAndRectCollide(B.x,B.y,B.radius,te[ce+0],te[ce+1],te[ce+2],te[ce+3])&&(!z||z(ue))&&!jt(Z,ue.overlapMode))return C.push(!0),!0}}const X=this.circleCells[b];if(X!==null){const te=this.circles;for(const le of X)if(!U.circle[le]){U.circle[le]=!0;const ce=3*le,ue=this.circleKeys[le];if(this._circlesCollide(te[ce],te[ce+1],te[ce+2],B.x,B.y,B.radius)&&(!z||z(ue))&&!jt(Z,ue.overlapMode))return C.push(!0),!0}}}_forEachCell(e,o,h,m,b,C,R,z){const B=this._convertToXCellCoord(e),U=this._convertToYCellCoord(o),Z=this._convertToXCellCoord(h),H=this._convertToYCellCoord(m);for(let X=B;X<=Z;X++)for(let te=U;te<=H;te++)if(b.call(this,e,o,h,m,this.xCellCount*te+X,C,R,z))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,h,m,b,C){const R=m-e,z=b-o,B=h+C;return B*B>R*R+z*z}_circleAndRectCollide(e,o,h,m,b,C,R){const z=(C-m)/2,B=Math.abs(e-(m+z));if(B>z+h)return!1;const U=(R-b)/2,Z=Math.abs(o-(b+U));if(Z>U+h)return!1;if(B<=z||Z<=U)return!0;const H=B-z,X=Z-U;return H*H+X*X<=h*h}}function ro(v,e,o){const h=c.N();if(!v){const{vecSouth:Z,vecEast:H}=cs(e),X=k();X[0]=H[0],X[1]=H[1],X[2]=Z[0],X[3]=Z[1],m=X,(U=(C=(b=X)[0])*(B=b[3])-(z=b[2])*(R=b[1]))&&(m[0]=B*(U=1/U),m[1]=-R*U,m[2]=-z*U,m[3]=C*U),h[0]=X[0],h[1]=X[1],h[4]=X[2],h[5]=X[3]}var m,b,C,R,z,B,U;return c.Q(h,h,[1/o,1/o,1]),h}function Cc(v,e,o,h){if(v){const m=c.N();if(!e){const{vecSouth:b,vecEast:C}=cs(o);m[0]=C[0],m[1]=C[1],m[4]=b[0],m[5]=b[1]}return c.Q(m,m,[h,h,1]),m}return o.pixelsToClipSpaceMatrix}function cs(v){const e=Math.cos(v.rollInRadians),o=Math.sin(v.rollInRadians),h=Math.cos(v.pitchInRadians),m=Math.cos(v.bearingInRadians),b=Math.sin(v.bearingInRadians),C=c.aC();C[0]=-m*h*o-b*e,C[1]=-b*h*o+m*e;const R=c.aD(C);R<1e-9?c.aE(C):c.aF(C,C,1/R);const z=c.aC();z[0]=m*h*e-b*o,z[1]=b*h*e+m*o;const B=c.aD(z);return B<1e-9?c.aE(z):c.aF(z,z,1/B),{vecEast:z,vecSouth:C}}function Qt(v,e,o,h){let m;h?(m=[v,e,h(v,e),1],c.aH(m,m,o)):(m=[v,e,0,1],To(m,m,o));const b=m[3];return{point:new c.P(m[0]/b,m[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function Ga(v,e){return .5+v/e*.5}function hs(v,e){return v.x>=-e[0]&&v.x<=e[0]&&v.y>=-e[1]&&v.y<=e[1]}function Vs(v,e,o,h,m,b,C,R,z,B,U,Z,H){const X=o?v.textSizeData:v.iconSizeData,te=c.ay(X,e.transform.zoom),le=[256/e.width*2+1,256/e.height*2+1],ce=o?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;ce.clear();const ue=v.lineVertexArray,fe=o?v.text.placedSymbolArray:v.icon.placedSymbolArray,xe=e.transform.width/e.transform.height;let he=!1;for(let ve=0;ve<fe.length;ve++){const Te=fe.get(ve);if(Te.hidden||Te.writingMode===c.az.vertical&&!he){ps(Te.numGlyphs,ce);continue}he=!1;const ge=new c.P(Te.anchorX,Te.anchorY),Ae={getElevation:H,pitchedLabelPlaneMatrix:h,lineVertexArray:ue,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ge,unwrappedTileID:z,width:B,height:U,translation:Z},Ve=Fl(Te.anchorX,Te.anchorY,Ae);if(!hs(Ve.point,le)){ps(Te.numGlyphs,ce);continue}const ke=Ga(e.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),Oe=c.aA(X,te,Te),Ue=b?Oe*e.transform.getPitchedTextCorrection(Te.anchorX,Te.anchorY,z)/ke:Oe*ke,pt=wi({projectionContext:Ae,pitchedLabelPlaneMatrixInverse:m,symbol:Te,fontSize:Ue,flip:!1,keepUpright:C,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:ce,aspectRatio:xe,rotateToLine:R});he=pt.useVertical,(pt.notEnoughRoom||he||pt.needsFlipping&&wi({projectionContext:Ae,pitchedLabelPlaneMatrixInverse:m,symbol:Te,fontSize:Ue,flip:!0,keepUpright:C,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:ce,aspectRatio:xe,rotateToLine:R}).notEnoughRoom)&&ps(Te.numGlyphs,ce)}o?v.text.dynamicLayoutVertexBuffer.updateData(ce):v.icon.dynamicLayoutVertexBuffer.updateData(ce)}function ds(v,e,o,h,m,b,C,R){const z=b.glyphStartIndex+b.numGlyphs,B=b.lineStartIndex,U=b.lineStartIndex+b.lineLength,Z=e.getoffsetX(b.glyphStartIndex),H=e.getoffsetX(z-1),X=Zo(v*Z,o,h,m,b.segment,B,U,R,C);if(!X)return null;const te=Zo(v*H,o,h,m,b.segment,B,U,R,C);return te?R.projectionCache.anyProjectionOccluded?null:{first:X,last:te}:null}function fs(v,e,o,h){return v===c.az.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*h?{useVertical:!0}:(v===c.az.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function wi(v){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:o,symbol:h,fontSize:m,flip:b,keepUpright:C,glyphOffsetArray:R,dynamicLayoutVertexArray:z,aspectRatio:B,rotateToLine:U}=v,Z=m/24,H=h.lineOffsetX*Z,X=h.lineOffsetY*Z;let te;if(h.numGlyphs>1){const le=h.glyphStartIndex+h.numGlyphs,ce=h.lineStartIndex,ue=h.lineStartIndex+h.lineLength,fe=ds(Z,R,H,X,b,h,U,e);if(!fe)return{notEnoughRoom:!0};const xe=Gs(fe.first.point.x,fe.first.point.y,e,o),he=Gs(fe.last.point.x,fe.last.point.y,e,o);if(C&&!b){const ve=fs(h.writingMode,xe,he,B);if(ve)return ve}te=[fe.first];for(let ve=h.glyphStartIndex+1;ve<le-1;ve++){const Te=Zo(Z*R.getoffsetX(ve),H,X,b,h.segment,ce,ue,e,U);if(!Te)return{notEnoughRoom:!0};te.push(Te)}te.push(fe.last)}else{if(C&&!b){const ce=Sn(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,ue=h.lineStartIndex+h.segment+1,fe=new c.P(e.lineVertexArray.getx(ue),e.lineVertexArray.gety(ue)),xe=Sn(fe.x,fe.y,e),he=xe.signedDistanceFromCamera>0?xe.point:kl(e.tileAnchorPoint,fe,ce,1,e),ve=Gs(ce.x,ce.y,e,o),Te=Gs(he.x,he.y,e,o),ge=fs(h.writingMode,ve,Te,B);if(ge)return ge}const le=Zo(Z*R.getoffsetX(h.glyphStartIndex),H,X,b,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,e,U);if(!le||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};te=[le]}for(const le of te)c.aG(z,le.point,le.angle);return{}}function kl(v,e,o,h,m){const b=v.add(v.sub(e)._unit()),C=Sn(b.x,b.y,m).point,R=o.sub(C);return o.add(R._mult(h/R.mag()))}function Er(v,e,o){const h=e.projectionCache;if(h.projections[v])return h.projections[v];const m=new c.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),b=Sn(m.x,m.y,e);if(b.signedDistanceFromCamera>0)return h.projections[v]=b.point,h.anyProjectionOccluded=h.anyProjectionOccluded||b.isOccluded,b.point;const C=v-o.direction;return kl(o.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(C),e.lineVertexArray.gety(C)),m,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,e)}function Sn(v,e,o){const h=v+o.translation[0],m=e+o.translation[1];let b;return o.pitchWithMap?(b=Qt(h,m,o.pitchedLabelPlaneMatrix,o.getElevation),b.isOccluded=!1):(b=o.transform.projectTileCoordinates(h,m,o.unwrappedTileID,o.getElevation),b.point.x=(.5*b.point.x+.5)*o.width,b.point.y=(.5*-b.point.y+.5)*o.height),b}function Gs(v,e,o,h){if(o.pitchWithMap){const m=[v,e,0,1];return c.aH(m,m,h),o.transform.projectTileCoordinates(m[0]/m[3],m[1]/m[3],o.unwrappedTileID,o.getElevation).point}return{x:v/o.width*2-1,y:1-e/o.height*2}}function Fl(v,e,o){return o.transform.projectTileCoordinates(v,e,o.unwrappedTileID,o.getElevation)}function Bl(v,e,o){return v._unit()._perp()._mult(e*o)}function ha(v,e,o,h,m,b,C,R,z){if(R.projectionCache.offsets[v])return R.projectionCache.offsets[v];const B=o.add(e);if(v+z.direction<h||v+z.direction>=m)return R.projectionCache.offsets[v]=B,B;const U=Er(v+z.direction,R,z),Z=Bl(U.sub(o),C,z.direction),H=o.add(Z),X=U.add(Z);return R.projectionCache.offsets[v]=c.aI(b,B,H,X)||B,R.projectionCache.offsets[v]}function Zo(v,e,o,h,m,b,C,R,z){const B=h?v-e:v+e;let U=B>0?1:-1,Z=0;h&&(U*=-1,Z=Math.PI),U<0&&(Z+=Math.PI);let H,X=U>0?b+m:b+m+1;R.projectionCache.cachedAnchorPoint?H=R.projectionCache.cachedAnchorPoint:(H=Sn(R.tileAnchorPoint.x,R.tileAnchorPoint.y,R).point,R.projectionCache.cachedAnchorPoint=H);let te,le,ce=H,ue=H,fe=0,xe=0;const he=Math.abs(B),ve=[];let Te;for(;fe+xe<=he;){if(X+=U,X<b||X>=C)return null;fe+=xe,ue=ce,le=te;const Ve={absOffsetX:he,direction:U,distanceFromAnchor:fe,previousVertex:ue};if(ce=Er(X,R,Ve),o===0)ve.push(ue),Te=ce.sub(ue);else{let ke;const Oe=ce.sub(ue);ke=Oe.mag()===0?Bl(Er(X+U,R,Ve).sub(ce),o,U):Bl(Oe,o,U),le||(le=ue.add(ke)),te=ha(X,ke,ce,b,C,le,o,R,Ve),ve.push(le),Te=te.sub(le)}xe=Te.mag()}const ge=Te._mult((he-fe)/xe)._add(le||ue),Ae=Z+Math.atan2(ce.y-ue.y,ce.x-ue.x);return ve.push(ge),{point:ge,angle:z?Ae:0,path:ve}}const Eu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ps(v,e){for(let o=0;o<v;o++){const h=e.length;e.resize(h+4),e.float32.set(Eu,3*h)}}function To(v,e,o){const h=e[0],m=e[1];return v[0]=o[0]*h+o[4]*m+o[12],v[1]=o[1]*h+o[5]*m+o[13],v[3]=o[3]*h+o[7]*m+o[15],v}const Pn=100;class Ah{constructor(e,o=new on(e.width+200,e.height+200,25),h=new on(e.width+200,e.height+200,25)){this.transform=e,this.grid=o,this.ignoredGrid=h,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Pn,this.screenBottomBoundary=e.height+Pn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,h,m,b,C,R,z,B,U,Z,H){const X=this.projectAndGetPerspectiveRatio(e.anchorPointX+z[0],e.anchorPointY+z[1],b,U,H),te=h*X.perspectiveRatio;let le;if(C||R)le=this._projectCollisionBox(e,te,m,b,C,R,z,X,U,Z,H);else{const Te=X.x+(Z?Z.x*te:0),ge=X.y+(Z?Z.y*te:0);le={allPointsOccluded:!1,box:[Te+e.x1*te,ge+e.y1*te,Te+e.x2*te,ge+e.y2*te]}}const[ce,ue,fe,xe]=le.box,he=C?le.allPointsOccluded:X.isOccluded;let ve=he;return ve||(ve=X.perspectiveRatio<this.perspectiveRatioCutoff),ve||(ve=!this.isInsideGrid(ce,ue,fe,xe)),ve||o!=="always"&&this.grid.hitTest(ce,ue,fe,xe,o,B)?{box:[ce,ue,fe,xe],placeable:!1,offscreen:!1,occluded:he}:{box:[ce,ue,fe,xe],placeable:!0,offscreen:this.isOffscreen(ce,ue,fe,xe),occluded:he}}placeCollisionCircles(e,o,h,m,b,C,R,z,B,U,Z,H,X,te){const le=[],ce=new c.P(o.anchorX,o.anchorY),ue=this.getPerspectiveRatio(ce.x,ce.y,C,te),fe=(B?b*this.transform.getPitchedTextCorrection(o.anchorX,o.anchorY,C)/ue:b*ue)/c.aM,xe={getElevation:te,pitchedLabelPlaneMatrix:R,lineVertexArray:h,pitchWithMap:B,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ce,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:X},he=ds(fe,m,o.lineOffsetX*fe,o.lineOffsetY*fe,!1,o,!1,xe);let ve=!1,Te=!1,ge=!0;if(he){const Ae=.5*Z*ue+H,Ve=new c.P(-100,-100),ke=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Oe=new dt,Ue=he.first,pt=he.last;let mt=[];for(let Wt=Ue.path.length-1;Wt>=1;Wt--)mt.push(Ue.path[Wt]);for(let Wt=1;Wt<pt.path.length;Wt++)mt.push(pt.path[Wt]);const ot=2.5*Ae;if(B){const Wt=this.projectPathToScreenSpace(mt,xe);mt=Wt.some((On=>On.signedDistanceFromCamera<=0))?[]:Wt.map((On=>On.point))}let vt=[];if(mt.length>0){const Wt=mt[0].clone(),On=mt[0].clone();for(let ti=1;ti<mt.length;ti++)Wt.x=Math.min(Wt.x,mt[ti].x),Wt.y=Math.min(Wt.y,mt[ti].y),On.x=Math.max(On.x,mt[ti].x),On.y=Math.max(On.y,mt[ti].y);vt=Wt.x>=Ve.x&&On.x<=ke.x&&Wt.y>=Ve.y&&On.y<=ke.y?[mt]:On.x<Ve.x||Wt.x>ke.x||On.y<Ve.y||Wt.y>ke.y?[]:c.aJ([mt],Ve.x,Ve.y,ke.x,ke.y)}for(const Wt of vt){Oe.reset(Wt,.25*Ae);let On=0;On=Oe.length<=.5*Ae?1:Math.ceil(Oe.paddedLength/ot)+1;for(let ti=0;ti<On;ti++){const Jn=ti/Math.max(On-1,1),li=Oe.lerp(Jn),Hn=li.x+Pn,xi=li.y+Pn;le.push(Hn,xi,Ae,0);const ui=Hn-Ae,cr=xi-Ae,Ci=Hn+Ae,Ai=xi+Ae;if(ge=ge&&this.isOffscreen(ui,cr,Ci,Ai),Te=Te||this.isInsideGrid(ui,cr,Ci,Ai),e!=="always"&&this.grid.hitTestCircle(Hn,xi,Ae,e,U)&&(ve=!0,!z))return{circles:[],offscreen:!1,collisionDetected:ve}}}}return{circles:!z&&ve||!Te||ue<this.perspectiveRatioCutoff?[]:le,offscreen:ge,collisionDetected:ve}}projectPathToScreenSpace(e,o){const h=(function(m,b){const C=c.N();return c.aB(C,b.pitchedLabelPlaneMatrix),m.map((R=>{const z=Qt(R.x,R.y,C,b.getElevation),B=b.transform.projectTileCoordinates(z.point.x,z.point.y,b.unwrappedTileID,b.getElevation);return B.point.x=(.5*B.point.x+.5)*b.width,B.point.y=(.5*-B.point.y+.5)*b.height,B}))})(e,o);return(function(m){let b=0,C=0,R=0,z=0;for(let B=0;B<m.length;B++)m[B].isOccluded?(R=B+1,z=0):(z++,z>C&&(C=z,b=R));return m.slice(b,b+C)})(h)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[],h=new c.aa;for(const Z of e){const H=new c.P(Z.x+Pn,Z.y+Pn);h.extend(H),o.push(H)}const{minX:m,minY:b,maxX:C,maxY:R}=h,z=this.grid.query(m,b,C,R).concat(this.ignoredGrid.query(m,b,C,R)),B={},U={};for(const Z of z){const H=Z.key;if(B[H.bucketInstanceId]===void 0&&(B[H.bucketInstanceId]={}),B[H.bucketInstanceId][H.featureIndex])continue;const X=[new c.P(Z.x1,Z.y1),new c.P(Z.x2,Z.y1),new c.P(Z.x2,Z.y2),new c.P(Z.x1,Z.y2)];c.aK(o,X)&&(B[H.bucketInstanceId][H.featureIndex]=!0,U[H.bucketInstanceId]===void 0&&(U[H.bucketInstanceId]=[]),U[H.bucketInstanceId].push(H.featureIndex))}return U}insertCollisionBox(e,o,h,m,b,C){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:C,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,h,m,b,C){const R=h?this.ignoredGrid:this.grid,z={bucketInstanceId:m,featureIndex:b,collisionGroupID:C,overlapMode:o};for(let B=0;B<e.length;B+=4)R.insertCircle(z,e[B],e[B+1],e[B+2])}projectAndGetPerspectiveRatio(e,o,h,m,b){if(b){let C;m?(C=[e,o,m(e,o),1],c.aH(C,C,b)):(C=[e,o,0,1],To(C,C,b));const R=C[3];return{x:(C[0]/R+1)/2*this.transform.width+Pn,y:(-C[1]/R+1)/2*this.transform.height+Pn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/R*.5,isOccluded:!1,signedDistanceFromCamera:R}}{const C=this.transform.projectTileCoordinates(e,o,h,m);return{x:(C.point.x+1)/2*this.transform.width+Pn,y:(1-C.point.y)/2*this.transform.height+Pn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5,isOccluded:C.isOccluded,signedDistanceFromCamera:C.signedDistanceFromCamera}}}getPerspectiveRatio(e,o,h,m){const b=this.transform.projectTileCoordinates(e,o,h,m);return .5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5}isOffscreen(e,o,h,m){return h<Pn||e>=this.screenRightBoundary||m<Pn||o>this.screenBottomBoundary}isInsideGrid(e,o,h,m){return h>=0&&e<this.gridRightBoundary&&m>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const e=c.ar([]);return c.O(e,e,[-100,-100,0]),e}_projectCollisionBox(e,o,h,m,b,C,R,z,B,U,Z){let H=1,X=0,te=0,le=1;const ce=e.anchorPointX+R[0],ue=e.anchorPointY+R[1];if(C&&!b){const mt=this.projectAndGetPerspectiveRatio(ce+1,ue,m,B,Z),ot=mt.x-z.x,vt=Math.atan((mt.y-z.y)/ot)+(ot<0?Math.PI:0),Wt=Math.sin(vt),On=Math.cos(vt);H=On,X=Wt,te=-Wt,le=On}else if(!C&&b){const mt=cs(this.transform);H=mt.vecEast[0],X=mt.vecEast[1],te=mt.vecSouth[0],le=mt.vecSouth[1]}let fe=z.x,xe=z.y,he=o;b&&(fe=ce,xe=ue,he=Math.pow(2,-(this.transform.zoom-h.overscaledZ)),he*=this.transform.getPitchedTextCorrection(ce,ue,m),U||(he*=c.an(.5+z.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),U&&(fe+=H*U.x*he+te*U.y*he,xe+=X*U.x*he+le*U.y*he);const ve=e.x1*he,Te=e.x2*he,ge=(ve+Te)/2,Ae=e.y1*he,Ve=e.y2*he,ke=(Ae+Ve)/2,Oe=[{offsetX:ve,offsetY:Ae},{offsetX:ge,offsetY:Ae},{offsetX:Te,offsetY:Ae},{offsetX:Te,offsetY:ke},{offsetX:Te,offsetY:Ve},{offsetX:ge,offsetY:Ve},{offsetX:ve,offsetY:Ve},{offsetX:ve,offsetY:ke}];let Ue=[];for(const{offsetX:mt,offsetY:ot}of Oe)Ue.push(new c.P(fe+H*mt+te*ot,xe+X*mt+le*ot));let pt=!1;if(b){const mt=Ue.map((ot=>this.projectAndGetPerspectiveRatio(ot.x,ot.y,m,B,Z)));pt=mt.some((ot=>!ot.isOccluded)),Ue=mt.map((ot=>new c.P(ot.x,ot.y)))}else pt=!0;return{box:c.aL(Ue),allPointsOccluded:!pt}}}class Ud{constructor(e,o,h,m){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class qa{constructor(e,o,h,m,b){this.text=new Ud(e?e.text:null,o,h,b),this.icon=new Ud(e?e.icon:null,o,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mh{constructor(e,o,h){this.text=e,this.icon=o,this.skipFade=h}}class Cu{constructor(e,o,h,m,b){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=b}}class Vd{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[e]}}function Lr(v,e,o,h,m){const{horizontalAlign:b,verticalAlign:C}=c.aS(v);return new c.P(-(b-.5)*e+h[0]*m,-(C-.5)*o+h[1]*m)}class Au{constructor(e,o,h,m,b){this.transform=e.clone(),this.terrain=o,this.collisionIndex=new Ah(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Vd(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const o=this.terrain;return o?(h,m)=>o.getElevation(e,h,m):null}getBucketParts(e,o,h,m){const b=h.getBucket(o),C=h.latestFeatureIndex;if(!b||!C||o.id!==b.layerIds[0])return;const R=h.collisionBoxArray,z=b.layers[0].layout,B=b.layers[0].paint,U=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),Z=h.tileSize/c.a5,H=h.tileID.toUnwrapped(),X=z.get("text-rotation-alignment")==="map",te=c.aN(h,1,this.transform.zoom),le=c.aO(this.collisionIndex.transform,h,B.get("text-translate"),B.get("text-translate-anchor")),ce=c.aO(this.collisionIndex.transform,h,B.get("icon-translate"),B.get("icon-translate-anchor")),ue=ro(X,this.transform,te);this.retainedQueryData[b.bucketInstanceId]=new Cu(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,h.tileID);const fe={bucket:b,layout:z,translationText:le,translationIcon:ce,unwrappedTileID:H,pitchedLabelPlaneMatrix:ue,scale:U,textPixelRatio:Z,holdingForFade:h.holdingForSymbolFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:c.ay(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const xe of b.sortKeyRanges){const{sortKey:he,symbolInstanceStart:ve,symbolInstanceEnd:Te}=xe;e.push({sortKey:he,symbolInstanceStart:ve,symbolInstanceEnd:Te,parameters:fe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:fe})}attemptAnchorPlacement(e,o,h,m,b,C,R,z,B,U,Z,H,X,te,le,ce,ue,fe,xe,he){const ve=c.aP[e.textAnchor],Te=[e.textOffset0,e.textOffset1],ge=Lr(ve,h,m,Te,b),Ae=this.collisionIndex.placeCollisionBox(o,H,z,B,U,R,C,ce,Z.predicate,xe,ge,he);if((!fe||this.collisionIndex.placeCollisionBox(fe,H,z,B,U,R,C,ue,Z.predicate,xe,ge,he).placeable)&&Ae.placeable){let Ve;if(this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(Ve=this.prevPlacement.variableOffsets[X.crossTileID].anchor),X.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[X.crossTileID]={textOffset:Te,width:h,height:m,anchor:ve,textBoxScale:b,prevAnchor:Ve},this.markUsedJustification(te,ve,X,le),te.allowVerticalPlacement&&(this.markUsedOrientation(te,le,X),this.placedOrientations[X.crossTileID]=le),{shift:ge,placedGlyphBoxes:Ae}}}placeLayerBucketPart(e,o,h){const{bucket:m,layout:b,translationText:C,translationIcon:R,unwrappedTileID:z,pitchedLabelPlaneMatrix:B,textPixelRatio:U,holdingForFade:Z,collisionBoxArray:H,partiallyEvaluatedTextSize:X,collisionGroup:te}=e.parameters,le=b.get("text-optional"),ce=b.get("icon-optional"),ue=c.aQ(b,"text-overlap","text-allow-overlap"),fe=ue==="always",xe=c.aQ(b,"icon-overlap","icon-allow-overlap"),he=xe==="always",ve=b.get("text-rotation-alignment")==="map",Te=b.get("text-pitch-alignment")==="map",ge=b.get("icon-text-fit")!=="none",Ae=b.get("symbol-z-order")==="viewport-y",Ve=fe&&(he||!m.hasIconData()||ce),ke=he&&(fe||!m.hasTextData()||le);!m.collisionArrays&&H&&m.deserializeCollisionBoxes(H);const Oe=this.retainedQueryData[m.bucketInstanceId].tileID,Ue=this._getTerrainElevationFunc(Oe),pt=this.transform.getFastPathSimpleProjectionMatrix(Oe),mt=(ot,vt,Wt)=>{var On,ti;if(o[ot.crossTileID])return;if(Z)return void(this.placements[ot.crossTileID]=new Mh(!1,!1,!1));let Jn=!1,li=!1,Hn=!0,xi=null,ui={box:null,placeable:!1,offscreen:null,occluded:!1},cr={placeable:!1},Ci=null,Ai=null,hr=null,zs=0,Ls=0,es=0;vt.textFeatureIndex?zs=vt.textFeatureIndex:ot.useRuntimeCollisionCircles&&(zs=ot.featureIndex),vt.verticalTextFeatureIndex&&(Ls=vt.verticalTextFeatureIndex);const Yr=vt.textBox;if(Yr){const Xr=Vn=>{let Wn=c.az.horizontal;if(m.allowVerticalPlacement&&!Vn&&this.prevPlacement){const Gi=this.prevPlacement.placedOrientations[ot.crossTileID];Gi&&(this.placedOrientations[ot.crossTileID]=Gi,Wn=Gi,this.markUsedOrientation(m,Wn,ot))}return Wn},go=(Vn,Wn)=>{if(m.allowVerticalPlacement&&ot.numVerticalGlyphVertices>0&&vt.verticalTextBox){for(const Gi of m.writingModes)if(Gi===c.az.vertical?(ui=Wn(),cr=ui):ui=Vn(),ui&&ui.placeable)break}else ui=Vn()},Lo=ot.textAnchorOffsetStartIndex,No=ot.textAnchorOffsetEndIndex;if(No===Lo){const Vn=(Wn,Gi)=>{const Wi=this.collisionIndex.placeCollisionBox(Wn,ue,U,Oe,z,Te,ve,C,te.predicate,Ue,void 0,pt);return Wi&&Wi.placeable&&(this.markUsedOrientation(m,Gi,ot),this.placedOrientations[ot.crossTileID]=Gi),Wi};go((()=>Vn(Yr,c.az.horizontal)),(()=>{const Wn=vt.verticalTextBox;return m.allowVerticalPlacement&&ot.numVerticalGlyphVertices>0&&Wn?Vn(Wn,c.az.vertical):{box:null,offscreen:null}})),Xr(ui&&ui.placeable)}else{let Vn=c.aP[(ti=(On=this.prevPlacement)===null||On===void 0?void 0:On.variableOffsets[ot.crossTileID])===null||ti===void 0?void 0:ti.anchor];const Wn=(Wi,eh,th)=>{const Pa=Wi.x2-Wi.x1,sf=Wi.y2-Wi.y1,Da=ot.textBoxScale,nh=ge&&xe==="never"?eh:null;let na=null,ia=ue==="never"?1:2,ns="never";Vn&&ia++;for(let ih=0;ih<ia;ih++){for(let uc=Lo;uc<No;uc++){const cc=m.textAnchorOffsets.get(uc);if(Vn&&cc.textAnchor!==Vn)continue;const hc=this.attemptAnchorPlacement(cc,Wi,Pa,sf,Da,ve,Te,U,Oe,z,te,ns,ot,m,th,C,R,nh,Ue);if(hc&&(na=hc.placedGlyphBoxes,na&&na.placeable))return Jn=!0,xi=hc.shift,na}Vn?Vn=null:ns=ue}return h&&!na&&(na={box:this.collisionIndex.placeCollisionBox(Yr,"always",U,Oe,z,Te,ve,C,te.predicate,Ue,void 0,pt).box,offscreen:!1,placeable:!1,occluded:!1}),na};go((()=>Wn(Yr,vt.iconBox,c.az.horizontal)),(()=>{const Wi=vt.verticalTextBox;return m.allowVerticalPlacement&&(!ui||!ui.placeable)&&ot.numVerticalGlyphVertices>0&&Wi?Wn(Wi,vt.verticalIconBox,c.az.vertical):{box:null,occluded:!0,offscreen:null}})),ui&&(Jn=ui.placeable,Hn=ui.offscreen);const Gi=Xr(ui&&ui.placeable);if(!Jn&&this.prevPlacement){const Wi=this.prevPlacement.variableOffsets[ot.crossTileID];Wi&&(this.variableOffsets[ot.crossTileID]=Wi,this.markUsedJustification(m,Wi.anchor,ot,Gi))}}}if(Ci=ui,Jn=Ci&&Ci.placeable,Hn=Ci&&Ci.offscreen,ot.useRuntimeCollisionCircles&&ot.centerJustifiedTextSymbolIndex>=0){const Xr=m.text.placedSymbolArray.get(ot.centerJustifiedTextSymbolIndex),go=c.aA(m.textSizeData,X,Xr),Lo=b.get("text-padding");Ai=this.collisionIndex.placeCollisionCircles(ue,Xr,m.lineVertexArray,m.glyphOffsetArray,go,z,B,h,Te,te.predicate,ot.collisionCircleDiameter,Lo,C,Ue),Ai.circles.length&&Ai.collisionDetected&&!h&&c.w("Collisions detected, but collision boxes are not shown"),Jn=fe||Ai.circles.length>0&&!Ai.collisionDetected,Hn=Hn&&Ai.offscreen}if(vt.iconFeatureIndex&&(es=vt.iconFeatureIndex),vt.iconBox){const Xr=go=>this.collisionIndex.placeCollisionBox(go,xe,U,Oe,z,Te,ve,R,te.predicate,Ue,ge&&xi?xi:void 0,pt);cr&&cr.placeable&&vt.verticalIconBox?(hr=Xr(vt.verticalIconBox),li=hr.placeable):(hr=Xr(vt.iconBox),li=hr.placeable),Hn=Hn&&hr.offscreen}const fl=le||ot.numHorizontalGlyphVertices===0&&ot.numVerticalGlyphVertices===0,au=ce||ot.numIconVertices===0;fl||au?au?fl||(li=li&&Jn):Jn=li&&Jn:li=Jn=li&&Jn;const ts=li&&hr.placeable;if(Jn&&Ci.placeable&&this.collisionIndex.insertCollisionBox(Ci.box,ue,b.get("text-ignore-placement"),m.bucketInstanceId,cr&&cr.placeable&&Ls?Ls:zs,te.ID),ts&&this.collisionIndex.insertCollisionBox(hr.box,xe,b.get("icon-ignore-placement"),m.bucketInstanceId,es,te.ID),Ai&&Jn&&this.collisionIndex.insertCollisionCircles(Ai.circles,ue,b.get("text-ignore-placement"),m.bucketInstanceId,zs,te.ID),h&&this.storeCollisionData(m.bucketInstanceId,Wt,vt,Ci,hr,Ai),ot.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ot.crossTileID]=new Mh((Jn||Ve)&&!(Ci!=null&&Ci.occluded),(li||ke)&&!(hr!=null&&hr.occluded),Hn||m.justReloaded),o[ot.crossTileID]=!0};if(Ae){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ot=m.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let vt=ot.length-1;vt>=0;--vt){const Wt=ot[vt];mt(m.symbolInstances.get(Wt),m.collisionArrays[Wt],Wt)}}else for(let ot=e.symbolInstanceStart;ot<e.symbolInstanceEnd;ot++)mt(m.symbolInstances.get(ot),m.collisionArrays[ot],ot);m.justReloaded=!1}storeCollisionData(e,o,h,m,b,C){if(h.textBox||h.iconBox){let R,z;this.collisionBoxArrays.has(e)?R=this.collisionBoxArrays.get(e):(R=new Map,this.collisionBoxArrays.set(e,R)),R.has(o)?z=R.get(o):(z={text:null,icon:null},R.set(o,z)),h.textBox&&(z.text=m.box),h.iconBox&&(z.icon=b.box)}if(C){let R=this.collisionCircleArrays[e];R===void 0&&(R=this.collisionCircleArrays[e]=[]);for(let z=0;z<C.circles.length;z+=4)R.push(C.circles[z+0]-Pn),R.push(C.circles[z+1]-Pn),R.push(C.circles[z+2]),R.push(C.collisionDetected?1:0)}}markUsedJustification(e,o,h,m){let b;b=m===c.az.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[c.aR(o)];const C=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const R of C)R>=0&&(e.text.placedSymbolArray.get(R).crossTileID=b>=0&&R!==b?0:h.crossTileID)}markUsedOrientation(e,o,h){const m=o===c.az.horizontal||o===c.az.horizontalOnly?o:0,b=o===c.az.vertical?o:0,C=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const R of C)e.text.placedSymbolArray.get(R).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const m=o?o.symbolFadeChange(e):1,b=o?o.opacities:{},C=o?o.variableOffsets:{},R=o?o.placedOrientations:{};for(const z in this.placements){const B=this.placements[z],U=b[z];U?(this.opacities[z]=new qa(U,m,B.text,B.icon),h=h||B.text!==U.text.placed||B.icon!==U.icon.placed):(this.opacities[z]=new qa(null,m,B.text,B.icon,B.skipFade),h=h||B.text||B.icon)}for(const z in b){const B=b[z];if(!this.opacities[z]){const U=new qa(B,m,!1,!1);U.isHidden()||(this.opacities[z]=U,h=h||B.text.placed||B.icon.placed)}}for(const z in C)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=C[z]);for(const z in R)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=R[z]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){const h={};for(const m of o){const b=m.getBucket(e);b&&m.latestFeatureIndex&&e.id===b.layerIds[0]&&this.updateBucketOpacities(b,m.tileID,h,m.collisionBoxArray)}}updateBucketOpacities(e,o,h,m){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const b=e.layers[0],C=b.layout,R=new qa(null,0,!1,!1,!0),z=C.get("text-allow-overlap"),B=C.get("icon-allow-overlap"),U=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Z=C.get("text-rotation-alignment")==="map",H=C.get("text-pitch-alignment")==="map",X=C.get("icon-text-fit")!=="none",te=new qa(null,0,z&&(B||!e.hasIconData()||C.get("icon-optional")),B&&(z||!e.hasTextData()||C.get("text-optional")),!0);!e.collisionArrays&&m&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(m);const le=(ue,fe,xe)=>{for(let he=0;he<fe/4;he++)ue.opacityVertexArray.emplaceBack(xe);ue.hasVisibleVertices=ue.hasVisibleVertices||xe!==Za},ce=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ue=0;ue<e.symbolInstances.length;ue++){const fe=e.symbolInstances.get(ue),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:he,crossTileID:ve}=fe;let Te=this.opacities[ve];h[ve]?Te=R:Te||(Te=te,this.opacities[ve]=Te),h[ve]=!0;const ge=fe.numIconVertices>0,Ae=this.placedOrientations[fe.crossTileID],Ve=Ae===c.az.vertical,ke=Ae===c.az.horizontal||Ae===c.az.horizontalOnly;if(xe>0||he>0){const Ue=Mc(Te.text);le(e.text,xe,Ve?Za:Ue),le(e.text,he,ke?Za:Ue);const pt=Te.text.isHidden();[fe.rightJustifiedTextSymbolIndex,fe.centerJustifiedTextSymbolIndex,fe.leftJustifiedTextSymbolIndex].forEach((vt=>{vt>=0&&(e.text.placedSymbolArray.get(vt).hidden=pt||Ve?1:0)})),fe.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(fe.verticalPlacedTextSymbolIndex).hidden=pt||ke?1:0);const mt=this.variableOffsets[fe.crossTileID];mt&&this.markUsedJustification(e,mt.anchor,fe,Ae);const ot=this.placedOrientations[fe.crossTileID];ot&&(this.markUsedJustification(e,"left",fe,ot),this.markUsedOrientation(e,ot,fe))}if(ge){const Ue=Mc(Te.icon),pt=!(X&&fe.verticalPlacedIconSymbolIndex&&Ve);fe.placedIconSymbolIndex>=0&&(le(e.icon,fe.numIconVertices,pt?Ue:Za),e.icon.placedSymbolArray.get(fe.placedIconSymbolIndex).hidden=Te.icon.isHidden()),fe.verticalPlacedIconSymbolIndex>=0&&(le(e.icon,fe.numVerticalIconVertices,pt?Za:Ue),e.icon.placedSymbolArray.get(fe.verticalPlacedIconSymbolIndex).hidden=Te.icon.isHidden())}const Oe=ce&&ce.has(ue)?ce.get(ue):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ue=e.collisionArrays[ue];if(Ue){let pt=new c.P(0,0);if(Ue.textBox||Ue.verticalTextBox){let mt=!0;if(U){const ot=this.variableOffsets[ve];ot?(pt=Lr(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textBoxScale),Z&&pt._rotate(H?-this.transform.bearingInRadians:this.transform.bearingInRadians)):mt=!1}if(Ue.textBox||Ue.verticalTextBox){let ot;Ue.textBox&&(ot=Ve),Ue.verticalTextBox&&(ot=ke),Ac(e.textCollisionBox.collisionVertexArray,Te.text.placed,!mt||ot,Oe.text,pt.x,pt.y)}}if(Ue.iconBox||Ue.verticalIconBox){const mt=!!(!ke&&Ue.verticalIconBox);let ot;Ue.iconBox&&(ot=mt),Ue.verticalIconBox&&(ot=!mt),Ac(e.iconCollisionBox.collisionVertexArray,Te.icon.placed,ot,Oe.icon,X?pt.x:0,X?pt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){const h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>e}setStale(){this.stale=!0}}function Ac(v,e,o,h,m,b){h&&h.length!==0||(h=[0,0,0,0]);const C=h[0]-Pn,R=h[1]-Pn,z=h[2]-Pn,B=h[3]-Pn;v.emplaceBack(e?1:0,o?1:0,m||0,b||0,C,R),v.emplaceBack(e?1:0,o?1:0,m||0,b||0,z,R),v.emplaceBack(e?1:0,o?1:0,m||0,b||0,z,B),v.emplaceBack(e?1:0,o?1:0,m||0,b||0,C,B)}const Mu=Math.pow(2,25),da=Math.pow(2,24),Gd=Math.pow(2,17),Ol=Math.pow(2,16),qs=Math.pow(2,9),qd=Math.pow(2,8),Ha=Math.pow(2,1);function Mc(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const e=v.placed?1:0,o=Math.floor(127*v.opacity);return o*Mu+e*da+o*Gd+e*Ol+o*qs+e*qd+o*Ha+e}const Za=0;class fa{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,h,m,b){const C=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(C,m,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(((R,z)=>R.sortKey-z.sortKey)));this._currentPartIndex<C.length;)if(o.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,b())return!0;return!1}}class Ul{constructor(e,o,h,m,b,C,R,z){this.placement=new Au(e,o,C,R,z),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(e,o,h){const m=Ne(),b=()=>!this._forceFullPlacement&&Ne()-m>2;for(;this._currentPlacementIndex>=0;){const C=o[e[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=R)&&(!C.maxzoom||C.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new fa(C)),this._inProgressLayer.continuePlacement(h[C.source],this.placement,this._showCollisionBoxes,C,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const rn=512/c.a5/2;class $o{constructor(e,o,h){this.tileID=e,this.bucketInstanceId=h,this._symbolsByKey={};const m=new Map;for(let b=0;b<o.length;b++){const C=o.get(b),R=C.key,z=m.get(R);z?z.push(C):m.set(R,[C])}for(const[b,C]of m){const R={positions:C.map((z=>({x:Math.floor(z.anchorX*rn),y:Math.floor(z.anchorY*rn)}))),crossTileIDs:C.map((z=>z.crossTileID))};if(R.positions.length>128){const z=new c.aT(R.positions.length,16,Uint16Array);for(const{x:B,y:U}of R.positions)z.add(B,U);z.finish(),delete R.positions,R.index=z}this._symbolsByKey[b]=R}}getScaledCoordinates(e,o){const{x:h,y:m,z:b}=this.tileID.canonical,{x:C,y:R,z}=o.canonical,B=rn/Math.pow(2,z-b),U=(R*c.a5+e.anchorY)*B,Z=m*c.a5*rn;return{x:Math.floor((C*c.a5+e.anchorX)*B-h*c.a5*rn),y:Math.floor(U-Z)}}findMatches(e,o,h){const m=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let b=0;b<e.length;b++){const C=e.get(b);if(C.crossTileID)continue;const R=this._symbolsByKey[C.key];if(!R)continue;const z=this.getScaledCoordinates(C,o);if(R.index){const B=R.index.range(z.x-m,z.y-m,z.x+m,z.y+m).sort();for(const U of B){const Z=R.crossTileIDs[U];if(!h[Z]){h[Z]=!0,C.crossTileID=Z;break}}}else if(R.positions)for(let B=0;B<R.positions.length;B++){const U=R.positions[B],Z=R.crossTileIDs[B];if(Math.abs(U.x-z.x)<=m&&Math.abs(U.y-z.y)<=m&&!h[Z]){h[Z]=!0,C.crossTileID=Z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class Ih{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Iu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const o=Math.round((e-this.lng)/360);if(o!==0)for(const h in this.indexes){const m=this.indexes[h],b={};for(const C in m){const R=m[C];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+o),b[R.tileID.key]=R}this.indexes[h]=b}this.lng=e}addBucket(e,o,h){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let b=0;b<o.symbolInstances.length;b++)o.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const m=this.usedCrossTileIDs[e.overscaledZ];for(const b in this.indexes){const C=this.indexes[b];if(Number(b)>e.overscaledZ)for(const R in C){const z=C[R];z.tileID.isChildOf(e)&&z.findMatches(o.symbolInstances,e,m)}else{const R=C[e.scaledTo(Number(b)).key];R&&R.findMatches(o.symbolInstances,e,m)}}for(let b=0;b<o.symbolInstances.length;b++){const C=o.symbolInstances.get(b);C.crossTileID||(C.crossTileID=h.generate(),m[C.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new $o(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(const h of o.getCrossTileIDsLists())for(const m of h)delete this.usedCrossTileIDs[e][m]}removeStaleBuckets(e){let o=!1;for(const h in this.indexes){const m=this.indexes[h];for(const b in m)e[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[b]),delete m[b],o=!0)}return o}}class tr{constructor(){this.layerIndexes={},this.crossTileIDs=new Ih,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,h){let m=this.layerIndexes[e.id];m===void 0&&(m=this.layerIndexes[e.id]=new Iu);let b=!1;const C={};m.handleWrapJump(h);for(const R of o){const z=R.getBucket(e);z&&e.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(R.tileID,z,this.crossTileIDs)&&(b=!0),C[z.bucketInstanceId]=!0)}return m.removeStaleBuckets(C)&&(b=!0),b}pruneUnusedLayers(e){const o={};e.forEach((h=>{o[h]=!0}));for(const h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}var Ui="void main() {fragColor=vec4(1.0);}";const ci={prelude:qt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:qt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:qt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:qt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:qt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:qt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:qt(Ui,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:qt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:qt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:qt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:qt(Ui,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:qt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:qt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:qt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:qt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:qt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:qt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:qt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:qt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:qt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:qt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:qt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:qt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:qt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:qt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:qt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:qt(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:qt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function qt(v,e){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=e.match(/in ([\w]+) ([\w]+)/g),m=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=b?b.concat(m):m,R={};return{fragmentSource:v=v.replace(o,((z,B,U,Z,H)=>(R[H]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${U} ${Z} ${H};
#else
uniform ${U} ${Z} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${U} ${Z} ${H} = u_${H};
#endif
`))),vertexSource:e=e.replace(o,((z,B,U,Z,H)=>{const X=Z==="float"?"vec2":"vec4",te=H.match(/color/)?"color":X;return R[H]?B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${U} ${X} a_${H};
out ${U} ${Z} ${H};
#else
uniform ${U} ${Z} u_${H};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${U} ${Z} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${te}(a_${H}, u_${H}_t);
#else
    ${U} ${Z} ${H} = u_${H};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${U} ${X} a_${H};
#else
uniform ${U} ${Z} u_${H};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${U} ${Z} ${H} = a_${H};
#else
    ${U} ${Z} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${U} ${Z} ${H} = unpack_mix_${te}(a_${H}, u_${H}_t);
#else
    ${U} ${Z} ${H} = u_${H};
#endif
`})),staticAttributes:h,staticUniforms:C}}class Yn{constructor(e,o,h){this.vertexBuffer=e,this.indexBuffer=o,this.segments=h}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var So=c.aU([{name:"a_pos",type:"Int16",components:2}]);const Ti="#define PROJECTION_MERCATOR",Nr="mercator";class nr{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Nr}get shaderDefine(){return Ti}get shaderPreludeCode(){return ci.projectionMercator}get vertexShaderPreludeCode(){return ci.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,o,h,m,b){if(this._cachedMesh)return this._cachedMesh;const C=new c.aW;C.emplaceBack(0,0),C.emplaceBack(c.a5,0),C.emplaceBack(0,c.a5),C.emplaceBack(c.a5,c.a5);const R=e.createVertexBuffer(C,So.members),z=c.aX.simpleSegment(0,0,4,2),B=new c.aY;B.emplaceBack(1,0,2),B.emplaceBack(1,2,3);const U=e.createIndexBuffer(B);return this._cachedMesh=new Yn(R,U,z),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class oo{constructor(e=0,o=0,h=0,m=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=h,this.right=m}interpolate(e,o,h){return o.top!=null&&e.top!=null&&(this.top=c.G.number(e.top,o.top,h)),o.bottom!=null&&e.bottom!=null&&(this.bottom=c.G.number(e.bottom,o.bottom,h)),o.left!=null&&e.left!=null&&(this.left=c.G.number(e.left,o.left,h)),o.right!=null&&e.right!=null&&(this.right=c.G.number(e.right,o.right,h)),this}getCenter(e,o){const h=c.an((this.left+e-this.right)/2,0,e),m=c.an((this.top+o-this.bottom)/2,0,o);return new c.P(h,m)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new oo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ms(v,e){if(!v.renderWorldCopies||v.lngRange)return;const o=e.lng-v.center.lng;e.lng+=o>180?-360:o<-180?360:0}function hi(v){return Math.max(0,Math.floor(v))}class pa{constructor(e,o){var h;this.applyConstrain=(m,b)=>this._constrainOverride!==null?this._constrainOverride(m,b):this._callbacks.defaultConstrain(m,b),this._callbacks=e,this._tileSize=512,this._renderWorldCopies=(o==null?void 0:o.renderWorldCopies)===void 0||!!(o!=null&&o.renderWorldCopies),this._minZoom=(o==null?void 0:o.minZoom)||0,this._maxZoom=(o==null?void 0:o.maxZoom)||22,this._minPitch=(o==null?void 0:o.minPitch)==null?0:o==null?void 0:o.minPitch,this._maxPitch=(o==null?void 0:o.maxPitch)==null?60:o==null?void 0:o.maxPitch,this._constrainOverride=(h=o==null?void 0:o.constrainOverride)!==null&&h!==void 0?h:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=hi(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new oo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,o,h){this._constrainOverride=e.constrainOverride,this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=hi(this._zoom),this._scale=c.aq(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new oo(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!h&&e.autoCalculateNearFarZ,o&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get constrainOverride(){return this._constrainOverride}setConstrainOverride(e){e===void 0&&(e=null),this._constrainOverride!==e&&(this._constrainOverride=e,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const o=c.W(e,-180,180)*Math.PI/180;var h,m,b,C,R,z,B,U,Z;this._bearingInRadians!==o&&(this._unmodified=!1,this._bearingInRadians=o,this._calcMatrices(),this._rotationMatrix=k(),h=this._rotationMatrix,b=-this._bearingInRadians,C=(m=this._rotationMatrix)[0],R=m[1],z=m[2],B=m[3],U=Math.sin(b),Z=Math.cos(b),h[0]=C*Z+z*U,h[1]=R*Z+B*U,h[2]=C*-U+z*Z,h[3]=R*-U+B*Z)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const o=c.an(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==o&&(this._unmodified=!1,this._pitchInRadians=o,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const o=e/180*Math.PI;this._rollInRadians!==o&&(this._unmodified=!1,this._rollInRadians=o,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aZ(this._fovInRadians)}setFov(e){e=c.an(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=c.ap(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const o=this.applyConstrain(this._center,e).zoom;this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this._tileZoom=Math.max(0,Math.floor(o)),this._scale=c.aq(o),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,o){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=o,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,h){this._unmodified=!1,this._edgeInsets.interpolate(e,o,h),this.constrainInternal(),this._calcMatrices()}resize(e,o,h=!0){this._width=e,this._height=o,h&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new un([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-c.ao,c.ao])}getCameraQueryGeometry(e,o){if(o.length===1)return[o[0],e];{const{minX:h,minY:m,maxX:b,maxY:C}=c.aa.fromPoints(o).extend(e);return[new c.P(h,m),new c.P(b,m),new c.P(b,C),new c.P(h,C),new c.P(h,m)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:o,zoom:h}=this.applyConstrain(this.center,this.zoom);this.setCenter(o),this.setZoom(h),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=c.ar(new Float64Array(16));c.Q(e,e,[this._width/2,-this._height/2,1]),c.O(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=c.ar(new Float64Array(16)),c.Q(e,e,[1,-1,1]),c.O(e,e,[-1,-1,0]),c.Q(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,o,h,m){const b=h!==void 0?h:this.bearing,C=m=m!==void 0?m:this.pitch,{distanceToCenter:R,clampedElevation:z}=this._distanceToCenterFromAltElevationPitch(o,this.elevation,C),{x:B,y:U}=Ht(C,b),Z=c.a9.fromLngLat(e,o);let H,X,te=c.a_(1,Z.y),le=0;do{if(le+=1,le>10)break;X=R/te,H=new c.a9(Z.x+B*X,Z.y+U*X),te=1/H.meterInMercatorCoordinateUnits()}while(Math.abs(R-X*te)>1e-12);return{center:H.toLngLat(),elevation:z,zoom:c.at(this.height/2/Math.tan(this.fovInRadians/2)/X/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const o=1/this.worldSize,h=c.as(1,this.center.lat)*this.worldSize,m=c.a9.fromLngLat(this.center,this.elevation),b=m.x/o,C=m.y/o,R=m.z/o,z=this.pitch,B=this.bearing,{x:U,y:Z,z:H}=Ht(z,B),X=this.cameraToCenterDistance,te=b+X*-U,le=C+X*-Z,ce=R+X*H,{distanceToCenter:ue,clampedElevation:fe}=this._distanceToCenterFromAltElevationPitch(ce/h,e,z),xe=ue*h,he=new c.a9((te+U*xe)*o,(le+Z*xe)*o,0).toLngLat(),ve=c.as(1,he.lat),Te=c.at(this.height/2/Math.tan(this.fovInRadians/2)/ue/ve/this.tileSize);this._elevation=fe,this._center=he,this.setZoom(Te)}_distanceToCenterFromAltElevationPitch(e,o,h){const m=-Math.cos(c.ap(h)),b=e-o;let C,R=o;return m*b>=0||Math.abs(m)<.1?(C=1e4,R=e+C*m):C=-b/m,{distanceToCenter:C,clampedElevation:R}}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=c.as(1,this.center.lat)*this.worldSize;return Ce(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const o=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/o,e.canonical.y/o,1/o/c.a5,1/o/c.a5]}}class so{constructor(e,o){this.min=e,this.max=o,this.center=c.a$([],c.b0([],this.min,this.max),.5)}quadrant(e){const o=[e%2==0,e<2],h=c.b1(this.min),m=c.b1(this.max);for(let b=0;b<o.length;b++)h[b]=o[b]?this.min[b]:this.center[b],m[b]=o[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new so(h,m)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let o=!0;for(let h=0;h<e.planes.length;h++){const m=this.intersectsPlane(e.planes[h]);if(m===0)return 0;m===1&&(o=!1)}return o?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let o=e[3],h=e[3];for(let m=0;m<3;m++)e[m]>0?(o+=e[m]*this.min[m],h+=e[m]*this.max[m]):(h+=e[m]*this.min[m],o+=e[m]*this.max[m]);return o>=0?2:h<0?0:1}}class $a{distanceToTile2d(e,o,h,m){const b=m.distanceX([e,o]),C=m.distanceY([e,o]);return Math.hypot(b,C)}getWrap(e,o,h){return h}getTileBoundingVolume(e,o,h,m){var b,C;let R=0,z=0;if(m!=null&&m.terrain){const U=new c.a2(e.z,o,e.z,e.x,e.y),Z=m.terrain.getMinMaxElevation(U);R=(b=Z.minElevation)!==null&&b!==void 0?b:Math.min(0,h),z=(C=Z.maxElevation)!==null&&C!==void 0?C:Math.max(0,h)}const B=1<<e.z;return new so([o+e.x/B,e.y/B,R],[o+(e.x+1)/B,(e.y+1)/B,z])}allowVariableZoom(e,o){const h=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,m=c.an(78.5-h/2,0,60);return!!o.terrain||e.pitch>m}allowWorldCopies(){return!0}prepareNextFrame(){}}class kr{constructor(e,o,h){this.points=e,this.planes=o,this.aabb=h}static fromInvProjectionMatrix(e,o=1,h=0,m,b){const C=b?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],R=Math.pow(2,h),z=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((H=>(function(X,te,le,ce){const ue=c.aH([],X,te),fe=1/ue[3]/le*ce;return c.b6(ue,ue,[fe,fe,1/ue[3],fe])})(H,e,o,R)));m&&(function(H,X,te,le){const ce=le?4:0,ue=le?0:4;let fe=0;const xe=[],he=[];for(let ge=0;ge<4;ge++){const Ae=c.b2([],H[ge+ue],H[ge+ce]),Ve=c.b7(Ae);c.a$(Ae,Ae,1/Ve),xe.push(Ve),he.push(Ae)}for(let ge=0;ge<4;ge++){const Ae=c.b8(H[ge+ce],he[ge],te);fe=Ae!==null&&Ae>=0?Math.max(fe,Ae):Math.max(fe,xe[ge])}const ve=(function(ge,Ae){const Ve=c.b2([],ge[Ae[0]],ge[Ae[1]]),ke=c.b2([],ge[Ae[2]],ge[Ae[1]]),Oe=[0,0,0,0];return c.b3(Oe,c.b4([],Ve,ke)),Oe[3]=-c.b5(Oe,ge[Ae[0]]),Oe})(H,X),Te=(function(ge,Ae){const Ve=c.b9(ge),ke=c.ba([],ge,1/Ve),Oe=c.b2([],Ae,c.a$([],ke,c.b5(Ae,ke))),Ue=c.b9(Oe);if(Ue>0){const pt=Math.sqrt(1-ke[3]*ke[3]),mt=c.a$([],ke,-ke[3]),ot=c.b0([],mt,c.a$([],Oe,pt/Ue));return c.bb(Ae,ot)}return null})(te,ve);if(Te!==null){const ge=Te/c.b5(he[0],ve);fe=Math.min(fe,ge)}for(let ge=0;ge<4;ge++){const Ae=Math.min(fe,xe[ge]);H[ge+ue]=[H[ge+ce][0]+he[ge][0]*Ae,H[ge+ce][1]+he[ge][1]*Ae,H[ge+ce][2]+he[ge][2]*Ae,1]}})(z,C[0],m,b);const B=C.map((H=>{const X=c.b2([],z[H[0]],z[H[1]]),te=c.b2([],z[H[2]],z[H[1]]),le=c.b3([],c.b4([],X,te)),ce=-c.b5(le,z[H[1]]);return le.concat(ce)})),U=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],Z=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const H of z)for(let X=0;X<3;X++)U[X]=Math.min(U[X],H[X]),Z[X]=Math.max(Z[X],H[X]);return new kr(z,B,new so(U,Z))}}class Ji{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,h){return this._helper.interpolatePadding(e,o,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o,h=!0){this._helper.resize(e,o,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,o){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(o,h)=>{h=c.an(+h,this.minZoom,this.maxZoom);const m={center:new c.V(o.lng,o.lat),zoom:h};let b=this._helper._lngRange;if(!this._helper._renderWorldCopies&&b===null){const he=179.9999999999;b=[-he,he]}const C=this.tileSize*c.aq(m.zoom);let R=0,z=C,B=0,U=C,Z=0,H=0;const{x:X,y:te}=this.size;if(this._helper._latRange){const he=this._helper._latRange;R=c.X(he[1])*C,z=c.X(he[0])*C,z-R<te&&(Z=te/(z-R))}b&&(B=c.W(c.Y(b[0])*C,0,C),U=c.W(c.Y(b[1])*C,0,C),U<B&&(U+=C),U-B<X&&(H=X/(U-B)));const{x:le,y:ce}=De(C,o);let ue,fe;const xe=Math.max(H||0,Z||0);if(xe){const he=new c.P(H?(U+B)/2:le,Z?(z+R)/2:ce);return m.center=et(C,he).wrap(),m.zoom+=c.at(xe),m}if(this._helper._latRange){const he=te/2;ce-he<R&&(fe=R+he),ce+he>z&&(fe=z-he)}if(b){const he=(B+U)/2;let ve=le;this._helper._renderWorldCopies&&(ve=c.W(le,he-C/2,he+C/2));const Te=X/2;ve-Te<B&&(ue=B+Te),ve+Te>U&&(ue=U-Te)}if(ue!==void 0||fe!==void 0){const he=new c.P(ue??le,fe??ce);m.center=et(C,he).wrap()}return m},this.applyConstrain=(o,h)=>this._helper.applyConstrain(o,h),this._helper=new pa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(o,h)=>this.defaultConstrain(o,h)},e),this._coveringTilesDetailsProvider=new $a}clone(){const e=new Ji;return e.apply(this,!1),e}apply(e,o,h){this._helper.apply(e,o,h)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const o=[new c.bc(0,e)];if(this._helper._renderWorldCopies){const h=this.screenPointToMercatorCoordinate(new c.P(0,0)),m=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),b=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),C=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),R=Math.floor(Math.min(h.x,m.x,b.x,C.x)),z=Math.floor(Math.max(h.x,m.x,b.x,C.x)),B=1;for(let U=R-B;U<=z+B;U++)U!==0&&o.push(new c.bc(U,e))}return o}getCameraFrustum(){return kr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const o=this.screenPointToLocation(this.centerPoint,e),h=e?e.getElevationForLngLatZoom(o,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(h)}setLocationAtPoint(e,o){const h=c.as(this.elevation,this.center.lat),m=this.screenPointToMercatorCoordinateAtZ(o,h),b=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,h),C=c.a9.fromLngLat(e),R=new c.a9(C.x-(m.x-b.x),C.y-(m.y-b.y));this.setCenter(R==null?void 0:R.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,o){return o?this.coordinatePoint(c.a9.fromLngLat(e),o.getElevationForLngLat(e,this),this._pixelMatrix3D):this.coordinatePoint(c.a9.fromLngLat(e))}screenPointToLocation(e,o){var h;return(h=this.screenPointToMercatorCoordinate(e,o))===null||h===void 0?void 0:h.toLngLat()}screenPointToMercatorCoordinate(e,o){if(o){const h=o.pointCoordinate(e);if(h!=null)return h}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,o){const h=o||0,m=[e.x,e.y,0,1],b=[e.x,e.y,1,1];c.aH(m,m,this._pixelMatrixInverse),c.aH(b,b,this._pixelMatrixInverse);const C=m[3],R=b[3],z=m[1]/C,B=b[1]/R,U=m[2]/C,Z=b[2]/R,H=U===Z?0:(h-U)/(Z-U);return new c.a9(c.G.number(m[0]/C,b[0]/R,H)/this.worldSize,c.G.number(z,B,H)/this.worldSize,h)}coordinatePoint(e,o=0,h=this._pixelMatrix){const m=[e.x*this.worldSize,e.y*this.worldSize,o,1];return c.aH(m,m,h),new c.P(m[0]/m[3],m[1]/m[3])}getBounds(){const e=Math.max(0,this._helper._height/2-$e(this));return new un().extend(this.screenPointToLocation(new c.P(0,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(e,o){return o?o.pointCoordinate(e)!=null:e.y>this.height/2-$e(this)}calculatePosMatrix(e,o=!1,h){var m;const b=(m=e.key)!==null&&m!==void 0?m:c.bd(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),C=o?this._alignedPosMatrixCache:this._posMatrixCache;if(C.has(b)){const B=C.get(b);return h?B.f32:B.f64}const R=ut(e,this.worldSize);c.S(R,o?this._alignedProjMatrix:this._viewProjMatrix,R);const z={f64:R,f32:new Float32Array(R)};return C.set(b,z),h?z.f32:z.f64}calculateFogMatrix(e){const o=e.key,h=this._fogMatrixCacheF32;if(h.has(o))return h.get(o);const m=ut(e,this.worldSize);return c.S(m,this._fogMatrix,m),h.set(o,new Float32Array(m)),h.get(o)}calculateCenterFromCameraLngLatAlt(e,o,h,m){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,h,m)}_calculateNearFarZIfNeeded(e,o,h){if(!this._helper.autoCalculateNearFarZ)return;const m=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),b=e-m*this._helper._pixelPerMeter/Math.cos(o),C=m<0?b:e,R=Math.PI/2+this.pitchInRadians,z=c.ap(this.fov)*(Math.abs(Math.cos(c.ap(this.roll)))*this.height+Math.abs(Math.sin(c.ap(this.roll)))*this.width)/this.height*(.5+h.y/this.height),B=Math.sin(z)*C/Math.sin(c.an(Math.PI-R-z,.01,Math.PI-.01)),U=$e(this),Z=Math.atan(U/this._helper.cameraToCenterDistance),H=c.ap(.75),X=Z>H?2*Z*(.5+h.y/(2*U)):H,te=Math.sin(X)*C/Math.sin(c.an(Math.PI-R-X,.01,Math.PI-.01)),le=Math.min(B,te);this._helper._farZ=1.01*(Math.cos(Math.PI/2-o)*le+C),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,o=De(this.worldSize,this.center),h=o.x,m=o.y;this._helper._pixelPerMeter=c.as(1,this.center.lat)*this.worldSize;const b=c.ap(Math.min(this.pitch,Ee)),C=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(b));let R;this._calculateNearFarZIfNeeded(C,b,e),R=new Float64Array(16),c.be(R,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aB(this._invProjMatrix,R),R[8]=2*-e.x/this._helper._width,R[9]=2*e.y/this._helper._height,this._projectionMatrix=c.bf(R),c.Q(R,R,[1,-1,1]),c.O(R,R,[0,0,-this._helper.cameraToCenterDistance]),c.bg(R,R,-this.rollInRadians),c.bh(R,R,this.pitchInRadians),c.bg(R,R,-this.bearingInRadians),c.O(R,R,[-h,-m,0]),this._mercatorMatrix=c.Q([],R,[this.worldSize,this.worldSize,this.worldSize]),c.Q(R,R,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,R),c.O(R,R,[0,0,-this.elevation]),this._viewProjMatrix=R,this._invViewProjMatrix=c.aB([],R);const z=[0,0,-1,1];c.aH(z,z,this._invViewProjMatrix),this._cameraPosition=[z[0]/z[3],z[1]/z[3],z[2]/z[3]],this._fogMatrix=new Float64Array(16),c.be(this._fogMatrix,this.fovInRadians,this.width/this.height,C,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,c.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.O(this._fogMatrix,this._fogMatrix,[-h,-m,0]),c.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,R);const B=this._helper._width%2/2,U=this._helper._height%2/2,Z=Math.cos(this.bearingInRadians),H=Math.sin(-this.bearingInRadians),X=h-Math.round(h)+Z*B+H*U,te=m-Math.round(m)+Z*U+H*B,le=new Float64Array(R);if(c.O(le,le,[X>.5?X-1:X,te>.5?te-1:te,0]),this._alignedProjMatrix=le,R=c.aB(new Float64Array(16),this._pixelMatrix),!R)throw new Error("failed to invert matrix");this._pixelMatrixInverse=R,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new c.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.aH(o,o,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=c.as(1,this.center.lat)*this.worldSize;return Ce(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,o){const h=c.a9.fromLngLat(e),m=[h.x*this.worldSize,h.y*this.worldSize,o,1];return c.aH(m,m,this._viewProjMatrix),m[2]/m[3]}getProjectionData(e){const{overscaledTileID:o,aligned:h,applyTerrainMatrix:m}=e,b=this._helper.getMercatorTileCoordinates(o),C=o?this.calculatePosMatrix(o,h,!0):null;let R;return R=o&&o.terrainRttPosMatrix32f&&m?o.terrainRttPosMatrix32f:C||c.bi(),{mainMatrix:R,tileMercatorCoords:b,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:R}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,o,h){return 1}transformLightDirection(e){return c.b1(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,o,h,m){const b=this.calculatePosMatrix(h);let C;m?(C=[e,o,m(e,o),1],c.aH(C,C,b)):(C=[e,o,0,1],To(C,C,b));const R=C[3];return{point:new c.P(C[0]/R,C[1]/R),signedDistanceFromCamera:R,isOccluded:!1}}populateCache(e){for(const o of e)this.calculatePosMatrix(o)}getMatrixForModel(e,o){const h=c.a9.fromLngLat(e,o),m=h.meterInMercatorCoordinateUnits(),b=c.bj();return c.O(b,b,[h.x,h.y,h.z]),c.bg(b,b,Math.PI),c.bh(b,b,Math.PI/2),c.Q(b,b,[-m,m,m]),b}getProjectionDataForCustomLayer(e=!0){const o=new c.a2(0,0,0,0,0),h=this.getProjectionData({overscaledTileID:o,applyGlobeMatrix:e}),m=ut(o,this.worldSize);c.S(m,this._viewProjMatrix,m),h.tileMercatorCoords=[0,0,1,1];const b=[c.a5,c.a5,this.worldSize/this._helper.pixelsPerMeter],C=c.bk();return c.Q(C,m,b),h.fallbackMatrix=C,h.mainMatrix=C,h}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Fr(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Ru(v){if(v.useSlerp)if(v.k<1){const e=c.bl(v.startEulerAngles.roll,v.startEulerAngles.pitch,v.startEulerAngles.bearing),o=c.bl(v.endEulerAngles.roll,v.endEulerAngles.pitch,v.endEulerAngles.bearing),h=new Float64Array(4);c.bm(h,e,o,v.k);const m=c.bn(h);v.tr.setRoll(m.roll),v.tr.setPitch(m.pitch),v.tr.setBearing(m.bearing)}else v.tr.setRoll(v.endEulerAngles.roll),v.tr.setPitch(v.endEulerAngles.pitch),v.tr.setBearing(v.endEulerAngles.bearing);else v.tr.setRoll(c.G.number(v.startEulerAngles.roll,v.endEulerAngles.roll,v.k)),v.tr.setPitch(c.G.number(v.startEulerAngles.pitch,v.endEulerAngles.pitch,v.k)),v.tr.setBearing(c.G.number(v.startEulerAngles.bearing,v.endEulerAngles.bearing,v.k))}function ja(v,e,o,h,m){const b=m.padding,C=De(m.worldSize,o.getNorthWest()),R=De(m.worldSize,o.getNorthEast()),z=De(m.worldSize,o.getSouthEast()),B=De(m.worldSize,o.getSouthWest()),U=c.ap(-h),Z=C.rotate(U),H=R.rotate(U),X=z.rotate(U),te=B.rotate(U),le=new c.P(Math.max(Z.x,H.x,te.x,X.x),Math.max(Z.y,H.y,te.y,X.y)),ce=new c.P(Math.min(Z.x,H.x,te.x,X.x),Math.min(Z.y,H.y,te.y,X.y)),ue=le.sub(ce),fe=(m.width-(b.left+b.right+e.left+e.right))/ue.x,xe=(m.height-(b.top+b.bottom+e.top+e.bottom))/ue.y;if(xe<0||fe<0)return void Fr();const he=Math.min(c.at(m.scale*Math.min(fe,xe)),v.maxZoom),ve=c.P.convert(v.offset),Te=new c.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(c.ap(h)),ge=ve.add(Te).mult(m.scale/c.aq(he));return{center:et(m.worldSize,C.add(z).div(2).sub(ge)),zoom:he,bearing:h}}class Ya{get useGlobeControls(){return!1}handlePanInertia(e,o){const h=e.mag(),m=Math.abs($e(o));return{easingOffset:e.mult(Math.min(.75*m/h,1)),easingCenter:o.center}}handleMapControlsRollPitchBearingZoom(e,o){e.bearingDelta&&o.setBearing(o.bearing+e.bearingDelta),e.pitchDelta&&o.setPitch(o.pitch+e.pitchDelta),e.rollDelta&&o.setRoll(o.roll+e.rollDelta),e.zoomDelta&&o.setZoom(o.zoom+e.zoomDelta)}handleMapControlsPan(e,o,h){e.around.distSqr(o.centerPoint)<.01||o.setLocationAtPoint(h,e.around)}cameraForBoxAndBearing(e,o,h,m,b){return ja(e,o,h,m,b)}handleJumpToCenterZoom(e,o){e.zoom!==(o.zoom!==void 0?+o.zoom:e.zoom)&&e.setZoom(+o.zoom),o.center!==void 0&&e.setCenter(c.V.convert(o.center))}handleEaseTo(e,o){const h=e.zoom,m=e.padding,b={roll:e.roll,pitch:e.pitch,bearing:e.bearing},C={roll:o.roll===void 0?e.roll:o.roll,pitch:o.pitch===void 0?e.pitch:o.pitch,bearing:o.bearing===void 0?e.bearing:o.bearing},R=o.zoom!==void 0,z=!e.isPaddingEqual(o.padding);let B=!1;const U=R?+o.zoom:e.zoom;let Z=e.centerPoint.add(o.offsetAsPoint);const H=e.screenPointToLocation(Z),{center:X,zoom:te}=e.applyConstrain(c.V.convert(o.center||H),U??h);ms(e,X);const le=De(e.worldSize,H),ce=De(e.worldSize,X).sub(le),ue=c.aq(te-h);return B=te!==h,{easeFunc:fe=>{if(B&&e.setZoom(c.G.number(h,te,fe)),c.bo(b,C)||Ru({startEulerAngles:b,endEulerAngles:C,tr:e,k:fe,useSlerp:b.roll!=C.roll}),z&&(e.interpolatePadding(m,o.padding,fe),Z=e.centerPoint.add(o.offsetAsPoint)),o.around)e.setLocationAtPoint(o.around,o.aroundPoint);else{const xe=c.aq(e.zoom-h),he=te>h?Math.min(2,ue):Math.max(.5,ue),ve=Math.pow(he,1-fe),Te=et(e.worldSize,le.add(ce.mult(fe*ve)).mult(xe));e.setLocationAtPoint(e.renderWorldCopies?Te.wrap():Te,Z)}},isZooming:B,elevationCenter:X}}handleFlyTo(e,o){const h=o.zoom!==void 0,m=e.zoom,b=e.applyConstrain(c.V.convert(o.center||o.locationAtOffset),h?+o.zoom:m),C=b.center,R=b.zoom;ms(e,C);const z=De(e.worldSize,o.locationAtOffset),B=De(e.worldSize,C).sub(z),U=B.mag(),Z=c.aq(R-m);let H;if(o.minZoom!==void 0){const X=Math.min(+o.minZoom,m,R),te=e.applyConstrain(C,X).zoom;H=c.aq(te-m)}return{easeFunc:(X,te,le,ce)=>{e.setZoom(X===1?R:m+c.at(te));const ue=X===1?C:et(e.worldSize,z.add(B.mult(le)).mult(te));e.setLocationAtPoint(e.renderWorldCopies?ue.wrap():ue,ce)},scaleOfZoom:Z,targetCenter:C,scaleOfMinZoom:H,pixelPathLength:U}}}class qn{constructor(e,o,h){this.blendFunction=e,this.blendColor=o,this.mask=h}}qn.Replace=[1,0],qn.disabled=new qn(qn.Replace,c.bp.transparent,[!1,!1,!1,!1]),qn.unblended=new qn(qn.Replace,c.bp.transparent,[!0,!0,!0,!0]),qn.alphaBlended=new qn([1,771],c.bp.transparent,[!0,!0,!0,!0]);const ma=2305;class cn{constructor(e,o,h){this.enable=e,this.mode=o,this.frontFace=h}}cn.disabled=new cn(!1,1029,ma),cn.backCCW=new cn(!0,1029,ma),cn.frontCCW=new cn(!0,1028,ma);class en{constructor(e,o,h){this.func=e,this.mask=o,this.range=h}}en.ReadOnly=!1,en.ReadWrite=!0,en.disabled=new en(519,en.ReadOnly,[0,1]);const Xa=7680;class En{constructor(e,o,h,m,b,C){this.test=e,this.ref=o,this.mask=h,this.fail=m,this.depthFail=b,this.pass=C}}En.disabled=new En({func:519,mask:0},0,0,Xa,Xa,Xa);const Pu=new WeakMap;function Eo(v){var e;if(Pu.has(v))return Pu.get(v);{const o=(e=v.getParameter(v.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Pu.set(v,o),o}}class ga{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const o=e.context,h=o.gl;this._texFormat=h.RGBA,this._texType=h.UNSIGNED_BYTE;const m=new c.aW;m.emplaceBack(-1,-1),m.emplaceBack(2,-1),m.emplaceBack(-1,2);const b=new c.aY;b.emplaceBack(0,1,2),this._fullscreenTriangle=new Yn(o.createVertexBuffer(m,So.members),o.createIndexBuffer(b),c.aX.simpleSegment(0,0,m.length,b.length)),this._resultBuffer=new Uint8Array(4),o.activeTexture.set(h.TEXTURE1);const C=h.createTexture();h.bindTexture(h.TEXTURE_2D,C),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texImage2D(h.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=o.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(C),Eo(h)&&(this._pbo=h.createBuffer(),h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.bufferData(h.PIXEL_PACK_BUFFER,4,h.STREAM_READ),h.bindBuffer(h.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,o){const h=this._updateCount;return this._readbackQueue?h>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():h>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,o),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,o=e.gl;e.activeTexture.set(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,o){const h=this._cachedRenderContext.context,m=h.gl;if(this._bindFramebuffer(),h.viewport.set([0,0,this._texWidth,this._texHeight]),h.clear({color:c.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(h,m.TRIANGLES,en.disabled,En.disabled,qn.unblended,cn.disabled,((b,C)=>({u_input:b,u_output_expected:C}))(e,o),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Eo(m)){m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.readBuffer(m.COLOR_ATTACHMENT0),m.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),m.bindBuffer(m.PIXEL_PACK_BUFFER,null);const b=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);m.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:b}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Eo(e)){const o=e.clientWaitSync(this._readbackQueue.sync,0,0);if(o===e.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(o===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ga._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let o=0;return o+=e[0]/256,o+=e[1]/65536,o+=e[2]/16777216,e[3]<127&&(o=-o),o/128}}const _a=c.a5/128;function Hd(v,e){const o=v.granularity!==void 0?Math.max(v.granularity,1):1,h=o+(v.generateBorders?2:0),m=o+(v.extendToNorthPole||v.generateBorders?1:0)+(v.extendToSouthPole||v.generateBorders?1:0),b=h+1,C=m+1,R=v.generateBorders?-1:0,z=v.generateBorders||v.extendToNorthPole?-1:0,B=o+(v.generateBorders?1:0),U=o+(v.generateBorders||v.extendToSouthPole?1:0),Z=b*C,H=h*m*6,X=b*C>65536;if(X&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const te=X||e==="32bit",le=new Int16Array(2*Z);let ce=0;for(let xe=z;xe<=U;xe++)for(let he=R;he<=B;he++){let ve=he/o*c.a5;he===-1&&(ve=-_a),he===o+1&&(ve=c.a5+_a);let Te=xe/o*c.a5;xe===-1&&(Te=v.extendToNorthPole?c.br:-_a),xe===o+1&&(Te=v.extendToSouthPole?c.bs:c.a5+_a),le[ce++]=ve,le[ce++]=Te}const ue=te?new Uint32Array(H):new Uint16Array(H);let fe=0;for(let xe=0;xe<m;xe++)for(let he=0;he<h;he++){const ve=he+1+xe*b,Te=he+(xe+1)*b,ge=he+1+(xe+1)*b;ue[fe++]=he+xe*b,ue[fe++]=Te,ue[fe++]=ve,ue[fe++]=ve,ue[fe++]=Te,ue[fe++]=ge}return{vertices:le.buffer.slice(0),indices:ue.buffer.slice(0),uses32bitIndices:te}}const Du=new c.aV({fill:new c.bt(128,2),line:new c.bt(512,0),tile:new c.bt(128,32),stencil:new c.bt(128,1),circle:3});class Rh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ci.projectionGlobe}get vertexShaderPreludeCode(){return ci.projectionMercator.vertexSource}get subdivisionGranularity(){return Du}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new ga(e));const o=c.X(this._errorQueryLatitudeDegrees),h=2*Math.atan(Math.exp(Math.PI-o*Math.PI*2))-.5*Math.PI,m=this._errorMeasurement.updateErrorLoop(o,h),b=Ne();m!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=m,this._errorMeasurementLastChangeTime=b);const C=Math.min(Math.max((b-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bv(C))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,o,h,m,b){const C=(b==="stencil"?Du.stencil:Du.tile).getGranularityForZoomLevel(o.z);return this._getMesh(e,{granularity:C,generateBorders:h,extendToNorthPole:o.y===0&&m,extendToSouthPole:o.y===(1<<o.z)-1&&m})}_getMesh(e,o){const h=this._getMeshKey(o);if(h in this._tileMeshCache)return this._tileMeshCache[h];const m=(function(b,C){const R=Hd(C,"16bit"),z=c.aW.deserialize({arrayBuffer:R.vertices,length:R.vertices.byteLength/2/2}),B=c.aY.deserialize({arrayBuffer:R.indices,length:R.indices.byteLength/2/3});return new Yn(b.createVertexBuffer(z,So.members),b.createIndexBuffer(B),c.aX.simpleSegment(0,0,z.length,B.length))})(e,o);return this._tileMeshCache[h]=m,m}recalculate(e){}hasTransition(){const e=Ne();let o=!1;return o=o||(e-this._errorMeasurementLastChangeTime)/1e3<.7,o=o||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,o}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const gp=new c.t({type:new c.D(c.u.projection.type)});class Ph extends c.E{constructor(e){super(),this._transitionable=new c.x(gp,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0)),this._mercatorProjection=new nr,this._verticalPerspectiveProjection=new Rh}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof c.bw){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,o,h,m,b){return this.currentProjection.getMeshFromTileID(e,o,h,m,b)}setProjection(e){this._transitionable.setValue("type",(e==null?void 0:e.type)||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Br(v){const e=Ja(v.worldSize,v.center.lat);return 2*Math.PI*e}function gs(v,e,o,h,m){const b=1/(1<<m),C=e/c.a5*b+h*b,R=c.bz((v/c.a5*b+o*b)*Math.PI*2+Math.PI,2*Math.PI),z=2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI,B=Math.cos(z),U=new Float64Array(3);return U[0]=Math.sin(R)*B,U[1]=Math.sin(z),U[2]=Math.cos(R)*B,U}function di(v){return(function(e,o){const h=Math.cos(o),m=new Float64Array(3);return m[0]=Math.sin(e)*h,m[1]=Math.sin(o),m[2]=Math.cos(e)*h,m})(v.lng*Math.PI/180,v.lat*Math.PI/180)}function Ja(v,e){return v/(2*Math.PI)/Math.cos(e*Math.PI/180)}function zu(v){const e=Math.asin(v[1])/Math.PI*180,o=Math.sqrt(v[0]*v[0]+v[2]*v[2]);if(o>1e-6){const h=v[0]/o,m=Math.acos(v[2]/o),b=(h>0?m:-m)/Math.PI*180;return new c.V(c.W(b,-180,180),e)}return new c.V(0,e)}function Lu(v){return Math.cos(v*Math.PI/180)}function Si(v,e){const o=Lu(v),h=Lu(e);return c.at(h/o)}function Zd(v,e){const o=v.rotate(e.bearingInRadians),h=e.zoom+Si(e.center.lat,0),m=c.bu(1/Lu(e.center.lat),1/Lu(Math.min(Math.abs(e.center.lat),60)),c.bx(h,7,3,0,1)),b=360/Br({worldSize:e.worldSize,center:{lat:e.center.lat}});return new c.V(e.center.lng-o.x*b*m,c.an(e.center.lat+o.y*b,-c.ao,c.ao))}function Ic(v){const e=.5*v,o=Math.sin(e),h=Math.cos(e);return Math.log(o+h)-Math.log(h-o)}function $d(v,e,o,h){const m=v.lat+o*h;if(Math.abs(o)>1){const b=(Math.sign(v.lat+o)!==Math.sign(v.lat)?-Math.abs(v.lat):Math.abs(v.lat))*Math.PI/180,C=Math.abs(v.lat+o)*Math.PI/180,R=Ic(b+h*(C-b)),z=Ic(b),B=Ic(C);return new c.V(v.lng+e*((R-z)/(B-z)),m)}return new c.V(v.lng+e*h,m)}class _p{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,o,h,m){const b=`${e.z}_${e.x}_${e.y}_${m!=null&&m.terrain?"t":""}`,C=this._cache.get(b);if(C)return C;const R=this._cachePrevious.get(b);if(R)return this._cache.set(b,R),R;const z=this._boundingVolumeFactory(e,o,h,m);return this._cache.set(b,z),this._hadAnyChanges=!0,z}}class Vl{constructor(e,o,h,m){this.min=h,this.max=m,this.points=e,this.planes=o}static fromAabb(e,o){const h=[];for(let m=0;m<8;m++)h.push([1&~m?e[0]:o[0],(m>>1&1)==1?o[1]:e[1],(m>>2&1)==1?o[2]:e[2]]);return new Vl(h,[[-1,0,0,o[0]],[1,0,0,-e[0]],[0,-1,0,o[1]],[0,1,0,-e[1]],[0,0,-1,o[2]],[0,0,1,-e[2]]],e,o)}static fromCenterSizeAngles(e,o,h){const m=c.bB([],h[0],h[1],h[2]),b=c.bC([],[o[0],0,0],m),C=c.bC([],[0,o[1],0],m),R=c.bC([],[0,0,o[2]],m),z=[...e],B=[...e];for(let Z=0;Z<8;Z++)for(let H=0;H<3;H++){const X=e[H]+b[H]*(1&~Z?-1:1)+C[H]*((Z>>1&1)==1?1:-1)+R[H]*((Z>>2&1)==1?1:-1);z[H]=Math.min(z[H],X),B[H]=Math.max(B[H],X)}const U=[];for(let Z=0;Z<8;Z++){const H=[...e];c.b0(H,H,c.a$([],b,1&~Z?-1:1)),c.b0(H,H,c.a$([],C,(Z>>1&1)==1?1:-1)),c.b0(H,H,c.a$([],R,(Z>>2&1)==1?1:-1)),U.push(H)}return new Vl(U,[[...b,-c.b5(b,U[0])],[...C,-c.b5(C,U[0])],[...R,-c.b5(R,U[0])],[-b[0],-b[1],-b[2],-c.b5(b,U[7])],[-C[0],-C[1],-C[2],-c.b5(C,U[7])],[-R[0],-R[1],-R[2],-c.b5(R,U[7])]],z,B)}intersectsFrustum(e){let o=!0;const h=this.points.length,m=this.planes.length,b=e.planes.length,C=e.points.length;for(let R=0;R<b;R++){const z=e.planes[R];let B=0;for(let U=0;U<h;U++){const Z=this.points[U];z[0]*Z[0]+z[1]*Z[1]+z[2]*Z[2]+z[3]>=0&&B++}if(B===0)return 0;B<h&&(o=!1)}if(o)return 2;for(let R=0;R<m;R++){const z=this.planes[R];let B=0;for(let U=0;U<C;U++){const Z=e.points[U];z[0]*Z[0]+z[1]*Z[1]+z[2]*Z[2]+z[3]>=0&&B++}if(B===0)return 0}return 1}intersectsPlane(e){const o=this.points.length;let h=0;for(let m=0;m<o;m++){const b=this.points[m];e[0]*b[0]+e[1]*b[1]+e[2]*b[2]+e[3]>=0&&h++}return h===o?2:h===0?0:1}}function Rc(v,e,o){const h=v-e;return h<0?-h:Math.max(0,h-o)}function Gl(v,e,o,h,m){const b=v-o;let C;return C=b<0?Math.min(-b,1+b-m):b>1?Math.min(Math.max(b-m,0),1-b):0,Math.max(C,Rc(e,h,m))}class Dh{constructor(){this._boundingVolumeCache=new _p(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,o,h,m){const b=1<<h.z,C=1/b,R=h.x/b,z=h.y/b;let B=2;return B=Math.min(B,Gl(e,o,R,z,C)),B=Math.min(B,Gl(e,o,R+.5,-z-C,C)),B=Math.min(B,Gl(e,o,R+.5,2-z-C,C)),B}getWrap(e,o,h){const m=1<<o.z,b=1/m,C=o.x/m,R=Rc(e.x,C,b),z=Rc(e.x,C-1,b),B=Rc(e.x,C+1,b),U=Math.min(R,z,B);return U===B?1:U===z?-1:0}allowVariableZoom(e,o){return Nn(e,o)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,o,h,m){return this._boundingVolumeCache.getTileBoundingVolume(e,o,h,m)}_computeTileBoundingVolume(e,o,h,m){var b,C;let R=0,z=0;if(m!=null&&m.terrain){const B=new c.a2(e.z,o,e.z,e.x,e.y),U=m.terrain.getMinMaxElevation(B);R=(b=U.minElevation)!==null&&b!==void 0?b:Math.min(0,h),z=(C=U.maxElevation)!==null&&C!==void 0?C:Math.max(0,h)}if(R/=c.bE,z/=c.bE,R+=1,z+=1,e.z<=0)return Vl.fromAabb([-z,-z,-z],[z,z,z]);if(e.z===1)return Vl.fromAabb([e.x===0?-z:0,e.y===0?0:-z,-z],[e.x===0?0:z,e.y===0?z:0,z]);{const B=[gs(0,0,e.x,e.y,e.z),gs(c.a5,0,e.x,e.y,e.z),gs(c.a5,c.a5,e.x,e.y,e.z),gs(0,c.a5,e.x,e.y,e.z)],U=[];for(const Oe of B)U.push(c.a$([],Oe,z));if(z!==R)for(const Oe of B)U.push(c.a$([],Oe,R));e.y===0&&U.push([0,1,0]),e.y===(1<<e.z)-1&&U.push([0,-1,0]);const Z=[1,1,1],H=[-1,-1,-1];for(const Oe of U)for(let Ue=0;Ue<3;Ue++)Z[Ue]=Math.min(Z[Ue],Oe[Ue]),H[Ue]=Math.max(H[Ue],Oe[Ue]);const X=gs(c.a5/2,c.a5/2,e.x,e.y,e.z),te=c.b4([],[0,1,0],X);c.b3(te,te);const le=c.b4([],X,te);c.b3(le,le);const ce=c.b4([],B[2],B[1]);c.b3(ce,ce);const ue=c.b4([],B[0],B[3]);c.b3(ue,ue),U.push(c.a$([],X,z)),e.y>=(1<<e.z)/2&&U.push(c.a$([],gs(c.a5/2,0,e.x,e.y,e.z),z)),e.y<(1<<e.z)/2&&U.push(c.a$([],gs(c.a5/2,c.a5,e.x,e.y,e.z),z));const fe=Nu(X,U),xe=Nu(le,U),he=[-X[0],-X[1],-X[2],fe.max],ve=[X[0],X[1],X[2],-fe.min],Te=[-le[0],-le[1],-le[2],xe.max],ge=[le[0],le[1],le[2],-xe.min],Ae=[...ce,0],Ve=[...ue,0],ke=[];return e.y===0?ke.push(c.bD(Ve,Ae,he),c.bD(Ve,Ae,ve)):ke.push(c.bD(Te,Ae,he),c.bD(Te,Ae,ve),c.bD(Te,Ve,he),c.bD(Te,Ve,ve)),e.y===(1<<e.z)-1?ke.push(c.bD(Ve,Ae,he),c.bD(Ve,Ae,ve)):ke.push(c.bD(ge,Ae,he),c.bD(ge,Ae,ve),c.bD(ge,Ve,he),c.bD(ge,Ve,ve)),new Vl(ke,[he,ve,Te,ge,Ae,Ve],Z,H)}}}function Nu(v,e){let o=1/0,h=-1/0;for(const m of e){const b=c.b5(v,m);o=Math.min(o,b),h=Math.max(h,b)}return{min:o,max:h}}class ql{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,h){return this._helper.interpolatePadding(e,o,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o){this._helper.resize(e,o)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=c.bF(),this._projectionMatrix=c.bj(),this._globeViewProjMatrix32f=c.bi(),this._globeViewProjMatrixNoCorrection=c.bj(),this._globeViewProjMatrixNoCorrectionInverted=c.bj(),this._globeProjMatrixInverted=c.bj(),this._cameraPosition=c.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(o,h)=>{const m=c.an(o.lat,-c.ao,c.ao),b=c.an(+h,this.minZoom+Si(0,m),this.maxZoom);return{center:new c.V(o.lng,m),zoom:b}},this.applyConstrain=(o,h)=>this._helper.applyConstrain(o,h),this._helper=new pa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(o,h)=>this.defaultConstrain(o,h)},e),this._coveringTilesDetailsProvider=new Dh}clone(){const e=new ql;return e.apply(this,!1),e}apply(e,o,h){this._globeLatitudeErrorCorrectionRadians=h||0,this._helper.apply(e,o)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=c.bA();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:o,applyGlobeMatrix:h}=e,m=this._helper.getMercatorTileCoordinates(o);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:m,clippingPlane:this._cachedClippingPlane,projectionTransition:h?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const o=this.pitchInRadians,h=this.cameraToCenterDistance/e,m=Math.sin(o)*h,b=Math.cos(o)*h+1,C=1/Math.sqrt(m*m+b*b)*1;let R=-m,z=b;const B=Math.sqrt(R*R+z*z);R/=B,z/=B;const U=[0,R,z];c.bG(U,U,[0,0,0],-this.bearingInRadians),c.bH(U,U,[0,0,0],-1*this.center.lat*Math.PI/180),c.bI(U,U,[0,0,0],this.center.lng*Math.PI/180);const Z=1/c.b7(U);return c.a$(U,U,Z),[...U,-C*Z]}isLocationOccluded(e){return!this.isSurfacePointVisible(di(e))}transformLightDirection(e){const o=this._helper._center.lng*Math.PI/180,h=this._helper._center.lat*Math.PI/180,m=Math.cos(h),b=[Math.sin(o)*m,Math.sin(h),Math.cos(o)*m],C=[b[2],0,-b[0]],R=[0,0,0];c.b4(R,C,b),c.b3(C,C),c.b3(R,R);const z=[0,0,0];return c.b3(z,[C[0]*e[0]+R[0]*e[1]+b[0]*e[2],C[1]*e[0]+R[1]*e[1]+b[1]*e[2],C[2]*e[0]+R[2]*e[1]+b[2]*e[2]]),z}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,o,h){const m=(function(R,z,B){const U=1/(1<<B.z);return new c.a9(R/c.a5*U+B.x*U,z/c.a5*U+B.y*U)})(e,o,h.canonical),b=(C=m.y,[c.bz(m.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI]);var C;return this.getCircleRadiusCorrection()/Math.cos(b[1])}projectTileCoordinates(e,o,h,m){const b=h.canonical,C=gs(e,o,b.x,b.y,b.z),R=1+(m?m(e,o):0)/c.bE,z=[C[0]*R,C[1]*R,C[2]*R,1];c.aH(z,z,this._globeViewProjMatrixNoCorrection);const B=this._cachedClippingPlane,U=B[0]*C[0]+B[1]*C[1]+B[2]*C[2]+B[3]<0;return{point:new c.P(z[0]/z[3],z[1]/z[3]),signedDistanceFromCamera:z[3],isOccluded:U}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Ja(this.worldSize,this.center.lat),o=c.bk(),h=c.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),c.be(o,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const m=this.centerOffset;o[8]=2*-m.x/this._helper._width,o[9]=2*m.y/this._helper._height,this._projectionMatrix=c.bf(o),this._globeProjMatrixInverted=c.bk(),c.aB(this._globeProjMatrixInverted,o),c.O(o,o,[0,0,-this.cameraToCenterDistance]),c.bg(o,o,this.rollInRadians),c.bh(o,o,-this.pitchInRadians),c.bg(o,o,this.bearingInRadians),c.O(o,o,[0,0,-e]);const b=c.bA();b[0]=e,b[1]=e,b[2]=e,c.bh(h,o,this.center.lat*Math.PI/180),c.bJ(h,h,-this.center.lng*Math.PI/180),c.Q(h,h,b),this._globeViewProjMatrixNoCorrection=h,c.bh(o,o,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bJ(o,o,-this.center.lng*Math.PI/180),c.Q(o,o,b),this._globeViewProjMatrix32f=new Float32Array(o),this._globeViewProjMatrixNoCorrectionInverted=c.bk(),c.aB(this._globeViewProjMatrixNoCorrectionInverted,h);const C=c.bA();this._cameraPosition=c.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/e,c.bG(this._cameraPosition,this._cameraPosition,C,-this.rollInRadians),c.bH(this._cameraPosition,this._cameraPosition,C,this.pitchInRadians),c.bG(this._cameraPosition,this._cameraPosition,C,-this.bearingInRadians),c.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bH(this._cameraPosition,this._cameraPosition,C,-this.center.lat*Math.PI/180),c.bI(this._cameraPosition,this._cameraPosition,C,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const R=c.bf(this._globeViewProjMatrixNoCorrectionInverted);c.Q(R,R,[1,1,-1]),this._cachedFrustum=kr.fromInvProjectionMatrix(R,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){c.w("calculateFogMatrix is not supported on globe projection.");const o=c.bk();return c.ar(o),o}getVisibleUnwrappedCoordinates(e){return[new c.bc(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,o){if(!this._globeViewProjMatrixNoCorrection)return 1;const h=di(e);c.a$(h,h,1+o/c.bE);const m=c.bF();return c.aH(m,[h[0],h[1],h[2],1],this._globeViewProjMatrixNoCorrection),m[2]/m[3]}populateCache(e){}getBounds(){const e=.5*this.width,o=.5*this.height,h=[new c.P(0,0),new c.P(e,0),new c.P(this.width,0),new c.P(this.width,o),new c.P(this.width,this.height),new c.P(e,this.height),new c.P(0,this.height),new c.P(0,o)],m=[];for(const Z of h)m.push(this.unprojectScreenPoint(Z));let b=0,C=0,R=0,z=0;const B=this.center;for(const Z of m){const H=c.bK(B.lng,Z.lng),X=c.bK(B.lat,Z.lat);H<C&&(C=H),H>b&&(b=H),X<z&&(z=X),X>R&&(R=X)}const U=[B.lng+C,B.lat+z,B.lng+b,B.lat+R];return this.isSurfacePointOnScreen([0,1,0])&&(U[3]=90,U[0]=-180,U[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(U[1]=-90,U[0]=-180,U[2]=180),new un(U)}calculateCenterFromCameraLngLatAlt(e,o,h,m){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,h,m)}setLocationAtPoint(e,o){const h=di(this.unprojectScreenPoint(o)),m=di(e),b=c.bA();c.bL(b);const C=c.bA();c.bI(C,h,b,-this.center.lng*Math.PI/180),c.bH(C,C,b,this.center.lat*Math.PI/180);const R=m[0]*m[0]+m[2]*m[2],z=C[0]*C[0];if(R<z)return;const B=Math.sqrt(R-z),U=-B,Z=c.bM(m[0],m[2],C[0],B),H=c.bM(m[0],m[2],C[0],U),X=c.bA();c.bI(X,m,b,-Z);const te=c.bM(X[1],X[2],C[1],C[2]),le=c.bA();c.bI(le,m,b,-H);const ce=c.bM(le[1],le[2],C[1],C[2]),ue=.5*Math.PI,fe=te>=-ue&&te<=ue,xe=ce>=-ue&&ce<=ue;let he,ve;if(fe&&xe){const Ve=this.center.lng*Math.PI/180,ke=this.center.lat*Math.PI/180;c.bN(Z,Ve)+c.bN(te,ke)<c.bN(H,Ve)+c.bN(ce,ke)?(he=Z,ve=te):(he=H,ve=ce)}else if(fe)he=Z,ve=te;else{if(!xe)return;he=H,ve=ce}const Te=he/Math.PI*180,ge=ve/Math.PI*180,Ae=this.center.lat;this.setCenter(new c.V(Te,c.an(ge,-90,90))),this.setZoom(this.zoom+Si(Ae,this.center.lat))}locationToScreenPoint(e,o){const h=di(e);if(o){const m=o.getElevationForLngLatZoom(e,this._helper._tileZoom);c.a$(h,h,1+m/c.bE)}return this._projectSurfacePointToScreen(h)}_projectSurfacePointToScreen(e){const o=c.bF();return c.aH(o,[...e,1],this._globeViewProjMatrixNoCorrection),o[0]/=o[3],o[1]/=o[3],new c.P((.5*o[0]+.5)*this.width,(.5*-o[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,o){if(o){const h=o.pointCoordinate(e);if(h)return h}return c.a9.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,o){var h;return(h=this.screenPointToMercatorCoordinate(e,o))===null||h===void 0?void 0:h.toLngLat()}isPointOnMapSurface(e,o){const h=this._cameraPosition,m=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(h,m)}getRayDirectionFromPixel(e){const o=c.bF();o[0]=e.x/this.width*2-1,o[1]=-1*(e.y/this.height*2-1),o[2]=1,o[3]=1,c.aH(o,o,this._globeViewProjMatrixNoCorrectionInverted),o[0]/=o[3],o[1]/=o[3],o[2]/=o[3];const h=c.bA();h[0]=o[0]-this._cameraPosition[0],h[1]=o[1]-this._cameraPosition[1],h[2]=o[2]-this._cameraPosition[2];const m=c.bA();return c.b3(m,h),m}isSurfacePointVisible(e){const o=this._cachedClippingPlane;return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]+o[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const o=c.bF();return c.aH(o,[...e,1],this._globeViewProjMatrixNoCorrection),o[0]/=o[3],o[1]/=o[3],o[2]/=o[3],o[0]>-1&&o[0]<1&&o[1]>-1&&o[1]<1&&o[2]>-1&&o[2]<1}rayPlanetIntersection(e,o){const h=c.b5(e,o),m=c.bA(),b=c.bA();c.a$(b,o,h),c.b2(m,e,b);const C=1-c.b5(m,m);if(C<0)return null;const R=c.b5(e,e)-1,z=-h+(h<0?1:-1)*Math.sqrt(C),B=R/z,U=z;return{tMin:Math.min(B,U),tMax:Math.max(B,U)}}unprojectScreenPoint(e){const o=this._cameraPosition,h=this.getRayDirectionFromPixel(e),m=this.rayPlanetIntersection(o,h);if(m){const U=c.bA();c.b0(U,o,[h[0]*m.tMin,h[1]*m.tMin,h[2]*m.tMin]);const Z=c.bA();return c.b3(Z,U),zu(Z)}const b=this._cachedClippingPlane,C=b[0]*h[0]+b[1]*h[1]+b[2]*h[2],R=-c.bb(b,o)/C,z=c.bA();if(R>0)c.b0(z,o,[h[0]*R,h[1]*R,h[2]*R]);else{const U=c.bA();c.b0(U,o,[2*h[0],2*h[1],2*h[2]]);const Z=c.bb(this._cachedClippingPlane,U);c.b2(z,U,[this._cachedClippingPlane[0]*Z,this._cachedClippingPlane[1]*Z,this._cachedClippingPlane[2]*Z])}const B=(function(U){const Z=c.bA();return Z[0]=U[0]*-U[3],Z[1]=U[1]*-U[3],Z[2]=U[2]*-U[3],{center:Z,radius:Math.sqrt(1-U[3]*U[3])}})(b);return zu((function(U,Z,H){const X=c.bA();c.b2(X,H,U);const te=c.bA();return c.by(te,U,X,Z/c.b9(X)),te})(B.center,B.radius,z))}getMatrixForModel(e,o){const h=c.V.convert(e),m=1/c.bE,b=c.bj();return c.bJ(b,b,h.lng/180*Math.PI),c.bh(b,b,-h.lat/180*Math.PI),c.O(b,b,[0,0,1+o/c.bE]),c.bh(b,b,.5*Math.PI),c.Q(b,b,[m,m,m]),b}getProjectionDataForCustomLayer(e=!0){const o=this.getProjectionData({overscaledTileID:new c.a2(0,0,0,0,0),applyGlobeMatrix:e});return o.tileMercatorCoords=[0,0,1,1],o}getFastPathSimpleProjectionMatrix(e){}}class Hl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,h){return this._helper.interpolatePadding(e,o,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o,h=!0){this._helper.resize(e,o,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,o){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=o,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(o,h)=>this.currentTransform.defaultConstrain(o,h),this.applyConstrain=(o,h)=>this._helper.applyConstrain(o,h),this._helper=new pa({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(o,h)=>this.defaultConstrain(o,h)},e),this._globeness=1,this._mercatorTransform=new Ji,this._verticalPerspectiveTransform=new ql}clone(){const e=new Hl;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this,!1),e}apply(e,o){this._helper.apply(e,o),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const o=this._mercatorTransform.getProjectionData(e),h=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?h.mainMatrix:o.mainMatrix,clippingPlane:h.clippingPlane,tileMercatorCoords:h.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:o.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return c.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,o,h){const m=this._mercatorTransform.getPitchedTextCorrection(e,o,h),b=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,o,h);return c.bu(m,b,this._globeness)}projectTileCoordinates(e,o,h,m){return this.currentTransform.projectTileCoordinates(e,o,h,m)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,o){return this.currentTransform.lngLatToCameraDepth(e,o)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,o,h,m){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,h,m)}setLocationAtPoint(e,o){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,o),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(e,o),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(e,o){return this.currentTransform.locationToScreenPoint(e,o)}screenPointToMercatorCoordinate(e,o){return this.currentTransform.screenPointToMercatorCoordinate(e,o)}screenPointToLocation(e,o){return this.currentTransform.screenPointToLocation(e,o)}isPointOnMapSurface(e,o){return this.currentTransform.isPointOnMapSurface(e,o)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,o){return this.currentTransform.getMatrixForModel(e,o)}getProjectionDataForCustomLayer(e=!0){const o=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return o;const h=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return h.fallbackMatrix=o.mainMatrix,h}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Li{get useGlobeControls(){return!0}handlePanInertia(e,o){const h=Zd(e,o);return Math.abs(h.lng-o.center.lng)>180&&(h.lng=o.center.lng+179.5*Math.sign(h.lng-o.center.lng)),{easingCenter:h,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,o){const h=e.around,m=o.screenPointToLocation(h);e.bearingDelta&&o.setBearing(o.bearing+e.bearingDelta),e.pitchDelta&&o.setPitch(o.pitch+e.pitchDelta),e.rollDelta&&o.setRoll(o.roll+e.rollDelta);const b=o.zoom;e.zoomDelta&&o.setZoom(o.zoom+e.zoomDelta);const C=o.zoom-b;if(C===0)return;const R=c.bK(o.center.lng,m.lng),z=R/(Math.abs(R/180)+1),B=c.bK(o.center.lat,m.lat),U=o.getRayDirectionFromPixel(h),Z=o.cameraPosition,H=-1*c.b5(Z,U),X=c.bA();c.b0(X,Z,[U[0]*H,U[1]*H,U[2]*H]);const te=c.b7(X)-1,le=Math.exp(.5*-Math.max(te-.3,0)),ce=Ja(o.worldSize,o.center.lat)/Math.min(o.width,o.height),ue=c.bx(ce,.9,.5,1,.25),fe=(1-c.aq(-C))*Math.min(le,ue),xe=o.center.lat,he=o.zoom,ve=new c.V(o.center.lng+z*fe,c.an(o.center.lat+B*fe,-c.ao,c.ao));o.setLocationAtPoint(m,h);const Te=o.center,ge=c.bx(Math.abs(R),45,85,0,1),Ae=c.bx(ce,.75,.35,0,1),Ve=Math.pow(Math.max(ge,Ae),.25),ke=c.bK(Te.lng,ve.lng),Oe=c.bK(Te.lat,ve.lat);o.setCenter(new c.V(Te.lng+ke*Ve,Te.lat+Oe*Ve).wrap()),o.setZoom(he+Si(xe,o.center.lat))}handleMapControlsPan(e,o,h){if(!e.panDelta)return;const m=o.center.lat,b=o.zoom;o.setCenter(Zd(e.panDelta,o).wrap()),o.setZoom(b+Si(m,o.center.lat))}cameraForBoxAndBearing(e,o,h,m,b){const C=ja(e,o,h,m,b),R=o.left/b.width*2-1,z=(b.width-o.right)/b.width*2-1,B=o.top/b.height*-2+1,U=(b.height-o.bottom)/b.height*-2+1,Z=c.bK(h.getWest(),h.getEast())<0,H=Z?h.getEast():h.getWest(),X=Z?h.getWest():h.getEast(),te=Math.max(h.getNorth(),h.getSouth()),le=Math.min(h.getNorth(),h.getSouth()),ce=H+.5*c.bK(H,X),ue=te+.5*c.bK(te,le),fe=b.clone();fe.setCenter(C.center),fe.setBearing(C.bearing),fe.setPitch(0),fe.setRoll(0),fe.setZoom(C.zoom);const xe=fe.modelViewProjectionMatrix,he=[di(h.getNorthWest()),di(h.getNorthEast()),di(h.getSouthWest()),di(h.getSouthEast()),di(new c.V(X,ue)),di(new c.V(H,ue)),di(new c.V(ce,te)),di(new c.V(ce,le))],ve=di(C.center);let Te=Number.POSITIVE_INFINITY;for(const ge of he)R<0&&(Te=Li.getLesserNonNegativeNonNull(Te,Li.solveVectorScale(ge,ve,xe,"x",R))),z>0&&(Te=Li.getLesserNonNegativeNonNull(Te,Li.solveVectorScale(ge,ve,xe,"x",z))),B>0&&(Te=Li.getLesserNonNegativeNonNull(Te,Li.solveVectorScale(ge,ve,xe,"y",B))),U<0&&(Te=Li.getLesserNonNegativeNonNull(Te,Li.solveVectorScale(ge,ve,xe,"y",U)));if(Number.isFinite(Te)&&Te!==0)return C.zoom=fe.zoom+c.at(Te),C;Fr()}handleJumpToCenterZoom(e,o){const h=e.center.lat,m=e.applyConstrain(o.center?c.V.convert(o.center):e.center,e.zoom).center;e.setCenter(m.wrap());const b=o.zoom!==void 0?+o.zoom:e.zoom+Si(h,m.lat);e.zoom!==b&&e.setZoom(b)}handleEaseTo(e,o){const h=e.zoom,m=e.center,b=e.padding,C={roll:e.roll,pitch:e.pitch,bearing:e.bearing},R={roll:o.roll===void 0?e.roll:o.roll,pitch:o.pitch===void 0?e.pitch:o.pitch,bearing:o.bearing===void 0?e.bearing:o.bearing},z=o.zoom!==void 0,B=!e.isPaddingEqual(o.padding);let U=!1;const Z=o.center?c.V.convert(o.center):m,H=e.applyConstrain(Z,h).center;ms(e,H);const X=e.clone();X.setCenter(H),X.setZoom(z?+o.zoom:h+Si(m.lat,Z.lat)),X.setBearing(o.bearing);const te=new c.P(c.an(e.centerPoint.x+o.offsetAsPoint.x,0,e.width),c.an(e.centerPoint.y+o.offsetAsPoint.y,0,e.height));X.setLocationAtPoint(H,te);const le=(o.offset&&o.offsetAsPoint.mag())>0?X.center:H,ce=z?+o.zoom:h+Si(m.lat,le.lat),ue=h+Si(m.lat,0),fe=ce+Si(le.lat,0),xe=c.bK(m.lng,le.lng),he=c.bK(m.lat,le.lat),ve=c.aq(fe-ue);return U=ce!==h,{easeFunc:Te=>{if(c.bo(C,R)||Ru({startEulerAngles:C,endEulerAngles:R,tr:e,k:Te,useSlerp:C.roll!=R.roll}),B&&e.interpolatePadding(b,o.padding,Te),o.around)c.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(o.around,o.aroundPoint);else{const ge=fe>ue?Math.min(2,ve):Math.max(.5,ve),Ae=Math.pow(ge,1-Te),Ve=$d(m,xe,he,Te*Ae);e.setCenter(Ve.wrap())}if(U){const ge=c.G.number(ue,fe,Te)+Si(0,e.center.lat);e.setZoom(ge)}},isZooming:U,elevationCenter:le}}handleFlyTo(e,o){const h=o.zoom!==void 0,m=e.center,b=e.zoom,C=e.padding,R=!e.isPaddingEqual(o.padding),z=e.applyConstrain(c.V.convert(o.center||o.locationAtOffset),b).center,B=h?+o.zoom:e.zoom+Si(e.center.lat,z.lat),U=e.clone();U.setCenter(z),U.setZoom(B),U.setBearing(o.bearing);const Z=new c.P(c.an(e.centerPoint.x+o.offsetAsPoint.x,0,e.width),c.an(e.centerPoint.y+o.offsetAsPoint.y,0,e.height));U.setLocationAtPoint(z,Z);const H=U.center;ms(e,H);const X=(function(he,ve,Te){const ge=di(ve),Ae=di(Te),Ve=c.b5(ge,Ae),ke=Math.acos(Ve),Oe=Br(he);return ke/(2*Math.PI)*Oe})(e,m,H),te=b+Si(m.lat,0),le=B+Si(H.lat,0),ce=c.aq(le-te);let ue;if(typeof o.minZoom=="number"){const he=+o.minZoom+Si(H.lat,0),ve=Math.min(he,te,le)+Si(0,H.lat),Te=e.applyConstrain(H,ve).zoom+Si(H.lat,0);ue=c.aq(Te-te)}const fe=c.bK(m.lng,H.lng),xe=c.bK(m.lat,H.lat);return{easeFunc:(he,ve,Te,ge)=>{const Ae=$d(m,fe,xe,Te);R&&e.interpolatePadding(C,o.padding,he);const Ve=he===1?H:Ae;e.setCenter(Ve.wrap());const ke=te+c.at(ve);e.setZoom(he===1?B:ke+Si(0,Ve.lat))},scaleOfZoom:ce,targetCenter:H,scaleOfMinZoom:ue,pixelPathLength:X}}static solveVectorScale(e,o,h,m,b){const C=m==="x"?[h[0],h[4],h[8],h[12]]:[h[1],h[5],h[9],h[13]],R=[h[3],h[7],h[11],h[15]],z=e[0]*C[0]+e[1]*C[1]+e[2]*C[2],B=e[0]*R[0]+e[1]*R[1]+e[2]*R[2],U=o[0]*C[0]+o[1]*C[1]+o[2]*C[2],Z=o[0]*R[0]+o[1]*R[1]+o[2]*R[2];return U+b*B===z+b*Z||R[3]*(z-U)+C[3]*(Z-B)+z*Z==U*B?null:(U+C[3]-b*Z-b*R[3])/(U-z-b*Z+b*B)}static getLesserNonNegativeNonNull(e,o){return o!==null&&o>=0&&o<e?o:e}}class Zl{constructor(e){this._globe=e,this._mercatorCameraHelper=new Ya,this._verticalPerspectiveCameraHelper=new Li}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,o){return this.currentHelper.handlePanInertia(e,o)}handleMapControlsRollPitchBearingZoom(e,o){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,o)}handleMapControlsPan(e,o,h){this.currentHelper.handleMapControlsPan(e,o,h)}cameraForBoxAndBearing(e,o,h,m,b){return this.currentHelper.cameraForBoxAndBearing(e,o,h,m,b)}handleJumpToCenterZoom(e,o){this.currentHelper.handleJumpToCenterZoom(e,o)}handleEaseTo(e,o){return this.currentHelper.handleEaseTo(e,o)}handleFlyTo(e,o){return this.currentHelper.handleFlyTo(e,o)}}const $l=(v,e)=>c.B(v,e&&e.filter((o=>o.identifier!=="source.canvas"))),jl=c.bO();class ya extends c.E{constructor(e,o={}){var h,m;super(),this._rtlPluginLoaded=()=>{for(const C in this.tileManagers){const R=this.tileManagers[C].getSource().type;R!=="vector"&&R!=="geojson"||this.tileManagers[C].reload()}},this.map=e,this.dispatcher=new ei(gn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((C,R)=>this.getGlyphs(C,R))),this.dispatcher.registerMessageHandler("GI",((C,R)=>this.getImages(C,R))),this.dispatcher.registerMessageHandler("GDA",((C,R)=>this.getDashes(C,R))),this.imageManager=new an,this.imageManager.setEventedParent(this);const b=((h=e._container)===null||h===void 0?void 0:h.lang)||typeof document<"u"&&((m=document.documentElement)===null||m===void 0?void 0:m.lang)||void 0;this.glyphManager=new ft(e._requestManager,o.localIdeographFontFamily,b),this.lineAtlas=new Et(256,512),this.crossTileSymbolIndex=new tr,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",c.bP()),ne().on(Re,this._rtlPluginLoaded),this.on("data",(C=>{if(C.dataType!=="source"||C.sourceDataType!=="metadata")return;const R=this.tileManagers[C.sourceId];if(!R)return;const z=R.getSource();if(z&&z.vectorLayerIds)for(const B in this._layers){const U=this._layers[B];U.source===z.id&&this._validateLayer(U)}}))}_setInitialValues(){var e;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new c.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((e=this.crossTileSymbolIndex)===null||e===void 0?void 0:e.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(e,o){var h,m,b;this._checkLoaded();const C=o===null?(b=(m=(h=this.stylesheet.state)===null||h===void 0?void 0:h[e])===null||m===void 0?void 0:m.default)!==null&&b!==void 0?b:null:o;if(c.bR(C,this._globalState[e]))return this;this._globalState[e]=C,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const o=[];for(const h in e)!c.bR(this._globalState[h],e[h].default)&&(o.push(h),this._globalState[h]=e[h].default);this._applyGlobalStateChanges(o)}_applyGlobalStateChanges(e){if(e.length===0)return;const o=new Set,h={};for(const m of e){h[m]=this._globalState[m];for(const b in this._layers){const C=this._layers[b],R=C.getLayoutAffectingGlobalStateRefs(),z=C.getPaintAffectingGlobalStateRefs(),B=C.getVisibilityAffectingGlobalStateRefs();if(R.has(m)&&o.add(C.source),z.has(m))for(const{name:U,value:Z}of z.get(m))this._updatePaintProperty(C,U,Z);B!=null&&B.has(m)&&(C.recalculateVisibility(),this._updateLayer(C))}}this.dispatcher.broadcast("UGS",h);for(const m in this.tileManagers)o.has(m)&&(this._reloadSource(m),this._changed=!0)}loadURL(e,o={},h){this.fire(new c.l("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const m=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;c.j(m,this._loadStyleRequest).then((C=>{this._loadStyleRequest=null,this._load(C.data,o,h)})).catch((C=>{this._loadStyleRequest=null,C&&!b.signal.aborted&&this.fire(new c.k(C))}))}loadJSON(e,o={},h){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ye.frameAsync(this._frameRequest,this.map._ownerWindow).then((()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(e,o,h)})).catch((()=>{}))}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(jl,{validate:!1})}_load(e,o,h){var m,b;let C=o.transformStyle?o.transformStyle(h,e):e;if(!o.validate||!$l(this,c.C(C))){C=Object.assign({},C),this._loaded=!0,this.stylesheet=C;for(const R in C.sources)this.addSource(R,C.sources[R],{validate:!1});C.sprite?this._loadSprite(C.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(C.glyphs),this._createLayers(),this.light=new yn(this.stylesheet.light),this._setProjectionInternal(((m=this.stylesheet.projection)===null||m===void 0?void 0:m.type)||"mercator"),this.sky=new at(this.stylesheet.sky),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){var e,o,h;const m=c.bS(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",m),this._order=m.map((b=>b.id)),this._layers={},this._serializedLayers=null;for(const b of m){const C=c.bT(b,this._globalState);if(C.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=C,c.bU(C)&&this.tileManagers[C.source]){const R=(h=(o=b.paint)===null||o===void 0?void 0:o["raster-fade-duration"])!==null&&h!==void 0?h:C.paint.get("raster-fade-duration");this.tileManagers[C.source].setRasterFadeDuration(R)}}}_loadSprite(e,o=!1,h=void 0){this.imageManager.setLoaded(!1);const m=new AbortController;let b;this._spriteRequest=m,(function(C,R,z,B){return c._(this,void 0,void 0,(function*(){const U=At(C),Z=z>1?"@2x":"",H={},X={};for(const{id:te,url:le}of U){const ce=R.transformRequest(Xt(le,Z,".json"),"SpriteJSON");H[te]=c.j(ce,B);const ue=R.transformRequest(Xt(le,Z,".png"),"SpriteImage");X[te]=_t.getImage(ue,B)}return yield Promise.all([...Object.values(H),...Object.values(X)]),(function(te,le){return c._(this,void 0,void 0,(function*(){const ce={};for(const ue in te){ce[ue]={};const fe=ye.getImageCanvasContext((yield le[ue]).data),xe=(yield te[ue]).data;for(const he in xe){const{width:ve,height:Te,x:ge,y:Ae,sdf:Ve,pixelRatio:ke,stretchX:Oe,stretchY:Ue,content:pt,textFitWidth:mt,textFitHeight:ot}=xe[he];ce[ue][he]={data:null,pixelRatio:ke,sdf:Ve,stretchX:Oe,stretchY:Ue,content:pt,textFitWidth:mt,textFitHeight:ot,spriteData:{width:ve,height:Te,x:ge,y:Ae,context:fe}}}}return ce}))})(H,X)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((C=>{if(this._spriteRequest=null,C)for(const R in C){this._spritesImagesIds[R]=[];const z=this._spritesImagesIds[R]?this._spritesImagesIds[R].filter((B=>!(B in C))):[];for(const B of z)this.imageManager.removeImage(B),this._changedImages[B]=!0;for(const B in C[R]){const U=R==="default"?B:`${R}:${B}`;this._spritesImagesIds[R].push(U),U in this.imageManager.images?this.imageManager.updateImage(U,C[R][B],!1):this.imageManager.addImage(U,C[R][B]),o&&(this._changedImages[U]=!0)}}})).catch((C=>{this._spriteRequest=null,b=C,m.signal.aborted||this.fire(new c.k(b))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),h&&h(b)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(e){const o=this.tileManagers[e.source];if(!o)return;const h=e.sourceLayer;if(!h)return;const m=o.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(h)===-1)&&this.fire(new c.k(new Error(`Source layer "${h}" does not exist on source "${m.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.tileManagers)if(!this.tileManagers[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,o=!1){const h=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o?c.bV(h):h);const m=[];for(const b of e)if(h[b]){const C=o?c.bV(h[b]):h[b];m.push(C)}return m}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const o=Object.keys(this._layers);for(const h of o){const m=this._layers[h];m.type!=="custom"&&(e[h]=m.serialize())}return e}hasTransitions(){var e,o,h;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((o=this.sky)===null||o===void 0)&&o.hasTransition()||!((h=this.projection)===null||h===void 0)&&h.hasTransition())return!0;for(const m in this.tileManagers)if(this.tileManagers[m].hasTransition())return!0;for(const m in this._layers)if(this._layers[m].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const o=this._changed;if(o){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const C in this._updatedSources){const R=this._updatedSources[C];if(R==="reload")this._reloadSource(C);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const h={};for(const m in this.tileManagers){const b=this.tileManagers[m];h[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(e,this._availableImages),!b.isHidden(e.zoom)&&b.source&&(this.tileManagers[b.source].used=!0)}for(const m in h){const b=this.tileManagers[m];!!h[m]!=!!b.used&&b.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,o&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const o in this.tileManagers)this.tileManagers[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.tileManagers)this.tileManagers[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){var h;this._checkLoaded();const m=this.serialize();if(e=o.transformStyle?o.transformStyle(m,e):e,((h=o.validate)===null||h===void 0||h)&&$l(this,c.C(e)))return!1;(e=c.bV(e)).layers=c.bS(e.layers);const b=c.bW(m,e),C=this._getOperationsToPerform(b);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const R of C.operations)R();return this.stylesheet=e,this._serializedLayers=null,this.fire(new c.l("style.load",{style:this})),!0}_getOperationsToPerform(e){const o=[],h=[];for(const m of e)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":o.push((()=>this.addLayer.apply(this,m.args)));break;case"removeLayer":o.push((()=>this.removeLayer.apply(this,m.args)));break;case"setPaintProperty":o.push((()=>this.setPaintProperty.apply(this,m.args)));break;case"setLayoutProperty":o.push((()=>this.setLayoutProperty.apply(this,m.args)));break;case"setFilter":o.push((()=>this.setFilter.apply(this,m.args)));break;case"addSource":o.push((()=>this.addSource.apply(this,m.args)));break;case"removeSource":o.push((()=>this.removeSource.apply(this,m.args)));break;case"setLayerZoomRange":o.push((()=>this.setLayerZoomRange.apply(this,m.args)));break;case"setLight":o.push((()=>this.setLight.apply(this,m.args)));break;case"setGeoJSONSourceData":o.push((()=>this.setGeoJSONSourceData.apply(this,m.args)));break;case"setGlyphs":o.push((()=>this.setGlyphs.apply(this,m.args)));break;case"setSprite":o.push((()=>this.setSprite.apply(this,m.args)));break;case"setTerrain":o.push((()=>this.map.setTerrain.apply(this,m.args)));break;case"setSky":o.push((()=>this.setSky.apply(this,m.args)));break;case"setProjection":this.setProjection.apply(this,m.args);break;case"setGlobalState":o.push((()=>this.setGlobalState.apply(this,m.args)));break;case"setTransition":o.push((()=>{}));break;default:h.push(m.command)}return{operations:o,unimplemented:h}}addImage(e,o){if(this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,h={}){if(this._checkLoaded(),this.tileManagers[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(c.C.source,`sources.${e}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const m=this.tileManagers[e]=new vn(e,o,this.dispatcher);m.style=this,m.setEventedParent(this,(()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:e}))),m.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===e)return this.fire(new c.k(new Error(`Source "${e}" cannot be removed while layer "${h}" is using it.`)));const o=this.tileManagers[e];delete this.tileManagers[e],delete this._updatedSources[e],o.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const h=this.tileManagers[e].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(o),this._changed=!0}getSource(e){return this.tileManagers[e]&&this.tileManagers[e].getSource()}addLayer(e,o,h={}){this._checkLoaded();const m=e.id;if(this.getLayer(m))return void this.fire(new c.k(new Error(`Layer "${m}" already exists on this map.`)));let b;if(e.type==="custom"){if($l(this,c.bX(e)))return;b=c.bT(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(m,e.source),e=c.bV(e),e=c.e(e,{source:m})),this._validate(c.C.layer,`layers.${m}`,e,{arrayIndex:-1},h))return;b=c.bT(e,this._globalState),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const C=o?this._order.indexOf(o):this._order.length;if(o&&C===-1)this.fire(new c.k(new Error(`Cannot add layer "${m}" before non-existing layer "${o}".`)));else{if(this._order.splice(C,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const R=this._removedLayers[m];delete this._removedLayers[m],R.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.tileManagers[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;const h=this._order.indexOf(e);this._order.splice(h,1);const m=o?this._order.indexOf(o):this._order.length;o&&m===-1?this.fire(new c.k(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(m,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const o=this._layers[e];if(!o)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);const h=this._order.indexOf(e);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,h){this._checkLoaded();const m=this.getLayer(e);m?m.minzoom===o&&m.maxzoom===h||(o!=null&&(m.minzoom=o),h!=null&&(m.maxzoom=h),this._updateLayer(m)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,h={}){this._checkLoaded();const m=this.getLayer(e);if(m){if(!c.bR(m.filter,o))return o==null?(m.setFilter(void 0),void this._updateLayer(m)):void(this._validate(c.C.filter,`layers.${m.id}.filter`,o,null,h)||(m.setFilter(c.bV(o)),this._updateLayer(m)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.bV(this.getLayer(e).filter)}setLayoutProperty(e,o,h,m={}){this._checkLoaded();const b=this.getLayer(e);b?c.bR(b.getLayoutProperty(o),h)||(b.setLayoutProperty(o,h,m),this._updateLayer(b)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){const h=this.getLayer(e);if(h)return h.getLayoutProperty(o);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,h,m={}){this._checkLoaded();const b=this.getLayer(e);b?c.bR(b.getPaintProperty(o),h)||this._updatePaintProperty(b,o,h,m):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,o,h,m={}){e.setPaintProperty(o,h,m)&&this._updateLayer(e),c.bU(e)&&o==="raster-fade-duration"&&this.tileManagers[e.source].setRasterFadeDuration(h),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();const h=e.source,m=e.sourceLayer,b=this.tileManagers[h];if(b===void 0)return void this.fire(new c.k(new Error(`The source '${h}' does not exist in the map's style.`)));const C=b.getSource().type;C==="geojson"&&m?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||m?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,e.id,o)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();const h=e.source,m=this.tileManagers[h];if(m===void 0)return void this.fire(new c.k(new Error(`The source '${h}' does not exist in the map's style.`)));const b=m.getSource().type,C=b==="vector"?e.sourceLayer:void 0;b!=="vector"||C?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(C,e.id,o):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const o=e.source,h=e.sourceLayer,m=this.tileManagers[o];if(m!==void 0)return m.getSource().type!=="vector"||h?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),m.getFeatureState(h,e.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.bY(this.tileManagers,(b=>b.serialize())),o=this._serializeByIds(this._order,!0),h=this.map.getTerrain()||void 0,m=this.stylesheet;return c.bZ({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,projection:m.projection,sources:e,layers:o,terrain:h},(b=>b!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.tileManagers[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.tileManagers[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const o=C=>this._layers[C].type==="fill-extrusion",h={},m=[];for(let C=this._order.length-1;C>=0;C--){const R=this._order[C];if(o(R)){h[R]=C;for(const z of e){const B=z[R];if(B)for(const U of B)m.push(U)}}}m.sort(((C,R)=>R.intersectionZ-C.intersectionZ));const b=[];for(let C=this._order.length-1;C>=0;C--){const R=this._order[C];if(o(R))for(let z=m.length-1;z>=0;z--){const B=m[z].feature;if(h[B.layer.id]<C)break;b.push(B),m.pop()}else for(const z of e){const B=z[R];if(B)for(const U of B)b.push(U.feature)}}return b}queryRenderedFeatures(e,o,h){o&&o.filter&&this._validate(c.C.filter,"queryRenderedFeatures.filter",o.filter,null,o);const m={};if(o&&o.layers){if(!(Array.isArray(o.layers)||o.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const B of o.layers){const U=this._layers[B];if(!U)return this.fire(new c.k(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];m[U.source]=!0}}const b=[];o.availableImages=this._availableImages;const C=this._serializedAllLayers(),R=o.layers instanceof Set?o.layers:Array.isArray(o.layers)?new Set(o.layers):null,z=Object.assign(Object.assign({},o),{layers:R,globalState:this._globalState});for(const B in this.tileManagers)o.layers&&!m[B]||b.push(er(this.tileManagers[B],this._layers,C,e,z,h,this.map.terrain?(U,Z,H)=>this.map.terrain.getElevation(U,Z,H):void 0));return this.placement&&b.push((function(B,U,Z,H,X,te,le){const ce={},ue=te.queryRenderedSymbols(H),fe=[];for(const xe of Object.keys(ue).map(Number))fe.push(le[xe]);fe.sort(wn);for(const xe of fe){const he=xe.featureIndex.lookupSymbolFeatures(ue[xe.bucketInstanceId],U,xe.bucketIndex,xe.sourceLayerIndex,{filterSpec:X.filter,globalState:X.globalState},X.layers,X.availableImages,B);for(const ve in he){const Te=ce[ve]=ce[ve]||[],ge=he[ve];ge.sort(((Ae,Ve)=>{const ke=xe.featureSortOrder;if(ke){const Oe=ke.indexOf(Ae.featureIndex);return ke.indexOf(Ve.featureIndex)-Oe}return Ve.featureIndex-Ae.featureIndex}));for(const Ae of ge)Te.push(Ae)}}return(function(xe,he,ve){for(const Te in xe)for(const ge of xe[Te])ji(ge,ve[he[Te].source]);return xe})(ce,B,Z)})(this._layers,C,this.tileManagers,e,z,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(e,o){o!=null&&o.filter&&this._validate(c.C.filter,"querySourceFeatures.filter",o.filter,null,o);const h=this.tileManagers[e];return h?(function(m,b){const C=m.getRenderableIds().map((B=>m.getTileByID(B))),R=[],z={};for(let B=0;B<C.length;B++){const U=C[B],Z=U.tileID.canonical.key;z[Z]||(z[Z]=!0,U.querySourceFeatures(R,b))}return R})(h,o?Object.assign(Object.assign({},o),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();const h=this.light.getLight();let m=!1;for(const C in e)if(!c.bR(e[C],h[C])){m=!0;break}if(!m)return;const b={now:Ne(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(b)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,o={}){this._checkLoaded();const h=this.getSky();let m=!1;if(!e&&!h)return;if(e&&!h)m=!0;else if(!e&&h)m=!0;else for(const C in e)if(!c.bR(e[C],h[C])){m=!0;break}if(!m)return;const b={now:Ne(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,o),this.sky.updateTransitions(b)}_setProjectionInternal(e){const o=(function(h,m){const b={constrainOverride:m};if(Array.isArray(h)){const C=new Ph({type:h});return{projection:C,transform:new Hl(b),cameraHelper:new Zl(C)}}switch(h){case"mercator":return{projection:new nr,transform:new Ji(b),cameraHelper:new Ya};case"globe":{const C=new Ph({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:C,transform:new Hl(b),cameraHelper:new Zl(C)}}case"vertical-perspective":return{projection:new Rh,transform:new ql(b),cameraHelper:new Li};default:return c.w(`Unknown projection name: ${h}. Falling back to mercator projection.`),{projection:new nr,transform:new Ji(b),cameraHelper:new Ya}}})(e,this.map.transformConstrain);this.projection=o.projection,this.map.migrateProjection(o.transform,o.cameraHelper);for(const h in this.tileManagers)this.tileManagers[h].reload()}_validate(e,o,h,m,b={}){return(!b||b.validate!==!1)&&$l(this,e.call(c.C,c.e({key:o,style:this.serialize(),value:h,styleSpec:c.u},m)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ne().off(Re,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.tileManagers){const h=this.tileManagers[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.tileManagers[e].clearTiles()}_reloadSource(e){this.tileManagers[e].resume(),this.tileManagers[e].reload()}_updateSources(e){for(const o in this.tileManagers)this.tileManagers[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.tileManagers)this._reloadSource(e)}_updatePlacement(e,o,h,m,b=!1){let C=!1,R=!1;const z={};for(const B of this._order){const U=this._layers[B];if(U.type!=="symbol")continue;if(!z[U.source]){const H=this.tileManagers[U.source];z[U.source]=H.getRenderableIds(!0).map((X=>H.getTileByID(X))).sort(((X,te)=>te.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(te.tileID)?-1:1)))}const Z=this.crossTileSymbolIndex.addLayer(U,z[U.source],e.center.lng);C=C||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Ne(),e.zoom))&&(this.pauseablePlacement=new Ul(e,this.map.terrain,this._order,b,o,h,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Ne()),R=!0),C&&this.pauseablePlacement.placement.setStale()),R||C)for(const B of this._order){const U=this._layers[B];U.type==="symbol"&&this.placement.updateLayerOpacities(U,z[U.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Ne())}_releaseSymbolFadeTiles(){for(const e in this.tileManagers)this.tileManagers[e].releaseSymbolFadeTiles()}getImages(e,o){return c._(this,void 0,void 0,(function*(){const h=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const m=this.tileManagers[o.source];return m&&m.setDependencies(o.tileID.key,o.type,o.icons),h}))}getGlyphs(e,o){return c._(this,void 0,void 0,(function*(){const h=yield this.glyphManager.getGlyphs(o.stacks),m=this.tileManagers[o.source];return m&&m.setDependencies(o.tileID.key,o.type,[""]),h}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(c.C.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,o){return c._(this,void 0,void 0,(function*(){const h={};for(const[m,b]of Object.entries(o.dashes))h[m]=this.lineAtlas.getDash(b.dasharray,b.round);return h}))}addSprite(e,o,h={},m){this._checkLoaded();const b=[{id:e,url:o}],C=[...At(this.stylesheet.sprite),...b];this._validate(c.C.sprite,"sprite",C,null,h)||(this.stylesheet.sprite=C,this._loadSprite(b,!0,m))}removeSprite(e){this._checkLoaded();const o=At(this.stylesheet.sprite);if(o.find((h=>h.id===e))){if(this._spritesImagesIds[e])for(const h of this._spritesImagesIds[e])this.imageManager.removeImage(h),this._changedImages[h]=!0;o.splice(o.findIndex((h=>h.id===e)),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return At(this.stylesheet.sprite)}setSprite(e,o={},h){this._checkLoaded(),e&&this._validate(c.C.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,h):(this._unloadSprite(),h&&h(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const e in this.tileManagers){const o=this.tileManagers[e];o.setEventedParent(null),o.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const e in this._layers){const o=this._layers[e];o.setEventedParent(null),o.onRemove&&o.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var jd=c.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ku{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,h,m,b,C,R,z,B){this.context=e;let U=this.boundPaintVertexBuffers.length!==m.length;for(let Z=0;!U&&Z<m.length;Z++)this.boundPaintVertexBuffers[Z]!==m[Z]&&(U=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||U||this.boundIndexBuffer!==b||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==z||this.boundDynamicVertexBuffer3!==B?this.freshBind(o,h,m,b,C,R,z,B):(e.bindVertexArray.set(this.vao),R&&R.bind(),b&&b.dynamicDraw&&b.bind(),z&&z.bind(),B&&B.bind())}freshBind(e,o,h,m,b,C,R,z){const B=e.numAttributes,U=this.context,Z=U.gl;this.vao&&this.destroy(),this.vao=U.createVertexArray(),U.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=z,o.enableAttributes(Z,e);for(const H of h)H.enableAttributes(Z,e);C&&C.enableAttributes(Z,e),R&&R.enableAttributes(Z,e),z&&z.enableAttributes(Z,e),o.bind(),o.setVertexAttribPointers(Z,e,b);for(const H of h)H.bind(),H.setVertexAttribPointers(Z,e,b);C&&(C.bind(),C.setVertexAttribPointers(Z,e,b)),m&&m.bind(),R&&(R.bind(),R.setVertexAttribPointers(Z,e,b)),z&&(z.bind(),z.setVertexAttribPointers(Z,e,b)),U.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Yd=(v,e,o,h,m)=>({u_texture:0,u_ele_delta:v,u_fog_matrix:e,u_fog_color:o?o.properties.get("fog-color"):c.bp.white,u_fog_ground_blend:o?o.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?0:o?o.calculateFogBlendOpacity(h):0,u_horizon_color:o?o.properties.get("horizon-color"):c.bp.white,u_horizon_fog_blend:o?o.properties.get("horizon-fog-blend"):1,u_is_globe_mode:m?1:0}),jo={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Pc(v){const e=[];for(let o=0;o<v.length;o++){if(v[o]===null)continue;const h=v[o].split(" ");e.push(h.pop())}return e}class Xd{constructor(e,o,h,m,b,C,R,z,B=[]){const U=e.gl;this.program=U.createProgram();const Z=Pc(o.staticAttributes),H=h?h.getBinderAttributes():[],X=Z.concat(H),te=ci.prelude.staticUniforms?Pc(ci.prelude.staticUniforms):[],le=R.staticUniforms?Pc(R.staticUniforms):[],ce=o.staticUniforms?Pc(o.staticUniforms):[],ue=h?h.getBinderUniforms():[],fe=te.concat(le).concat(ce).concat(ue),xe=[];for(const ke of fe)xe.indexOf(ke)<0&&xe.push(ke);const he=h?h.defines():[];Eo(U)&&he.unshift("#version 300 es"),b&&he.push("#define OVERDRAW_INSPECTOR;"),C&&he.push("#define TERRAIN3D;"),z&&he.push(z),B&&he.push(...B);let ve=he.concat(ci.prelude.fragmentSource,R.fragmentSource,o.fragmentSource).join(`
`),Te=he.concat(ci.prelude.vertexSource,R.vertexSource,o.vertexSource).join(`
`);Eo(U)||(ve=(function(ke){return ke.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ve),Te=(function(ke){return ke.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Te));const ge=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(ge,ve),U.compileShader(ge),!U.getShaderParameter(ge,U.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${U.getShaderInfoLog(ge)}`);U.attachShader(this.program,ge);const Ae=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);if(U.shaderSource(Ae,Te),U.compileShader(Ae),!U.getShaderParameter(Ae,U.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${U.getShaderInfoLog(Ae)}`);U.attachShader(this.program,Ae),this.attributes={};const Ve={};this.numAttributes=X.length;for(let ke=0;ke<this.numAttributes;ke++)X[ke]&&(U.bindAttribLocation(this.program,ke,X[ke]),this.attributes[X[ke]]=ke);if(U.linkProgram(this.program),!U.getProgramParameter(this.program,U.LINK_STATUS))throw new Error(`Program failed to link: ${U.getProgramInfoLog(this.program)}`);U.deleteShader(Ae),U.deleteShader(ge);for(let ke=0;ke<xe.length;ke++){const Oe=xe[ke];if(Oe&&!Ve[Oe]){const Ue=U.getUniformLocation(this.program,Oe);Ue&&(Ve[Oe]=Ue)}}this.fixedUniforms=m(e,Ve),this.terrainUniforms=((ke,Oe)=>({u_depth:new c.b_(ke,Oe.u_depth),u_terrain:new c.b_(ke,Oe.u_terrain),u_terrain_dim:new c.bq(ke,Oe.u_terrain_dim),u_terrain_matrix:new c.c0(ke,Oe.u_terrain_matrix),u_terrain_unpack:new c.c1(ke,Oe.u_terrain_unpack),u_terrain_exaggeration:new c.bq(ke,Oe.u_terrain_exaggeration)}))(e,Ve),this.projectionUniforms=((ke,Oe)=>({u_projection_matrix:new c.c0(ke,Oe.u_projection_matrix),u_projection_tile_mercator_coords:new c.c1(ke,Oe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.c1(ke,Oe.u_projection_clipping_plane),u_projection_transition:new c.bq(ke,Oe.u_projection_transition),u_projection_fallback_matrix:new c.c0(ke,Oe.u_projection_fallback_matrix)}))(e,Ve),this.binderUniforms=h?h.getUniforms(e,Ve):[]}draw(e,o,h,m,b,C,R,z,B,U,Z,H,X,te,le,ce,ue,fe,xe){const he=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(h),e.setStencilMode(m),e.setColorMode(b),e.setCullFace(C),z){e.activeTexture.set(he.TEXTURE2),he.bindTexture(he.TEXTURE_2D,z.depthTexture),e.activeTexture.set(he.TEXTURE3),he.bindTexture(he.TEXTURE_2D,z.texture);for(const Te in this.terrainUniforms)this.terrainUniforms[Te].set(z[Te])}if(B)for(const Te in B)this.projectionUniforms[jo[Te]].set(B[Te]);if(R)for(const Te in this.fixedUniforms)this.fixedUniforms[Te].set(R[Te]);ce&&ce.setUniforms(e,this.binderUniforms,te,{zoom:le});let ve=0;switch(o){case he.LINES:ve=2;break;case he.TRIANGLES:ve=3;break;case he.LINE_STRIP:ve=1}for(const Te of X.get()){const ge=Te.vaos||(Te.vaos={});(ge[U]||(ge[U]=new ku)).bind(e,this,Z,ce?ce.getPaintVertexBuffers():[],H,Te.vertexOffset,ue,fe,xe),he.drawElements(o,Te.primitiveLength*ve,he.UNSIGNED_SHORT,Te.primitiveOffset*ve*2)}}}function Jd(v,e,o){const h=1/c.aN(o,1,e.transform.tileZoom),m=Math.pow(2,o.tileID.overscaledZ),b=o.tileSize*Math.pow(2,e.transform.tileZoom)/m,C=b*(o.tileID.canonical.x+o.tileID.wrap*m),R=b*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[C>>16,R>>16],u_pixel_coord_lower:[65535&C,65535&R]}}const Dc=(v,e,o,h)=>{const m=v.style.light,b=m.properties.get("position"),C=[b.x,b.y,b.z],R=c.c4();m.properties.get("anchor")==="viewport"&&c.c5(R,v.transform.bearingInRadians),c.c6(C,C,R);const z=v.transform.transformLightDirection(C),B=m.properties.get("color");return{u_lightpos:C,u_lightpos_globe:z,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+e,u_opacity:o,u_fill_translate:h}},zc=(v,e,o,h,m,b,C)=>c.e(Dc(v,e,o,h),Jd(b,v,C),{u_height_factor:-Math.pow(2,m.overscaledZ)/C.tileSize/8}),Wa=(v,e,o,h)=>c.e(Jd(e,v,o),{u_fill_translate:h}),Yl=(v,e)=>({u_world:v,u_fill_translate:e}),Wd=(v,e,o,h,m)=>c.e(Wa(v,e,o,m),{u_world:h}),Fu=(v,e,o,h,m)=>{const b=v.transform;let C,R,z=0;if(o.paint.get("circle-pitch-alignment")==="map"){const B=c.aN(e,1,b.zoom);C=!0,R=[B,B],z=B/(c.a5*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*m}else C=!1,R=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+C,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:R,u_globe_extrude_scale:z,u_translate:h}},va=v=>({u_pixel_extrude_scale:[1/v.width,1/v.height]}),zh=v=>({u_viewport_size:[v.width,v.height]}),Bu=(v,e=1)=>({u_color:v,u_overlay:0,u_overlay_scale:e}),xa=(v,e,o,h)=>{const m=c.aN(v,1,e)/(c.a5*Math.pow(2,v.tileID.overscaledZ))*2*Math.PI*h;return{u_extrude_scale:c.aN(v,1,e),u_intensity:o,u_globe_extrude_scale:m}},Lh=(v,e,o,h)=>{const m=c.N();c.c7(m,0,v.width,v.height,0,0,1);const b=v.context.gl;return{u_matrix:m,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:o,u_color_ramp:h,u_opacity:e.paint.get("heatmap-opacity")}},Ou=(v,e,o)=>{const h=o.paint.get("hillshade-accent-color");let m;switch(o.paint.get("hillshade-method")){case"basic":m=4;break;case"combined":m=1;break;case"igor":m=2;break;case"multidirectional":m=3;break;default:m=0}const b=o.getIlluminationProperties();for(let C=0;C<b.directionRadians.length;C++)o.paint.get("hillshade-illumination-anchor")==="viewport"&&(b.directionRadians[C]+=v.transform.bearingInRadians);return{u_image:0,u_latrange:yp(0,e.tileID),u_exaggeration:o.paint.get("hillshade-exaggeration"),u_altitudes:b.altitudeRadians,u_azimuths:b.directionRadians,u_accent:h,u_method:m,u_highlights:b.highlightColor,u_shadows:b.shadowColor}},Kd=(v,e)=>{const o=e.stride,h=c.N();return c.c7(h,0,c.a5,-c.a5,0,0,1),c.O(h,h,[0,-c.a5,0]),{u_matrix:h,u_image:1,u_dimension:[o,o],u_zoom:v.overscaledZ,u_unpack:e.getUnpackVector()}};function yp(v,e){const o=Math.pow(2,e.canonical.z),h=e.canonical.y;return[new c.a9(0,h/o).toLngLat().lat,new c.a9(0,(h+1)/o).toLngLat().lat]}const Qd=(v,e,o=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:o,u_opacity:v.paint.get("color-relief-opacity")}),Uu=(v,e,o,h)=>{const m=v.transform;return{u_translation:Vu(v,e,o),u_ratio:h/c.aN(e,1,m.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},ef=(v,e,o,h,m)=>c.e(Uu(v,e,o,h),{u_image:0,u_image_height:m}),Nh=(v,e,o,h,m)=>{const b=v.transform,C=Co(e,b);return{u_translation:Vu(v,e,o),u_texsize:e.imageAtlasTexture.size,u_ratio:h/c.aN(e,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[C,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},qr=(v,e,o,h,m)=>{const b=Co(e,v.transform);return c.e(Uu(v,e,o,h),{u_tileratio:b,u_crossfade_from:m.fromScale,u_crossfade_to:m.toScale,u_image:0,u_mix:m.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})},ba=(v,e,o,h,m,b)=>{const C=Co(e,v.transform);return c.e(Uu(v,e,o,h),{u_image:0,u_image_height:b,u_tileratio:C,u_crossfade_from:m.fromScale,u_crossfade_to:m.toScale,u_image_dash:1,u_mix:m.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})};function Co(v,e){return 1/c.aN(v,1,e.tileZoom)}function Vu(v,e,o){return c.aO(v.transform,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Lc=(v,e,o,h,m)=>{return{u_tl_parent:v,u_scale_parent:e,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(C=h.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(b=h.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Nc(h.paint.get("raster-hue-rotate")),u_coords_top:[m[0].x,m[0].y,m[1].x,m[1].y],u_coords_bottom:[m[3].x,m[3].y,m[2].x,m[2].y]};var b,C};function Nc(v){v*=Math.PI/180;const e=Math.sin(v),o=Math.cos(v);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}const Gu=(v,e,o,h,m,b,C,R,z,B,U,Z,H)=>{const X=C.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:X.width/X.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_label_plane_matrix:R,u_coord_matrix:z,u_is_text:+U,u_pitch_with_map:+h,u_is_along_line:m,u_is_variable_anchor:b,u_texsize:Z,u_texture:0,u_translation:B,u_pitched_scale:H}},kc=(v,e,o,h,m,b,C,R,z,B,U,Z,H,X)=>{const te=C.transform;return c.e(Gu(v,e,o,h,m,b,C,R,z,B,U,Z,X),{u_gamma_scale:h?Math.cos(te.pitch*Math.PI/180)*te.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:1})},Ao=(v,e,o,h,m,b,C,R,z,B,U,Z,H)=>c.e(kc(v,e,o,h,m,b,C,R,z,B,!0,U,0,H),{u_texsize_icon:Z,u_texture_icon:1}),qu=(v,e)=>({u_opacity:v,u_color:e}),Hu=(v,e,o,h,m)=>c.e((function(b,C,R,z){const B=R.imageManager.getPattern(b.from.toString()),U=R.imageManager.getPattern(b.to.toString()),{width:Z,height:H}=R.imageManager.getPixelSize(),X=Math.pow(2,z.tileID.overscaledZ),te=z.tileSize*Math.pow(2,R.transform.tileZoom)/X,le=te*(z.tileID.canonical.x+z.tileID.wrap*X),ce=te*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:B.tl,u_pattern_br_a:B.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[Z,H],u_mix:C.t,u_pattern_size_a:B.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/c.aN(z,1,R.transform.tileZoom),u_pixel_coord_upper:[le>>16,ce>>16],u_pixel_coord_lower:[65535&le,65535&ce]}})(o,m,e,h),{u_opacity:v}),Fc=(v,e)=>{},tf={fillExtrusion:(v,e)=>({u_lightpos:new c.c2(v,e.u_lightpos),u_lightpos_globe:new c.c2(v,e.u_lightpos_globe),u_lightintensity:new c.bq(v,e.u_lightintensity),u_lightcolor:new c.c2(v,e.u_lightcolor),u_vertical_gradient:new c.bq(v,e.u_vertical_gradient),u_opacity:new c.bq(v,e.u_opacity),u_fill_translate:new c.c3(v,e.u_fill_translate)}),fillExtrusionPattern:(v,e)=>({u_lightpos:new c.c2(v,e.u_lightpos),u_lightpos_globe:new c.c2(v,e.u_lightpos_globe),u_lightintensity:new c.bq(v,e.u_lightintensity),u_lightcolor:new c.c2(v,e.u_lightcolor),u_vertical_gradient:new c.bq(v,e.u_vertical_gradient),u_height_factor:new c.bq(v,e.u_height_factor),u_opacity:new c.bq(v,e.u_opacity),u_fill_translate:new c.c3(v,e.u_fill_translate),u_image:new c.b_(v,e.u_image),u_texsize:new c.c3(v,e.u_texsize),u_pixel_coord_upper:new c.c3(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(v,e.u_pixel_coord_lower),u_scale:new c.c2(v,e.u_scale),u_fade:new c.bq(v,e.u_fade)}),fill:(v,e)=>({u_fill_translate:new c.c3(v,e.u_fill_translate)}),fillPattern:(v,e)=>({u_image:new c.b_(v,e.u_image),u_texsize:new c.c3(v,e.u_texsize),u_pixel_coord_upper:new c.c3(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(v,e.u_pixel_coord_lower),u_scale:new c.c2(v,e.u_scale),u_fade:new c.bq(v,e.u_fade),u_fill_translate:new c.c3(v,e.u_fill_translate)}),fillOutline:(v,e)=>({u_world:new c.c3(v,e.u_world),u_fill_translate:new c.c3(v,e.u_fill_translate)}),fillOutlinePattern:(v,e)=>({u_world:new c.c3(v,e.u_world),u_image:new c.b_(v,e.u_image),u_texsize:new c.c3(v,e.u_texsize),u_pixel_coord_upper:new c.c3(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(v,e.u_pixel_coord_lower),u_scale:new c.c2(v,e.u_scale),u_fade:new c.bq(v,e.u_fade),u_fill_translate:new c.c3(v,e.u_fill_translate)}),circle:(v,e)=>({u_camera_to_center_distance:new c.bq(v,e.u_camera_to_center_distance),u_scale_with_map:new c.b_(v,e.u_scale_with_map),u_pitch_with_map:new c.b_(v,e.u_pitch_with_map),u_extrude_scale:new c.c3(v,e.u_extrude_scale),u_device_pixel_ratio:new c.bq(v,e.u_device_pixel_ratio),u_globe_extrude_scale:new c.bq(v,e.u_globe_extrude_scale),u_translate:new c.c3(v,e.u_translate)}),collisionBox:(v,e)=>({u_pixel_extrude_scale:new c.c3(v,e.u_pixel_extrude_scale)}),collisionCircle:(v,e)=>({u_viewport_size:new c.c3(v,e.u_viewport_size)}),debug:(v,e)=>({u_color:new c.b$(v,e.u_color),u_overlay:new c.b_(v,e.u_overlay),u_overlay_scale:new c.bq(v,e.u_overlay_scale)}),depth:Fc,clippingMask:Fc,heatmap:(v,e)=>({u_extrude_scale:new c.bq(v,e.u_extrude_scale),u_intensity:new c.bq(v,e.u_intensity),u_globe_extrude_scale:new c.bq(v,e.u_globe_extrude_scale)}),heatmapTexture:(v,e)=>({u_matrix:new c.c0(v,e.u_matrix),u_world:new c.c3(v,e.u_world),u_image:new c.b_(v,e.u_image),u_color_ramp:new c.b_(v,e.u_color_ramp),u_opacity:new c.bq(v,e.u_opacity)}),hillshade:(v,e)=>({u_image:new c.b_(v,e.u_image),u_latrange:new c.c3(v,e.u_latrange),u_exaggeration:new c.bq(v,e.u_exaggeration),u_altitudes:new c.c9(v,e.u_altitudes),u_azimuths:new c.c9(v,e.u_azimuths),u_accent:new c.b$(v,e.u_accent),u_method:new c.b_(v,e.u_method),u_shadows:new c.c8(v,e.u_shadows),u_highlights:new c.c8(v,e.u_highlights)}),hillshadePrepare:(v,e)=>({u_matrix:new c.c0(v,e.u_matrix),u_image:new c.b_(v,e.u_image),u_dimension:new c.c3(v,e.u_dimension),u_zoom:new c.bq(v,e.u_zoom),u_unpack:new c.c1(v,e.u_unpack)}),colorRelief:(v,e)=>({u_image:new c.b_(v,e.u_image),u_unpack:new c.c1(v,e.u_unpack),u_dimension:new c.c3(v,e.u_dimension),u_elevation_stops:new c.b_(v,e.u_elevation_stops),u_color_stops:new c.b_(v,e.u_color_stops),u_color_ramp_size:new c.b_(v,e.u_color_ramp_size),u_opacity:new c.bq(v,e.u_opacity)}),line:(v,e)=>({u_translation:new c.c3(v,e.u_translation),u_ratio:new c.bq(v,e.u_ratio),u_device_pixel_ratio:new c.bq(v,e.u_device_pixel_ratio),u_units_to_pixels:new c.c3(v,e.u_units_to_pixels)}),lineGradient:(v,e)=>({u_translation:new c.c3(v,e.u_translation),u_ratio:new c.bq(v,e.u_ratio),u_device_pixel_ratio:new c.bq(v,e.u_device_pixel_ratio),u_units_to_pixels:new c.c3(v,e.u_units_to_pixels),u_image:new c.b_(v,e.u_image),u_image_height:new c.bq(v,e.u_image_height)}),linePattern:(v,e)=>({u_translation:new c.c3(v,e.u_translation),u_texsize:new c.c3(v,e.u_texsize),u_ratio:new c.bq(v,e.u_ratio),u_device_pixel_ratio:new c.bq(v,e.u_device_pixel_ratio),u_image:new c.b_(v,e.u_image),u_units_to_pixels:new c.c3(v,e.u_units_to_pixels),u_scale:new c.c2(v,e.u_scale),u_fade:new c.bq(v,e.u_fade)}),lineSDF:(v,e)=>({u_translation:new c.c3(v,e.u_translation),u_ratio:new c.bq(v,e.u_ratio),u_device_pixel_ratio:new c.bq(v,e.u_device_pixel_ratio),u_units_to_pixels:new c.c3(v,e.u_units_to_pixels),u_image:new c.b_(v,e.u_image),u_mix:new c.bq(v,e.u_mix),u_tileratio:new c.bq(v,e.u_tileratio),u_crossfade_from:new c.bq(v,e.u_crossfade_from),u_crossfade_to:new c.bq(v,e.u_crossfade_to),u_lineatlas_width:new c.bq(v,e.u_lineatlas_width),u_lineatlas_height:new c.bq(v,e.u_lineatlas_height)}),lineGradientSDF:(v,e)=>({u_translation:new c.c3(v,e.u_translation),u_ratio:new c.bq(v,e.u_ratio),u_device_pixel_ratio:new c.bq(v,e.u_device_pixel_ratio),u_units_to_pixels:new c.c3(v,e.u_units_to_pixels),u_image:new c.b_(v,e.u_image),u_image_height:new c.bq(v,e.u_image_height),u_tileratio:new c.bq(v,e.u_tileratio),u_crossfade_from:new c.bq(v,e.u_crossfade_from),u_crossfade_to:new c.bq(v,e.u_crossfade_to),u_image_dash:new c.b_(v,e.u_image_dash),u_mix:new c.bq(v,e.u_mix),u_lineatlas_width:new c.bq(v,e.u_lineatlas_width),u_lineatlas_height:new c.bq(v,e.u_lineatlas_height)}),raster:(v,e)=>({u_tl_parent:new c.c3(v,e.u_tl_parent),u_scale_parent:new c.bq(v,e.u_scale_parent),u_buffer_scale:new c.bq(v,e.u_buffer_scale),u_fade_t:new c.bq(v,e.u_fade_t),u_opacity:new c.bq(v,e.u_opacity),u_image0:new c.b_(v,e.u_image0),u_image1:new c.b_(v,e.u_image1),u_brightness_low:new c.bq(v,e.u_brightness_low),u_brightness_high:new c.bq(v,e.u_brightness_high),u_saturation_factor:new c.bq(v,e.u_saturation_factor),u_contrast_factor:new c.bq(v,e.u_contrast_factor),u_spin_weights:new c.c2(v,e.u_spin_weights),u_coords_top:new c.c1(v,e.u_coords_top),u_coords_bottom:new c.c1(v,e.u_coords_bottom)}),symbolIcon:(v,e)=>({u_is_size_zoom_constant:new c.b_(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(v,e.u_is_size_feature_constant),u_size_t:new c.bq(v,e.u_size_t),u_size:new c.bq(v,e.u_size),u_camera_to_center_distance:new c.bq(v,e.u_camera_to_center_distance),u_pitch:new c.bq(v,e.u_pitch),u_rotate_symbol:new c.b_(v,e.u_rotate_symbol),u_aspect_ratio:new c.bq(v,e.u_aspect_ratio),u_fade_change:new c.bq(v,e.u_fade_change),u_label_plane_matrix:new c.c0(v,e.u_label_plane_matrix),u_coord_matrix:new c.c0(v,e.u_coord_matrix),u_is_text:new c.b_(v,e.u_is_text),u_pitch_with_map:new c.b_(v,e.u_pitch_with_map),u_is_along_line:new c.b_(v,e.u_is_along_line),u_is_variable_anchor:new c.b_(v,e.u_is_variable_anchor),u_texsize:new c.c3(v,e.u_texsize),u_texture:new c.b_(v,e.u_texture),u_translation:new c.c3(v,e.u_translation),u_pitched_scale:new c.bq(v,e.u_pitched_scale)}),symbolSDF:(v,e)=>({u_is_size_zoom_constant:new c.b_(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(v,e.u_is_size_feature_constant),u_size_t:new c.bq(v,e.u_size_t),u_size:new c.bq(v,e.u_size),u_camera_to_center_distance:new c.bq(v,e.u_camera_to_center_distance),u_pitch:new c.bq(v,e.u_pitch),u_rotate_symbol:new c.b_(v,e.u_rotate_symbol),u_aspect_ratio:new c.bq(v,e.u_aspect_ratio),u_fade_change:new c.bq(v,e.u_fade_change),u_label_plane_matrix:new c.c0(v,e.u_label_plane_matrix),u_coord_matrix:new c.c0(v,e.u_coord_matrix),u_is_text:new c.b_(v,e.u_is_text),u_pitch_with_map:new c.b_(v,e.u_pitch_with_map),u_is_along_line:new c.b_(v,e.u_is_along_line),u_is_variable_anchor:new c.b_(v,e.u_is_variable_anchor),u_texsize:new c.c3(v,e.u_texsize),u_texture:new c.b_(v,e.u_texture),u_gamma_scale:new c.bq(v,e.u_gamma_scale),u_device_pixel_ratio:new c.bq(v,e.u_device_pixel_ratio),u_is_halo:new c.b_(v,e.u_is_halo),u_translation:new c.c3(v,e.u_translation),u_pitched_scale:new c.bq(v,e.u_pitched_scale)}),symbolTextAndIcon:(v,e)=>({u_is_size_zoom_constant:new c.b_(v,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b_(v,e.u_is_size_feature_constant),u_size_t:new c.bq(v,e.u_size_t),u_size:new c.bq(v,e.u_size),u_camera_to_center_distance:new c.bq(v,e.u_camera_to_center_distance),u_pitch:new c.bq(v,e.u_pitch),u_rotate_symbol:new c.b_(v,e.u_rotate_symbol),u_aspect_ratio:new c.bq(v,e.u_aspect_ratio),u_fade_change:new c.bq(v,e.u_fade_change),u_label_plane_matrix:new c.c0(v,e.u_label_plane_matrix),u_coord_matrix:new c.c0(v,e.u_coord_matrix),u_is_text:new c.b_(v,e.u_is_text),u_pitch_with_map:new c.b_(v,e.u_pitch_with_map),u_is_along_line:new c.b_(v,e.u_is_along_line),u_is_variable_anchor:new c.b_(v,e.u_is_variable_anchor),u_texsize:new c.c3(v,e.u_texsize),u_texsize_icon:new c.c3(v,e.u_texsize_icon),u_texture:new c.b_(v,e.u_texture),u_texture_icon:new c.b_(v,e.u_texture_icon),u_gamma_scale:new c.bq(v,e.u_gamma_scale),u_device_pixel_ratio:new c.bq(v,e.u_device_pixel_ratio),u_is_halo:new c.b_(v,e.u_is_halo),u_translation:new c.c3(v,e.u_translation),u_pitched_scale:new c.bq(v,e.u_pitched_scale)}),background:(v,e)=>({u_opacity:new c.bq(v,e.u_opacity),u_color:new c.b$(v,e.u_color)}),backgroundPattern:(v,e)=>({u_opacity:new c.bq(v,e.u_opacity),u_image:new c.b_(v,e.u_image),u_pattern_tl_a:new c.c3(v,e.u_pattern_tl_a),u_pattern_br_a:new c.c3(v,e.u_pattern_br_a),u_pattern_tl_b:new c.c3(v,e.u_pattern_tl_b),u_pattern_br_b:new c.c3(v,e.u_pattern_br_b),u_texsize:new c.c3(v,e.u_texsize),u_mix:new c.bq(v,e.u_mix),u_pattern_size_a:new c.c3(v,e.u_pattern_size_a),u_pattern_size_b:new c.c3(v,e.u_pattern_size_b),u_scale_a:new c.bq(v,e.u_scale_a),u_scale_b:new c.bq(v,e.u_scale_b),u_pixel_coord_upper:new c.c3(v,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.c3(v,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bq(v,e.u_tile_units_to_pixels)}),terrain:(v,e)=>({u_texture:new c.b_(v,e.u_texture),u_ele_delta:new c.bq(v,e.u_ele_delta),u_fog_matrix:new c.c0(v,e.u_fog_matrix),u_fog_color:new c.b$(v,e.u_fog_color),u_fog_ground_blend:new c.bq(v,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bq(v,e.u_fog_ground_blend_opacity),u_horizon_color:new c.b$(v,e.u_horizon_color),u_horizon_fog_blend:new c.bq(v,e.u_horizon_fog_blend),u_is_globe_mode:new c.bq(v,e.u_is_globe_mode)}),terrainDepth:(v,e)=>({u_ele_delta:new c.bq(v,e.u_ele_delta)}),terrainCoords:(v,e)=>({u_texture:new c.b_(v,e.u_texture),u_terrain_coords_id:new c.bq(v,e.u_terrain_coords_id),u_ele_delta:new c.bq(v,e.u_ele_delta)}),projectionErrorMeasurement:(v,e)=>({u_input:new c.bq(v,e.u_input),u_output_expected:new c.bq(v,e.u_output_expected)}),atmosphere:(v,e)=>({u_sun_pos:new c.c2(v,e.u_sun_pos),u_atmosphere_blend:new c.bq(v,e.u_atmosphere_blend),u_globe_position:new c.c2(v,e.u_globe_position),u_globe_radius:new c.bq(v,e.u_globe_radius),u_inv_proj_matrix:new c.c0(v,e.u_inv_proj_matrix)}),sky:(v,e)=>({u_sky_color:new c.b$(v,e.u_sky_color),u_horizon_color:new c.b$(v,e.u_horizon_color),u_horizon:new c.c3(v,e.u_horizon),u_horizon_normal:new c.c3(v,e.u_horizon_normal),u_sky_horizon_blend:new c.bq(v,e.u_sky_horizon_blend),u_sky_blend:new c.bq(v,e.u_sky_blend)})};class Ka{constructor(e,o,h){this.context=e;const m=e.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Qa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class kh{constructor(e,o,h,m){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=m,this.context=e;const b=e.gl;this.buffer=b.createBuffer(),e.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let h=0;h<this.attributes.length;h++){const m=o.attributes[this.attributes[h].name];m!==void 0&&e.enableVertexAttribArray(m)}}setVertexAttribPointers(e,o,h){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],C=o.attributes[b.name];C!==void 0&&e.vertexAttribPointer(C,b.components,e[Qa[b.type]],!1,this.itemSize,b.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Dn{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _s extends Dn{getDefault(){return c.bp.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Zu extends Dn{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class $u extends Dn{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Bc extends Dn{getDefault(){return[!0,!0,!0,!0]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class el extends Dn{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class ju extends Dn{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Xl extends Dn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class ao extends Dn{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Fh extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Oc extends Dn{getDefault(){return[0,1]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class lo extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class ys extends Dn{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Or extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class Hs extends Dn{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class tl extends Dn{getDefault(){return c.bp.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class nl extends Dn{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Yu extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class wa extends Dn{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Mo extends Dn{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Bh extends Dn{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Jl extends Dn{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class nn extends Dn{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Uc extends Dn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class uo extends Dn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Vc extends Dn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class co extends Dn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class nf extends Dn{getDefault(){return null}set(e){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Gc extends Dn{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;const h=this.gl;Eo(h)?h.bindVertexArray(e):(o=h.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Ta extends Dn{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Oh extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class qc extends Dn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Sa extends Dn{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class Wl extends Sa{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Ur extends Sa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ea extends Sa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Ca="Framebuffer is not complete";class il{constructor(e,o,h,m,b){this.context=e,this.width=o,this.height=h;const C=e.gl,R=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new Wl(e,R),m)this.depthAttachment=b?new Ea(e,R):new Ur(e,R);else if(b)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error(Ca)}destroy(){const e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){const h=this.depthAttachment.get();h&&e.deleteRenderbuffer(h)}e.deleteFramebuffer(this.framebuffer)}}class Aa{constructor(e){var o,h;if(this.gl=e,this.clearColor=new _s(this),this.clearDepth=new Zu(this),this.clearStencil=new $u(this),this.colorMask=new Bc(this),this.depthMask=new el(this),this.stencilMask=new ju(this),this.stencilFunc=new Xl(this),this.stencilOp=new ao(this),this.stencilTest=new Fh(this),this.depthRange=new Oc(this),this.depthTest=new lo(this),this.depthFunc=new ys(this),this.blend=new Or(this),this.blendFunc=new Hs(this),this.blendColor=new tl(this),this.blendEquation=new nl(this),this.cullFace=new Yu(this),this.cullFaceSide=new wa(this),this.frontFace=new Mo(this),this.program=new Bh(this),this.activeTexture=new Jl(this),this.viewport=new nn(this),this.bindFramebuffer=new Uc(this),this.bindRenderbuffer=new uo(this),this.bindTexture=new Vc(this),this.bindVertexBuffer=new co(this),this.bindElementBuffer=new nf(this),this.bindVertexArray=new Gc(this),this.pixelStoreUnpack=new Ta(this),this.pixelStoreUnpackPremultiplyAlpha=new Oh(this),this.pixelStoreUnpackFlipY=new qc(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Eo(e)){this.HALF_FLOAT=e.HALF_FLOAT;const m=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(h=e.RGB16F)!==null&&h!==void 0?h:m==null?void 0:m.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const m=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new Ka(this,e,o)}createVertexBuffer(e,o,h){return new kh(this,e,o,h)}createRenderbuffer(e,o,h){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,e,o,h),this.bindRenderbuffer.set(null),b}createFramebuffer(e,o,h,m){return new il(this,e,o,h,m)}clear({color:e,depth:o,stencil:h}){const m=this.gl;let b=0;e&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),m.clear(b)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.bR(e.blendFunction,qn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Eo(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return Eo(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let ir;function lr(v,e,o,h,m){const b=v.context,C=v.transform,R=b.gl,z=v.useProgram("collisionBox"),B=[];let U=0,Z=0;for(let ue=0;ue<h.length;ue++){const fe=h[ue],xe=e.getTile(fe).getBucket(o);if(!xe)continue;const he=m?xe.textCollisionBox:xe.iconCollisionBox,ve=xe.collisionCircleArray;ve.length>0&&(B.push({circleArray:ve,circleOffset:Z,coord:fe}),U+=ve.length/4,Z=U),he&&z.draw(b,R.LINES,en.disabled,En.disabled,v.colorModeForRenderPass(),cn.disabled,va(v.transform),v.style.map.terrain&&v.style.map.terrain.getTerrainData(fe),C.getProjectionData({overscaledTileID:fe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),o.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,null,v.transform.zoom,null,null,he.collisionVertexBuffer)}if(!m||!B.length)return;const H=v.useProgram("collisionCircle"),X=new c.ca;X.resize(4*U),X._trim();let te=0;for(const ue of B)for(let fe=0;fe<ue.circleArray.length/4;fe++){const xe=4*fe,he=ue.circleArray[xe+0],ve=ue.circleArray[xe+1],Te=ue.circleArray[xe+2],ge=ue.circleArray[xe+3];X.emplace(te++,he,ve,Te,ge,0),X.emplace(te++,he,ve,Te,ge,1),X.emplace(te++,he,ve,Te,ge,2),X.emplace(te++,he,ve,Te,ge,3)}(!ir||ir.length<2*U)&&(ir=(function(ue){const fe=2*ue,xe=new c.cc;xe.resize(fe),xe._trim();for(let he=0;he<fe;he++){const ve=6*he;xe.uint16[ve+0]=4*he+0,xe.uint16[ve+1]=4*he+1,xe.uint16[ve+2]=4*he+2,xe.uint16[ve+3]=4*he+2,xe.uint16[ve+4]=4*he+3,xe.uint16[ve+5]=4*he+0}return xe})(U));const le=b.createIndexBuffer(ir,!0),ce=b.createVertexBuffer(X,c.cb.members,!0);for(const ue of B){const fe=zh(v.transform);H.draw(b,R.TRIANGLES,en.disabled,En.disabled,v.colorModeForRenderPass(),cn.disabled,fe,v.style.map.terrain&&v.style.map.terrain.getTerrainData(ue.coord),null,o.id,ce,le,c.aX.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,v.transform.zoom,null,null,null)}ce.destroy(),le.destroy()}const vs=c.ar(new Float32Array(16));function xs(v,e,o,h,m,b){const{horizontalAlign:C,verticalAlign:R}=c.aS(v);return new c.P((-(C-.5)*e/m+h[0])*b,(-(R-.5)*o/m+h[1])*b)}function Hr(v,e,o,h,m,b){const C=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let R=h.mult(b);o||(R=R.rotate(-m));const z=C.add(R);return Qt(z.x,z.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(o){const R=Sn(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(v),z=Math.atan(R.y/R.x)+(R.x<0?Math.PI:0);return v.add(h.rotate(z))}return v.add(h)}function Zs(v,e,o,h,m,b,C,R,z,B,U,Z){const H=v.text.placedSymbolArray,X=v.text.dynamicLayoutVertexArray,te=v.icon.dynamicLayoutVertexArray,le={};X.clear();for(let ce=0;ce<H.length;ce++){const ue=H.get(ce),fe=ue.hidden||!ue.crossTileID||v.allowVerticalPlacement&&!ue.placedOrientation?null:h[ue.crossTileID];if(fe){const xe=new c.P(ue.anchorX,ue.anchorY),he={getElevation:Z,width:m.width,height:m.height,pitchedLabelPlaneMatrix:b,pitchWithMap:o,transform:m,tileAnchorPoint:xe,translation:B,unwrappedTileID:U},ve=o?Fl(xe.x,xe.y,he):Sn(xe.x,xe.y,he),Te=Ga(m.cameraToCenterDistance,ve.signedDistanceFromCamera);let ge=c.aA(v.textSizeData,R,ue)*Te/c.aM;o&&(ge*=v.tilePixelRatio/C);const{width:Ae,height:Ve,anchor:ke,textOffset:Oe,textBoxScale:Ue}=fe,pt=xs(ke,Ae,Ve,Oe,Ue,ge),mt=m.getPitchedTextCorrection(xe.x+B[0],xe.y+B[1],U),ot=Hr(ve.point,he,e,pt,-m.bearingInRadians,mt),vt=v.allowVerticalPlacement&&ue.placedOrientation===c.az.vertical?Math.PI/2:0;for(let Wt=0;Wt<ue.numGlyphs;Wt++)c.aG(X,ot,vt);z&&ue.associatedIconIndex>=0&&(le[ue.associatedIconIndex]={shiftedAnchor:ot,angle:vt})}else ps(ue.numGlyphs,X)}if(z){te.clear();const ce=v.icon.placedSymbolArray;for(let ue=0;ue<ce.length;ue++){const fe=ce.get(ue);if(fe.hidden)ps(fe.numGlyphs,te);else{const xe=le[ue];if(xe)for(let he=0;he<fe.numGlyphs;he++)c.aG(te,xe.shiftedAnchor,xe.angle);else ps(fe.numGlyphs,te)}}v.icon.dynamicLayoutVertexBuffer.updateData(te)}v.text.dynamicLayoutVertexBuffer.updateData(X)}function Uh(v,e,o){return o.iconsInText&&e?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function rl(v,e,o,h,m,b,C,R,z,B,U,Z,H){const X=v.context,te=X.gl,le=v.transform,ce=R==="map",ue=z==="map",fe=R!=="viewport"&&o.layout.get("symbol-placement")!=="point",xe=ce&&!ue&&!fe,he=!o.layout.get("symbol-sort-key").isConstant();let ve=!1;const Te=v.getDepthModeForSublayer(0,en.ReadOnly),ge=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ae=[],Ve=le.getCircleRadiusCorrection();for(const ke of h){const Oe=e.getTile(ke),Ue=Oe.getBucket(o);if(!Ue)continue;const pt=m?Ue.text:Ue.icon;if(!pt||!pt.segments.get().length||!pt.hasVisibleVertices)continue;const mt=pt.programConfigurations.get(o.id),ot=m||Ue.sdfIcons,vt=m?Ue.textSizeData:Ue.iconSizeData,Wt=ue||le.pitch!==0,On=v.useProgram(Uh(ot,m,Ue),mt),ti=c.ay(vt,le.zoom),Jn=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ke);let li,Hn,xi,ui,cr=[0,0],Ci=null;if(m)Hn=Oe.glyphAtlasTexture,xi=te.LINEAR,li=Oe.glyphAtlasTexture.size,Ue.iconsInText&&(cr=Oe.imageAtlasTexture.size,Ci=Oe.imageAtlasTexture,ui=Wt||v.options.rotating||v.options.zooming||vt.kind==="composite"||vt.kind==="camera"?te.LINEAR:te.NEAREST);else{const Vn=o.layout.get("icon-size").constantOr(0)!==1||Ue.iconsNeedLinear;Hn=Oe.imageAtlasTexture,xi=ot||v.options.rotating||v.options.zooming||Vn||Wt?te.LINEAR:te.NEAREST,li=Oe.imageAtlasTexture.size}const Ai=c.aN(Oe,1,v.transform.zoom),hr=ro(ce,v.transform,Ai),zs=c.N();c.aB(zs,hr);const Ls=Cc(ue,ce,v.transform,Ai),es=c.aO(le,Oe,b,C),Yr=le.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),fl=ge&&Ue.hasTextData(),au=o.layout.get("icon-text-fit")!=="none"&&fl&&Ue.hasIconData();if(fe){const Vn=v.style.map.terrain?(Gi,Wi)=>v.style.map.terrain.getElevation(ke,Gi,Wi):null,Wn=o.layout.get("text-rotation-alignment")==="map";Vs(Ue,v,m,hr,zs,ue,B,Wn,ke.toUnwrapped(),le.width,le.height,es,Vn)}const ts=m&&ge||au,Xr=fe||ts?vs:ue?hr:v.transform.clipSpaceToPixelsMatrix,go=ot&&o.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Lo;Lo=ot?Ue.iconsInText?Ao(vt.kind,ti,xe,ue,fe,ts,v,Xr,Ls,es,li,cr,Ve):kc(vt.kind,ti,xe,ue,fe,ts,v,Xr,Ls,es,m,li,0,Ve):Gu(vt.kind,ti,xe,ue,fe,ts,v,Xr,Ls,es,m,li,Ve);const No={program:On,buffers:pt,uniformValues:Lo,projectionData:Yr,atlasTexture:Hn,atlasTextureIcon:Ci,atlasInterpolation:xi,atlasInterpolationIcon:ui,isSDF:ot,hasHalo:go};if(he&&Ue.canOverlap){ve=!0;const Vn=pt.segments.get();for(const Wn of Vn)Ae.push({segments:new c.aX([Wn]),sortKey:Wn.sortKey,state:No,terrainData:Jn})}else Ae.push({segments:pt.segments,sortKey:0,state:No,terrainData:Jn})}ve&&Ae.sort(((ke,Oe)=>ke.sortKey-Oe.sortKey));for(const ke of Ae){const Oe=ke.state;if(X.activeTexture.set(te.TEXTURE0),Oe.atlasTexture.bind(Oe.atlasInterpolation,te.CLAMP_TO_EDGE),Oe.atlasTextureIcon&&(X.activeTexture.set(te.TEXTURE1),Oe.atlasTextureIcon&&Oe.atlasTextureIcon.bind(Oe.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),Oe.isSDF){const Ue=Oe.uniformValues;Oe.hasHalo&&(Ue.u_is_halo=1,Kl(Oe.buffers,ke.segments,o,v,Oe.program,Te,U,Z,Ue,Oe.projectionData,ke.terrainData)),Ue.u_is_halo=0}Kl(Oe.buffers,ke.segments,o,v,Oe.program,Te,U,Z,Oe.uniformValues,Oe.projectionData,ke.terrainData)}}function Kl(v,e,o,h,m,b,C,R,z,B,U){const Z=h.context;m.draw(Z,Z.gl.TRIANGLES,b,C,R,cn.backCCW,z,U,B,o.id,v.layoutVertexBuffer,v.indexBuffer,e,o.paint,h.transform.zoom,v.programConfigurations.get(o.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function Vh(v,e,o,h,m){const b=v.context,C=b.gl,R=En.disabled,z=new qn([C.ONE,C.ONE],c.bp.transparent,[!0,!0,!0,!0]),B=e.getBucket(o);if(!B)return;const U=h.key;let Z=o.heatmapFbos.get(U);Z||(Z=Xn(b,e.tileSize,e.tileSize),o.heatmapFbos.set(U,Z)),b.bindFramebuffer.set(Z.framebuffer),b.viewport.set([0,0,e.tileSize,e.tileSize]),b.clear({color:c.bp.transparent});const H=B.programConfigurations.get(o.id),X=v.useProgram("heatmap",H,!m),te=v.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),le=v.style.map.terrain.getTerrainData(h);X.draw(b,C.TRIANGLES,en.disabled,R,z,cn.disabled,xa(e,v.transform.zoom,o.paint.get("heatmap-intensity"),1),le,te,o.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,o.paint,v.transform.zoom,H)}function ur(v,e,o,h,m){const b=v.context,C=b.gl,R=v.transform;b.setColorMode(v.colorModeForRenderPass());const z=xn(b,e),B=o.key,U=e.heatmapFbos.get(B);if(!U)return;b.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,U.colorAttachment.get()),b.activeTexture.set(C.TEXTURE1),z.bind(C.LINEAR,C.CLAMP_TO_EDGE);const Z=R.getProjectionData({overscaledTileID:o,applyTerrainMatrix:m,applyGlobeMatrix:!h});v.useProgram("heatmapTexture").draw(b,C.TRIANGLES,en.disabled,En.disabled,v.colorModeForRenderPass(),cn.disabled,Lh(v,e,0,1),null,Z,e.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,e.paint,R.zoom),U.destroy(),e.heatmapFbos.delete(B)}function Xn(v,e,o){var h,m;const b=v.gl,C=b.createTexture();b.bindTexture(b.TEXTURE_2D,C),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const R=(h=v.HALF_FLOAT)!==null&&h!==void 0?h:b.UNSIGNED_BYTE,z=(m=v.RGBA16F)!==null&&m!==void 0?m:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,z,e,o,0,b.RGBA,R,null);const B=v.createFramebuffer(e,o,!1,!1);return B.colorAttachment.set(C),B}function xn(v,e){return e.colorRampTexture||(e.colorRampTexture=new c.T(v,e.colorRamp,v.gl.RGBA)),e.colorRampTexture}function $s(v,e,o,h,m,b,C,R){let z=256;if(m.stepInterpolant){const B=e.getSource().maxzoom,U=C.canonical.z===B?Math.ceil(1<<v.transform.maxZoom-C.canonical.z):1;z=c.an(c.ce(b.maxLineLength/c.a5*1024*U),256,o.maxTextureSize)}return R.gradient=c.cf({expression:m.gradientExpression(),evaluationKey:"lineProgress",resolution:z,image:R.gradient||void 0,clips:b.lineClipsArray}),R.texture?R.texture.update(R.gradient):R.texture=new c.T(o,R.gradient,h.RGBA),R.version=m.gradientVersion,R.texture}function ho(v,e,o,h,m){v.activeTexture.set(e.TEXTURE0),o.imageAtlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),h.updatePaintBuffers(m)}function yi(v,e,o,h,m,b){(m||v.lineAtlas.dirty)&&(e.activeTexture.set(o.TEXTURE0),v.lineAtlas.bind(e)),h.updatePaintBuffers(b)}function Zr(v,e,o,h,m,b,C){const R=b.gradients[m.id];let z=R.texture;m.gradientVersion!==R.version&&(z=$s(v,e,o,h,m,b,C,R)),o.activeTexture.set(h.TEXTURE0),z.bind(m.stepInterpolant?h.NEAREST:h.LINEAR,h.CLAMP_TO_EDGE)}function $r(v,e,o,h,m,b,C,R,z){const B=b.gradients[m.id];let U=B.texture;m.gradientVersion!==B.version&&(U=$s(v,e,o,h,m,b,C,B)),o.activeTexture.set(h.TEXTURE0),U.bind(m.stepInterpolant?h.NEAREST:h.LINEAR,h.CLAMP_TO_EDGE),o.activeTexture.set(h.TEXTURE1),v.lineAtlas.bind(o),R.updatePaintBuffers(z)}function Xu(v,e,o,h,m){if(!o||!h||!h.imageAtlas)return;const b=h.imageAtlas.patternPositions;let C=b[o.to.toString()],R=b[o.from.toString()];if(!C&&R&&(C=R),!R&&C&&(R=C),!C||!R){const z=m.getPaintProperty(e);C=b[z],R=b[z]}C&&R&&v.setConstantPatternPositions(C,R)}function bs(v,e,o,h,m,b,C,R){const z=v.context.gl,B="fill-pattern",U=o.paint.get(B),Z=U&&U.constantOr(1),H=o.getCrossfadeParameters();let X,te,le,ce,ue;const fe=v.transform,xe=o.paint.get("fill-translate"),he=o.paint.get("fill-translate-anchor");C?(te=Z&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=z.LINES):(te=Z?"fillPattern":"fill",X=z.TRIANGLES);const ve=U.constantOr(null);for(const Te of h){const ge=e.getTile(Te);if(Z&&!ge.patternsLoaded())continue;const Ae=ge.getBucket(o);if(!Ae)continue;const Ve=Ae.programConfigurations.get(o.id),ke=v.useProgram(te,Ve),Oe=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Te);Z&&(v.context.activeTexture.set(z.TEXTURE0),ge.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ve.updatePaintBuffers(H)),Xu(Ve,B,ve,ge,o);const Ue=fe.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),pt=c.aO(fe,ge,xe,he);if(C){ce=Ae.indexBuffer2,ue=Ae.segments2;const ot=[z.drawingBufferWidth,z.drawingBufferHeight];le=te==="fillOutlinePattern"&&Z?Wd(v,H,ge,ot,pt):Yl(ot,pt)}else ce=Ae.indexBuffer,ue=Ae.segments,le=Z?Wa(v,H,ge,pt):{u_fill_translate:pt};const mt=v.stencilModeForClipping(Te);ke.draw(v.context,X,m,mt,b,cn.backCCW,le,Oe,Ue,o.id,Ae.layoutVertexBuffer,ce,ue,o.paint,v.transform.zoom,Ve)}}function ws(v,e,o,h,m,b,C,R){const z=v.context,B=z.gl,U="fill-extrusion-pattern",Z=o.paint.get(U),H=Z.constantOr(1),X=o.getCrossfadeParameters(),te=o.paint.get("fill-extrusion-opacity"),le=Z.constantOr(null),ce=v.transform;for(const ue of h){const fe=e.getTile(ue),xe=fe.getBucket(o);if(!xe)continue;const he=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ue),ve=xe.programConfigurations.get(o.id),Te=v.useProgram(H?"fillExtrusionPattern":"fillExtrusion",ve);H&&(v.context.activeTexture.set(B.TEXTURE0),fe.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ve.updatePaintBuffers(X));const ge=ce.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!R,applyTerrainMatrix:!0});Xu(ve,U,le,fe,o);const Ae=c.aO(ce,fe,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Ve=o.paint.get("fill-extrusion-vertical-gradient"),ke=H?zc(v,Ve,te,Ae,ue,X,fe):Dc(v,Ve,te,Ae);Te.draw(z,z.gl.TRIANGLES,m,b,C,cn.backCCW,ke,he,ge,o.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,o.paint,v.transform.zoom,ve,v.style.map.terrain&&xe.centroidVertexBuffer)}}function Ts(v,e,o,h,m,b,C,R,z){var B;const U=v.style.projection,Z=v.context,H=v.transform,X=Z.gl,te=[`#define NUM_ILLUMINATION_SOURCES ${o.paint.get("hillshade-highlight-color").values.length}`],le=v.useProgram("hillshade",null,!1,te),ce=!v.options.moving;for(const ue of h){const fe=e.getTile(ue),xe=fe.fbo;if(!xe)continue;const he=U.getMeshFromTileID(Z,ue.canonical,R,!0,"raster"),ve=(B=v.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(ue);Z.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,xe.colorAttachment.get());const Te=H.getProjectionData({overscaledTileID:ue,aligned:ce,applyGlobeMatrix:!z,applyTerrainMatrix:!0});le.draw(Z,X.TRIANGLES,b,m[ue.overscaledZ],C,cn.backCCW,Ou(v,fe,o),ve,Te,o.id,he.vertexBuffer,he.indexBuffer,he.segments)}}function js(v,e,o,h,m,b,C,R,z){var B;const U=v.style.projection,Z=v.context,H=v.transform,X=Z.gl,te=v.useProgram("colorRelief"),le=!v.options.moving;let ce=!0,ue=0;for(const fe of h){const xe=e.getTile(fe),he=xe.dem;if(ce){const ke=X.getParameter(X.MAX_TEXTURE_SIZE),{elevationTexture:Oe,colorTexture:Ue}=o.getColorRampTextures(Z,ke,he.getUnpackVector());Z.activeTexture.set(X.TEXTURE1),Oe.bind(X.NEAREST,X.CLAMP_TO_EDGE),Z.activeTexture.set(X.TEXTURE4),Ue.bind(X.LINEAR,X.CLAMP_TO_EDGE),ce=!1,ue=Oe.size[0]}if(!he||!he.data)continue;const ve=he.stride,Te=he.getPixels();if(Z.activeTexture.set(X.TEXTURE0),Z.pixelStoreUnpackPremultiplyAlpha.set(!1),xe.demTexture=xe.demTexture||v.getTileTexture(ve),xe.demTexture){const ke=xe.demTexture;ke.update(Te,{premultiply:!1}),ke.bind(X.LINEAR,X.CLAMP_TO_EDGE)}else xe.demTexture=new c.T(Z,Te,X.RGBA,{premultiply:!1}),xe.demTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const ge=U.getMeshFromTileID(Z,fe.canonical,R,!0,"raster"),Ae=(B=v.style.map.terrain)===null||B===void 0?void 0:B.getTerrainData(fe),Ve=H.getProjectionData({overscaledTileID:fe,aligned:le,applyGlobeMatrix:!z,applyTerrainMatrix:!0});te.draw(Z,X.TRIANGLES,b,m[fe.overscaledZ],C,cn.backCCW,Qd(o,xe.dem,ue),Ae,Ve,o.id,ge.vertexBuffer,ge.indexBuffer,ge.segments)}}const Ys=[new c.P(0,0),new c.P(c.a5,0),new c.P(c.a5,c.a5),new c.P(0,c.a5)];function Io(v,e,o,h,m,b,C,R,z=!1,B=!1){const U=h[h.length-1].overscaledZ,Z=v.context,H=Z.gl,X=v.useProgram("raster"),te=v.transform,le=v.style.projection,ce=v.colorModeForRenderPass(),ue=!v.options.moving,fe=o.paint.get("raster-opacity"),xe=o.paint.get("raster-resampling"),he=o.paint.get("raster-fade-duration"),ve=!!v.style.map.terrain;for(const Te of h){const ge=v.getDepthModeForSublayer(Te.overscaledZ-U,fe===1?en.ReadWrite:en.ReadOnly,H.LESS),Ae=e.getTile(Te),Ve=xe==="nearest"?H.NEAREST:H.LINEAR;Z.activeTexture.set(H.TEXTURE0),Ae.texture.bind(Ve,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Z.activeTexture.set(H.TEXTURE1);const{parentTile:ke,parentScaleBy:Oe,parentTopLeft:Ue,fadeValues:pt}=Ss(Ae,e,he,ve);Ae.fadeOpacity=pt.tileOpacity,ke?(ke.fadeOpacity=pt.parentTileOpacity,ke.texture.bind(Ve,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST)):Ae.texture.bind(Ve,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Ae.texture.useMipmap&&Z.extTextureFilterAnisotropic&&v.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const mt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Te),ot=te.getProjectionData({overscaledTileID:Te,aligned:ue,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),vt=Lc(Ue,Oe,pt.fadeMix,o,R),Wt=le.getMeshFromTileID(Z,Te.canonical,b,C,"raster");X.draw(Z,H.TRIANGLES,ge,m?m[Te.overscaledZ]:En.disabled,ce,z?cn.frontCCW:cn.backCCW,vt,mt,ot,o.id,Wt.vertexBuffer,Wt.indexBuffer,Wt.segments)}}function Ss(v,e,o,h){const m={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(o===0||h)return m;if(v.fadingParentID){const b=e.getLoadedTile(v.fadingParentID);if(!b)return m;const C=Math.pow(2,b.tileID.overscaledZ-v.tileID.overscaledZ),R=[v.tileID.canonical.x*C%1,v.tileID.canonical.y*C%1],z=(function(B,U,Z){const H=Ne(),X=(H-U.timeAdded)/Z,te=B.fadingDirection===we.Incoming,le=c.an((H-B.timeAdded)/Z,0,1),ce=c.an(1-X,0,1),ue=te?le:ce;return{tileOpacity:ue,parentTileOpacity:te?ce:le,fadeMix:{opacity:1,mix:1-ue}}})(v,b,o);return{parentTile:b,parentScaleBy:C,parentTopLeft:R,fadeValues:z}}if(v.selfFading){const b=(function(C,R){const z=(Ne()-C.timeAdded)/R,B=c.an(z,0,1);return{tileOpacity:B,fadeMix:{opacity:B,mix:0}}})(v,o);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:b}}return m}const Xs=new c.bp(1,0,0,1),Es=new c.bp(0,1,0,1),Hc=new c.bp(0,0,1,1),Zc=new c.bp(1,0,1,1),fo=new c.bp(0,1,1,1);function Ql(v,e,o,h){Vi(v,0,e+o/2,v.transform.width,o,h)}function Js(v,e,o,h){Vi(v,e-o/2,0,o,v.transform.height,h)}function Vi(v,e,o,h,m,b){const C=v.context,R=C.gl;R.enable(R.SCISSOR_TEST),R.scissor(e*v.pixelRatio,o*v.pixelRatio,h*v.pixelRatio,m*v.pixelRatio),C.clear({color:b}),R.disable(R.SCISSOR_TEST)}function Ju(v,e,o){const h=v.context,m=h.gl,b=v.useProgram("debug"),C=en.disabled,R=En.disabled,z=v.colorModeForRenderPass(),B="$debug",U=v.style.map.terrain&&v.style.map.terrain.getTerrainData(o);h.activeTexture.set(m.TEXTURE0);const Z=e.getTileByID(o.key).latestRawTileData,H=Math.floor((Z&&Z.byteLength||0)/1024),X=e.getTile(o).tileSize,te=512/Math.min(X,512)*(o.overscaledZ/v.transform.zoom)*.5;let le=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(le+=` => ${o.overscaledZ}`),(function(ue,fe){ue.initDebugOverlayCanvas();const xe=ue.debugOverlayCanvas,he=ue.context.gl,ve=ue.debugOverlayCanvas.getContext("2d");ve.clearRect(0,0,xe.width,xe.height),ve.shadowColor="white",ve.shadowBlur=2,ve.lineWidth=1.5,ve.strokeStyle="white",ve.textBaseline="top",ve.font="bold 36px Open Sans, sans-serif",ve.fillText(fe,5,5),ve.strokeText(fe,5,5),ue.debugOverlayTexture.update(xe),ue.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)})(v,`${le} ${H}kB`);const ce=v.transform.getProjectionData({overscaledTileID:o,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(h,m.TRIANGLES,C,R,qn.alphaBlended,cn.disabled,Bu(c.bp.transparent,te),null,ce,B,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),b.draw(h,m.LINE_STRIP,C,R,z,cn.disabled,Bu(c.bp.red),U,ce,B,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function $c(v,e,o,h){const{isRenderingGlobe:m}=h,b=v.context,C=b.gl,R=v.transform,z=v.colorModeForRenderPass(),B=v.getDepthModeFor3D(),U=v.useProgram("terrain");b.bindFramebuffer.set(null),b.viewport.set([0,0,v.width,v.height]);for(const Z of o){const H=e.getTerrainMesh(Z.tileID),X=v.renderToTexture.getTexture(Z),te=e.getTerrainData(Z.tileID);b.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,X.texture);const le=e.getMeshFrameDelta(R.zoom),ce=R.calculateFogMatrix(Z.tileID.toUnwrapped()),ue=Yd(le,ce,v.style.sky,R.pitch,m),fe=R.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(b,C.TRIANGLES,B,En.disabled,z,cn.backCCW,ue,te,fe,"terrain",H.vertexBuffer,H.indexBuffer,H.segments)}}function Gh(v,e){if(!e.mesh){const o=new c.aW;o.emplaceBack(-1,-1),o.emplaceBack(1,-1),o.emplaceBack(1,1),o.emplaceBack(-1,1);const h=new c.aY;h.emplaceBack(0,1,2),h.emplaceBack(0,2,3),e.mesh=new Yn(v.createVertexBuffer(o,So.members),v.createIndexBuffer(h),c.aX.simpleSegment(0,0,o.length,h.length))}return e.mesh}class rf{constructor(e,o){this.context=new Aa(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=vn.maxOverzooming+vn.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new tr}resize(e,o,h){if(this.width=Math.floor(e*h),this.height=Math.floor(o*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const e=this.context,o=new c.aW;o.emplaceBack(0,0),o.emplaceBack(c.a5,0),o.emplaceBack(0,c.a5),o.emplaceBack(c.a5,c.a5),this.tileExtentBuffer=e.createVertexBuffer(o,So.members),this.tileExtentSegments=c.aX.simpleSegment(0,0,4,2);const h=new c.aW;h.emplaceBack(0,0),h.emplaceBack(c.a5,0),h.emplaceBack(0,c.a5),h.emplaceBack(c.a5,c.a5),this.debugBuffer=e.createVertexBuffer(h,So.members),this.debugSegments=c.aX.simpleSegment(0,0,4,5);const m=new c.ch;m.emplaceBack(0,0,0,0),m.emplaceBack(c.a5,0,c.a5,0),m.emplaceBack(0,c.a5,0,c.a5),m.emplaceBack(c.a5,c.a5,c.a5,c.a5),this.rasterBoundsBuffer=e.createVertexBuffer(m,jd.members),this.rasterBoundsSegments=c.aX.simpleSegment(0,0,4,2);const b=new c.aW;b.emplaceBack(0,0),b.emplaceBack(c.a5,0),b.emplaceBack(0,c.a5),b.emplaceBack(c.a5,c.a5),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(b,So.members),this.rasterBoundsSegmentsPosOnly=c.aX.simpleSegment(0,0,4,5);const C=new c.aW;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(C,So.members),this.viewportSegments=c.aX.simpleSegment(0,0,4,2);const R=new c.ci;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(R);const z=new c.aY;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(z);const B=this.context.gl;this.stencilClearMode=new En({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.tileExtentMesh=new Yn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=c.N();c.c7(h,0,this.width,this.height,0,0,1),c.Q(h,h,[o.drawingBufferWidth,o.drawingBufferHeight,0]);const m={mainMatrix:h,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:h};this.useProgram("clippingMask",null,!0).draw(e,o.TRIANGLES,en.disabled,this.stencilClearMode,qn.disabled,cn.disabled,null,null,m,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o,h){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source,this.nextStencilID+o.length>256&&this.clearStencil();const m=this.context;m.setColorMode(qn.disabled),m.setDepthMode(en.disabled);const b={};for(const C of o)b[C.key]=this.nextStencilID++;this._renderTileMasks(b,o,h,!0),this._renderTileMasks(b,o,h,!1),this._tileClippingMaskIDs=b}_renderTileMasks(e,o,h,m){const b=this.context,C=b.gl,R=this.style.projection,z=this.transform,B=this.useProgram("clippingMask");for(const U of o){const Z=e[U.key],H=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U),X=R.getMeshFromTileID(this.context,U.canonical,m,!0,"stencil"),te=z.getProjectionData({overscaledTileID:U,applyGlobeMatrix:!h,applyTerrainMatrix:!0});B.draw(b,C.TRIANGLES,en.disabled,new En({func:C.ALWAYS,mask:0},Z,255,C.KEEP,C.KEEP,C.REPLACE),qn.disabled,h?cn.disabled:cn.backCCW,null,H,te,"$clipping",X.vertexBuffer,X.indexBuffer,X.segments)}}_renderTilesDepthBuffer(){const e=this.context,o=e.gl,h=this.style.projection,m=this.transform,b=this.useProgram("depth"),C=this.getDepthModeFor3D(),R=ii(m,{tileSize:m.tileSize});for(const z of R){const B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),U=h.getMeshFromTileID(this.context,z.canonical,!0,!0,"raster"),Z=m.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(e,o.TRIANGLES,C,En.disabled,qn.disabled,cn.backCCW,null,B,Z,"$clipping",U.vertexBuffer,U.indexBuffer,U.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,o=this.context.gl;return new En({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){const o=this.context.gl;return new En({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const o=this.context.gl,h=e.sort(((C,R)=>R.overscaledZ-C.overscaledZ)),m=h[h.length-1].overscaledZ,b=h[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const C={};for(let R=0;R<b;R++)C[R+m]=new En({func:o.GEQUAL,mask:255},R+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=b,[C,h]}return[{[m]:En.disabled},h]}stencilConfigForOverlapTwoPass(e){const o=this.context.gl,h=e.sort(((C,R)=>R.overscaledZ-C.overscaledZ)),m=h[h.length-1].overscaledZ,b=h[0].overscaledZ-m+1;if(this.clearStencil(),b>1){const C={},R={};for(let z=0;z<b;z++)C[z+m]=new En({func:o.GREATER,mask:255},b+1+z,255,o.KEEP,o.KEEP,o.REPLACE),R[z+m]=new En({func:o.GREATER,mask:255},1+z,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID=2*b+1,[C,R,h]}return this.nextStencilID=3,[{[m]:new En({func:o.GREATER,mask:255},2,255,o.KEEP,o.KEEP,o.REPLACE)},{[m]:new En({func:o.GREATER,mask:255},1,255,o.KEEP,o.KEEP,o.REPLACE)},h]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new qn([e.CONSTANT_COLOR,e.ONE],new c.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?qn.unblended:qn.alphaBlended}getDepthModeForSublayer(e,o,h){if(!this.opaquePassEnabledForLayer())return en.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new en(h||this.context.gl.LEQUAL,o,[m,m])}getDepthModeFor3D(){return new en(this.context.gl.LEQUAL,en.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){var h,m;this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Ne()),this.imageManager.beginFrame();const b=this.style._order,C=this.style.tileManagers,R={},z={},B={},U={isRenderingToTexture:!1,isRenderingGlobe:((h=e.projection)===null||h===void 0?void 0:h.transitionState)>0};for(const H in C){const X=C[H];X.used&&X.prepare(this.context),R[H]=X.getVisibleCoordinates(!1),z[H]=R[H].slice().reverse(),B[H]=X.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let H=0;H<b.length;H++)if(this.style._layers[b[H]].is3D()){this.opaquePassCutoff=H;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const H of b){const X=this.style._layers[H];if(!X.hasOffscreenPass()||X.isHidden(this.transform.zoom))continue;const te=z[X.source];(X.type==="custom"||te.length)&&this.renderLayer(this,C[X.source],X,te,U)}if((m=this.style.projection)===null||m===void 0||m.updateGPUdependent({context:this.context,useProgram:H=>this.useProgram(H)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?c.bp.black:c.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(H,X){const te=H.context,le=te.gl,ce=((Te,ge,Ae)=>{const Ve=Math.cos(ge.rollInRadians),ke=Math.sin(ge.rollInRadians),Oe=$e(ge),Ue=ge.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Te.properties.get("sky-color"),u_horizon_color:Te.properties.get("horizon-color"),u_horizon:[(ge.width/2-Oe*ke)*Ae,(ge.height/2+Oe*Ve)*Ae],u_horizon_normal:[-ke,Ve],u_sky_horizon_blend:Te.properties.get("sky-horizon-blend")*ge.height/2*Ae,u_sky_blend:Ue}})(X,H.style.map.transform,H.pixelRatio),ue=new en(le.LEQUAL,en.ReadWrite,[0,1]),fe=En.disabled,xe=H.colorModeForRenderPass(),he=H.useProgram("sky"),ve=Gh(te,X);he.draw(te,le.TRIANGLES,ue,fe,xe,cn.disabled,ce,null,void 0,"sky",ve.vertexBuffer,ve.indexBuffer,ve.segments)})(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const H=this.style._layers[b[this.currentLayer]],X=C[H.source],te=R[H.source];this._renderTileClippingMasks(H,te,!1),this.renderLayer(this,X,H,te,U)}this.renderPass="translucent";let Z=!1;for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const H=this.style._layers[b[this.currentLayer]],X=C[H.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(H,U))continue;this.opaquePassEnabledForLayer()||Z||(Z=!0,U.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const te=(H.type==="symbol"?B:z)[H.source];this._renderTileClippingMasks(H,R[H.source],!!this.renderToTexture),this.renderLayer(this,X,H,te,U)}if(U.isRenderingGlobe&&(function(H,X,te){const le=H.context,ce=le.gl,ue=H.useProgram("atmosphere"),fe=new en(ce.LEQUAL,en.ReadOnly,[0,1]),xe=H.transform,he=(function(Ue,pt){const mt=Ue.properties.get("position"),ot=[-mt.x,-mt.y,-mt.z],vt=c.ar(new Float64Array(16));return Ue.properties.get("anchor")==="map"&&(c.bg(vt,vt,pt.rollInRadians),c.bh(vt,vt,-pt.pitchInRadians),c.bg(vt,vt,pt.bearingInRadians),c.bh(vt,vt,pt.center.lat*Math.PI/180),c.bJ(vt,vt,-pt.center.lng*Math.PI/180)),c.cg(ot,ot,vt),ot})(te,H.transform),ve=xe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Te=X.properties.get("atmosphere-blend")*ve.projectionTransition;if(Te===0)return;const ge=Ja(xe.worldSize,xe.center.lat),Ae=xe.inverseProjectionMatrix,Ve=new Float64Array(4);Ve[3]=1,c.aH(Ve,Ve,xe.modelViewProjectionMatrix),Ve[0]/=Ve[3],Ve[1]/=Ve[3],Ve[2]/=Ve[3],Ve[3]=1,c.aH(Ve,Ve,Ae),Ve[0]/=Ve[3],Ve[1]/=Ve[3],Ve[2]/=Ve[3],Ve[3]=1;const ke=((Ue,pt,mt,ot,vt)=>({u_sun_pos:Ue,u_atmosphere_blend:pt,u_globe_position:mt,u_globe_radius:ot,u_inv_proj_matrix:vt}))(he,Te,[Ve[0],Ve[1],Ve[2]],ge,Ae),Oe=Gh(le,X);ue.draw(le,ce.TRIANGLES,fe,En.disabled,qn.alphaBlended,cn.disabled,ke,null,null,"atmosphere",Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const H=(function(X,te){let le=null;const ce=Object.values(X._layers).flatMap((he=>he.source&&!he.isHidden(te)?[X.tileManagers[he.source]]:[])),ue=ce.filter((he=>he.getSource().type==="vector")),fe=ce.filter((he=>he.getSource().type!=="vector")),xe=he=>{(!le||le.getSource().maxzoom<he.getSource().maxzoom)&&(le=he)};return ue.forEach((he=>xe(he))),le||fe.forEach((he=>xe(he))),le})(this.style,this.transform.zoom);H&&(function(X,te,le){for(let ce=0;ce<le.length;ce++)Ju(X,te,le[ce])})(this,H,H.getVisibleCoordinates())}this.options.showPadding&&(function(H){const X=H.transform.padding;Ql(H,H.transform.height-(X.top||0),3,Xs),Ql(H,X.bottom||0,3,Es),Js(H,X.left||0,3,Hc),Js(H,H.transform.width-(X.right||0),3,Zc);const te=H.transform.centerPoint;(function(le,ce,ue,fe){Vi(le,ce-1,ue-10,2,20,fe),Vi(le,ce-10,ue-1,20,2,fe)})(H,te.x,H.transform.height-te.y,fo)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,h=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=e?!c.cj(o,h):!c.ck(o,h)),m||(m=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),m&&(c.cl(o,h),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(b,C){const R=b.context,z=R.gl,B=b.transform,U=qn.unblended,Z=new en(z.LEQUAL,en.ReadWrite,[0,1]),H=C.tileManager.getRenderableTiles(),X=b.useProgram("terrainDepth");R.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),R.clear({color:c.bp.transparent,depth:1});for(const te of H){const le=C.getTerrainMesh(te.tileID),ce=C.getTerrainData(te.tileID),ue=B.getProjectionData({overscaledTileID:te.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),fe={u_ele_delta:C.getMeshFrameDelta(B.zoom)};X.draw(R,z.TRIANGLES,Z,En.disabled,U,cn.backCCW,fe,ce,ue,"terrain",le.vertexBuffer,le.indexBuffer,le.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,b.width,b.height])})(this,this.style.map.terrain),(function(b,C){const R=b.context,z=R.gl,B=b.transform,U=qn.unblended,Z=new en(z.LEQUAL,en.ReadWrite,[0,1]),H=C.getCoordsTexture(),X=C.tileManager.getRenderableTiles(),te=b.useProgram("terrainCoords");R.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),R.clear({color:c.bp.transparent,depth:1}),C.coordsIndex=[];for(const le of X){const ce=C.getTerrainMesh(le.tileID),ue=C.getTerrainData(le.tileID);R.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,H.texture);const fe={u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(B.zoom)},xe=B.getProjectionData({overscaledTileID:le.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});te.draw(R,z.TRIANGLES,Z,En.disabled,U,cn.backCCW,fe,ue,xe,"terrain",ce.vertexBuffer,ce.indexBuffer,ce.segments),C.coordsIndex.push(le.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,b.width,b.height])})(this,this.style.map.terrain))}renderLayer(e,o,h,m,b){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||(m||[]).length)&&(this.id=h.id,c.cm(h)?(function(C,R,z,B,U,Z){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:H}=Z,X=En.disabled,te=C.colorModeForRenderPass();(z._unevaluatedLayout.hasValue("text-variable-anchor")||z._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(le,ce,ue,fe,xe,he,ve,Te,ge){const Ae=ce.transform,Ve=ce.style.map.terrain,ke=xe==="map",Oe=he==="map";for(const Ue of le){const pt=fe.getTile(Ue),mt=pt.getBucket(ue);if(!mt||!mt.text||!mt.text.segments.get().length)continue;const ot=c.ay(mt.textSizeData,Ae.zoom),vt=c.aN(pt,1,ce.transform.zoom),Wt=ro(ke,ce.transform,vt),On=ue.layout.get("icon-text-fit")!=="none"&&mt.hasIconData();if(ot){const ti=Math.pow(2,Ae.zoom-pt.tileID.overscaledZ),Jn=Ve?(li,Hn)=>Ve.getElevation(Ue,li,Hn):null;Zs(mt,ke,Oe,ge,Ae,Wt,ti,ot,On,c.aO(Ae,pt,ve,Te),Ue.toUnwrapped(),Jn)}}})(B,C,z,R,z.layout.get("text-rotation-alignment"),z.layout.get("text-pitch-alignment"),z.paint.get("text-translate"),z.paint.get("text-translate-anchor"),U),z.paint.get("icon-opacity").constantOr(1)!==0&&rl(C,R,z,B,!1,z.paint.get("icon-translate"),z.paint.get("icon-translate-anchor"),z.layout.get("icon-rotation-alignment"),z.layout.get("icon-pitch-alignment"),z.layout.get("icon-keep-upright"),X,te,H),z.paint.get("text-opacity").constantOr(1)!==0&&rl(C,R,z,B,!0,z.paint.get("text-translate"),z.paint.get("text-translate-anchor"),z.layout.get("text-rotation-alignment"),z.layout.get("text-pitch-alignment"),z.layout.get("text-keep-upright"),X,te,H),R.map.showCollisionBoxes&&(lr(C,R,z,B,!0),lr(C,R,z,B,!1))})(e,o,h,m,this.style.placement.variableOffsets,b):c.cn(h)?(function(C,R,z,B,U){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=U,H=z.paint.get("circle-opacity"),X=z.paint.get("circle-stroke-width"),te=z.paint.get("circle-stroke-opacity"),le=!z.layout.get("circle-sort-key").isConstant();if(H.constantOr(1)===0&&(X.constantOr(1)===0||te.constantOr(1)===0))return;const ce=C.context,ue=ce.gl,fe=C.transform,xe=C.getDepthModeForSublayer(0,en.ReadOnly),he=En.disabled,ve=C.colorModeForRenderPass(),Te=[],ge=fe.getCircleRadiusCorrection();for(let Ae=0;Ae<B.length;Ae++){const Ve=B[Ae],ke=R.getTile(Ve),Oe=ke.getBucket(z);if(!Oe)continue;const Ue=z.paint.get("circle-translate"),pt=z.paint.get("circle-translate-anchor"),mt=c.aO(fe,ke,Ue,pt),ot=Oe.programConfigurations.get(z.id),vt=C.useProgram("circle",ot),Wt=Oe.layoutVertexBuffer,On=Oe.indexBuffer,ti=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ve),Jn={programConfiguration:ot,program:vt,layoutVertexBuffer:Wt,indexBuffer:On,uniformValues:Fu(C,ke,z,mt,ge),terrainData:ti,projectionData:fe.getProjectionData({overscaledTileID:Ve,applyGlobeMatrix:!Z,applyTerrainMatrix:!0})};if(le){const li=Oe.segments.get();for(const Hn of li)Te.push({segments:new c.aX([Hn]),sortKey:Hn.sortKey,state:Jn})}else Te.push({segments:Oe.segments,sortKey:0,state:Jn})}le&&Te.sort(((Ae,Ve)=>Ae.sortKey-Ve.sortKey));for(const Ae of Te){const{programConfiguration:Ve,program:ke,layoutVertexBuffer:Oe,indexBuffer:Ue,uniformValues:pt,terrainData:mt,projectionData:ot}=Ae.state;ke.draw(ce,ue.TRIANGLES,xe,he,ve,cn.backCCW,pt,mt,ot,z.id,Oe,Ue,Ae.segments,z.paint,C.transform.zoom,Ve)}})(e,o,h,m,b):c.co(h)?(function(C,R,z,B,U){if(z.paint.get("heatmap-opacity")===0)return;const Z=C.context,{isRenderingToTexture:H,isRenderingGlobe:X}=U;if(C.style.map.terrain){for(const te of B){const le=R.getTile(te);R.hasRenderableParent(te)||(C.renderPass==="offscreen"?Vh(C,le,z,te,X):C.renderPass==="translucent"&&ur(C,z,te,H,X))}Z.viewport.set([0,0,C.width,C.height])}else C.renderPass==="offscreen"?(function(te,le,ce,ue){const fe=te.context,xe=fe.gl,he=te.transform,ve=En.disabled,Te=new qn([xe.ONE,xe.ONE],c.bp.transparent,[!0,!0,!0,!0]);(function(ge,Ae,Ve){const ke=ge.gl;ge.activeTexture.set(ke.TEXTURE1),ge.viewport.set([0,0,Ae.width/4,Ae.height/4]);let Oe=Ve.heatmapFbos.get(c.cd);Oe?(ke.bindTexture(ke.TEXTURE_2D,Oe.colorAttachment.get()),ge.bindFramebuffer.set(Oe.framebuffer)):(Oe=Xn(ge,Ae.width/4,Ae.height/4),Ve.heatmapFbos.set(c.cd,Oe))})(fe,te,ce),fe.clear({color:c.bp.transparent});for(let ge=0;ge<ue.length;ge++){const Ae=ue[ge];if(le.hasRenderableParent(Ae))continue;const Ve=le.getTile(Ae),ke=Ve.getBucket(ce);if(!ke)continue;const Oe=ke.programConfigurations.get(ce.id),Ue=te.useProgram("heatmap",Oe),pt=he.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),mt=he.getCircleRadiusCorrection();Ue.draw(fe,xe.TRIANGLES,en.disabled,ve,Te,cn.backCCW,xa(Ve,he.zoom,ce.paint.get("heatmap-intensity"),mt),null,pt,ce.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,ce.paint,he.zoom,Oe)}fe.viewport.set([0,0,te.width,te.height])})(C,R,z,B):C.renderPass==="translucent"&&(function(te,le){const ce=te.context,ue=ce.gl;ce.setColorMode(te.colorModeForRenderPass());const fe=le.heatmapFbos.get(c.cd);fe&&(ce.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_2D,fe.colorAttachment.get()),ce.activeTexture.set(ue.TEXTURE1),xn(ce,le).bind(ue.LINEAR,ue.CLAMP_TO_EDGE),te.useProgram("heatmapTexture").draw(ce,ue.TRIANGLES,en.disabled,En.disabled,te.colorModeForRenderPass(),cn.disabled,Lh(te,le,0,1),null,null,le.id,te.viewportBuffer,te.quadTriangleIndexBuffer,te.viewportSegments,le.paint,te.transform.zoom))})(C,z)})(e,o,h,m,b):c.cp(h)?(function(C,R,z,B,U){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=U,H=z.paint.get("line-opacity"),X=z.paint.get("line-width");if(H.constantOr(1)===0||X.constantOr(1)===0)return;const te=C.getDepthModeForSublayer(0,en.ReadOnly),le=C.colorModeForRenderPass(),ce=z.paint.get("line-dasharray"),ue=ce.constantOr(1),fe=z.paint.get("line-pattern"),xe=fe.constantOr(1),he=z.paint.get("line-gradient"),ve=z.getCrossfadeParameters();let Te;Te=xe?"linePattern":ue&&he?"lineGradientSDF":ue?"lineSDF":he?"lineGradient":"line";const ge=C.context,Ae=ge.gl,Ve=C.transform;let ke=!0;for(const Oe of B){const Ue=R.getTile(Oe);if(xe&&!Ue.patternsLoaded())continue;const pt=Ue.getBucket(z);if(!pt)continue;const mt=pt.programConfigurations.get(z.id),ot=C.context.program.get(),vt=C.useProgram(Te,mt),Wt=ke||vt.program!==ot,On=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Oe),ti=fe.constantOr(null),Jn=ce&&ce.constantOr(null);if(ti&&Ue.imageAtlas){const cr=Ue.imageAtlas,Ci=cr.patternPositions[ti.to.toString()],Ai=cr.patternPositions[ti.from.toString()];Ci&&Ai&&mt.setConstantPatternPositions(Ci,Ai)}else if(Jn){const cr=z.layout.get("line-cap")==="round",Ci=C.lineAtlas.getDash(Jn.to,cr),Ai=C.lineAtlas.getDash(Jn.from,cr);mt.setConstantDashPositions(Ci,Ai)}const li=Ve.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),Hn=Ve.getPixelScale();let xi;xe?(xi=Nh(C,Ue,z,Hn,ve),ho(ge,Ae,Ue,mt,ve)):ue&&he?(xi=ba(C,Ue,z,Hn,ve,pt.lineClipsArray.length),$r(C,R,ge,Ae,z,pt,Oe,mt,ve)):ue?(xi=qr(C,Ue,z,Hn,ve),yi(C,ge,Ae,mt,Wt,ve)):he?(xi=ef(C,Ue,z,Hn,pt.lineClipsArray.length),Zr(C,R,ge,Ae,z,pt,Oe)):xi=Uu(C,Ue,z,Hn);const ui=C.stencilModeForClipping(Oe);vt.draw(ge,Ae.TRIANGLES,te,ui,le,cn.disabled,xi,On,li,z.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,z.paint,C.transform.zoom,mt,pt.layoutVertexBuffer2),ke=!1}})(e,o,h,m,b):c.cq(h)?(function(C,R,z,B,U){const Z=z.paint.get("fill-color"),H=z.paint.get("fill-opacity");if(H.constantOr(1)===0)return;const{isRenderingToTexture:X}=U,te=C.colorModeForRenderPass(),le=z.paint.get("fill-pattern"),ce=C.opaquePassEnabledForLayer()&&!le.constantOr(1)&&Z.constantOr(c.bp.transparent).a===1&&H.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===ce){const ue=C.getDepthModeForSublayer(1,C.renderPass==="opaque"?en.ReadWrite:en.ReadOnly);bs(C,R,z,B,ue,te,!1,X)}if(C.renderPass==="translucent"&&z.paint.get("fill-antialias")){const ue=C.getDepthModeForSublayer(z.getPaintProperty("fill-outline-color")?2:0,en.ReadOnly);bs(C,R,z,B,ue,te,!0,X)}})(e,o,h,m,b):c.cr(h)?(function(C,R,z,B,U){const Z=z.paint.get("fill-extrusion-opacity");if(Z===0)return;const{isRenderingToTexture:H}=U;if(C.renderPass==="translucent"){const X=new en(C.context.gl.LEQUAL,en.ReadWrite,C.depthRangeFor3D);if(Z!==1||z.paint.get("fill-extrusion-pattern").constantOr(1))ws(C,R,z,B,X,En.disabled,qn.disabled,H),ws(C,R,z,B,X,C.stencilModeFor3D(),C.colorModeForRenderPass(),H);else{const te=C.colorModeForRenderPass();ws(C,R,z,B,X,En.disabled,te,H)}}})(e,o,h,m,b):c.cs(h)?(function(C,R,z,B,U){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=U,H=C.context,X=C.style.projection.useSubdivision,te=C.getDepthModeForSublayer(0,en.ReadOnly),le=C.colorModeForRenderPass();if(C.renderPass==="offscreen")(function(ce,ue,fe,xe,he,ve,Te){const ge=ce.context,Ae=ge.gl;for(const Ve of fe){const ke=ue.getTile(Ve),Oe=ke.dem;if(!Oe||!Oe.data||!ke.needsHillshadePrepare)continue;const Ue=Oe.dim,pt=Oe.stride,mt=Oe.getPixels();if(ge.activeTexture.set(Ae.TEXTURE1),ge.pixelStoreUnpackPremultiplyAlpha.set(!1),ke.demTexture=ke.demTexture||ce.getTileTexture(pt),ke.demTexture){const vt=ke.demTexture;vt.update(mt,{premultiply:!1}),vt.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE)}else ke.demTexture=new c.T(ge,mt,Ae.RGBA,{premultiply:!1}),ke.demTexture.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);ge.activeTexture.set(Ae.TEXTURE0);let ot=ke.fbo;if(!ot){const vt=new c.T(ge,{width:Ue,height:Ue,data:null},Ae.RGBA);vt.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),ot=ke.fbo=ge.createFramebuffer(Ue,Ue,!0,!1),ot.colorAttachment.set(vt.texture)}ge.bindFramebuffer.set(ot.framebuffer),ge.viewport.set([0,0,Ue,Ue]),ce.useProgram("hillshadePrepare").draw(ge,Ae.TRIANGLES,he,ve,Te,cn.disabled,Kd(ke.tileID,Oe),null,null,xe.id,ce.rasterBoundsBuffer,ce.quadTriangleIndexBuffer,ce.rasterBoundsSegments),ke.needsHillshadePrepare=!1}})(C,R,B,z,te,En.disabled,le),H.viewport.set([0,0,C.width,C.height]);else if(C.renderPass==="translucent")if(X){const[ce,ue,fe]=C.stencilConfigForOverlapTwoPass(B);Ts(C,R,z,fe,ce,te,le,!1,Z),Ts(C,R,z,fe,ue,te,le,!0,Z)}else{const[ce,ue]=C.getStencilConfigForOverlapAndUpdateStencilID(B);Ts(C,R,z,ue,ce,te,le,!1,Z)}})(e,o,h,m,b):c.ct(h)?(function(C,R,z,B,U){if(C.renderPass!=="translucent"||!B.length)return;const{isRenderingToTexture:Z}=U,H=C.style.projection.useSubdivision,X=C.getDepthModeForSublayer(0,en.ReadOnly),te=C.colorModeForRenderPass();if(H){const[le,ce,ue]=C.stencilConfigForOverlapTwoPass(B);js(C,R,z,ue,le,X,te,!1,Z),js(C,R,z,ue,ce,X,te,!0,Z)}else{const[le,ce]=C.getStencilConfigForOverlapAndUpdateStencilID(B);js(C,R,z,ce,le,X,te,!1,Z)}})(e,o,h,m,b):c.bU(h)?(function(C,R,z,B,U){if(C.renderPass!=="translucent"||z.paint.get("raster-opacity")===0||!B.length)return;const{isRenderingToTexture:Z}=U,H=R.getSource(),X=C.style.projection.useSubdivision;if(H instanceof Sr)Io(C,R,z,B,null,!1,!1,H.tileCoords,H.flippedWindingOrder,Z);else if(X){const[te,le,ce]=C.stencilConfigForOverlapTwoPass(B);Io(C,R,z,ce,te,!1,!0,Ys,!1,Z),Io(C,R,z,ce,le,!0,!0,Ys,!1,Z)}else{const[te,le]=C.getStencilConfigForOverlapAndUpdateStencilID(B);Io(C,R,z,le,te,!1,!0,Ys,!1,Z)}})(e,o,h,m,b):c.cu(h)?(function(C,R,z,B,U){const Z=z.paint.get("background-color"),H=z.paint.get("background-opacity");if(H===0)return;const{isRenderingToTexture:X}=U,te=C.context,le=te.gl,ce=C.style.projection,ue=C.transform,fe=ue.tileSize,xe=z.paint.get("background-pattern");if(C.isPatternMissing(xe))return;const he=!xe&&Z.a===1&&H===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==he)return;const ve=En.disabled,Te=C.getDepthModeForSublayer(0,he==="opaque"?en.ReadWrite:en.ReadOnly),ge=C.colorModeForRenderPass(),Ae=C.useProgram(xe?"backgroundPattern":"background"),Ve=B||ii(ue,{tileSize:fe,terrain:C.style.map.terrain});xe&&(te.activeTexture.set(le.TEXTURE0),C.imageManager.bind(C.context));const ke=z.getCrossfadeParameters();for(const Oe of Ve){const Ue=ue.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!X,applyTerrainMatrix:!0}),pt=xe?Hu(H,C,xe,{tileID:Oe,tileSize:fe},ke):qu(H,Z),mt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Oe),ot=ce.getMeshFromTileID(te,Oe.canonical,!1,!0,"raster");Ae.draw(te,le.TRIANGLES,Te,ve,ge,cn.backCCW,pt,mt,Ue,z.id,ot.vertexBuffer,ot.indexBuffer,ot.segments)}})(e,0,h,m,b):c.cv(h)&&(function(C,R,z,B){const{isRenderingGlobe:U}=B,Z=C.context,H=z.implementation,X=C.style.projection,te=C.transform,le=te.getProjectionDataForCustomLayer(U),ce={farZ:te.farZ,nearZ:te.nearZ,fov:te.fov*Math.PI/180,modelViewProjectionMatrix:te.modelViewProjectionMatrix,projectionMatrix:te.projectionMatrix,shaderData:{variantName:X.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${X.shaderPreludeCode.vertexSource}`,define:X.shaderDefine},defaultProjectionData:le},ue=H.renderingMode?H.renderingMode:"2d";if(C.renderPass==="offscreen"){const fe=H.prerender;fe&&(C.setCustomLayerDefaults(),Z.setColorMode(C.colorModeForRenderPass()),fe.call(H,Z.gl,ce),Z.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),Z.setColorMode(C.colorModeForRenderPass()),Z.setStencilMode(En.disabled);const fe=ue==="3d"?C.getDepthModeFor3D():C.getDepthModeForSublayer(0,en.ReadOnly);Z.setDepthMode(fe),H.render(Z.gl,ce),Z.setDirty(),C.setBaseState(),Z.bindFramebuffer.set(null)}})(e,0,h,b))}saveTileTexture(e){const o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const o=this.imageManager.getPattern(e.from.toString()),h=this.imageManager.getPattern(e.to.toString());return!o||!h}useProgram(e,o,h=!1,m=[]){this.cache=this.cache||{};const b=!!this.style.map.terrain,C=this.style.projection,R=h?ci.projectionMercator:C.shaderPreludeCode,z=h?Ti:C.shaderDefine,B=e+(o?o.cacheKey:"")+`/${h?Nr:C.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(b?"/terrain":"")+(m?`/${m.join("/")}`:"");return this.cache[B]||(this.cache[B]=new Xd(this.context,ci[e],o,tf[e],this._showOverdrawInspector,b,R,z,m)),this.cache[B]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var e,o;if(this._tileTextures){for(const h in this._tileTextures){const m=this._tileTextures[h];if(m)for(const b of m)b.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((e=this.tileExtentMesh.vertexBuffer)===null||e===void 0||e.destroy()),this.tileExtentMesh&&((o=this.tileExtentMesh.indexBuffer)===null||o===void 0||o.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const h in this.cache){const m=this.cache[h];m&&m.program&&this.context.gl.deleteProgram(m.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}function qh(v,e){let o,h=!1,m=null,b=null;const C=()=>{m=null,h&&(v.apply(b,o),m=setTimeout(C,e),h=!1)};return(...R)=>(h=!0,b=this,o=R,m||C(),m)}class Ni{constructor(e){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map((m=>m.split("="))).forEach((m=>{m[0]===this._hashName&&(h=m)})),(h&&h[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(!this._isValidHash(o))return!1;const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{const o=this._getCurrentHash();if(o.length===0)return;const h=o.join("/");let m=h;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${h}`);let b=window.location.hash.replace(m,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let C=window.location.href.replace(/(#.+)?$/,b);C=C.replace("&&","&"),window.history.replaceState(window.history.state,null,C)},this._updateHash=qh(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const o=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),C=Math.round(o.lng*b)/b,R=Math.round(o.lat*b)/b,z=this._map.getBearing(),B=this._map.getPitch();let U="";if(U+=e?`/${C}/${R}/${h}`:`${h}/${R}/${C}`,(z||B)&&(U+="/"+Math.round(10*z)/10),B&&(U+=`/${Math.round(B)}`),this._hashName){const Z=this._hashName;let H=!1;const X=window.location.hash.slice(1).split("&").map((te=>{const le=te.split("=")[0];return le===Z?(H=!0,`${le}=${U}`):te})).filter((te=>te));return H||X.push(`${Z}=${U}`),`#${X.join("&")}`}return`#${U}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new c.V(+e[2],+e[1])}catch{return!1}const o=+e[0],h=+(e[3]||0),m=+(e[4]||0);return o>=this._map.getMinZoom()&&o<=this._map.getMaxZoom()&&h>=-180&&h<=180&&m>=this._map.getMinPitch()&&m<=this._map.getMaxPitch()}}const Cs={linearity:.3,easing:c.cw(0,0,.3,1)},eu=c.e({deceleration:2500,maxSpeed:1400},Cs),Cr=c.e({deceleration:20,maxSpeed:1400},Cs),po=c.e({deceleration:1e3,maxSpeed:360},Cs),ol=c.e({deceleration:1e3,maxSpeed:90},Cs),Ar=c.e({deceleration:1e3,maxSpeed:360},Cs);class vp{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Ne(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,o=Ne();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)o.zoom+=b.zoomDelta||0,o.bearing+=b.bearingDelta||0,o.pitch+=b.pitchDelta||0,o.roll+=b.rollDelta||0,b.panDelta&&o.pan._add(b.panDelta),b.around&&(o.around=b.around),b.pinchAround&&(o.pinchAround=b.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(o.pan.mag()){const b=Wu(o.pan.mag(),h,c.e({},eu,e||{})),C=o.pan.mult(b.amount/o.pan.mag()),R=this._map.cameraHelper.handlePanInertia(C,this._map.transform);m.center=R.easingCenter,m.offset=R.easingOffset,tu(m,b)}if(o.zoom){const b=Wu(o.zoom,h,Cr),C=c.cx(this._map.transform.zoom+b.amount,this._map.getZoomSnap(),b.amount);m.zoom=C,tu(m,b)}if(o.bearing){const b=Wu(o.bearing,h,po);m.bearing=this._map.transform.bearing+c.an(b.amount,-179,179),tu(m,b)}if(o.pitch){const b=Wu(o.pitch,h,ol);m.pitch=this._map.transform.pitch+b.amount,tu(m,b)}if(o.roll){const b=Wu(o.roll,h,Ar);m.roll=this._map.transform.roll+c.an(b.amount,-179,179),tu(m,b)}if(m.zoom||m.bearing){const b=o.pinchAround===void 0?o.around:o.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),c.e(m,{noMoveStart:!0})}}function tu(v,e){(!v.duration||v.duration<e.duration)&&(v.duration=e.duration,v.easing=e.easing)}function Wu(v,e,o){const{maxSpeed:h,linearity:m,deceleration:b}=o,C=c.an(v*m/(e/1e3),-h,h),R=Math.abs(C)/(b*m);return{easing:o.easing,duration:1e3*R,amount:C*(R/2)}}class rr extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,h,m={}){h=h instanceof MouseEvent?h:new MouseEvent(e,h);const b=se.mousePos(o.getCanvas(),h),C=o.unproject(b);super(e,c.e({point:b,lngLat:C,originalEvent:h},m)),this._defaultPrevented=!1,this.target=o}}class Yo extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,h){const m=e==="touchend"?h.changedTouches:h.touches,b=se.touchPos(o.getCanvasContainer(),m),C=b.map((z=>o.unproject(z))),R=b.reduce(((z,B,U,Z)=>z.add(B.div(Z.length))),new c.P(0,0));super(e,{points:b,point:R,lngLats:C,lngLat:o.unproject(R),originalEvent:h}),this._defaultPrevented=!1}}class jc extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,h){super(e,{originalEvent:h}),this._defaultPrevented=!1}}class Yc{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new jc(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new rr(e.type,this._map,e))}mouseup(e){this._map.fire(new rr(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new rr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new rr(e.type,this._map,e))}mouseover(e){this._map.fire(new rr(e.type,this._map,e))}mouseout(e){this._map.fire(new rr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Yo(e.type,this._map,e))}touchmove(e){this._map.fire(new Yo(e.type,this._map,e))}touchend(e){this._map.fire(new Yo(e.type,this._map,e))}touchcancel(e){this._map.fire(new Yo(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class of{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new rr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new rr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(c.P.convert(e),this._map.terrain)}}class Ma{constructor(e,o){this._map=e,this._tr=new Xo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&(se.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;const h=o;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=h,this._box||(this._box=se.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const b=Math.min(m.x,h.x),C=Math.max(m.x,h.x),R=Math.min(m.y,h.y),z=Math.max(m.y,h.y);se.setTransform(this._box,`translate(${b}px,${R}px)`),this._box.style.width=C-b+"px",this._box.style.height=z-R+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;const h=this._startPos,m=o;if(this.reset(),se.suppressClick(),h.x!==m.x||h.y!==m.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:e})),{cameraAnimation:b=>b.fitScreenCoordinates(h,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(se.remove(this._box),this._box=null),se.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new c.l(e,{originalEvent:o}))}}function jr(v,e){if(v.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${e.length}`);const o={};for(let h=0;h<v.length;h++)o[v[h].identifier]=e[h];return o}class Tt{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),h.length===this.numTouches&&(this.centroid=(function(m){const b=new c.P(0,0);for(const C of m)b._add(C);return b.div(m.length)})(o),this.touches=jr(h,o)))}touchmove(e,o,h){if(this.aborted||!this.centroid)return;const m=jr(h,o);for(const b in this.touches){const C=m[b];(!C||C.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(e,o,h){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Ku{constructor(e){this.singleTap=new Tt(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,h){this.singleTap.touchstart(e,o,h)}touchmove(e,o,h){this.singleTap.touchmove(e,o,h)}touchend(e,o,h){const m=this.singleTap.touchend(e,o,h);if(m){const b=e.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(m)<30;if(b&&C||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Xc{constructor(e){this._tr=new Xo(e),this._zoomIn=new Ku({numTouches:1,numTaps:2}),this._zoomOut=new Ku({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,h){this._zoomIn.touchstart(e,o,h),this._zoomOut.touchstart(e,o,h)}touchmove(e,o,h){this._zoomIn.touchmove(e,o,h),this._zoomOut.touchmove(e,o,h)}touchend(e,o,h){const m=this._zoomIn.touchend(e,o,h),b=this._zoomOut.touchend(e,o,h),C=this._tr;return m?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:c.cx(C.zoom+1,R.getZoomSnap()),around:C.unproject(m)},{originalEvent:e})}):b?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:c.cx(C.zoom-1,R.getZoomSnap()),around:C.unproject(b)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ro{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.rollDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(o)?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const m=Array.isArray(o)?o[0]:o;return!this._moved&&m.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(h,m))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&se.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Jo=0,nu=2,Jc={[Jo]:1,[nu]:2};class As{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const o=se.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(o,h){const m=Jc[h];return o.buttons===void 0||(o.buttons&m)!==m})(e,this._eventButton)}isValidEndEvent(e){return se.mouseButton(e)===this._eventButton}}class sl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Qu{constructor(e=new As({checkCorrectEvent:()=>!0}),o=new sl){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=o}_executeRelevantHandler(e,o,h){return e instanceof MouseEvent?o(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?h(e):void 0}startMove(e){this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.startMove(o)),(o=>this.oneFingerTouchMoveStateManager.startMove(o)))}endMove(e){this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.endMove(o)),(o=>this.oneFingerTouchMoveStateManager.endMove(o)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.isValidStartEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidStartEvent(o)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.isValidMoveEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(o)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.isValidEndEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidEndEvent(o)))}}const Ms=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=e=>{e.preventDefault()}};class Wc{constructor(e,o){this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,o,h){return this._calculateTransform(e,o,h)}touchmove(e,o,h){if(this._active){if(!this._shouldBePrevented(h.length))return e.preventDefault(),this._calculateTransform(e,o,h);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,o,h){this._calculateTransform(e,o,h),this._active&&this._shouldBePrevented(h.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,h){h.length>0&&(this._active=!0);const m=jr(h,o),b=new c.P(0,0),C=new c.P(0,0);let R=0;for(const B in m){const U=m[B],Z=this._touches[B];Z&&(b._add(U),C._add(U.sub(Z)),R++,m[B]=U)}if(this._touches=m,this._shouldBePrevented(R)||!C.mag())return;const z=C.div(R);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(R),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ec{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,h){if(!this._firstTwoTouches)return;e.preventDefault();const[m,b]=this._firstTwoTouches,C=Is(h,o,m),R=Is(h,o,b);if(!C||!R)return;const z=this._aroundCenter?null:C.add(R).div(2);return this._move([C,R],z,e)}touchend(e,o,h){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,C=Is(h,o,m),R=Is(h,o,b);C&&R||(this._active&&se.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Is(v,e,o){for(let h=0;h<v.length;h++)if(v[h].identifier===o)return e[h]}function Hh(v,e){return Math.log(v/e)/Math.LN2}class Rs extends ec{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){const h=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Hh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hh(this._distance,h),pinchAround:o}}}function Kc(v,e){return 180*v.angleWith(e)/Math.PI}class tc extends ec{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o,h){const m=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Kc(this._vector,m),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const o=25/(Math.PI*this._minDiameter)*360,h=Kc(e,this._startVector);return Math.abs(h)<o}}function Ps(v){return Math.abs(v.y)>Math.abs(v.x)}class Ws extends ec{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,h){super.touchstart(e,o,h),this._currentTouchCount=h.length}_start(e){this._lastPoints=e,Ps(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,h){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=e[0].sub(this._lastPoints[0]),b=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,h.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,h){if(this._valid!==void 0)return this._valid;const m=e.mag()>=2,b=o.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const C=e.y>0==o.y>0;return Ps(e)&&Ps(o)&&C}}const Po={panStep:100,bearingStep:15,pitchStep:10};class Un{constructor(e){this._tr=new Xo(e);const o=Po;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,h=0,m=0,b=0,C=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?h=-1:(e.preventDefault(),b=-1);break;case 39:e.shiftKey?h=1:(e.preventDefault(),b=1);break;case 38:e.shiftKey?m=1:(e.preventDefault(),C=-1);break;case 40:e.shiftKey?m=-1:(e.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:R=>{const z=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:Zh,zoom:o?c.cx(z.zoom+o*(e.shiftKey?2:1),R.getZoomSnap()):z.zoom,bearing:z.bearing+h*this._bearingStep,pitch:z.pitch+m*this._pitchStep,offset:[-b*this._panStep,-C*this._panStep],center:z.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zh(v){return v*(2-v)}const Ks=4.000244140625,Ia=1/450;class nc{constructor(e,o){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=e,this._tr=new Xo(e),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ia}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const h=Ne(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,o!==0&&o%Ks==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(m*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=se.mousePos(this._map.getCanvas(),e),h=this._tr;this._aroundPoint=this._aroundCenter?h.transform.locationToScreenPoint(c.V.convert(h.center)):o,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const R=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=R),typeof this._targetZoom=="number"&&(this._targetZoom+=R)}if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>Ks?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&z!==0&&(z=1/z);const B=typeof this._targetZoom!="number"?e.scale:c.aq(this._targetZoom),U=e.applyConstrain(e.getCameraLngLat(),c.at(B*z)).zoom,Z=this._map.getZoomSnap();if(this._type==="wheel"&&Z>0){const H=c.cx(e.zoom,Z);this._targetZoom=c.cx(U,Z,U-H)}else this._targetZoom=U;this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,h=this._startZoom,m=this._easing;let b,C=!1;if(this._type==="wheel"&&h&&m){const R=Ne()-this._lastWheelEventTime,z=Math.min((R+5)/200,1),B=m(z);b=c.G.number(h,o,B),z<1?this._frameId||(this._frameId=!0):C=!0}else b=o,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=b,{noInertia:!0,needsRenderFrame:!C,zoomDelta:b-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=c.cz;if(this._prevEase){const h=this._prevEase,m=(Ne()-h.start)/h.duration,b=h.easing(m+.01)-h.easing(m),C=.27/Math.sqrt(b*b+1e-4)*.01,R=Math.sqrt(.0729-C*C);o=c.cw(C,R,.25,1)}return this._prevEase={start:Ne(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Qc{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class al{constructor(e){this._tr=new Xo(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:c.cx(this._tr.zoom+(e.shiftKey?-1:1),h.getZoomSnap()),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ic{constructor(){this._tap=new Ku({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,h){if(!this._swipePoint)if(this._tapTime){const m=o[0],b=e.timeStamp-this._tapTime<500,C=this._tapPoint.dist(m)<30;b&&C?h.length>0&&(this._swipePoint=m,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(e,o,h)}touchmove(e,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=o[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,e.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(e,o,h)}touchend(e,o,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const m=this._tap.touchend(e,o,h);m&&(this._tapTime=e.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $h{constructor(e,o,h){this._el=e,this._mousePan=o,this._touchPan=h}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class mo{constructor(e,o,h,m){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=o,this._mousePitch=h,this._mouseRoll=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class ll{constructor(e,o,h,m){this._el=e,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class St{constructor(e,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=se.create("div","maplibregl-cooperative-gesture-screen",e);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const h=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=o,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=h,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(se.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,o){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:e,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const It=v=>v.zoom||v.drag||v.roll||v.pitch||v.rotate;class Do extends c.l{}function iu(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta||v.rollDelta}class rc{get _ownerDocument(){var e;return((e=this._el)===null||e===void 0?void 0:e.ownerDocument)||document}get _ownerWindow(){var e,o;return((o=(e=this._el)===null||e===void 0?void 0:e.ownerDocument)===null||o===void 0?void 0:o.defaultView)||window}constructor(e,o){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=m.type==="renderFrame"?void 0:m,R={needsRenderFrame:!1},z={},B={};for(const{handlerName:H,handler:X,allowed:te}of this._handlers){if(!X.isEnabled())continue;let le;if(this._blockedByActive(B,te,H))X.reset();else if(X[b||m.type]){if(c.cA(m,b||m.type)){const ce=se.mousePos(this._map.getCanvas(),m);le=X[b||m.type](m,ce)}else if(c.cB(m,b||m.type)){const ce=this._getMapTouches(m.touches),ue=se.touchPos(this._map.getCanvas(),ce);le=X[b||m.type](m,ue,ce)}else c.cC(b||m.type)||(le=X[b||m.type](m));this.mergeHandlerResult(R,z,le,H,C),le&&le.needsRenderFrame&&this._triggerRenderFrame()}(le||X.isActive())&&(B[H]=X)}const U={};for(const H in this._previousActiveHandlers)B[H]||(U[H]=C);this._previousActiveHandlers=B,(Object.keys(U).length||iu(R))&&(this._changes.push([R,z,U]),this._triggerRenderFrame()),(Object.keys(B).length||iu(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=R;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vp(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(const[m,b,C]of this._listeners)se.addEventListener(m,b,m===this._ownerDocument?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[e,o,h]of this._listeners)se.removeEventListener(e,o,e===this._ownerDocument?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(e){const o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new Yc(o,e));const m=o.boxZoom=new Ma(o,e);this._add("boxZoom",m),e.interactive&&e.boxZoom&&m.enable();const b=o.cooperativeGestures=new St(o,e.cooperativeGestures);this._add("cooperativeGestures",b),e.cooperativeGestures&&b.enable();const C=new Xc(o),R=new al(o);o.doubleClickZoom=new Qc(R,C),this._add("tapZoom",C),this._add("clickZoom",R),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();const z=new ic;this._add("tapDragZoom",z);const B=o.touchPitch=new Ws(o);this._add("touchPitch",B),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);const U=()=>o.project(o.getCenter()),Z=(function({enable:he,clickTolerance:ve,aroundCenter:Te=!0,minPixelCenterThreshold:ge=100,rotateDegreesPerPixelMoved:Ae=.8},Ve){const ke=new As({checkCorrectEvent:Oe=>se.mouseButton(Oe)===0&&Oe.ctrlKey||se.mouseButton(Oe)===2&&!Oe.ctrlKey});return new Ro({clickTolerance:ve,move:(Oe,Ue)=>{const pt=Ve();if(Te&&Math.abs(pt.y-Oe.y)>ge)return{bearingDelta:c.cy(new c.P(Oe.x,Ue.y),Ue,pt)};let mt=(Ue.x-Oe.x)*Ae;return Te&&Ue.y<pt.y&&(mt=-mt),{bearingDelta:mt}},moveStateManager:ke,enable:he,assignEvents:Ms})})(e,U),H=(function({enable:he,clickTolerance:ve,pitchDegreesPerPixelMoved:Te=-.5}){const ge=new As({checkCorrectEvent:Ae=>se.mouseButton(Ae)===0&&Ae.ctrlKey||se.mouseButton(Ae)===2});return new Ro({clickTolerance:ve,move:(Ae,Ve)=>({pitchDelta:(Ve.y-Ae.y)*Te}),moveStateManager:ge,enable:he,assignEvents:Ms})})(e),X=(function({enable:he,clickTolerance:ve,rollDegreesPerPixelMoved:Te=.3},ge){const Ae=new As({checkCorrectEvent:Ve=>se.mouseButton(Ve)===2&&Ve.ctrlKey});return new Ro({clickTolerance:ve,move:(Ve,ke)=>{const Oe=ge();let Ue=(ke.x-Ve.x)*Te;return ke.y<Oe.y&&(Ue=-Ue),{rollDelta:Ue}},moveStateManager:Ae,enable:he,assignEvents:Ms})})(e,U);o.dragRotate=new mo(e,Z,H,X),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",H,["mouseRotate","mouseRoll"]),this._add("mouseRoll",X,["mousePitch"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();const te=(function({enable:he,clickTolerance:ve}){const Te=new As({checkCorrectEvent:ge=>se.mouseButton(ge)===0&&!ge.ctrlKey});return new Ro({clickTolerance:ve,move:(ge,Ae)=>({around:Ae,panDelta:Ae.sub(ge)}),activateOnStart:!0,moveStateManager:Te,enable:he,assignEvents:Ms})})(e),le=new Wc(e,o);o.dragPan=new $h(h,te,le),this._add("mousePan",te),this._add("touchPan",le,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);const ce=new tc,ue=new Rs;o.touchZoomRotate=new ll(h,ue,ce,z),this._add("touchRotate",ce,["touchPan","touchZoom"]),this._add("touchZoom",ue,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new of(o));const fe=o.scrollZoom=new nc(o,(()=>this._triggerRenderFrame()));this._add("scrollZoom",fe,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);const xe=o.keyboard=new Un(o);this._add("keyboard",xe),e.interactive&&e.keyboard&&o.keyboard.enable()}_add(e,o,h){this._handlers.push({handlerName:e,handler:o,allowed:h}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!It(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,h){for(const m in e)if(m!==h&&(!o||o.indexOf(m)<0))return!0;return!1}_getMapTouches(e){const o=[];for(const h of e)this._el.contains(h.target)&&o.push(h);return o}mergeHandlerResult(e,o,h,m,b){if(!h)return;c.e(e,h);const C={handlerName:m,originalEvent:h.originalEvent||b};h.zoomDelta!==void 0&&(o.zoom=C),h.panDelta!==void 0&&(o.drag=C),h.rollDelta!==void 0&&(o.roll=C),h.pitchDelta!==void 0&&(o.pitch=C),h.bearingDelta!==void 0&&(o.rotate=C)}_applyChanges(){const e={},o={},h={};for(const[m,b,C]of this._changes)m.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(m.panDelta)),m.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+m.pitchDelta),m.rollDelta&&(e.rollDelta=(e.rollDelta||0)+m.rollDelta),m.around!==void 0&&(e.around=m.around),m.pinchAround!==void 0&&(e.pinchAround=m.pinchAround),m.noInertia&&(e.noInertia=m.noInertia),c.e(o,b),c.e(h,C);this._updateMapTransform(e,o,h),this._changes=[]}_updateMapTransform(e,o,h){const m=this._map,b=m._getTransformForUpdate(),C=m.terrain;if(!(iu(e)||C&&this._terrainMovement))return this._fireEvents(o,h,!0);m._stop(!0);let{panDelta:R,zoomDelta:z,bearingDelta:B,pitchDelta:U,rollDelta:Z,around:H,pinchAround:X}=e;X!==void 0&&(H=X),H=H||m.transform.centerPoint,C&&!b.isPointOnMapSurface(H)&&(H=b.centerPoint);const te={panDelta:R,zoomDelta:z,rollDelta:Z,pitchDelta:U,bearingDelta:B,around:H};this._map.cameraHelper.useGlobeControls&&!b.isPointOnMapSurface(H)&&(H=b.centerPoint);const le=H.distSqr(b.centerPoint)<.01?b.center:b.screenPointToLocation(R?H.sub(R):H);this._handleMapControls({terrain:C,tr:b,deltasForHelper:te,preZoomAroundLoc:le,combinedEventsInProgress:o,panDelta:R}),m._applyUpdatedTransform(b),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,h,!0)}_handleMapControls({terrain:e,tr:o,deltasForHelper:h,preZoomAroundLoc:m,combinedEventsInProgress:b,panDelta:C}){const R=this._map.cameraHelper;if(R.handleMapControlsRollPitchBearingZoom(h,o),e)return R.useGlobeControls?(this._terrainMovement||!b.drag&&!b.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void R.handleMapControlsPan(h,o,m)):this._terrainMovement||!b.drag&&!b.zoom?void(b.drag&&this._terrainMovement&&C?o.setCenter(o.screenPointToLocation(o.centerPoint.sub(C))):R.handleMapControlsPan(h,o,m)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void R.handleMapControlsPan(h,o,m));R.handleMapControlsPan(h,o,m)}_fireEvents(e,o,h){const m=It(this._eventsInProgress),b=It(e),C={};for(const Z in e){const{originalEvent:H}=e[Z];this._eventsInProgress[Z]||(C[`${Z}start`]=H),this._eventsInProgress[Z]=e[Z]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const Z in C)this._fireEvent(Z,C[Z]);b&&this._fireEvent("move",b.originalEvent);for(const Z in e){const{originalEvent:H}=e[Z];this._fireEvent(Z,H)}const R={};let z;for(const Z in this._eventsInProgress){const{handlerName:H,originalEvent:X}=this._eventsInProgress[Z];this._handlersById[H].isActive()||(delete this._eventsInProgress[Z],z=o[H]||X,R[`${Z}end`]=z)}for(const Z in R)this._fireEvent(Z,R[Z]);const B=It(this._eventsInProgress),U=(m||b)&&!B;if(U&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Z=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&Z.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(Z)}if(h&&U){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;!Z||!Z.essential&&ye.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:z})),H(this._map.getBearing())&&this._map.resetNorth()):(H(Z.bearing||this._map.getBearing())&&(Z.bearing=0),Z.freezeElevation=!0,this._map.easeTo(Z,{originalEvent:z})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new c.l(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new Do("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ki extends c.E{constructor(e,o,h){super(),this._renderFrameCallback=()=>{const m=Math.min((Ne()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=h.bearingSnap,this._zoomSnap=h.zoomSnap,this.cameraHelper=o,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,o){e.apply(this.transform,!0),this.transform=e,this.cameraHelper=o}getCenter(){return new c.V(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,o){return this.jumpTo({elevation:e},o),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,o,h){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},o),h)}panTo(e,o,h){return this.easeTo(c.e({center:e},o),h)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,h){return this.easeTo(c.e({zoom:e},o),h)}zoomIn(e,o){return this.zoomTo(c.cx(this.getZoom()+1,this._zoomSnap),e,o),this}zoomOut(e,o){return this.zoomTo(c.cx(this.getZoom()-1,this._zoomSnap),e,o),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,o){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new c.l("movestart",o)).fire(new c.l("move",o)).fire(new c.l("moveend",o))),this}getBearing(){return this.transform.bearing}setZoomSnap(e){return this._zoomSnap=e,this}getZoomSnap(){return this._zoomSnap}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,h){return this.easeTo(c.e({bearing:e},o),h)}resetNorth(e,o){return this.rotateTo(0,c.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}getRoll(){return this.transform.roll}setRoll(e,o){return this.jumpTo({roll:e},o),this}cameraForBounds(e,o){e=un.convert(e).adjustAntiMeridian();const h=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),h,o)}_cameraForBoxAndBearing(e,o,h,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=c.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const B=m.padding;m.padding={top:B,bottom:B,right:B,left:B}}const C=c.e(b,m.padding);m.padding=C;const R=this.transform,z=new un(e,o);return this.cameraHelper.cameraForBoxAndBearing(m,C,z,h,R)}fitBounds(e,o,h){return this._fitInternal(this.cameraForBounds(e,o),o,h)}fitScreenCoordinates(e,o,h,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(e)),this.transform.screenPointToLocation(c.P.convert(o)),h,m),m,b)}_fitInternal(e,o,h){return e?(delete(o=c.e(e,o)).padding,o.linear?this.easeTo(o,h):this.flyTo(o,h)):this}jumpTo(e,o){this.stop();const h=this._getTransformForUpdate();let m=!1,b=!1,C=!1;const R=h.zoom;this.cameraHelper.handleJumpToCenterZoom(h,e);const z=h.zoom!==R;return"elevation"in e&&h.elevation!==+e.elevation&&h.setElevation(+e.elevation),"bearing"in e&&h.bearing!==+e.bearing&&(m=!0,h.setBearing(+e.bearing)),"pitch"in e&&h.pitch!==+e.pitch&&(b=!0,h.setPitch(+e.pitch)),"roll"in e&&h.roll!==+e.roll&&(C=!0,h.setRoll(+e.roll)),e.padding==null||h.isPaddingEqual(e.padding)||h.setPadding(e.padding),this._applyUpdatedTransform(h),this.fire(new c.l("movestart",o)).fire(new c.l("move",o)),z&&this.fire(new c.l("zoomstart",o)).fire(new c.l("zoom",o)).fire(new c.l("zoomend",o)),m&&this.fire(new c.l("rotatestart",o)).fire(new c.l("rotate",o)).fire(new c.l("rotateend",o)),b&&this.fire(new c.l("pitchstart",o)).fire(new c.l("pitch",o)).fire(new c.l("pitchend",o)),C&&this.fire(new c.l("rollstart",o)).fire(new c.l("roll",o)).fire(new c.l("rollend",o)),this.fire(new c.l("moveend",o))}calculateCameraOptionsFromTo(e,o,h,m=0){const b=c.a9.fromLngLat(e,o),C=c.a9.fromLngLat(h,m),R=C.x-b.x,z=C.y-b.y,B=C.z-b.z,U=Math.hypot(R,z,B);if(U===0)throw new Error("Can't calculate camera options with same From and To");const Z=Math.hypot(R,z),H=c.at(this.transform.cameraToCenterDistance/U/this.transform.tileSize),X=180*Math.atan2(R,-z)/Math.PI;let te=180*Math.acos(Z/U)/Math.PI;return te=B<0?90-te:90+te,{center:C.toLngLat(),elevation:m,zoom:H,pitch:te,bearing:X}}calculateCameraOptionsFromCameraLngLatAltRotation(e,o,h,m,b){const C=this.transform.calculateCenterFromCameraLngLatAlt(e,o,h,m);return{center:C.center,elevation:C.elevation,zoom:C.zoom,bearing:h,pitch:m,roll:b}}easeTo(e,o){this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.cz},e)).animate===!1||!e.essential&&ye.prefersReducedMotion)&&(e.duration=0);const h=this._getTransformForUpdate(),m=this.getBearing(),b=h.pitch,C=h.roll,R="bearing"in e?this._normalizeBearing(e.bearing,m):m,z="pitch"in e?+e.pitch:b,B="roll"in e?this._normalizeBearing(e.roll,C):C,U="padding"in e?e.padding:h.padding,Z=c.P.convert(e.offset);let H,X;e.around&&(H=c.V.convert(e.around),X=h.locationToScreenPoint(H));const te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},le=this.cameraHelper.handleEaseTo(h,{bearing:R,pitch:z,roll:B,padding:U,around:H,aroundPoint:X,offsetAsPoint:Z,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||m!==R,this._pitching=this._pitching||z!==b,this._rolling=this._rolling||B!==C,this._padding=!h.isPaddingEqual(U),this._zooming=this._zooming||le.isZooming,this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,te),this.terrain&&this._prepareElevation(le.elevationCenter),this._ease((ce=>{le.easeFunc(ce),this.terrain&&!e.freezeElevation&&this._updateElevation(ce),this._applyUpdatedTransform(h),this._fireMoveEvents(o)}),(ce=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o,ce)}),e),this}_prepareEase(e,o,h={}){this._moving=!0,o||h.moving||this.fire(new c.l("movestart",e)),this._zooming&&!h.zooming&&this.fire(new c.l("zoomstart",e)),this._rotating&&!h.rotating&&this.fire(new c.l("rotatestart",e)),this._pitching&&!h.pitching&&this.fire(new c.l("pitchstart",e)),this._rolling&&!h.rolling&&this.fire(new c.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(h-(o-(h*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.setElevation(c.G.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const o=e.getCameraLngLat(),h=e.getCameraAltitude(),m=this.terrain?this.terrain.getElevationForLngLatZoom(o,e.zoom):0;if(h<m){const b=this.calculateCameraOptionsFromTo(o,m,e.center,e.elevation);return{pitch:b.pitch,zoom:b.zoom}}return{}}_applyUpdatedTransform(e){const o=[];if(o.push((m=>this._elevateCameraIfInsideTerrain(m))),this.transformCameraUpdate&&o.push((m=>this.transformCameraUpdate(m))),!o.length)return;const h=e.clone();for(const m of o){const b=h.clone(),{center:C,zoom:R,roll:z,pitch:B,bearing:U,elevation:Z}=m(b);C&&b.setCenter(C),Z!==void 0&&b.setElevation(Z),R!==void 0&&b.setZoom(R),z!==void 0&&b.setRoll(z),B!==void 0&&b.setPitch(B),U!==void 0&&b.setBearing(U),h.apply(b,!1)}this.transform.apply(h,!1)}_fireMoveEvents(e){this.fire(new c.l("move",e)),this._zooming&&this.fire(new c.l("zoom",e)),this._rotating&&this.fire(new c.l("rotate",e)),this._pitching&&this.fire(new c.l("pitch",e)),this._rolling&&this.fire(new c.l("roll",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const h=this._zooming,m=this._rotating,b=this._pitching,C=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,h&&this.fire(new c.l("zoomend",e)),m&&this.fire(new c.l("rotateend",e)),b&&this.fire(new c.l("pitchend",e)),C&&this.fire(new c.l("rollend",e)),this.fire(new c.l("moveend",e))}flyTo(e,o){if(!e.essential&&ye.prefersReducedMotion){const Ue=c.U(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ue,o)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cz},e);const h=this._getTransformForUpdate(),m=h.bearing,b=h.pitch,C=h.roll,R=h.padding,z="bearing"in e?this._normalizeBearing(e.bearing,m):m,B="pitch"in e?+e.pitch:b,U="roll"in e?this._normalizeBearing(e.roll,C):C,Z="padding"in e?e.padding:h.padding,H=c.P.convert(e.offset);let X=h.centerPoint.add(H);const te=h.screenPointToLocation(X),le=this.cameraHelper.handleFlyTo(h,{bearing:z,pitch:B,roll:U,padding:Z,locationAtOffset:te,offsetAsPoint:H,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let ce=e.curve;const ue=Math.max(h.width,h.height),fe=ue/le.scaleOfZoom,xe=le.pixelPathLength;typeof le.scaleOfMinZoom=="number"&&(ce=Math.sqrt(ue/le.scaleOfMinZoom/xe*2));const he=ce*ce;function ve(Ue){const pt=(fe*fe-ue*ue+(Ue?-1:1)*he*he*xe*xe)/(2*(Ue?fe:ue)*he*xe);return Math.log(Math.sqrt(pt*pt+1)-pt)}function Te(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function ge(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}const Ae=ve(!1);let Ve=function(Ue){return ge(Ae)/ge(Ae+ce*Ue)},ke=function(Ue){return ue*((ge(Ae)*(Te(pt=Ae+ce*Ue)/ge(pt))-Te(Ae))/he)/xe;var pt},Oe=(ve(!0)-Ae)/ce;if(Math.abs(xe)<2e-6||!isFinite(Oe)){if(Math.abs(ue-fe)<1e-6)return this.easeTo(e,o);const Ue=fe<ue?-1:1;Oe=Math.abs(Math.log(fe/ue))/ce,ke=()=>0,Ve=pt=>Math.exp(Ue*ce*pt)}return e.duration="duration"in e?+e.duration:1e3*Oe/("screenSpeed"in e?+e.screenSpeed/ce:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=m!==z,this._pitching=B!==b,this._rolling=U!==C,this._padding=!h.isPaddingEqual(Z),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(le.targetCenter),this._ease((Ue=>{const pt=Ue*Oe,mt=1/Ve(pt),ot=ke(pt);this._rotating&&h.setBearing(c.G.number(m,z,Ue)),this._pitching&&h.setPitch(c.G.number(b,B,Ue)),this._rolling&&h.setRoll(c.G.number(C,U,Ue)),this._padding&&(h.interpolatePadding(R,Z,Ue),X=h.centerPoint.add(H)),le.easeFunc(Ue,mt,ot,X),this.terrain&&!e.freezeElevation&&this._updateElevation(Ue),this._applyUpdatedTransform(h),this._fireMoveEvents(o)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){var h;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,o)}return e||(h=this.handlers)===null||h===void 0||h.stop(!1),this}_ease(e,o,h){h.animate===!1||h.duration===0?(e(1),o()):(this._easeStart=Ne(),this._easeOptions=h,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=c.W(e,-180,180);const h=Math.abs(e-o);return Math.abs(e-360-o)<h&&(e-=360),Math.abs(e+360-o)<h&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLat(c.V.convert(e),this.transform):null}}const vi={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ei{constructor(e=vi){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=se.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=se.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=se.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){se.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){const h=this._map._getUIString(`AttributionControl.${o}`);e.title=h,e.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((m=>typeof m!="string"?"":m))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const o=this._map.style.tileManagers;for(const m in o){const b=o[m];if(b.used||b.usedForTerrain){const C=b.getSource();C.attribution&&e.indexOf(C.attribution)<0&&e.push(C.attribution)}}e=e.filter((m=>String(m).trim())),e.sort(((m,b)=>m.length-b.length)),e=e.filter(((m,b)=>{for(let C=b+1;C<e.length;C++)if(e[C].indexOf(m)>=0)return!1;return!0}));const h=e.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,e.length?(this._innerContainer.innerHTML=se.sanitize(h),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class oc{constructor(e={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=se.create("div","maplibregl-ctrl");const o=se.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){se.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Qs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){const o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(const m of h)if(m.id===e)return void(m.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const h of o)if(!h.cancelled&&(h.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ln=c.aU([{name:"a_pos3d",type:"Int16",components:3}]);class Bn extends c.E{constructor(e){super(),this._lastTilesetChange=Ne(),this.tileManager=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(e,o){this.tileManager.update(e,o),this._renderableTilesKeys=[];const h={};for(const m of ii(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o,calculateTileZoom:this.tileManager._source.calculateTileZoom}))h[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.terrainRttPosMatrix32f=new Float64Array(16),c.c7(m.terrainRttPosMatrix32f,0,c.a5,c.a5,0,0,1),this._tiles[m.key]=new Pe(m,this.tileSize),this._lastTilesetChange=Ne());for(const m in this._tiles)h[m]||delete this._tiles[m]}freeRtt(e){for(const o in this._tiles){const h=this._tiles[o];(!e||h.tileID.equals(e)||h.tileID.isChildOf(e)||e.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,o){return o?this._getTerrainCoordsForTileRanges(e,o):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const o={};for(const h of this._renderableTilesKeys){const m=this._tiles[h].tileID,b=e.clone(),C=c.bk();if(m.canonical.equals(e.canonical))c.c7(C,0,c.a5,c.a5,0,0,1);else if(m.canonical.isChildOf(e.canonical)){const R=m.canonical.z-e.canonical.z,z=m.canonical.x-(m.canonical.x>>R<<R),B=m.canonical.y-(m.canonical.y>>R<<R),U=c.a5>>R;c.c7(C,0,U,U,0,0,1),c.O(C,C,[-z*U,-B*U,0])}else{if(!e.canonical.isChildOf(m.canonical))continue;{const R=e.canonical.z-m.canonical.z,z=e.canonical.x-(e.canonical.x>>R<<R),B=e.canonical.y-(e.canonical.y>>R<<R),U=c.a5>>R;c.c7(C,0,c.a5,c.a5,0,0,1),c.O(C,C,[z*U,B*U,0]),c.Q(C,C,[1/2**R,1/2**R,0])}}b.terrainRttPosMatrix32f=new Float32Array(C),o[h]=b}return o}_getTerrainCoordsForTileRanges(e,o){const h={};for(const m of this._renderableTilesKeys){const b=this._tiles[m].tileID;if(!this._isWithinTileRanges(b,o))continue;const C=e.clone(),R=c.bk();if(b.canonical.z===e.canonical.z){const z=e.canonical.x-b.canonical.x+e.wrap*(1<<e.canonical.z),B=e.canonical.y-b.canonical.y;c.c7(R,0,c.a5,c.a5,0,0,1),c.O(R,R,[z*c.a5,B*c.a5,0])}else if(b.canonical.z>e.canonical.z){const z=b.canonical.z-e.canonical.z,B=b.canonical.x-(b.canonical.x>>z<<z)+e.wrap*(1<<b.canonical.z),U=b.canonical.y-(b.canonical.y>>z<<z),Z=e.canonical.x-(b.canonical.x>>z),H=e.canonical.y-(b.canonical.y>>z),X=c.a5>>z;c.c7(R,0,X,X,0,0,1),c.O(R,R,[-B*X+Z*c.a5,-U*X+H*c.a5,0])}else{const z=e.canonical.z-b.canonical.z,B=e.canonical.x-(e.canonical.x>>z<<z)+e.wrap*(1<<e.canonical.z),U=e.canonical.y-(e.canonical.y>>z<<z),Z=(e.canonical.x>>z)-b.canonical.x,H=(e.canonical.y>>z)-b.canonical.y,X=c.a5<<z;c.c7(R,0,X,X,0,0,1),c.O(R,R,[B*c.a5+Z*X,U*c.a5+H*X,0])}C.terrainRttPosMatrix32f=new Float32Array(R),h[m]=C}return h}getSourceTile(e,o){const h=this.tileManager._source;let m=e.overscaledZ-this.deltaZoom;if(m>h.maxzoom&&(m=h.maxzoom),m<h.minzoom)return;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(m).key);let b=this.findTileInCaches(this._sourceTileCache[e.key]);if(!(b!=null&&b.dem)&&o)for(;m>=h.minzoom&&!(b!=null&&b.dem);)b=this.findTileInCaches(e.scaledTo(m--).key);return b}findTileInCaches(e){let o=this.tileManager.getTileByID(e);return o||(o=this.tileManager._outOfViewCache.getByKey(e),o)}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,o){const h=o[e.canonical.z];return!!h&&(e.wrap>h.minWrap||e.wrap<h.maxWrap||e.canonical.x>=h.minTileXWrapped&&e.canonical.x<=h.maxTileXWrapped&&e.canonical.y>=h.minTileY&&e.canonical.y<=h.maxTileY)}}class sn{constructor(e,o,h){this._meshCache={},this.painter=e,this.tileManager=new Bn(o),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,h,m=c.a5){var b;if(!(o>=0&&o<m&&h>=0&&h<m))return 0;const C=this.getTerrainData(e),R=(b=C.tile)===null||b===void 0?void 0:b.dem;if(!R)return 0;const z=c.cD([],[o/m*c.a5,h/m*c.a5],C.u_terrain_matrix),B=[z[0]*R.dim,z[1]*R.dim],U=Math.floor(B[0]),Z=Math.floor(B[1]),H=B[0]-U,X=B[1]-Z;return R.get(U,Z)*(1-H)*(1-X)+R.get(U+1,Z)*H*(1-X)+R.get(U,Z+1)*(1-H)*X+R.get(U+1,Z+1)*H*X}getElevationForLngLatZoom(e,o){if(!c.cE(o,e.wrap()))return 0;const{tileID:h,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(h,m%c.a5,b%c.a5,c.a5)}getElevationForLngLat(e,o){const h=ii(o,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let m=0;for(const b of h)b.canonical.z>m&&(m=Math.min(b.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(e,m)}getElevation(e,o,h,m=c.a5){return this.getDEMElevation(e,o,h,m)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const m=this.painter.context,b=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(m,new c.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.ar([])}const o=this.tileManager.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const m=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new c.T(m,o.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),o.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const h=o&&o.toString()+o.tileID.key+e.key;if(h&&!this._demMatrixCache[h]){const m=this.tileManager.getSource().maxzoom;let b=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=m?b=e.canonical.z-m:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=e.canonical.x-(e.canonical.x>>b<<b),R=e.canonical.y-(e.canonical.y>>b<<b),z=c.cF(new Float64Array(16),[1/(c.a5<<b),1/(c.a5<<b),0]);c.O(z,z,[C*c.a5,R*c.a5,0]),this._demMatrixCache[e.key]={matrix:z,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){const o=this.painter,h=o.width/devicePixelRatio,m=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(o.context,{width:h,height:m,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(o.context,{width:h,height:m,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(h,m,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,h,m))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,C=0;b<this._coordsTextureSize;b++)for(let R=0;R<this._coordsTextureSize;R++,C+=4)o[C+0]=255&R,o[C+1]=255&b,o[C+2]=R>>8<<4|b>>8,o[C+3]=0;const h=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),m=new c.T(e,h,e.gl.RGBA,{premultiply:!1});return m.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),h=this.painter.context,m=h.gl,b=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,R-C-1,1,1,m.RGBA,m.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null);const z=o[0]+(o[2]>>4<<8),B=o[1]+((15&o[2])<<8),U=this.coordsIndex[255-o[3]],Z=U&&this.tileManager.getTileByID(U);if(!Z)return null;const H=this._coordsTextureSize,X=(1<<Z.tileID.canonical.z)*H;return new c.a9((Z.tileID.canonical.x*H+z)/X+Z.tileID.wrap,(Z.tileID.canonical.y*H+B)/X,this.getElevation(Z.tileID,z,B,H))}depthAtPoint(e){const o=new Uint8Array(4),h=this.painter.context,m=h.gl;return h.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(e){var o;const h=((o=this.painter.style.projection)===null||o===void 0?void 0:o.transitionState)>0,m=h&&e.canonical.y===0,b=h&&e.canonical.y===(1<<e.canonical.z)-1,C=`m_${m?"n":""}_${b?"s":""}`;if(this._meshCache[C])return this._meshCache[C];const R=this.painter.context,z=new c.cG,B=new c.aY,U=this.meshSize,Z=c.a5/U,H=U*U;for(let ge=0;ge<=U;ge++)for(let Ae=0;Ae<=U;Ae++)z.emplaceBack(Ae*Z,ge*Z,0);for(let ge=0;ge<H;ge+=U+1)for(let Ae=0;Ae<U;Ae++)B.emplaceBack(Ae+ge,U+Ae+ge+1,U+Ae+ge+2),B.emplaceBack(Ae+ge,U+Ae+ge+2,Ae+ge+1);const X=z.length,te=X+(U+1),le=(U+1)*U,ce=m?c.br:0,ue=m?0:1,fe=b?c.bs:c.a5,xe=b?0:1;for(let ge=0;ge<=U;ge++)z.emplaceBack(ge*Z,ce,ue);for(let ge=0;ge<=U;ge++)z.emplaceBack(ge*Z,fe,xe);for(let ge=0;ge<U;ge++)B.emplaceBack(le+ge,te+ge,te+ge+1),B.emplaceBack(le+ge,te+ge+1,le+ge+1),B.emplaceBack(0+ge,X+ge+1,X+ge),B.emplaceBack(0+ge,0+ge+1,X+ge+1);const he=z.length,ve=he+2*(U+1);for(const ge of[0,1])for(let Ae=0;Ae<=U;Ae++)for(const Ve of[0,1])z.emplaceBack(ge*c.a5,Ae*Z,Ve);for(let ge=0;ge<2*U;ge+=2)B.emplaceBack(he+ge,he+ge+1,he+ge+3),B.emplaceBack(he+ge,he+ge+3,he+ge+2),B.emplaceBack(ve+ge,ve+ge+3,ve+ge+1),B.emplaceBack(ve+ge,ve+ge+2,ve+ge+3);const Te=new Yn(R.createVertexBuffer(z,ln.members),R.createIndexBuffer(B),c.aX.simpleSegment(0,0,z.length,B.length));return this._meshCache[C]=Te,Te}getMeshFrameDelta(e){return 2*Math.PI*c.bE/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,o){var h;if(!c.cE(o,e.wrap()))return 0;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(h=this.getMinMaxElevation(m).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(e){const o=this.getTerrainData(e).tile,h={minElevation:null,maxElevation:null};return o&&o.dem&&(h.minElevation=o.dem.min*this.exaggeration,h.maxElevation=o.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(e,o){const h=c.a9.fromLngLat(e.wrap()),m=(1<<o)*c.a5,b=h.x*m,C=h.y*m,R=Math.floor(b/c.a5),z=Math.floor(C/c.a5);return{tileID:new c.a2(o,0,o,R,z),mercatorX:b,mercatorY:C}}}class fi{constructor(e,o,h){this._context=e,this._size=o,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(h.texture),{id:e,fbo:o,texture:h,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((o=>e.id!==o)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const zo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Wo{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new fi(e.context,30,o.tileManager.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=e._order.filter((h=>!e._layers[h].isHidden(o))),this._coordsAscending={};for(const h in e.tileManagers){this._coordsAscending[h]={};const m=e.tileManagers[h].getVisibleCoordinates(),b=e.tileManagers[h].getSource(),C=b instanceof Sr?b.terrainTileRanges:null;for(const R of m){const z=this.terrain.tileManager.getTerrainCoords(R,C);for(const B in z)this._coordsAscending[h][B]||(this._coordsAscending[h][B]=[]),this._coordsAscending[h][B].push(z[B])}}this._coordsAscendingStr={};for(const h of e._order){const m=e._layers[h],b=m.source;if(zo[m.type]&&!this._coordsAscendingStr[b]){this._coordsAscendingStr[b]={};for(const C in this._coordsAscending[b])this._coordsAscendingStr[b][C]=this._coordsAscending[b][C].map((R=>R.key)).sort().join()}}for(const h of this._renderableTiles)for(const m in this._coordsAscendingStr){const b=this._coordsAscendingStr[m][h.tileID.key];b&&b!==h.rttCoords[m]&&(h.rtt=[])}}renderLayer(e,o){if(e.isHidden(this.painter.transform.zoom))return!1;const h=Object.assign(Object.assign({},o),{isRenderingToTexture:!0}),m=e.type,b=this.painter,C=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(zo[m]&&(this._prevType&&zo[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(e.id),!C))return!0;if(zo[this._prevType]||zo[m]&&C){this._prevType=m;const R=this._stacks.length-1,z=this._stacks[R]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&($c(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[R]){const Z=this.pool.getObjectForId(B.rtt[R].id);if(Z.stamp===B.rtt[R].stamp){this.pool.useObject(Z);continue}}const U=this.pool.getOrCreateFreeObject();this.pool.useObject(U),this.pool.stampObject(U),B.rtt[R]={id:U.id,stamp:U.stamp},b.context.bindFramebuffer.set(U.fbo.framebuffer),b.context.clear({color:c.bp.transparent,stencil:0}),b.currentStencilSource=void 0;for(let Z=0;Z<z.length;Z++){const H=b.style._layers[z[Z]],X=H.source?this._coordsAscending[H.source][B.tileID.key]:[B.tileID];b.context.viewport.set([0,0,U.fbo.width,U.fbo.height]),b._renderTileClippingMasks(H,X,!0),b.renderLayer(b,b.style.tileManagers[H.source],H,X,h),H.source&&(B.rttCoords[H.source]=this._coordsAscendingStr[H.source][B.tileID.key])}}return $c(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects(),zo[m]}return!1}}const ul={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},cl=F,ea={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:vi,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},jh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ai{constructor(e,o,h=!1){this.mousedown=b=>{this.startMove(b,se.mousePos(this.element,b)),se.addEventListener(window,"mousemove",this.mousemove),se.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.move(b,se.mousePos(this.element,b))},this.mouseup=b=>{this._rotatePitchHandler.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=se.touchPos(this.element,b.targetTouches)[0],this.startMove(b,this._startPos),se.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=se.touchPos(this.element,b.targetTouches)[0],this.move(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=o;const m=new Qu;this._rotatePitchHandler=new Ro({clickTolerance:3,move:(b,C)=>{const R=o.getBoundingClientRect(),z=new c.P((R.bottom-R.top)/2,(R.right-R.left)/2);return{bearingDelta:c.cy(new c.P(b.x,C.y),C,z),pitchDelta:h?-.5*(C.y-b.y):void 0}},moveStateManager:m,enable:!0,assignEvents:()=>{}}),this.map=e,se.addEventListener(o,"mousedown",this.mousedown),se.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),se.addEventListener(o,"touchcancel",this.reset)}startMove(e,o){this._rotatePitchHandler.dragStart(e,o),se.disableDrag()}move(e,o){const h=this.map,{bearingDelta:m,pitchDelta:b}=this._rotatePitchHandler.dragMove(e,o)||{};m&&h.setBearing(h.getBearing()+m),b&&h.setPitch(h.getPitch()+b)}off(){const e=this.element;se.removeEventListener(e,"mousedown",this.mousedown),se.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.removeEventListener(window,"touchend",this.touchend),se.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){se.enableDrag(),se.removeEventListener(window,"mousemove",this.mousemove),se.removeEventListener(window,"mouseup",this.mouseup),se.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),se.removeEventListener(window,"touchend",this.touchend)}}let Ko;function ru(v,e,o,h=!1){if(h||!o.getCoveringTilesDetailsProvider().allowWorldCopies())return v==null?void 0:v.wrap();const m=new c.V(v.lng,v.lat);if(v=new c.V(v.lng,v.lat),e){const b=new c.V(v.lng-360,v.lat),C=new c.V(v.lng+360,v.lat),R=o.locationToScreenPoint(v).distSqr(e);o.locationToScreenPoint(b).distSqr(e)<R?v=b:o.locationToScreenPoint(C).distSqr(e)<R&&(v=C)}for(;Math.abs(v.lng-o.center.lng)>180;){const b=o.locationToScreenPoint(v);if(b.x>=0&&b.y>=0&&b.x<=o.width&&b.y<=o.height)break;v.lng>o.center.lng?v.lng-=360:v.lng+=360}return v.lng!==m.lng&&o.isPointOnMapSurface(o.locationToScreenPoint(v))?v:m}const ou={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function sc(v,e,o){const h=v.classList;for(const m in ou)h.remove(`maplibregl-${o}-anchor-${m}`);h.add(`maplibregl-${o}-anchor-${e}`)}class ac extends c.E{constructor(e){if(super(),this._onKeyPress=o=>{const h=o.code,m=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=o=>{const h=o.originalEvent.target,m=this._element;this._popup&&(h===m||m.contains(h))&&this.togglePopup()},this._update=o=>{if(!this._map)return;const h=this._map.loaded()&&!this._map.isMoving();((o==null?void 0:o.type)==="terrain"||(o==null?void 0:o.type)==="render"&&!h)&&this._map.once("render",this._update),this._lngLat=ru(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),se.setTransform(this._element,`${ou[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${m}`),ye.frameAsync(new AbortController,this._map._ownerWindow).then((()=>{this._updateOpacity(o&&o.type==="moveend")})).catch((()=>{}))},this._onMove=o=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=se.create("div");const o=se.createNS("http://www.w3.org/2000/svg","svg"),h=41,m=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${h}px`),o.setAttributeNS(null,"width",`${m}px`),o.setAttributeNS(null,"viewBox",`0 0 ${m} ${h}`);const b=se.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const C=se.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const R=se.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ue of z){const fe=se.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",ue.rx),fe.setAttributeNS(null,"ry",ue.ry),R.appendChild(fe)}const B=se.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const U=se.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(U);const Z=se.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const H=se.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(H);const X=se.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(6.0, 7.0)"),X.setAttributeNS(null,"fill","#FFFFFF");const te=se.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(8.0, 8.0)");const le=se.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#000000"),le.setAttributeNS(null,"opacity","0.25"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962");const ce=se.createNS("http://www.w3.org/2000/svg","circle");ce.setAttributeNS(null,"fill","#FFFFFF"),ce.setAttributeNS(null,"cx","5.5"),ce.setAttributeNS(null,"cy","5.5"),ce.setAttributeNS(null,"r","5.4999962"),te.appendChild(le),te.appendChild(ce),C.appendChild(R),C.appendChild(B),C.appendChild(Z),C.appendChild(X),C.appendChild(te),o.appendChild(C),o.setAttributeNS(null,"height",h*this._scale+"px"),o.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(o),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(o=>{o.preventDefault()})),this._element.addEventListener("mousedown",(o=>{o.preventDefault()})),sc(this._element,this._anchor,"marker"),e&&e.className)for(const o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),se.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.V.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const m=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var o,h;const m=(o=this._map)===null||o===void 0?void 0:o.terrain,b=this._map.transform.isLocationOccluded(this._lngLat);if(!m||b){const X=b?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==X&&(this._element.style.opacity=X))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const C=this._map,R=C.terrain.depthAtPoint(this._pos),z=C.terrain.getElevationForLngLat(this._lngLat,C.transform);if(C.transform.lngLatToCameraDepth(this._lngLat,z)-R<.006)return void(this._element.style.opacity=this._opacity);const B=-this._offset.y/C.transform.pixelsPerMeter,U=Math.sin(C.getPitch()*Math.PI/180)*B,Z=C.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),H=C.transform.lngLatToCameraDepth(this._lngLat,z+U)-Z>.006;!((h=this._popup)===null||h===void 0)&&h.isOpen()&&H&&this._popup.remove(),this._element.style.opacity=H?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,o){return(this._opacity===void 0||e===void 0&&o===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const lc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ra=0,ta=!1;const xr={maxWidth:100,unit:"metric"};function pi(v,e,o){const h=o&&o.maxWidth||100,m=v._container.clientHeight/2,b=v._container.clientWidth/2,C=v.unproject([b-h/2,m]),R=v.unproject([b+h/2,m]),z=Math.round(v.project(R).x-v.project(C).x),B=Math.min(h,z,v._container.clientWidth),U=C.distanceTo(R);if(o&&o.unit==="imperial"){const Z=3.2808*U;Z>5280?Ds(e,B,Z/5280,v._getUIString("ScaleControl.Miles")):Ds(e,B,Z,v._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Ds(e,B,U/1852,v._getUIString("ScaleControl.NauticalMiles")):U>=1e3?Ds(e,B,U/1e3,v._getUIString("ScaleControl.Kilometers")):Ds(e,B,U,v._getUIString("ScaleControl.Meters"))}function Ds(v,e,o,h){const m=(function(b){const C=Math.pow(10,`${Math.floor(b)}`.length-1);let R=b/C;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:(function(z){const B=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*B)/B})(R),C*R})(o);v.style.width=e*(m/o)+"px",v.innerHTML=`${m}&nbsp;${h}`}const hl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},dl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function su(v){if(v){if(typeof v=="number"){const e=Math.round(Math.abs(v)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,v),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-v),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(v,0),right:new c.P(-v,0)}}if(v instanceof c.P||Array.isArray(v)){const e=c.P.convert(v);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(v.center||[0,0]),top:c.P.convert(v.top||[0,0]),"top-left":c.P.convert(v["top-left"]||[0,0]),"top-right":c.P.convert(v["top-right"]||[0,0]),bottom:c.P.convert(v.bottom||[0,0]),"bottom-left":c.P.convert(v["bottom-left"]||[0,0]),"bottom-right":c.P.convert(v["bottom-right"]||[0,0]),left:c.P.convert(v.left||[0,0]),right:c.P.convert(v.right||[0,0])}}return su(new c.P(0,0))}const Qo=F;S.AJAXError=c.cJ,S.Event=c.l,S.Evented=c.E,S.LngLat=c.V,S.MercatorCoordinate=c.a9,S.Point=c.P,S.addProtocol=c.cK,S.config=c.c,S.removeProtocol=c.cL,S.AttributionControl=Ei,S.BoxZoomHandler=Ma,S.CanvasSource=Ll,S.CooperativeGesturesHandler=St,S.DoubleClickZoomHandler=Qc,S.DragPanHandler=$h,S.DragRotateHandler=mo,S.EdgeInsets=oo,S.FullscreenControl=class extends c.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var e;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=o==null?void 0:o.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){se.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=se.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);se.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=Di,S.GeolocateControl=class extends c.E{constructor(v){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const o=new c.V(e.coords.longitude,e.coords.latitude),h=e.coords.accuracy,m=this._map.getBearing(),b=c.e({bearing:m},this.options.fitBoundsOptions),C=un.fromLngLat(o,h);this._map.fitBounds(C,b,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const o=new c.V(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&ta)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=se.create("button","maplibregl-ctrl-geolocate",this._container),se.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ac({element:this._dotElement}),this._circleElement=se.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ac({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(o=>{const h=(o==null?void 0:o[0])instanceof ResizeObserverEntry;o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))}))}},this.options=c.e({},lc,v)}onAdd(v){return this._map=v,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return c._(this,arguments,void 0,(function*(e=!1){if(Ko!==void 0&&!e)return Ko;if(window.navigator.permissions===void 0)return Ko=!!window.navigator.geolocation,Ko;try{Ko=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ko=!!window.navigator.geolocation}return Ko}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),se.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ra=0,ta=!1}_isOutOfMapMaxBounds(v){const e=this._map.getMaxBounds(),o=v.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const v=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&v))return;const e=this._map.project(v),o=this._map.unproject([e.x+100,e.y]),h=v.distanceTo(o)/100,m=2*this._accuracy/h;this._circleElement.style.width=`${m.toFixed(2)}px`,this._circleElement.style.height=`${m.toFixed(2)}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ra--,ta=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ra++,Ra>1?(v={maximumAge:6e5,timeout:0},ta=!0):(v=this.options.positionOptions,ta=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.GlobeControl=class{constructor(){this._toggleProjection=()=>{var v;const e=(v=this._map.getProjection())===null||v===void 0?void 0:v.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var v;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((v=this._map.getProjection())===null||v===void 0?void 0:v.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(v){return this._map=v,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=se.create("button","maplibregl-ctrl-globe",this._container),se.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){se.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},S.Hash=Ni,S.ImageSource=Sr,S.KeyboardHandler=Un,S.LngLatBounds=un,S.LogoControl=oc,S.Map=class extends ki{get _ownerWindow(){var v,e;return((e=(v=this._container)===null||v===void 0?void 0:v.ownerDocument)===null||e===void 0?void 0:e.defaultView)||window}constructor(v){var e,o;c.cH.mark(c.cI.create);const h=Object.assign(Object.assign(Object.assign({},ea),v),{canvasContextAttributes:Object.assign(Object.assign({},ea.canvasContextAttributes),v.canvasContextAttributes)});if(h.minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const m=new Ji,b=new Ya;h.minZoom!==void 0&&m.setMinZoom(h.minZoom),h.maxZoom!==void 0&&m.setMaxZoom(h.maxZoom),h.minPitch!==void 0&&m.setMinPitch(h.minPitch),h.maxPitch!==void 0&&m.setMaxPitch(h.maxPitch),h.renderWorldCopies!==void 0&&m.setRenderWorldCopies(h.renderWorldCopies),h.transformConstrain!==null&&m.setConstrainOverride(h.transformConstrain),super(m,b,{bearingSnap:h.bearingSnap,zoomSnap:h.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Qs,this._controls=[],this._mapId=c.af(),this._lostContextStyle={style:null,images:null},this._contextLost=R=>{R.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const z of Object.values(this.style._layers))if(z.type==="custom"&&console.warn(`Custom layer with id '${z.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),z._listeners)for(const[B]of Object.entries(z._listeners))console.warn(`Custom layer with id '${z.id}' had event listeners for event '${B}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new c.l("webglcontextlost",{originalEvent:R}))},this._contextRestored=R=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new c.l("webglcontextrestored",{originalEvent:R}))},this._onMapScroll=R=>{if(R.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._maxTileCacheZoomLevels=h.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},h.canvasContextAttributes),this._trackResize=h.trackResize===!0,this._bearingSnap=h.bearingSnap,this._zoomSnap=h.zoomSnap,this._centerClampedToGround=h.centerClampedToGround,this._refreshExpiredTiles=h.refreshExpiredTiles===!0,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions===!0,this._collectResourceTiming=h.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ul),h.locale),this._clickTolerance=h.clickTolerance,this._overridePixelRatio=h.pixelRatio,this._maxCanvasSize=h.maxCanvasSize,this._zoomLevelsToOverscale=h.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=h.transformCameraUpdate,this.transformConstrain=h.transformConstrain,this.cancelPendingTileRequestsWhileZooming=h.cancelPendingTileRequestsWhileZooming===!0,h.reduceMotion!==void 0&&(ye.prefersReducedMotion=h.reduceMotion),this._imageQueueHandle=_t.addThrottleControl((()=>this.isMoving())),this._requestManager=new Ut(h.transformRequest),this._container=this._resolveContainer(h.container),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new rc(this,h),this._hash=h.hash&&new Ni(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,elevation:h.elevation,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,roll:h.roll}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,c.e({},h.fitBoundsOptions,{duration:0}))));const C=typeof h.style=="string"||((o=(e=h.style)===null||e===void 0?void 0:e.projection)===null||o===void 0?void 0:o.type)!=="globe";this.resize(null,C),this._localIdeographFontFamily=h.localIdeographFontFamily,this._validateStyle=h.validateStyle,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new Ei(typeof h.attributionControl=="boolean"?void 0:h.attributionControl)),h.maplibreLogo&&this.addControl(new oc,h.logoPosition),this.on("style.load",(()=>{if(C||this._resizeTransform(),this.transform.unmodified){const R=c.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(R)}})),this.on("data",(R=>{this._update(R.dataType==="style"),this.fire(new c.l(`${R.dataType}data`,R))})),this.on("dataloading",(R=>{this.fire(new c.l(`${R.dataType}dataloading`,R))})),this.on("dataabort",(R=>{this.fire(new c.l("sourcedataabort",R))}))}_getMapId(){return this._mapId}setGlobalStateProperty(v,e){return this.style.setGlobalStateProperty(v,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(v,e){if(e===void 0&&(e=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=v.onAdd(this);this._controls.push(v);const h=this._controlPositions[e];return e.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(v);return e>-1&&this._controls.splice(e,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}coveringTiles(v){return ii(this.transform,v)}calculateCameraOptionsFromTo(v,e,o,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLat(o,this.transform)),super.calculateCameraOptionsFromTo(v,e,o,h)}resize(v,e=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(e);const o=!this._moving;return o&&(this.stop(),this.fire(new c.l("movestart",v)).fire(new c.l("move",v))),this.fire(new c.l("resize",v)),o&&this.fire(new c.l("moveend",v)),this}_resizeInternal(v=!0){const[e,o]=this._containerDimensions(),h=this._getClampedPixelRatio(e,o);if(this._resizeCanvas(e,o,h),this.painter.resize(e,o,h),this.painter.overLimit()){const m=this.painter.context.gl;this._maxCanvasSize=[m.drawingBufferWidth,m.drawingBufferHeight];const b=this._getClampedPixelRatio(e,o);this._resizeCanvas(e,o,b),this.painter.resize(e,o,b)}this._resizeTransform(v)}_resizeTransform(v=!0){var e;const[o,h]=this._containerDimensions();this.transform.resize(o,h,v),(e=this._requestedCameraState)===null||e===void 0||e.resize(o,h,v)}_getClampedPixelRatio(v,e){const{0:o,1:h}=this._maxCanvasSize,m=this.getPixelRatio(),b=v*m,C=e*m;return Math.min(b>o?o/b:1,C>h?h/C:1)*m}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(un.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom){const e=this.transform.zoom,o=this._getTransformForUpdate();return o.setMinZoom(v),this._applyUpdatedTransform(o),this._update(),e!==this.transform.zoom&&this.fire(new c.l("zoomstart")).fire(new c.l("zoom")).fire(new c.l("zoomend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom){const e=this.transform.zoom,o=this._getTransformForUpdate();return o.setMaxZoom(v),this._applyUpdatedTransform(o),this._update(),e!==this.transform.zoom&&this.fire(new c.l("zoomstart")).fire(new c.l("zoom")).fire(new c.l("zoomend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch){const e=this.transform.pitch,o=this._getTransformForUpdate();return o.setMinPitch(v),this._applyUpdatedTransform(o),this._update(),e!==this.transform.pitch&&this.fire(new c.l("pitchstart")).fire(new c.l("pitch")).fire(new c.l("pitchend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(v>=this.transform.minPitch){const e=this.transform.pitch,o=this._getTransformForUpdate();return o.setMaxPitch(v),this._applyUpdatedTransform(o),this._update(),e!==this.transform.pitch&&this.fire(new c.l("pitchstart")).fire(new c.l("pitch")).fire(new c.l("pitchend")).fire(new c.l("movestart")).fire(new c.l("move")).fire(new c.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.setRenderWorldCopies(v),this._update()}setTransformConstrain(v){return this.transform.setConstrainOverride(v),this._update()}project(v){return this.transform.locationToScreenPoint(c.V.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.screenPointToLocation(c.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,e,o){if(v==="mouseenter"||v==="mouseover"){let h=!1;return{layers:e,listener:o,delegates:{mousemove:b=>{const C=e.filter((z=>this.getLayer(z))),R=C.length!==0?this.queryRenderedFeatures(b.point,{layers:C}):[];R.length?h||(h=!0,o.call(this,new rr(v,this,b.originalEvent,{features:R}))):h=!1},mouseout:()=>{h=!1}}}}if(v==="mouseleave"||v==="mouseout"){let h=!1;return{layers:e,listener:o,delegates:{mousemove:C=>{const R=e.filter((z=>this.getLayer(z)));(R.length!==0?this.queryRenderedFeatures(C.point,{layers:R}):[]).length?h=!0:h&&(h=!1,o.call(this,new rr(v,this,C.originalEvent)))},mouseout:C=>{h&&(h=!1,o.call(this,new rr(v,this,C.originalEvent)))}}}}{const h=m=>{const b=e.filter((R=>this.getLayer(R))),C=b.length!==0?this.queryRenderedFeatures(m.point,{layers:b}):[];C.length&&(m.features=C,o.call(this,m),delete m.features)};return{layers:e,listener:o,delegates:{[v]:h}}}}_saveDelegatedListener(v,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(e)}_removeDelegatedListener(v,e,o){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const h=this._delegatedListeners[v];for(let m=0;m<h.length;m++){const b=h[m];if(b.listener===o&&b.layers.length===e.length&&b.layers.every((C=>e.includes(C)))){for(const C in b.delegates)this.off(C,b.delegates[C]);return void h.splice(m,1)}}}on(v,e,o){if(o===void 0)return super.on(v,e);const h=typeof e=="string"?[e]:e,m=this._createDelegatedListener(v,h,o);this._saveDelegatedListener(v,m);for(const b in m.delegates)this.on(b,m.delegates[b]);return{unsubscribe:()=>{this._removeDelegatedListener(v,h,o)}}}once(v,e,o){if(o===void 0)return super.once(v,e);const h=typeof e=="string"?[e]:e,m=this._createDelegatedListener(v,h,o);for(const b in m.delegates){const C=m.delegates[b];m.delegates[b]=(...R)=>{this._removeDelegatedListener(v,h,o),C(...R)}}this._saveDelegatedListener(v,m);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(v,e,o){return o===void 0?super.off(v,e):(this._removeDelegatedListener(v,typeof e=="string"?[e]:e,o),this)}queryRenderedFeatures(v,e){if(!this.style)return[];let o;const h=v instanceof c.P||Array.isArray(v),m=h?v:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(h?{}:v)||{},m instanceof c.P||typeof m[0]=="number")o=[c.P.convert(m)];else{const b=c.P.convert(m[0]),C=c.P.convert(m[1]);o=[b,new c.P(C.x,b.y),C,new c.P(b.x,C.y),b]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(v,e){return this.style.querySourceFeatures(v,e)}setStyle(v,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(v,e))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const e=this._locale[v];if(e==null)throw new Error(`Missing UI string '${v}'`);return e}_updateStyle(v,e){var o,h;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(v,e)));const m=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new ya(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,e,m):this.style.loadJSON(v,e,m),this):((h=(o=this.style)===null||o===void 0?void 0:o.projection)===null||h===void 0||h.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ya(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,e){if(typeof v=="string"){const o=this._requestManager.transformRequest(v,"Style");c.j(o,new AbortController).then((h=>{this._updateDiff(h.data,e)})).catch((h=>{h&&this.fire(new c.k(h))}))}else typeof v=="object"&&this._updateDiff(v,e)}_updateDiff(v,e){try{this.style.setState(v,e)&&this._update(!0)}catch(o){c.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(v,e)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(v,e){return this._lazyInitEmptyStyle(),this.style.addSource(v,e),this._update(!0)}isSourceLoaded(v){const e=this.style&&this.style.tileManagers[v];if(e!==void 0)return e.loaded();this.fire(new c.k(new Error(`There is no tile manager with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const e=this.style.tileManagers[v.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&e.reload();for(const o in this.style._layers){const h=this.style._layers[o];h.type==="hillshade"&&h.source===v.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),h.type==="color-relief"&&h.source===v.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new sn(this.painter,e,v),this.painter.renderToTexture=new Wo(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=o=>{var h;o.dataType==="style"?this.terrain.tileManager.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==v.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((h=o.source)===null||h===void 0?void 0:h.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:v})),this}getTerrain(){var v,e;return(e=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const v=this.style&&this.style.tileManagers;for(const e of Object.values(v))if(!e.areTilesLoaded())return!1;return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}setSourceTileLodParams(v,e,o){if(o){const h=this.getSource(o);if(!h)throw new Error(`There is no source with ID "${o}", cannot set LOD parameters`);h.calculateTileZoom=Ot(Math.max(1,v),Math.max(1,e))}else for(const h in this.style.tileManagers)this.style.tileManagers[h].getSource().calculateTileZoom=Ot(Math.max(1,v),Math.max(1,e));return this._update(!0),this}refreshTiles(v,e){const o=this.style.tileManagers[v];if(!o)throw new Error(`There is no tile manager with ID "${v}", cannot refresh tile`);e===void 0?o.reload(!0):o.refreshTiles(e.map((h=>new c.ac(h.z,h.x,h.y))))}addImage(v,e,o={}){const{pixelRatio:h=1,sdf:m=!1,stretchX:b,stretchY:C,content:R,textFitWidth:z,textFitHeight:B}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:U,height:Z,data:H}=e,X=e;return this.style.addImage(v,{data:new c.R({width:U,height:Z},new Uint8Array(H)),pixelRatio:h,stretchX:b,stretchY:C,content:R,textFitWidth:z,textFitHeight:B,sdf:m,version:0,userImage:X}),X.onAdd&&X.onAdd(this,v),this}}{const{width:U,height:Z,data:H}=ye.getImageData(e);this.style.addImage(v,{data:new c.R({width:U,height:Z},H),pixelRatio:h,stretchX:b,stretchY:C,content:R,textFitWidth:z,textFitHeight:B,sdf:m,version:0})}}updateImage(v,e){const o=this.style.getImage(v);if(!o)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=e instanceof HTMLImageElement||c.b(e)?ye.getImageData(e):e,{width:m,height:b,data:C}=h;if(m===void 0||b===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==o.data.width||b!==o.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(e instanceof HTMLImageElement||c.b(e));return o.data.replace(C,R),this.style.updateImage(v,o),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return _t.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,e){return this._lazyInitEmptyStyle(),this.style.addLayer(v,e),this._update(!0)}moveLayer(v,e){return this.style.moveLayer(v,e),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,e,o){return this.style.setLayerZoomRange(v,e,o),this._update(!0)}setFilter(v,e,o={}){return this.style.setFilter(v,e,o),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,e,o,h={}){return this.style.setPaintProperty(v,e,o,h),this._update(!0)}getPaintProperty(v,e){return this.style.getPaintProperty(v,e)}setLayoutProperty(v,e,o,h={}){return this.style.setLayoutProperty(v,e,o,h),this._update(!0)}getLayoutProperty(v,e){return this.style.getLayoutProperty(v,e)}setGlyphs(v,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,e,o,(h=>{h||this._update(!0)})),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,e,(o=>{o||this._update(!0)})),this}setLight(v,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(v,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(v,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,e){return this.style.setFeatureState(v,e),this._update()}removeFeatureState(v,e){return this.style.removeFeatureState(v,e),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,e=0;return this._container&&(v=this._container.clientWidth||400,e=this._container.clientHeight||300),[v,e]}_setupResizeObserver(){var v;let e=!1;const o=qh((m=>{this._trackResize&&!this._removed&&(this.resize(m),this.redraw())}),50),h=(v=this._ownerWindow.ResizeObserver)!==null&&v!==void 0?v:ResizeObserver;this._resizeObserver=new h((m=>{e?o(m):e=!0})),this._resizeObserver.observe(this._container)}_resolveContainer(v){if(typeof v=="string"){const e=document.getElementById(v);if(!e)throw new Error(`Container '${v}' not found.`);return e}if(v instanceof HTMLElement||v&&typeof v=="object"&&v.nodeType===1)return v;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const e=this._canvasContainer=se.create("div","maplibregl-canvas-container",v);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=se.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),h=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],h);const m=this._controlContainer=se.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((C=>{b[C]=se.create("div",`maplibregl-ctrl-${C} `,m)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,e,o){this._canvas.width=Math.floor(o*v),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const v=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(h=>{e={requestedAttributes:v},h&&(e.statusMessage=h.statusMessage,e.type=h.type)}),{once:!0});let o=null;if(o=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,v):this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v),!o){const h="Failed to initialize WebGL";throw e?(e.message=h,new Error(JSON.stringify(e))):new Error(h)}this.painter=new rf(o,this.transform),Ye.testSupport(o)}migrateProjection(v,e){super.migrateProjection(v,e),this.painter.transform=v,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){var e,o,h,m,b;const C=this._idleTriggered?this._fadeDuration:0,R=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Z=this.transform.zoom,H=Ne();this.style.zoomHistory.update(Z,H);const X=new c.H(Z,{now:H,fadeDuration:C,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),te=X.crossFadingFactor();te===1&&te===this._crossFadingFactor||(z=!0,this._crossFadingFactor=te),this.style.update(X)}const B=((o=this.style.projection)===null||o===void 0?void 0:o.transitionState)>0!==R;(h=this.style.projection)===null||h===void 0||h.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((m=this.style.projection)===null||m===void 0?void 0:m.transitionState,(b=this.style.projection)===null||b===void 0?void 0:b.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||B)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,B),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cH.mark(c.cI.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const U=this._sourcesDirty||this._styleDirty||this._placementDirty;return U||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||U||(this._fullyLoaded=!0,c.cH.mark(c.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),_t.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),se.remove(this._canvasContainer),se.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cH.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ye.frame(this._frameRequest,(v=>{c.cH.frame(v),this._frameRequest=null;try{this._render(v)}catch(e){if(!c.Z(e)&&!(function(o){return o.message===Ca})(e))throw e}}),(()=>{}),this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return cl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(v){return this._lazyInitEmptyStyle(),this.style.setProjection(v),this._update(!0)}},S.MapMouseEvent=rr,S.MapTouchEvent=Yo,S.MapWheelEvent=jc,S.Marker=ac,S.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const e=this._map.getZoom(),o=e===this._map.getMaxZoom(),h=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,o)=>{const h=this._map._getUIString(`NavigationControl.${o}`);e.title=h,e.setAttribute("aria-label",h)},this.options=c.e({},jh,v),this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),se.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),se.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=se.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ai(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){se.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,e){const o=se.create("button",v,this._container);return o.type="button",o.addEventListener("click",e),o}},S.Popup=class extends c.E{constructor(v){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&se.remove(this._content),this._container&&(se.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=se.create("div","maplibregl-popup",this._map.getContainer()),this._tip=se.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=ru(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const o=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let h=this.options.anchor;const m=su(this.options.offset);if(!h){const C=this._container.offsetWidth,R=this._container.offsetHeight,z=(function(U){var Z,H,X,te;return U?{top:(Z=U.top)!==null&&Z!==void 0?Z:0,right:(H=U.right)!==null&&H!==void 0?H:0,bottom:(X=U.bottom)!==null&&X!==void 0?X:0,left:(te=U.left)!==null&&te!==void 0?te:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding);let B;B=o.y+m.bottom.y<R+z.top?["top"]:o.y>this._map.transform.height-R-z.bottom?["bottom"]:[],o.x<C/2+z.left?B.push("left"):o.x>this._map.transform.width-C/2-z.right&&B.push("right"),h=B.length===0?"bottom":B.join("-")}let b=o.add(m[h]);this.options.subpixelPositioning||(b=b.round()),se.setTransform(this._container,`${ou[h]} translate(${b.x}px,${b.y}px)`),sc(this._container,h,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(hl),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=c.V.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const e=document.createDocumentFragment(),o=document.createElement("body");let h;for(o.innerHTML=v;h=o.firstChild,h;)e.appendChild(h);return this.setDOMContent(e)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=se.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}setPadding(v){this.options.padding=v,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=se.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(dl);v&&v.focus()}},S.RasterDEMTileSource=Dr,S.RasterTileSource=Ho,S.ScaleControl=class{constructor(v){this._onMove=()=>{pi(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,pi(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},xr),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){se.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=nc,S.Style=ya,S.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=se.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=se.create("button","maplibregl-ctrl-terrain",this._container),se.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){se.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=Ws,S.TwoFingersTouchRotateHandler=tc,S.TwoFingersTouchZoomHandler=Rs,S.TwoFingersTouchZoomRotateHandler=ll,S.VectorTileSource=wo,S.VideoSource=Os,S.addSourceType=(v,e)=>c._(void 0,void 0,void 0,(function*(){if(Nl(v))throw new Error(`A source type called "${v}" already exists.`);((o,h)=>{Us[o]=h})(v,e)})),S.clearPrewarmedResources=function(){const v=mn;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Rt),mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.createTileMesh=Hd,S.getMaxParallelImageRequests=function(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return ne().getRTLTextPluginStatus()},S.getVersion=function(){return Qo},S.getWorkerCount=function(){return $t.workerCount},S.getWorkerUrl=function(){return c.c.WORKER_URL},S.importScriptInWorkers=function(v){return bn().broadcast("IS",v)},S.isTimeFrozen=function(){return Le.isFrozen()},S.now=Ne,S.prewarm=function(){gn().acquire(Rt)},S.restoreNow=function(){Le.restoreNow()},S.setMaxParallelImageRequests=function(v){c.c.MAX_PARALLEL_IMAGE_REQUESTS=v},S.setNow=function(v){Le.setNow(v)},S.setRTLTextPlugin=function(v,e){return ne().setRTLTextPlugin(v,e)},S.setWorkerCount=function(v){$t.workerCount=v},S.setWorkerUrl=function(v){c.c.WORKER_URL=v}}));var I=f;return I}))})(Fg)),Fg.exports}var b_=Cb();const Ab=({onBuildingClick:u,overlayType:a,highlightedIds:f=[],groundedPoints:y=[]})=>{const T=Tn.useRef(null),I=Tn.useRef(null),S=Tn.useRef({}),[c,F]=Tn.useState("NEURAL_DARK"),[k,G]=Tn.useState("ALL"),[K,ee]=Tn.useState(!1),[ye,Le]=Tn.useState(!1);Tn.useEffect(()=>{if(!I.current||T.current)return;const se=setTimeout(()=>{K||(console.log("Map failed to load, showing fallback"),ee(!0),Le(!0))},5e3);try{const Ye=new b_.Map({container:I.current,style:{version:8,sources:{"dark-tiles":{type:"raster",tiles:["https://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png"],tileSize:256,attribution:"&copy; CARTO"},"satellite-tiles":{type:"raster",tiles:["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,attribution:"&copy; Esri"}},layers:[{id:"dark-base",type:"raster",source:"dark-tiles",layout:{visibility:"visible"},paint:{"raster-opacity":.9}},{id:"satellite-base",type:"raster",source:"satellite-tiles",layout:{visibility:"none"},paint:{"raster-opacity":.8}}]},center:[Su.lng,Su.lat],zoom:15.5,pitch:60,bearing:-20,attributionControl:!1});Ye.on("load",()=>{clearTimeout(se),ee(!0),Le(!1)}),Ye.on("error",()=>{ee(!0),Le(!0)}),Ye.addControl(new b_.NavigationControl({showCompass:!0}),"top-right"),T.current=Ye}catch{ee(!0),Le(!0)}return()=>{clearTimeout(se),T.current&&(T.current.remove(),T.current=null)}},[]),Tn.useEffect(()=>{if(!T.current||ye)return;const se=T.current;try{se.getLayer("dark-base")&&se.setLayoutProperty("dark-base","visibility",c==="NEURAL_DARK"?"visible":"none"),se.getLayer("satellite-base")&&se.setLayoutProperty("satellite-base","visibility",c==="SATELLITE"?"visible":"none"),c==="STREET_LEVEL"?se.easeTo({pitch:85,zoom:18,duration:2500}):se.easeTo({pitch:60,zoom:15.5,duration:1500})}catch{}},[c,ye]),Tn.useEffect(()=>{if(!(!T.current||ye)&&(console.log("Starting marker rendering process..."),console.log("Map bounds:",T.current.getBounds()),console.log("Map center:",T.current.getCenter()),Object.keys(S.current).forEach(se=>{S.current[se].remove()}),S.current={},Ey.forEach(se=>{if(k!=="ALL"&&se.category!==k)return;const Ye=f.includes(se.id),st=se.id.includes("listing"),We=se.category==="SIGHTSEEING";let gt="#3b82f6";st&&(gt="#10b981"),We&&(gt="#f59e0b"),se.id==="listing-002"&&(gt="#8b5cf6"),Ne(se,se.coordinates.lng,se.coordinates.lat,gt,Ye,!1)}),console.log("Rendering groundedPoints:",y,"MapMode:",c),y.length>0)){y.filter((st,We,gt)=>We===gt.findIndex(nt=>nt.id===st.id)).forEach((st,We)=>{if(st.lng&&st.lat){console.log(`Creating unique search marker ${We}:`,st,"in mode:",c);const gt=c==="SATELLITE"?"#ff0066":"#ef4444";Ne(st,st.lng,st.lat,gt,!0,!0)}});const Ye=y[y.length-1];T.current&&Ye.lng&&Ye.lat&&T.current.flyTo({center:[Ye.lng,Ye.lat],zoom:16,essential:!0,speed:1.2})}},[f,k,K,ye,y,c]);const Ne=(se,Ye,st,We,gt,nt)=>{const zt=document.createElement("div");zt.className="w-0 h-0 flex items-center justify-center visible";const _t=nt?"animate-ping duration-[1s]":"animate-ping duration-[3s]",Ut=gt?"scale-150":"scale-100",At=gt?"scale-125":"scale-100",Xt=gt?"opacity-100":"";zt.innerHTML=`
      <div class="relative flex items-center justify-center w-8 h-8 group cursor-pointer" style="transform: translate(0, 0);">
        
        <!--  -->
        <div class="absolute inset-0 rounded-full border-2 opacity-60 ${_t} ${Ut}"
             style="border-color: ${We}; box-shadow: 0 0 25px ${We}, 0 0 50px ${We};"></div>
        
        <!--  -->
        <div class="relative w-4 h-4 rounded-full flex items-center justify-center transition-all duration-300 ${At}"
             style="background-color: ${We}; box-shadow: 0 0 25px ${We}, 0 0 50px ${We}, 0 0 75px ${We};">
            <div class="w-2 h-2 bg-white rounded-full shadow-inner"></div>
        </div>
        
        <!--  -->
        <div class="absolute top-10 left-1/2 -translate-x-1/2 px-3 py-2 rounded-xl bg-black/95 border text-white text-[11px] font-mono whitespace-nowrap opacity-0 group-hover:opacity-100 transition-all duration-300 z-50 pointer-events-none ${Xt} shadow-2xl"
             style="border-color: ${We}; box-shadow: 0 0 20px rgba(0,0,0,0.8), 0 0 40px ${We};">
          ${se.label||se.name}
        </div>

      </div>
    `,zt.addEventListener("click",tn=>{tn.stopPropagation(),u(se)});try{const tn=new b_.Marker({element:zt}).setLngLat([Ye,st]).addTo(T.current),an=se.id||`temp-${Math.random()}`;S.current[an]=tn,console.log(`Marker created: ${an} at [${Ye}, ${st}]`)}catch(tn){console.error("Error creating marker:",tn)}};return _e.jsxs("div",{className:"relative w-full h-full bg-[#020617] overflow-hidden",children:[!K&&!ye&&_e.jsxs("div",{className:"absolute inset-0 z-[100] bg-[#020617] flex flex-col items-center justify-center",children:[_e.jsx(Ng,{size:32,className:"text-blue-500 animate-pulse mb-4"}),_e.jsx("p",{className:"text-blue-400 font-mono text-xs uppercase tracking-widest",children:"Initializing Neural Map..."})]}),ye&&_e.jsx("div",{className:"absolute inset-0 z-0 bg-[#020617] flex items-center justify-center overflow-hidden",children:_e.jsxs("div",{className:"relative w-full h-full max-w-4xl max-h-[80vh] border border-blue-500/20 rounded-[3rem] bg-blue-500/5 backdrop-blur-3xl m-10 relative",children:[_e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-10 pointer-events-none",children:_e.jsx(tb,{size:300,className:"text-blue-500"})}),Ey.map((se,Ye)=>_e.jsx("div",{className:"absolute w-3 h-3 bg-blue-500 rounded-full",style:{left:`${20+Ye*15}%`,top:`${30+Ye%3*20}%`},title:se.name},se.id)),y.map((se,Ye)=>_e.jsxs("div",{className:"absolute flex flex-col items-center",style:{left:"50%",top:"50%",transform:`translate(${Ye*20}px, ${Ye*20}px)`},children:[_e.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full animate-bounce shadow-[0_0_20px_red]"}),_e.jsx("span",{className:"text-xs text-red-400 font-mono bg-black/80 px-2 mt-1",children:se.label})]},se.id)),_e.jsx("div",{className:"absolute bottom-10 left-10 text-white/40 font-mono text-xs",children:"System: Fallback Schematic Mode Active"})]})}),_e.jsx("div",{ref:I,className:`absolute inset-0 z-20 transition-opacity duration-1000 ${ye?"opacity-0 pointer-events-none":"opacity-100"}`}),!ye&&K&&y.length>0&&_e.jsx("div",{className:"absolute inset-0 z-25 pointer-events-none",children:y.map((se,Ye)=>{if(!T.current)return null;try{const st=T.current.project([se.lng,se.lat]);return console.log(`Debug marker ${Ye} at pixel:`,st),_e.jsx("div",{className:"absolute w-8 h-8 bg-red-500 rounded-full animate-pulse pointer-events-auto cursor-pointer flex items-center justify-center",style:{left:st.x-16,top:st.y-16,boxShadow:"0 0 25px #ff0066, 0 0 50px #ff0066, 0 0 75px #ff0066",zIndex:1e3},onClick:()=>u(se),title:se.label,children:_e.jsx("div",{className:"w-2 h-2 bg-white rounded-full shadow-inner"})},`debug-${se.id}`)}catch(st){return console.error("Error projecting point:",se,st),null}})}),_e.jsxs("div",{className:"absolute inset-0 z-30 pointer-events-none",children:[_e.jsx("div",{className:"absolute top-0 left-0 right-0 h-16 bg-gradient-to-b from-black/90 to-transparent flex items-center justify-between px-10",children:_e.jsxs("div",{className:"flex items-center gap-3",children:[_e.jsx(E_,{size:16,className:"text-blue-500"}),_e.jsx("span",{className:"text-[10px] font-mono text-white/60 uppercase tracking-[0.3em] font-bold",children:"CHICAGO_LOOP_OS"})]})}),_e.jsxs("div",{className:"absolute top-24 left-8 p-6 glass-panel rounded-[2rem] border border-white/10 pointer-events-auto flex flex-col gap-6 min-w-[280px] shadow-2xl",children:[_e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{id:"NEURAL_DARK",icon:Kx,label:"Dark"},{id:"SATELLITE",icon:E_,label:"Sat"},{id:"STREET_LEVEL",icon:hb,label:"Street"}].map(se=>_e.jsxs("button",{onClick:()=>F(se.id),className:`flex flex-col items-center justify-center p-3 rounded-2xl border transition-all 
                  ${c===se.id?"bg-blue-600/30 border-blue-500/50 text-white":"bg-white/5 border-transparent text-white/30 hover:bg-white/10"}`,children:[_e.jsx(se.icon,{size:14}),_e.jsx("span",{className:"text-[9px] mt-1.5 font-bold uppercase",children:se.label})]},se.id))}),_e.jsx("button",{onClick:()=>{console.log("Force re-rendering markers..."),console.log("Current groundedPoints:",y),T.current&&(console.log("Map center:",T.current.getCenter()),console.log("Map zoom:",T.current.getZoom()))},className:"px-3 py-2 bg-red-500/20 border border-red-500/30 rounded-xl text-[10px] text-red-400 hover:bg-red-500/30",children:""}),_e.jsxs("div",{className:"space-y-2",children:[_e.jsx("span",{className:"text-[9px] font-black text-white/30 uppercase tracking-[0.2em] px-1",children:"Layers"}),_e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["ALL","RESIDENTIAL","LANDMARK","SIGHTSEEING"].map(se=>_e.jsx("button",{onClick:()=>G(se),className:`px-3 py-2 rounded-xl border text-[9px] font-bold uppercase ${k===se?"bg-white/10 border-white/20 text-white":"border-transparent text-white/30"}`,children:se},se))})]})]})]})]})},Mb=({point:u,isOpen:a,onClose:f,onViewDetails:y,onCancel:T})=>{var G,K,ee,ye,Le,Ne;if(!a||!u)return null;const I="category"in u,S="type"in u&&u.type==="SEARCH_RESULT",c=se=>{switch(se){case"HIGH":return"text-green-500";case"MEDIUM":return"text-yellow-500";case"LOW":return"text-red-500";default:return"text-gray-400"}},F=se=>{switch(se){case"HIGH":return _e.jsx(Sy,{className:"w-4 h-4 text-green-500"});case"MEDIUM":return _e.jsx(wy,{className:"w-4 h-4 text-yellow-500"});case"LOW":return _e.jsx(wy,{className:"w-4 h-4 text-red-500"});default:return _e.jsx(Sy,{className:"w-4 h-4 text-gray-400"})}},k=se=>{switch(se){case"RESIDENTIAL":return _e.jsx(Mg,{className:"w-4 h-4 text-blue-500"});case"LANDMARK":return _e.jsx(Fd,{className:"w-4 h-4 text-purple-500"});case"SIGHTSEEING":return _e.jsx(Fd,{className:"w-4 h-4 text-amber-500"});default:return _e.jsx(Mg,{className:"w-4 h-4 text-gray-400"})}};return _e.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center p-6 bg-black/70 backdrop-blur-md",children:_e.jsxs("div",{className:"glass-modal w-full max-w-2xl rounded-[2rem] border border-white/10 overflow-hidden shadow-[0_0_50px_rgba(0,0,0,0.8)] animate-modal-in",children:[_e.jsxs("div",{className:"p-8 border-b border-white/10 flex items-center justify-between",children:[_e.jsxs("div",{className:"flex items-center gap-4",children:[_e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-500/20 to-purple-500/20 flex items-center justify-center",children:I?k(u.category):_e.jsx(Fd,{className:"w-6 h-6 text-red-500"})}),_e.jsxs("div",{children:[_e.jsx("h2",{className:"text-2xl font-bold text-white",children:u.name||u.label}),_e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[_e.jsx(Fd,{className:"w-3 h-3 text-gray-400"}),_e.jsx("span",{className:"text-sm text-gray-400",children:u.address||""})]})]})]}),_e.jsx("button",{onClick:f,className:"w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors",children:_e.jsx(C_,{className:"w-5 h-5 text-white"})})]}),_e.jsx("div",{className:"p-8",children:_e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[_e.jsxs("div",{className:"space-y-4",children:[_e.jsx("div",{className:"aspect-video rounded-2xl bg-gradient-to-br from-blue-900/30 to-purple-900/30 border border-white/10 flex items-center justify-center",children:_e.jsxs("div",{className:"text-center",children:[_e.jsx(Fd,{className:"w-12 h-12 text-blue-500 mx-auto mb-4"}),_e.jsx("p",{className:"text-sm text-gray-400",children:""}),_e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[": [",((K=(G=u.coordinates)==null?void 0:G.lat)==null?void 0:K.toFixed(4))||((ee=u.lat)==null?void 0:ee.toFixed(4)),", ",((Le=(ye=u.coordinates)==null?void 0:ye.lng)==null?void 0:Le.toFixed(4))||((Ne=u.lng)==null?void 0:Ne.toFixed(4)),"]"]})]})}),_e.jsx("div",{className:"p-4 rounded-2xl bg-gradient-to-r from-black/40 to-black/20 border border-white/10",children:_e.jsxs("div",{className:"flex items-center justify-between",children:[_e.jsxs("div",{className:"flex items-center gap-3",children:[F(u.securityLevel||u.safetyScore>90?"HIGH":"MEDIUM"),_e.jsxs("div",{children:[_e.jsx("p",{className:"text-sm font-medium text-white",children:""}),_e.jsx("p",{className:`text-xs font-bold ${c(u.securityLevel||u.safetyScore>90?"HIGH":"MEDIUM")}`,children:u.securityLevel||(u.safetyScore>90?"HIGH":"MEDIUM")})]})]}),u.safetyScore&&_e.jsxs("div",{className:"text-right",children:[_e.jsx("p",{className:"text-sm text-gray-400",children:""}),_e.jsx("p",{className:"text-xl font-bold text-green-500",children:u.safetyScore})]})]})})]}),_e.jsx("div",{className:"space-y-6",children:_e.jsxs("div",{children:[_e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:""}),I?_e.jsxs("div",{className:"space-y-4",children:[_e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_e.jsxs("div",{className:"p-3 rounded-xl bg-white/5",children:[_e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[_e.jsx(Mg,{className:"w-3 h-3 text-blue-400"}),_e.jsx("span",{className:"text-xs text-gray-400",children:""})]}),_e.jsx("p",{className:"text-sm font-medium text-white",children:u.category==="RESIDENTIAL"?"":u.category==="LANDMARK"?"":""})]}),u.yearBuilt&&_e.jsxs("div",{className:"p-3 rounded-xl bg-white/5",children:[_e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[_e.jsx(Ox,{className:"w-3 h-3 text-purple-400"}),_e.jsx("span",{className:"text-xs text-gray-400",children:""})]}),_e.jsx("p",{className:"text-sm font-medium text-white",children:u.yearBuilt})]})]}),u.rent&&_e.jsxs("div",{className:"p-3 rounded-xl bg-gradient-to-r from-emerald-900/20 to-emerald-800/10 border border-emerald-500/20",children:[_e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[_e.jsx(Yx,{className:"w-3 h-3 text-emerald-400"}),_e.jsx("span",{className:"text-xs text-gray-400",children:""})]}),_e.jsx("p",{className:"text-lg font-bold text-emerald-400",children:u.rent}),u.availability!==!1&&_e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[_e.jsx(Hx,{className:"w-3 h-3 text-emerald-500"}),_e.jsx("span",{className:"text-xs text-emerald-400",children:""})]})]}),u.description&&_e.jsx("div",{className:"p-3 rounded-xl bg-white/5",children:_e.jsx("p",{className:"text-sm text-gray-300",children:u.description})})]}):S?_e.jsxs("div",{className:"space-y-4",children:[_e.jsxs("div",{className:"p-3 rounded-xl bg-white/5",children:[_e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[_e.jsx(Fd,{className:"w-3 h-3 text-red-400"}),_e.jsx("span",{className:"text-xs text-gray-400",children:""})]}),_e.jsx("p",{className:"text-sm font-medium text-white",children:""})]}),u.footTraffic!==void 0&&_e.jsx("div",{className:"p-3 rounded-xl bg-white/5",children:_e.jsxs("div",{className:"flex items-center justify-between",children:[_e.jsxs("div",{className:"flex items-center gap-2",children:[_e.jsx(wb,{className:"w-3 h-3 text-blue-400"}),_e.jsx("span",{className:"text-xs text-gray-400",children:""})]}),_e.jsxs("div",{className:"flex items-center gap-2",children:[_e.jsx("div",{className:"w-24 h-2 bg-gray-700 rounded-full overflow-hidden",children:_e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-500",style:{width:`${Math.min(u.footTraffic,100)}%`}})}),_e.jsxs("span",{className:"text-sm font-bold text-white",children:[u.footTraffic,"%"]})]})]})}),u.nearbyFacilities&&u.nearbyFacilities.length>0&&_e.jsxs("div",{className:"p-3 rounded-xl bg-white/5",children:[_e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[_e.jsx(Mg,{className:"w-3 h-3 text-amber-400"}),_e.jsx("span",{className:"text-xs text-gray-400",children:""})]}),_e.jsx("div",{className:"flex flex-wrap gap-2",children:u.nearbyFacilities.slice(0,4).map((se,Ye)=>_e.jsx("span",{className:"px-2 py-1 text-xs bg-white/10 rounded-lg text-gray-300",children:se},Ye))})]})]}):_e.jsx("div",{className:"p-3 rounded-xl bg-white/5",children:_e.jsx("p",{className:"text-sm text-gray-300",children:""})})]})})]})}),_e.jsxs("div",{className:"p-8 border-t border-white/10 flex justify-end gap-4",children:[_e.jsx("button",{onClick:T,className:"px-6 py-3 rounded-xl border border-white/20 text-white hover:bg-white/10 transition-colors",children:""}),_e.jsx("button",{onClick:y,className:"px-6 py-3 rounded-xl bg-gradient-to-r from-blue-600 to-purple-600 text-white font-medium hover:opacity-90 transition-opacity",children:""})]})]})})};var Ib={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Rb,Pb;function Db(){return{geminiUrl:Rb,vertexUrl:Pb}}function zb(u,a,f,y){var T,I;if(!(u!=null&&u.baseUrl)){const S=Db();return a?(T=S.vertexUrl)!==null&&T!==void 0?T:f:(I=S.geminiUrl)!==null&&I!==void 0?I:y}return u.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Sc{}function Pt(u,a){const f=/\{([^}]+)\}/g;return u.replace(f,(y,T)=>{if(Object.prototype.hasOwnProperty.call(a,T)){const I=a[T];return I!=null?String(I):""}else throw new Error(`Key '${T}' not found in valueMap.`)})}function M(u,a,f){for(let I=0;I<a.length-1;I++){const S=a[I];if(S.endsWith("[]")){const c=S.slice(0,-2);if(!(c in u))if(Array.isArray(f))u[c]=Array.from({length:f.length},()=>({}));else throw new Error(`Value must be a list given an array path ${S}`);if(Array.isArray(u[c])){const F=u[c];if(Array.isArray(f))for(let k=0;k<F.length;k++){const G=F[k];M(G,a.slice(I+1),f[k])}else for(const k of F)M(k,a.slice(I+1),f)}return}else if(S.endsWith("[0]")){const c=S.slice(0,-3);c in u||(u[c]=[{}]);const F=u[c];M(F[0],a.slice(I+1),f);return}(!u[S]||typeof u[S]!="object")&&(u[S]={}),u=u[S]}const y=a[a.length-1],T=u[y];if(T!==void 0){if(!f||typeof f=="object"&&Object.keys(f).length===0||f===T)return;if(typeof T=="object"&&typeof f=="object"&&T!==null&&f!==null)Object.assign(T,f);else throw new Error(`Cannot set value for an existing key. Key: ${y}`)}else y==="_self"&&typeof f=="object"&&f!==null&&!Array.isArray(f)?Object.assign(u,f):u[y]=f}function E(u,a,f=void 0){try{if(a.length===1&&a[0]==="_self")return u;for(let y=0;y<a.length;y++){if(typeof u!="object"||u===null)return f;const T=a[y];if(T.endsWith("[]")){const I=T.slice(0,-2);if(I in u){const S=u[I];return Array.isArray(S)?S.map(c=>E(c,a.slice(y+1),f)):f}else return f}else u=u[T]}return u}catch(y){if(y instanceof TypeError)return f;throw y}}function Lb(u,a){for(const[f,y]of Object.entries(a)){const T=f.split("."),I=y.split("."),S=new Set;let c=-1;for(let F=0;F<T.length;F++)if(T[F]==="*"){c=F;break}if(c!==-1&&I.length>c)for(let F=c;F<I.length;F++){const k=I[F];k!=="*"&&!k.endsWith("[]")&&!k.endsWith("[0]")&&S.add(k)}A_(u,T,I,0,S)}}function A_(u,a,f,y,T){if(y>=a.length||typeof u!="object"||u===null)return;const I=a[y];if(I.endsWith("[]")){const S=I.slice(0,-2),c=u;if(S in c&&Array.isArray(c[S]))for(const F of c[S])A_(F,a,f,y+1,T)}else if(I==="*"){if(typeof u=="object"&&u!==null&&!Array.isArray(u)){const S=u,c=Object.keys(S).filter(k=>!k.startsWith("_")&&!T.has(k)),F={};for(const k of c)F[k]=S[k];for(const[k,G]of Object.entries(F)){const K=[];for(const ee of f.slice(y))ee==="*"?K.push(k):K.push(ee);M(S,K,G)}for(const k of c)delete S[k]}}else{const S=u;I in S&&A_(S[I],a,f,y+1,T)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function q_(u){if(typeof u!="string")throw new Error("fromImageBytes must be a string");return u}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Nb(u){const a={},f=E(u,["operationName"]);f!=null&&M(a,["operationName"],f);const y=E(u,["resourceName"]);return y!=null&&M(a,["_url","resourceName"],y),a}function kb(u){const a={},f=E(u,["name"]);f!=null&&M(a,["name"],f);const y=E(u,["metadata"]);y!=null&&M(a,["metadata"],y);const T=E(u,["done"]);T!=null&&M(a,["done"],T);const I=E(u,["error"]);I!=null&&M(a,["error"],I);const S=E(u,["response","generateVideoResponse"]);return S!=null&&M(a,["response"],Bb(S)),a}function Fb(u){const a={},f=E(u,["name"]);f!=null&&M(a,["name"],f);const y=E(u,["metadata"]);y!=null&&M(a,["metadata"],y);const T=E(u,["done"]);T!=null&&M(a,["done"],T);const I=E(u,["error"]);I!=null&&M(a,["error"],I);const S=E(u,["response"]);return S!=null&&M(a,["response"],Ob(S)),a}function Bb(u){const a={},f=E(u,["generatedSamples"]);if(f!=null){let I=f;Array.isArray(I)&&(I=I.map(S=>Ub(S))),M(a,["generatedVideos"],I)}const y=E(u,["raiMediaFilteredCount"]);y!=null&&M(a,["raiMediaFilteredCount"],y);const T=E(u,["raiMediaFilteredReasons"]);return T!=null&&M(a,["raiMediaFilteredReasons"],T),a}function Ob(u){const a={},f=E(u,["videos"]);if(f!=null){let I=f;Array.isArray(I)&&(I=I.map(S=>Vb(S))),M(a,["generatedVideos"],I)}const y=E(u,["raiMediaFilteredCount"]);y!=null&&M(a,["raiMediaFilteredCount"],y);const T=E(u,["raiMediaFilteredReasons"]);return T!=null&&M(a,["raiMediaFilteredReasons"],T),a}function Ub(u){const a={},f=E(u,["video"]);return f!=null&&M(a,["video"],jb(f)),a}function Vb(u){const a={},f=E(u,["_self"]);return f!=null&&M(a,["video"],Yb(f)),a}function Gb(u){const a={},f=E(u,["operationName"]);return f!=null&&M(a,["_url","operationName"],f),a}function qb(u){const a={},f=E(u,["operationName"]);return f!=null&&M(a,["_url","operationName"],f),a}function Hb(u){const a={},f=E(u,["name"]);f!=null&&M(a,["name"],f);const y=E(u,["metadata"]);y!=null&&M(a,["metadata"],y);const T=E(u,["done"]);T!=null&&M(a,["done"],T);const I=E(u,["error"]);I!=null&&M(a,["error"],I);const S=E(u,["response"]);return S!=null&&M(a,["response"],Zb(S)),a}function Zb(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["parent"]);y!=null&&M(a,["parent"],y);const T=E(u,["documentName"]);return T!=null&&M(a,["documentName"],T),a}function lv(u){const a={},f=E(u,["name"]);f!=null&&M(a,["name"],f);const y=E(u,["metadata"]);y!=null&&M(a,["metadata"],y);const T=E(u,["done"]);T!=null&&M(a,["done"],T);const I=E(u,["error"]);I!=null&&M(a,["error"],I);const S=E(u,["response"]);return S!=null&&M(a,["response"],$b(S)),a}function $b(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["parent"]);y!=null&&M(a,["parent"],y);const T=E(u,["documentName"]);return T!=null&&M(a,["documentName"],T),a}function jb(u){const a={},f=E(u,["uri"]);f!=null&&M(a,["uri"],f);const y=E(u,["encodedVideo"]);y!=null&&M(a,["videoBytes"],q_(y));const T=E(u,["encoding"]);return T!=null&&M(a,["mimeType"],T),a}function Yb(u){const a={},f=E(u,["gcsUri"]);f!=null&&M(a,["uri"],f);const y=E(u,["bytesBase64Encoded"]);y!=null&&M(a,["videoBytes"],q_(y));const T=E(u,["mimeType"]);return T!=null&&M(a,["mimeType"],T),a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Ay;(function(u){u.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",u.OUTCOME_OK="OUTCOME_OK",u.OUTCOME_FAILED="OUTCOME_FAILED",u.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Ay||(Ay={}));var My;(function(u){u.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",u.PYTHON="PYTHON"})(My||(My={}));var Iy;(function(u){u.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",u.SILENT="SILENT",u.WHEN_IDLE="WHEN_IDLE",u.INTERRUPT="INTERRUPT"})(Iy||(Iy={}));var Eh;(function(u){u.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",u.STRING="STRING",u.NUMBER="NUMBER",u.INTEGER="INTEGER",u.BOOLEAN="BOOLEAN",u.ARRAY="ARRAY",u.OBJECT="OBJECT",u.NULL="NULL"})(Eh||(Eh={}));var Ry;(function(u){u.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",u.SIMPLE_SEARCH="SIMPLE_SEARCH",u.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Ry||(Ry={}));var Py;(function(u){u.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",u.NO_AUTH="NO_AUTH",u.API_KEY_AUTH="API_KEY_AUTH",u.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",u.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",u.OAUTH="OAUTH",u.OIDC_AUTH="OIDC_AUTH"})(Py||(Py={}));var Dy;(function(u){u.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",u.HTTP_IN_QUERY="HTTP_IN_QUERY",u.HTTP_IN_HEADER="HTTP_IN_HEADER",u.HTTP_IN_PATH="HTTP_IN_PATH",u.HTTP_IN_BODY="HTTP_IN_BODY",u.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(Dy||(Dy={}));var zy;(function(u){u.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",u.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",u.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",u.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",u.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",u.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",u.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(zy||(zy={}));var Ly;(function(u){u.UNSPECIFIED="UNSPECIFIED",u.BLOCKING="BLOCKING",u.NON_BLOCKING="NON_BLOCKING"})(Ly||(Ly={}));var Ny;(function(u){u.MODE_UNSPECIFIED="MODE_UNSPECIFIED",u.MODE_DYNAMIC="MODE_DYNAMIC"})(Ny||(Ny={}));var ky;(function(u){u.MODE_UNSPECIFIED="MODE_UNSPECIFIED",u.AUTO="AUTO",u.ANY="ANY",u.NONE="NONE",u.VALIDATED="VALIDATED"})(ky||(ky={}));var Fy;(function(u){u.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",u.LOW="LOW",u.MEDIUM="MEDIUM",u.HIGH="HIGH",u.MINIMAL="MINIMAL"})(Fy||(Fy={}));var By;(function(u){u.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",u.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",u.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",u.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",u.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",u.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",u.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",u.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",u.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",u.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",u.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(By||(By={}));var Oy;(function(u){u.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",u.SEVERITY="SEVERITY",u.PROBABILITY="PROBABILITY"})(Oy||(Oy={}));var Uy;(function(u){u.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",u.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",u.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",u.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",u.BLOCK_NONE="BLOCK_NONE",u.OFF="OFF"})(Uy||(Uy={}));var Vy;(function(u){u.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",u.STOP="STOP",u.MAX_TOKENS="MAX_TOKENS",u.SAFETY="SAFETY",u.RECITATION="RECITATION",u.LANGUAGE="LANGUAGE",u.OTHER="OTHER",u.BLOCKLIST="BLOCKLIST",u.PROHIBITED_CONTENT="PROHIBITED_CONTENT",u.SPII="SPII",u.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",u.IMAGE_SAFETY="IMAGE_SAFETY",u.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",u.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",u.NO_IMAGE="NO_IMAGE",u.IMAGE_RECITATION="IMAGE_RECITATION",u.IMAGE_OTHER="IMAGE_OTHER"})(Vy||(Vy={}));var Gy;(function(u){u.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",u.NEGLIGIBLE="NEGLIGIBLE",u.LOW="LOW",u.MEDIUM="MEDIUM",u.HIGH="HIGH"})(Gy||(Gy={}));var qy;(function(u){u.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",u.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",u.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",u.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",u.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(qy||(qy={}));var Hy;(function(u){u.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",u.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",u.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",u.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",u.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Hy||(Hy={}));var Zy;(function(u){u.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",u.SAFETY="SAFETY",u.OTHER="OTHER",u.BLOCKLIST="BLOCKLIST",u.PROHIBITED_CONTENT="PROHIBITED_CONTENT",u.IMAGE_SAFETY="IMAGE_SAFETY",u.MODEL_ARMOR="MODEL_ARMOR",u.JAILBREAK="JAILBREAK"})(Zy||(Zy={}));var $y;(function(u){u.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",u.ON_DEMAND="ON_DEMAND",u.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})($y||($y={}));var Ug;(function(u){u.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",u.TEXT="TEXT",u.IMAGE="IMAGE",u.AUDIO="AUDIO"})(Ug||(Ug={}));var jy;(function(u){u.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",u.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",u.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",u.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(jy||(jy={}));var Yy;(function(u){u.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",u.TUNING_MODE_FULL="TUNING_MODE_FULL",u.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Yy||(Yy={}));var Xy;(function(u){u.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",u.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",u.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",u.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",u.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",u.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",u.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Xy||(Xy={}));var M_;(function(u){u.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",u.JOB_STATE_QUEUED="JOB_STATE_QUEUED",u.JOB_STATE_PENDING="JOB_STATE_PENDING",u.JOB_STATE_RUNNING="JOB_STATE_RUNNING",u.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",u.JOB_STATE_FAILED="JOB_STATE_FAILED",u.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",u.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",u.JOB_STATE_PAUSED="JOB_STATE_PAUSED",u.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",u.JOB_STATE_UPDATING="JOB_STATE_UPDATING",u.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(M_||(M_={}));var Jy;(function(u){u.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",u.TUNING_TASK_I2V="TUNING_TASK_I2V",u.TUNING_TASK_T2V="TUNING_TASK_T2V",u.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Jy||(Jy={}));var Wy;(function(u){u.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",u.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",u.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",u.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",u.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(Wy||(Wy={}));var I_;(function(u){u.COLLECTION="COLLECTION"})(I_||(I_={}));var Ky;(function(u){u.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",u.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",u.BALANCED="BALANCED",u.PRIORITIZE_COST="PRIORITIZE_COST"})(Ky||(Ky={}));var Qy;(function(u){u.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",u.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Qy||(Qy={}));var e0;(function(u){u.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",u.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",u.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",u.BLOCK_NONE="BLOCK_NONE"})(e0||(e0={}));var t0;(function(u){u.DONT_ALLOW="DONT_ALLOW",u.ALLOW_ADULT="ALLOW_ADULT",u.ALLOW_ALL="ALLOW_ALL"})(t0||(t0={}));var n0;(function(u){u.auto="auto",u.en="en",u.ja="ja",u.ko="ko",u.hi="hi",u.zh="zh",u.pt="pt",u.es="es"})(n0||(n0={}));var i0;(function(u){u.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",u.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",u.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",u.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",u.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(i0||(i0={}));var r0;(function(u){u.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",u.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",u.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",u.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(r0||(r0={}));var o0;(function(u){u.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",u.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",u.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",u.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(o0||(o0={}));var s0;(function(u){u.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",u.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",u.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",u.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",u.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",u.EDIT_MODE_STYLE="EDIT_MODE_STYLE",u.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",u.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(s0||(s0={}));var a0;(function(u){u.FOREGROUND="FOREGROUND",u.BACKGROUND="BACKGROUND",u.PROMPT="PROMPT",u.SEMANTIC="SEMANTIC",u.INTERACTIVE="INTERACTIVE"})(a0||(a0={}));var l0;(function(u){u.ASSET="ASSET",u.STYLE="STYLE"})(l0||(l0={}));var u0;(function(u){u.INSERT="INSERT",u.REMOVE="REMOVE",u.REMOVE_STATIC="REMOVE_STATIC",u.OUTPAINT="OUTPAINT"})(u0||(u0={}));var c0;(function(u){u.OPTIMIZED="OPTIMIZED",u.LOSSLESS="LOSSLESS"})(c0||(c0={}));var h0;(function(u){u.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",u.PREFERENCE_TUNING="PREFERENCE_TUNING",u.DISTILLATION="DISTILLATION"})(h0||(h0={}));var d0;(function(u){u.STATE_UNSPECIFIED="STATE_UNSPECIFIED",u.STATE_PENDING="STATE_PENDING",u.STATE_ACTIVE="STATE_ACTIVE",u.STATE_FAILED="STATE_FAILED"})(d0||(d0={}));var f0;(function(u){u.STATE_UNSPECIFIED="STATE_UNSPECIFIED",u.PROCESSING="PROCESSING",u.ACTIVE="ACTIVE",u.FAILED="FAILED"})(f0||(f0={}));var p0;(function(u){u.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",u.UPLOADED="UPLOADED",u.GENERATED="GENERATED",u.REGISTERED="REGISTERED"})(p0||(p0={}));var m0;(function(u){u.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",u.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",u.RESPONSE_REJECTED="RESPONSE_REJECTED",u.NEED_MORE_INPUT="NEED_MORE_INPUT"})(m0||(m0={}));var g0;(function(u){u.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",u.TEXT="TEXT",u.IMAGE="IMAGE",u.VIDEO="VIDEO",u.AUDIO="AUDIO",u.DOCUMENT="DOCUMENT"})(g0||(g0={}));var _0;(function(u){u.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",u.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",u.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(_0||(_0={}));var y0;(function(u){u.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",u.ACTIVITY_START="ACTIVITY_START",u.ACTIVITY_END="ACTIVITY_END"})(y0||(y0={}));var v0;(function(u){u.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",u.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",u.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(v0||(v0={}));var x0;(function(u){u.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",u.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",u.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(x0||(x0={}));var b0;(function(u){u.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",u.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",u.NO_INTERRUPTION="NO_INTERRUPTION"})(b0||(b0={}));var w0;(function(u){u.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",u.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",u.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(w0||(w0={}));var T0;(function(u){u.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",u.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",u.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",u.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",u.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",u.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",u.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",u.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",u.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",u.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",u.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",u.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",u.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(T0||(T0={}));var S0;(function(u){u.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",u.QUALITY="QUALITY",u.DIVERSITY="DIVERSITY",u.VOCALIZATION="VOCALIZATION"})(S0||(S0={}));var up;(function(u){u.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",u.PLAY="PLAY",u.PAUSE="PAUSE",u.STOP="STOP",u.RESET_CONTEXT="RESET_CONTEXT"})(up||(up={}));class R_{constructor(a){const f={};for(const y of a.headers.entries())f[y[0]]=y[1];this.headers=f,this.responseInternal=a}json(){return this.responseInternal.json()}}class Sm{get text(){var a,f,y,T,I,S,c,F;if(((T=(y=(f=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||f===void 0?void 0:f.content)===null||y===void 0?void 0:y.parts)===null||T===void 0?void 0:T.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let k="",G=!1;const K=[];for(const ee of(F=(c=(S=(I=this.candidates)===null||I===void 0?void 0:I[0])===null||S===void 0?void 0:S.content)===null||c===void 0?void 0:c.parts)!==null&&F!==void 0?F:[]){for(const[ye,Le]of Object.entries(ee))ye!=="text"&&ye!=="thought"&&ye!=="thoughtSignature"&&(Le!==null||Le!==void 0)&&K.push(ye);if(typeof ee.text=="string"){if(typeof ee.thought=="boolean"&&ee.thought)continue;G=!0,k+=ee.text}}return K.length>0&&console.warn(`there are non-text parts ${K} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),G?k:void 0}get data(){var a,f,y,T,I,S,c,F;if(((T=(y=(f=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||f===void 0?void 0:f.content)===null||y===void 0?void 0:y.parts)===null||T===void 0?void 0:T.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let k="";const G=[];for(const K of(F=(c=(S=(I=this.candidates)===null||I===void 0?void 0:I[0])===null||S===void 0?void 0:S.content)===null||c===void 0?void 0:c.parts)!==null&&F!==void 0?F:[]){for(const[ee,ye]of Object.entries(K))ee!=="inlineData"&&(ye!==null||ye!==void 0)&&G.push(ee);K.inlineData&&typeof K.inlineData.data=="string"&&(k+=atob(K.inlineData.data))}return G.length>0&&console.warn(`there are non-data parts ${G} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),k.length>0?btoa(k):void 0}get functionCalls(){var a,f,y,T,I,S,c,F;if(((T=(y=(f=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||f===void 0?void 0:f.content)===null||y===void 0?void 0:y.parts)===null||T===void 0?void 0:T.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const k=(F=(c=(S=(I=this.candidates)===null||I===void 0?void 0:I[0])===null||S===void 0?void 0:S.content)===null||c===void 0?void 0:c.parts)===null||F===void 0?void 0:F.filter(G=>G.functionCall).map(G=>G.functionCall).filter(G=>G!==void 0);if((k==null?void 0:k.length)!==0)return k}get executableCode(){var a,f,y,T,I,S,c,F,k;if(((T=(y=(f=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||f===void 0?void 0:f.content)===null||y===void 0?void 0:y.parts)===null||T===void 0?void 0:T.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const G=(F=(c=(S=(I=this.candidates)===null||I===void 0?void 0:I[0])===null||S===void 0?void 0:S.content)===null||c===void 0?void 0:c.parts)===null||F===void 0?void 0:F.filter(K=>K.executableCode).map(K=>K.executableCode).filter(K=>K!==void 0);if((G==null?void 0:G.length)!==0)return(k=G==null?void 0:G[0])===null||k===void 0?void 0:k.code}get codeExecutionResult(){var a,f,y,T,I,S,c,F,k;if(((T=(y=(f=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||f===void 0?void 0:f.content)===null||y===void 0?void 0:y.parts)===null||T===void 0?void 0:T.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const G=(F=(c=(S=(I=this.candidates)===null||I===void 0?void 0:I[0])===null||S===void 0?void 0:S.content)===null||c===void 0?void 0:c.parts)===null||F===void 0?void 0:F.filter(K=>K.codeExecutionResult).map(K=>K.codeExecutionResult).filter(K=>K!==void 0);if((G==null?void 0:G.length)!==0)return(k=G==null?void 0:G[0])===null||k===void 0?void 0:k.output}}class E0{}class C0{}class Xb{}class Jb{}class Wb{}class Kb{}class A0{}class M0{}class I0{}class Qb{}class Vg{_fromAPIResponse({apiResponse:a,_isVertexAI:f}){const y=new Vg;let T;const I=a;return f?T=Fb(I):T=kb(I),Object.assign(y,T),y}}class R0{}class P0{}class D0{}class z0{}class e1{}class t1{}class n1{}class H_{_fromAPIResponse({apiResponse:a,_isVertexAI:f}){const y=new H_,I=Hb(a);return Object.assign(y,I),y}}class i1{}class r1{}class o1{}class s1{}class L0{}class a1{get text(){var a,f,y;let T="",I=!1;const S=[];for(const c of(y=(f=(a=this.serverContent)===null||a===void 0?void 0:a.modelTurn)===null||f===void 0?void 0:f.parts)!==null&&y!==void 0?y:[]){for(const[F,k]of Object.entries(c))F!=="text"&&F!=="thought"&&k!==null&&S.push(F);if(typeof c.text=="string"){if(typeof c.thought=="boolean"&&c.thought)continue;I=!0,T+=c.text}}return S.length>0&&console.warn(`there are non-text parts ${S} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),I?T:void 0}get data(){var a,f,y;let T="";const I=[];for(const S of(y=(f=(a=this.serverContent)===null||a===void 0?void 0:a.modelTurn)===null||f===void 0?void 0:f.parts)!==null&&y!==void 0?y:[]){for(const[c,F]of Object.entries(S))c!=="inlineData"&&F!==null&&I.push(c);S.inlineData&&typeof S.inlineData.data=="string"&&(T+=atob(S.inlineData.data))}return I.length>0&&console.warn(`there are non-data parts ${I} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),T.length>0?btoa(T):void 0}}class l1{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Z_{_fromAPIResponse({apiResponse:a,_isVertexAI:f}){const y=new Z_,I=lv(a);return Object.assign(y,I),y}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ni(u,a){if(!a||typeof a!="string")throw new Error("model is required and must be a string");if(a.includes("..")||a.includes("?")||a.includes("&"))throw new Error("invalid model parameter");if(u.isVertexAI()){if(a.startsWith("publishers/")||a.startsWith("projects/")||a.startsWith("models/"))return a;if(a.indexOf("/")>=0){const f=a.split("/",2);return`publishers/${f[0]}/models/${f[1]}`}else return`publishers/google/models/${a}`}else return a.startsWith("models/")||a.startsWith("tunedModels/")?a:`models/${a}`}function uv(u,a){const f=ni(u,a);return f?f.startsWith("publishers/")&&u.isVertexAI()?`projects/${u.getProject()}/locations/${u.getLocation()}/${f}`:f.startsWith("models/")&&u.isVertexAI()?`projects/${u.getProject()}/locations/${u.getLocation()}/publishers/google/${f}`:f:""}function cv(u){return Array.isArray(u)?u.map(a=>Gg(a)):[Gg(u)]}function Gg(u){if(typeof u=="object"&&u!==null)return u;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof u}`)}function hv(u){const a=Gg(u);if(a.mimeType&&a.mimeType.startsWith("image/"))return a;throw new Error(`Unsupported mime type: ${a.mimeType}`)}function dv(u){const a=Gg(u);if(a.mimeType&&a.mimeType.startsWith("audio/"))return a;throw new Error(`Unsupported mime type: ${a.mimeType}`)}function N0(u){if(u==null)throw new Error("PartUnion is required");if(typeof u=="object")return u;if(typeof u=="string")return{text:u};throw new Error(`Unsupported part type: ${typeof u}`)}function fv(u){if(u==null||Array.isArray(u)&&u.length===0)throw new Error("PartListUnion is required");return Array.isArray(u)?u.map(a=>N0(a)):[N0(u)]}function P_(u){return u!=null&&typeof u=="object"&&"parts"in u&&Array.isArray(u.parts)}function k0(u){return u!=null&&typeof u=="object"&&"functionCall"in u}function F0(u){return u!=null&&typeof u=="object"&&"functionResponse"in u}function qo(u){if(u==null)throw new Error("ContentUnion is required");return P_(u)?u:{role:"user",parts:fv(u)}}function $_(u,a){if(!a)return[];if(u.isVertexAI()&&Array.isArray(a))return a.flatMap(f=>{const y=qo(f);return y.parts&&y.parts.length>0&&y.parts[0].text!==void 0?[y.parts[0].text]:[]});if(u.isVertexAI()){const f=qo(a);return f.parts&&f.parts.length>0&&f.parts[0].text!==void 0?[f.parts[0].text]:[]}return Array.isArray(a)?a.map(f=>qo(f)):[qo(a)]}function Ua(u){if(u==null||Array.isArray(u)&&u.length===0)throw new Error("contents are required");if(!Array.isArray(u)){if(k0(u)||F0(u))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[qo(u)]}const a=[],f=[],y=P_(u[0]);for(const T of u){const I=P_(T);if(I!=y)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(I)a.push(T);else{if(k0(T)||F0(T))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");f.push(T)}}return y||a.push({role:"user",parts:fv(f)}),a}function u1(u,a){u.includes("null")&&(a.nullable=!0);const f=u.filter(y=>y!=="null");if(f.length===1)a.type=Object.values(Eh).includes(f[0].toUpperCase())?f[0].toUpperCase():Eh.TYPE_UNSPECIFIED;else{a.anyOf=[];for(const y of f)a.anyOf.push({type:Object.values(Eh).includes(y.toUpperCase())?y.toUpperCase():Eh.TYPE_UNSPECIFIED})}}function hp(u){const a={},f=["items"],y=["anyOf"],T=["properties"];if(u.type&&u.anyOf)throw new Error("type and anyOf cannot be both populated.");const I=u.anyOf;I!=null&&I.length==2&&(I[0].type==="null"?(a.nullable=!0,u=I[1]):I[1].type==="null"&&(a.nullable=!0,u=I[0])),u.type instanceof Array&&u1(u.type,a);for(const[S,c]of Object.entries(u))if(c!=null)if(S=="type"){if(c==="null")throw new Error("type: null can not be the only possible type for the field.");if(c instanceof Array)continue;a.type=Object.values(Eh).includes(c.toUpperCase())?c.toUpperCase():Eh.TYPE_UNSPECIFIED}else if(f.includes(S))a[S]=hp(c);else if(y.includes(S)){const F=[];for(const k of c){if(k.type=="null"){a.nullable=!0;continue}F.push(hp(k))}a[S]=F}else if(T.includes(S)){const F={};for(const[k,G]of Object.entries(c))F[k]=hp(G);a[S]=F}else{if(S==="additionalProperties")continue;a[S]=c}return a}function j_(u){return hp(u)}function Y_(u){if(typeof u=="object")return u;if(typeof u=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:u}}};throw new Error(`Unsupported speechConfig type: ${typeof u}`)}function X_(u){if("multiSpeakerVoiceConfig"in u)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return u}function fp(u){if(u.functionDeclarations)for(const a of u.functionDeclarations)a.parameters&&(Object.keys(a.parameters).includes("$schema")?a.parametersJsonSchema||(a.parametersJsonSchema=a.parameters,delete a.parameters):a.parameters=hp(a.parameters)),a.response&&(Object.keys(a.response).includes("$schema")?a.responseJsonSchema||(a.responseJsonSchema=a.response,delete a.response):a.response=hp(a.response));return u}function pp(u){if(u==null)throw new Error("tools is required");if(!Array.isArray(u))throw new Error("tools is required and must be an array of Tools");const a=[];for(const f of u)a.push(f);return a}function c1(u,a,f,y=1){const T=!a.startsWith(`${f}/`)&&a.split("/").length===y;return u.isVertexAI()?a.startsWith("projects/")?a:a.startsWith("locations/")?`projects/${u.getProject()}/${a}`:a.startsWith(`${f}/`)?`projects/${u.getProject()}/locations/${u.getLocation()}/${a}`:T?`projects/${u.getProject()}/locations/${u.getLocation()}/${f}/${a}`:a:T?`${f}/${a}`:a}function Ec(u,a){if(typeof a!="string")throw new Error("name must be a string");return c1(u,a,"cachedContents")}function pv(u){switch(u){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return u}}function Ch(u){return q_(u)}function h1(u){return u!=null&&typeof u=="object"&&"name"in u}function d1(u){return u!=null&&typeof u=="object"&&"video"in u}function f1(u){return u!=null&&typeof u=="object"&&"uri"in u}function mv(u){var a;let f;if(h1(u)&&(f=u.name),!(f1(u)&&(f=u.uri,f===void 0))&&!(d1(u)&&(f=(a=u.video)===null||a===void 0?void 0:a.uri,f===void 0))){if(typeof u=="string"&&(f=u),f===void 0)throw new Error("Could not extract file name from the provided input.");if(f.startsWith("https://")){const T=f.split("files/")[1].match(/[a-z0-9]+/);if(T===null)throw new Error(`Could not extract file name from URI ${f}`);f=T[0]}else f.startsWith("files/")&&(f=f.split("files/")[1]);return f}}function gv(u,a){let f;return u.isVertexAI()?f=a?"publishers/google/models":"models":f=a?"models":"tunedModels",f}function _v(u){for(const a of["models","tunedModels","publisherModels"])if(p1(u,a))return u[a];return[]}function p1(u,a){return u!==null&&typeof u=="object"&&a in u}function m1(u,a={}){const f=u,y={name:f.name,description:f.description,parametersJsonSchema:f.inputSchema};return f.outputSchema&&(y.responseJsonSchema=f.outputSchema),a.behavior&&(y.behavior=a.behavior),{functionDeclarations:[y]}}function g1(u,a={}){const f=[],y=new Set;for(const T of u){const I=T.name;if(y.has(I))throw new Error(`Duplicate function name ${I} found in MCP tools. Please ensure function names are unique.`);y.add(I);const S=m1(T,a);S.functionDeclarations&&f.push(...S.functionDeclarations)}return{functionDeclarations:f}}function yv(u,a){let f;if(typeof a=="string")if(u.isVertexAI())if(a.startsWith("gs://"))f={format:"jsonl",gcsUri:[a]};else if(a.startsWith("bq://"))f={format:"bigquery",bigqueryUri:a};else throw new Error(`Unsupported string source for Vertex AI: ${a}`);else if(a.startsWith("files/"))f={fileName:a};else throw new Error(`Unsupported string source for Gemini API: ${a}`);else if(Array.isArray(a)){if(u.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");f={inlinedRequests:a}}else f=a;const y=[f.gcsUri,f.bigqueryUri].filter(Boolean).length,T=[f.inlinedRequests,f.fileName].filter(Boolean).length;if(u.isVertexAI()){if(T>0||y!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(y>0||T!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return f}function _1(u){if(typeof u!="string")return u;const a=u;if(a.startsWith("gs://"))return{format:"jsonl",gcsUri:a};if(a.startsWith("bq://"))return{format:"bigquery",bigqueryUri:a};throw new Error(`Unsupported destination: ${a}`)}function vv(u){if(typeof u!="object"||u===null)return{};const a=u,f=a.inlinedResponses;if(typeof f!="object"||f===null)return u;const T=f.inlinedResponses;if(!Array.isArray(T)||T.length===0)return u;let I=!1;for(const S of T){if(typeof S!="object"||S===null)continue;const F=S.response;if(typeof F!="object"||F===null)continue;if(F.embedding!==void 0){I=!0;break}}return I&&(a.inlinedEmbedContentResponses=a.inlinedResponses,delete a.inlinedResponses),u}function mp(u,a){const f=a;if(!u.isVertexAI()){if(/batches\/[^/]+$/.test(f))return f.split("/").pop();throw new Error(`Invalid batch job name: ${f}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(f))return f.split("/").pop();if(/^\d+$/.test(f))return f;throw new Error(`Invalid batch job name: ${f}.`)}function xv(u){const a=u;return a==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":a==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":a==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":a==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":a==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":a==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":a==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function y1(u){const a={},f=E(u,["responsesFile"]);f!=null&&M(a,["fileName"],f);const y=E(u,["inlinedResponses","inlinedResponses"]);if(y!=null){let I=y;Array.isArray(I)&&(I=I.map(S=>K1(S))),M(a,["inlinedResponses"],I)}const T=E(u,["inlinedEmbedContentResponses","inlinedResponses"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>S)),M(a,["inlinedEmbedContentResponses"],I)}return a}function v1(u){const a={},f=E(u,["predictionsFormat"]);f!=null&&M(a,["format"],f);const y=E(u,["gcsDestination","outputUriPrefix"]);y!=null&&M(a,["gcsUri"],y);const T=E(u,["bigqueryDestination","outputUri"]);return T!=null&&M(a,["bigqueryUri"],T),a}function x1(u){const a={},f=E(u,["format"]);f!=null&&M(a,["predictionsFormat"],f);const y=E(u,["gcsUri"]);y!=null&&M(a,["gcsDestination","outputUriPrefix"],y);const T=E(u,["bigqueryUri"]);if(T!=null&&M(a,["bigqueryDestination","outputUri"],T),E(u,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(E(u,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(E(u,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return a}function Bg(u){const a={},f=E(u,["name"]);f!=null&&M(a,["name"],f);const y=E(u,["metadata","displayName"]);y!=null&&M(a,["displayName"],y);const T=E(u,["metadata","state"]);T!=null&&M(a,["state"],xv(T));const I=E(u,["metadata","createTime"]);I!=null&&M(a,["createTime"],I);const S=E(u,["metadata","endTime"]);S!=null&&M(a,["endTime"],S);const c=E(u,["metadata","updateTime"]);c!=null&&M(a,["updateTime"],c);const F=E(u,["metadata","model"]);F!=null&&M(a,["model"],F);const k=E(u,["metadata","output"]);return k!=null&&M(a,["dest"],y1(vv(k))),a}function D_(u){const a={},f=E(u,["name"]);f!=null&&M(a,["name"],f);const y=E(u,["displayName"]);y!=null&&M(a,["displayName"],y);const T=E(u,["state"]);T!=null&&M(a,["state"],xv(T));const I=E(u,["error"]);I!=null&&M(a,["error"],I);const S=E(u,["createTime"]);S!=null&&M(a,["createTime"],S);const c=E(u,["startTime"]);c!=null&&M(a,["startTime"],c);const F=E(u,["endTime"]);F!=null&&M(a,["endTime"],F);const k=E(u,["updateTime"]);k!=null&&M(a,["updateTime"],k);const G=E(u,["model"]);G!=null&&M(a,["model"],G);const K=E(u,["inputConfig"]);K!=null&&M(a,["src"],b1(K));const ee=E(u,["outputConfig"]);ee!=null&&M(a,["dest"],v1(vv(ee)));const ye=E(u,["completionStats"]);return ye!=null&&M(a,["completionStats"],ye),a}function b1(u){const a={},f=E(u,["instancesFormat"]);f!=null&&M(a,["format"],f);const y=E(u,["gcsSource","uris"]);y!=null&&M(a,["gcsUri"],y);const T=E(u,["bigquerySource","inputUri"]);return T!=null&&M(a,["bigqueryUri"],T),a}function w1(u,a){const f={};if(E(a,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(E(a,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(E(a,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const y=E(a,["fileName"]);y!=null&&M(f,["fileName"],y);const T=E(a,["inlinedRequests"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>W1(u,S))),M(f,["requests","requests"],I)}return f}function T1(u){const a={},f=E(u,["format"]);f!=null&&M(a,["instancesFormat"],f);const y=E(u,["gcsUri"]);y!=null&&M(a,["gcsSource","uris"],y);const T=E(u,["bigqueryUri"]);if(T!=null&&M(a,["bigquerySource","inputUri"],T),E(u,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(E(u,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return a}function S1(u){const a={},f=E(u,["data"]);if(f!=null&&M(a,["data"],f),E(u,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const y=E(u,["mimeType"]);return y!=null&&M(a,["mimeType"],y),a}function E1(u,a){const f={},y=E(a,["name"]);return y!=null&&M(f,["_url","name"],mp(u,y)),f}function C1(u,a){const f={},y=E(a,["name"]);return y!=null&&M(f,["_url","name"],mp(u,y)),f}function A1(u){const a={},f=E(u,["content"]);f!=null&&M(a,["content"],f);const y=E(u,["citationMetadata"]);y!=null&&M(a,["citationMetadata"],M1(y));const T=E(u,["tokenCount"]);T!=null&&M(a,["tokenCount"],T);const I=E(u,["finishReason"]);I!=null&&M(a,["finishReason"],I);const S=E(u,["avgLogprobs"]);S!=null&&M(a,["avgLogprobs"],S);const c=E(u,["groundingMetadata"]);c!=null&&M(a,["groundingMetadata"],c);const F=E(u,["index"]);F!=null&&M(a,["index"],F);const k=E(u,["logprobsResult"]);k!=null&&M(a,["logprobsResult"],k);const G=E(u,["safetyRatings"]);if(G!=null){let ee=G;Array.isArray(ee)&&(ee=ee.map(ye=>ye)),M(a,["safetyRatings"],ee)}const K=E(u,["urlContextMetadata"]);return K!=null&&M(a,["urlContextMetadata"],K),a}function M1(u){const a={},f=E(u,["citationSources"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(T=>T)),M(a,["citations"],y)}return a}function bv(u){const a={},f=E(u,["parts"]);if(f!=null){let T=f;Array.isArray(T)&&(T=T.map(I=>ow(I))),M(a,["parts"],T)}const y=E(u,["role"]);return y!=null&&M(a,["role"],y),a}function I1(u,a){const f={},y=E(u,["displayName"]);if(a!==void 0&&y!=null&&M(a,["batch","displayName"],y),E(u,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return f}function R1(u,a){const f={},y=E(u,["displayName"]);a!==void 0&&y!=null&&M(a,["displayName"],y);const T=E(u,["dest"]);return a!==void 0&&T!=null&&M(a,["outputConfig"],x1(_1(T))),f}function B0(u,a){const f={},y=E(a,["model"]);y!=null&&M(f,["_url","model"],ni(u,y));const T=E(a,["src"]);T!=null&&M(f,["batch","inputConfig"],w1(u,yv(u,T)));const I=E(a,["config"]);return I!=null&&I1(I,f),f}function P1(u,a){const f={},y=E(a,["model"]);y!=null&&M(f,["model"],ni(u,y));const T=E(a,["src"]);T!=null&&M(f,["inputConfig"],T1(yv(u,T)));const I=E(a,["config"]);return I!=null&&R1(I,f),f}function D1(u,a){const f={},y=E(u,["displayName"]);return a!==void 0&&y!=null&&M(a,["batch","displayName"],y),f}function z1(u,a){const f={},y=E(a,["model"]);y!=null&&M(f,["_url","model"],ni(u,y));const T=E(a,["src"]);T!=null&&M(f,["batch","inputConfig"],U1(u,T));const I=E(a,["config"]);return I!=null&&D1(I,f),f}function L1(u,a){const f={},y=E(a,["name"]);return y!=null&&M(f,["_url","name"],mp(u,y)),f}function N1(u,a){const f={},y=E(a,["name"]);return y!=null&&M(f,["_url","name"],mp(u,y)),f}function k1(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["name"]);y!=null&&M(a,["name"],y);const T=E(u,["done"]);T!=null&&M(a,["done"],T);const I=E(u,["error"]);return I!=null&&M(a,["error"],I),a}function F1(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["name"]);y!=null&&M(a,["name"],y);const T=E(u,["done"]);T!=null&&M(a,["done"],T);const I=E(u,["error"]);return I!=null&&M(a,["error"],I),a}function B1(u,a){const f={},y=E(a,["contents"]);if(y!=null){let I=$_(u,y);Array.isArray(I)&&(I=I.map(S=>S)),M(f,["requests[]","request","content"],I)}const T=E(a,["config"]);return T!=null&&(M(f,["_self"],O1(T,f)),Lb(f,{"requests[].*":"requests[].request.*"})),f}function O1(u,a){const f={},y=E(u,["taskType"]);a!==void 0&&y!=null&&M(a,["requests[]","taskType"],y);const T=E(u,["title"]);a!==void 0&&T!=null&&M(a,["requests[]","title"],T);const I=E(u,["outputDimensionality"]);if(a!==void 0&&I!=null&&M(a,["requests[]","outputDimensionality"],I),E(u,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(E(u,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return f}function U1(u,a){const f={},y=E(a,["fileName"]);y!=null&&M(f,["file_name"],y);const T=E(a,["inlinedRequests"]);return T!=null&&M(f,["requests"],B1(u,T)),f}function V1(u){const a={};if(E(u,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const f=E(u,["fileUri"]);f!=null&&M(a,["fileUri"],f);const y=E(u,["mimeType"]);return y!=null&&M(a,["mimeType"],y),a}function G1(u){const a={},f=E(u,["id"]);f!=null&&M(a,["id"],f);const y=E(u,["args"]);y!=null&&M(a,["args"],y);const T=E(u,["name"]);if(T!=null&&M(a,["name"],T),E(u,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(E(u,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return a}function q1(u){const a={},f=E(u,["allowedFunctionNames"]);f!=null&&M(a,["allowedFunctionNames"],f);const y=E(u,["mode"]);if(y!=null&&M(a,["mode"],y),E(u,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return a}function H1(u,a,f){const y={},T=E(a,["systemInstruction"]);f!==void 0&&T!=null&&M(f,["systemInstruction"],bv(qo(T)));const I=E(a,["temperature"]);I!=null&&M(y,["temperature"],I);const S=E(a,["topP"]);S!=null&&M(y,["topP"],S);const c=E(a,["topK"]);c!=null&&M(y,["topK"],c);const F=E(a,["candidateCount"]);F!=null&&M(y,["candidateCount"],F);const k=E(a,["maxOutputTokens"]);k!=null&&M(y,["maxOutputTokens"],k);const G=E(a,["stopSequences"]);G!=null&&M(y,["stopSequences"],G);const K=E(a,["responseLogprobs"]);K!=null&&M(y,["responseLogprobs"],K);const ee=E(a,["logprobs"]);ee!=null&&M(y,["logprobs"],ee);const ye=E(a,["presencePenalty"]);ye!=null&&M(y,["presencePenalty"],ye);const Le=E(a,["frequencyPenalty"]);Le!=null&&M(y,["frequencyPenalty"],Le);const Ne=E(a,["seed"]);Ne!=null&&M(y,["seed"],Ne);const se=E(a,["responseMimeType"]);se!=null&&M(y,["responseMimeType"],se);const Ye=E(a,["responseSchema"]);Ye!=null&&M(y,["responseSchema"],j_(Ye));const st=E(a,["responseJsonSchema"]);if(st!=null&&M(y,["responseJsonSchema"],st),E(a,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(E(a,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const We=E(a,["safetySettings"]);if(f!==void 0&&We!=null){let An=We;Array.isArray(An)&&(An=An.map(kn=>sw(kn))),M(f,["safetySettings"],An)}const gt=E(a,["tools"]);if(f!==void 0&&gt!=null){let An=pp(gt);Array.isArray(An)&&(An=An.map(kn=>lw(fp(kn)))),M(f,["tools"],An)}const nt=E(a,["toolConfig"]);if(f!==void 0&&nt!=null&&M(f,["toolConfig"],aw(nt)),E(a,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const zt=E(a,["cachedContent"]);f!==void 0&&zt!=null&&M(f,["cachedContent"],Ec(u,zt));const _t=E(a,["responseModalities"]);_t!=null&&M(y,["responseModalities"],_t);const Ut=E(a,["mediaResolution"]);Ut!=null&&M(y,["mediaResolution"],Ut);const At=E(a,["speechConfig"]);if(At!=null&&M(y,["speechConfig"],Y_(At)),E(a,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const Xt=E(a,["thinkingConfig"]);Xt!=null&&M(y,["thinkingConfig"],Xt);const tn=E(a,["imageConfig"]);tn!=null&&M(y,["imageConfig"],J1(tn));const an=E(a,["enableEnhancedCivicAnswers"]);if(an!=null&&M(y,["enableEnhancedCivicAnswers"],an),E(a,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return y}function Z1(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["candidates"]);if(y!=null){let F=y;Array.isArray(F)&&(F=F.map(k=>A1(k))),M(a,["candidates"],F)}const T=E(u,["modelVersion"]);T!=null&&M(a,["modelVersion"],T);const I=E(u,["promptFeedback"]);I!=null&&M(a,["promptFeedback"],I);const S=E(u,["responseId"]);S!=null&&M(a,["responseId"],S);const c=E(u,["usageMetadata"]);return c!=null&&M(a,["usageMetadata"],c),a}function $1(u,a){const f={},y=E(a,["name"]);return y!=null&&M(f,["_url","name"],mp(u,y)),f}function j1(u,a){const f={},y=E(a,["name"]);return y!=null&&M(f,["_url","name"],mp(u,y)),f}function Y1(u){const a={};if(E(u,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const f=E(u,["enableWidget"]);return f!=null&&M(a,["enableWidget"],f),a}function X1(u){const a={};if(E(u,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(E(u,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const f=E(u,["timeRangeFilter"]);return f!=null&&M(a,["timeRangeFilter"],f),a}function J1(u){const a={},f=E(u,["aspectRatio"]);f!=null&&M(a,["aspectRatio"],f);const y=E(u,["imageSize"]);if(y!=null&&M(a,["imageSize"],y),E(u,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(E(u,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(E(u,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return a}function W1(u,a){const f={},y=E(a,["model"]);y!=null&&M(f,["request","model"],ni(u,y));const T=E(a,["contents"]);if(T!=null){let c=Ua(T);Array.isArray(c)&&(c=c.map(F=>bv(F))),M(f,["request","contents"],c)}const I=E(a,["metadata"]);I!=null&&M(f,["metadata"],I);const S=E(a,["config"]);return S!=null&&M(f,["request","generationConfig"],H1(u,S,E(f,["request"],{}))),f}function K1(u){const a={},f=E(u,["response"]);f!=null&&M(a,["response"],Z1(f));const y=E(u,["metadata"]);y!=null&&M(a,["metadata"],y);const T=E(u,["error"]);return T!=null&&M(a,["error"],T),a}function Q1(u,a){const f={},y=E(u,["pageSize"]);a!==void 0&&y!=null&&M(a,["_query","pageSize"],y);const T=E(u,["pageToken"]);if(a!==void 0&&T!=null&&M(a,["_query","pageToken"],T),E(u,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return f}function ew(u,a){const f={},y=E(u,["pageSize"]);a!==void 0&&y!=null&&M(a,["_query","pageSize"],y);const T=E(u,["pageToken"]);a!==void 0&&T!=null&&M(a,["_query","pageToken"],T);const I=E(u,["filter"]);return a!==void 0&&I!=null&&M(a,["_query","filter"],I),f}function tw(u){const a={},f=E(u,["config"]);return f!=null&&Q1(f,a),a}function nw(u){const a={},f=E(u,["config"]);return f!=null&&ew(f,a),a}function iw(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["nextPageToken"]);y!=null&&M(a,["nextPageToken"],y);const T=E(u,["operations"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>Bg(S))),M(a,["batchJobs"],I)}return a}function rw(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["nextPageToken"]);y!=null&&M(a,["nextPageToken"],y);const T=E(u,["batchPredictionJobs"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>D_(S))),M(a,["batchJobs"],I)}return a}function ow(u){const a={},f=E(u,["mediaResolution"]);f!=null&&M(a,["mediaResolution"],f);const y=E(u,["codeExecutionResult"]);y!=null&&M(a,["codeExecutionResult"],y);const T=E(u,["executableCode"]);T!=null&&M(a,["executableCode"],T);const I=E(u,["fileData"]);I!=null&&M(a,["fileData"],V1(I));const S=E(u,["functionCall"]);S!=null&&M(a,["functionCall"],G1(S));const c=E(u,["functionResponse"]);c!=null&&M(a,["functionResponse"],c);const F=E(u,["inlineData"]);F!=null&&M(a,["inlineData"],S1(F));const k=E(u,["text"]);k!=null&&M(a,["text"],k);const G=E(u,["thought"]);G!=null&&M(a,["thought"],G);const K=E(u,["thoughtSignature"]);K!=null&&M(a,["thoughtSignature"],K);const ee=E(u,["videoMetadata"]);return ee!=null&&M(a,["videoMetadata"],ee),a}function sw(u){const a={},f=E(u,["category"]);if(f!=null&&M(a,["category"],f),E(u,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const y=E(u,["threshold"]);return y!=null&&M(a,["threshold"],y),a}function aw(u){const a={},f=E(u,["retrievalConfig"]);f!=null&&M(a,["retrievalConfig"],f);const y=E(u,["functionCallingConfig"]);return y!=null&&M(a,["functionCallingConfig"],q1(y)),a}function lw(u){const a={};if(E(u,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const f=E(u,["computerUse"]);f!=null&&M(a,["computerUse"],f);const y=E(u,["fileSearch"]);y!=null&&M(a,["fileSearch"],y);const T=E(u,["codeExecution"]);if(T!=null&&M(a,["codeExecution"],T),E(u,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const I=E(u,["functionDeclarations"]);if(I!=null){let G=I;Array.isArray(G)&&(G=G.map(K=>K)),M(a,["functionDeclarations"],G)}const S=E(u,["googleMaps"]);S!=null&&M(a,["googleMaps"],Y1(S));const c=E(u,["googleSearch"]);c!=null&&M(a,["googleSearch"],X1(c));const F=E(u,["googleSearchRetrieval"]);F!=null&&M(a,["googleSearchRetrieval"],F);const k=E(u,["urlContext"]);return k!=null&&M(a,["urlContext"],k),a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Tc;(function(u){u.PAGED_ITEM_BATCH_JOBS="batchJobs",u.PAGED_ITEM_MODELS="models",u.PAGED_ITEM_TUNING_JOBS="tuningJobs",u.PAGED_ITEM_FILES="files",u.PAGED_ITEM_CACHED_CONTENTS="cachedContents",u.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",u.PAGED_ITEM_DOCUMENTS="documents"})(Tc||(Tc={}));class Od{constructor(a,f,y,T){this.pageInternal=[],this.paramsInternal={},this.requestInternal=f,this.init(a,y,T)}init(a,f,y){var T,I;this.nameInternal=a,this.pageInternal=f[this.nameInternal]||[],this.sdkHttpResponseInternal=f==null?void 0:f.sdkHttpResponse,this.idxInternal=0;let S={config:{}};!y||Object.keys(y).length===0?S={config:{}}:typeof y=="object"?S=Object.assign({},y):S=y,S.config&&(S.config.pageToken=f.nextPageToken),this.paramsInternal=S,this.pageInternalSize=(I=(T=S.config)===null||T===void 0?void 0:T.pageSize)!==null&&I!==void 0?I:this.pageInternal.length}initNextPage(a){this.init(this.nameInternal,a,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(a){return this.pageInternal[a]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const a=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:a,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const a=await this.requestInternal(this.params);return this.initNextPage(a),this.page}hasNextPage(){var a;return((a=this.params.config)===null||a===void 0?void 0:a.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class uw extends Sc{constructor(a){super(),this.apiClient=a,this.list=async(f={})=>new Od(Tc.PAGED_ITEM_BATCH_JOBS,y=>this.listInternal(y),await this.listInternal(f),f),this.create=async f=>(this.apiClient.isVertexAI()&&(f.config=this.formatDestination(f.src,f.config)),this.createInternal(f)),this.createEmbeddings=async f=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(f)}}createInlinedGenerateContentRequest(a){const f=B0(this.apiClient,a),y=f._url,T=Pt("{model}:batchGenerateContent",y),c=f.batch.inputConfig.requests,F=c.requests,k=[];for(const G of F){const K=Object.assign({},G);if(K.systemInstruction){const ee=K.systemInstruction;delete K.systemInstruction;const ye=K.request;ye.systemInstruction=ee,K.request=ye}k.push(K)}return c.requests=k,delete f.config,delete f._url,delete f._query,{path:T,body:f}}getGcsUri(a){if(typeof a=="string")return a.startsWith("gs://")?a:void 0;if(!Array.isArray(a)&&a.gcsUri&&a.gcsUri.length>0)return a.gcsUri[0]}getBigqueryUri(a){if(typeof a=="string")return a.startsWith("bq://")?a:void 0;if(!Array.isArray(a))return a.bigqueryUri}formatDestination(a,f){const y=f?Object.assign({},f):{},T=Date.now().toString();if(y.displayName||(y.displayName=`genaiBatchJob_${T}`),y.dest===void 0){const I=this.getGcsUri(a),S=this.getBigqueryUri(a);if(I)I.endsWith(".jsonl")?y.dest=`${I.slice(0,-6)}/dest`:y.dest=`${I}_dest_${T}`;else if(S)y.dest=`${S}_dest_${T}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return y}async createInternal(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=P1(this.apiClient,a);return c=Pt("batchPredictionJobs",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json()),S.then(G=>D_(G))}else{const k=B0(this.apiClient,a);return c=Pt("{model}:batchGenerateContent",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json()),S.then(G=>Bg(G))}}async createEmbeddingsInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=z1(this.apiClient,a);return I=Pt("{model}:asyncBatchEmbedContent",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>Bg(F))}}async get(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=j1(this.apiClient,a);return c=Pt("batchPredictionJobs/{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json()),S.then(G=>D_(G))}else{const k=$1(this.apiClient,a);return c=Pt("batches/{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json()),S.then(G=>Bg(G))}}async cancel(a){var f,y,T,I;let S="",c={};if(this.apiClient.isVertexAI()){const F=C1(this.apiClient,a);S=Pt("batchPredictionJobs/{name}:cancel",F._url),c=F._query,delete F._url,delete F._query,await this.apiClient.request({path:S,queryParams:c,body:JSON.stringify(F),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal})}else{const F=E1(this.apiClient,a);S=Pt("batches/{name}:cancel",F._url),c=F._query,delete F._url,delete F._query,await this.apiClient.request({path:S,queryParams:c,body:JSON.stringify(F),httpMethod:"POST",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal})}}async listInternal(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=nw(a);return c=Pt("batchPredictionJobs",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=rw(G),ee=new L0;return Object.assign(ee,K),ee})}else{const k=tw(a);return c=Pt("batches",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=iw(G),ee=new L0;return Object.assign(ee,K),ee})}}async delete(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=N1(this.apiClient,a);return c=Pt("batchPredictionJobs/{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"DELETE",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>F1(G))}else{const k=L1(this.apiClient,a);return c=Pt("batches/{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"DELETE",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>k1(G))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cw(u){const a={},f=E(u,["data"]);if(f!=null&&M(a,["data"],f),E(u,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const y=E(u,["mimeType"]);return y!=null&&M(a,["mimeType"],y),a}function O0(u){const a={},f=E(u,["parts"]);if(f!=null){let T=f;Array.isArray(T)&&(T=T.map(I=>zw(I))),M(a,["parts"],T)}const y=E(u,["role"]);return y!=null&&M(a,["role"],y),a}function hw(u,a){const f={},y=E(u,["ttl"]);a!==void 0&&y!=null&&M(a,["ttl"],y);const T=E(u,["expireTime"]);a!==void 0&&T!=null&&M(a,["expireTime"],T);const I=E(u,["displayName"]);a!==void 0&&I!=null&&M(a,["displayName"],I);const S=E(u,["contents"]);if(a!==void 0&&S!=null){let G=Ua(S);Array.isArray(G)&&(G=G.map(K=>O0(K))),M(a,["contents"],G)}const c=E(u,["systemInstruction"]);a!==void 0&&c!=null&&M(a,["systemInstruction"],O0(qo(c)));const F=E(u,["tools"]);if(a!==void 0&&F!=null){let G=F;Array.isArray(G)&&(G=G.map(K=>Nw(K))),M(a,["tools"],G)}const k=E(u,["toolConfig"]);if(a!==void 0&&k!=null&&M(a,["toolConfig"],Lw(k)),E(u,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return f}function dw(u,a){const f={},y=E(u,["ttl"]);a!==void 0&&y!=null&&M(a,["ttl"],y);const T=E(u,["expireTime"]);a!==void 0&&T!=null&&M(a,["expireTime"],T);const I=E(u,["displayName"]);a!==void 0&&I!=null&&M(a,["displayName"],I);const S=E(u,["contents"]);if(a!==void 0&&S!=null){let K=Ua(S);Array.isArray(K)&&(K=K.map(ee=>ee)),M(a,["contents"],K)}const c=E(u,["systemInstruction"]);a!==void 0&&c!=null&&M(a,["systemInstruction"],qo(c));const F=E(u,["tools"]);if(a!==void 0&&F!=null){let K=F;Array.isArray(K)&&(K=K.map(ee=>kw(ee))),M(a,["tools"],K)}const k=E(u,["toolConfig"]);a!==void 0&&k!=null&&M(a,["toolConfig"],k);const G=E(u,["kmsKeyName"]);return a!==void 0&&G!=null&&M(a,["encryption_spec","kmsKeyName"],G),f}function fw(u,a){const f={},y=E(a,["model"]);y!=null&&M(f,["model"],uv(u,y));const T=E(a,["config"]);return T!=null&&hw(T,f),f}function pw(u,a){const f={},y=E(a,["model"]);y!=null&&M(f,["model"],uv(u,y));const T=E(a,["config"]);return T!=null&&dw(T,f),f}function mw(u,a){const f={},y=E(a,["name"]);return y!=null&&M(f,["_url","name"],Ec(u,y)),f}function gw(u,a){const f={},y=E(a,["name"]);return y!=null&&M(f,["_url","name"],Ec(u,y)),f}function _w(u){const a={},f=E(u,["sdkHttpResponse"]);return f!=null&&M(a,["sdkHttpResponse"],f),a}function yw(u){const a={},f=E(u,["sdkHttpResponse"]);return f!=null&&M(a,["sdkHttpResponse"],f),a}function vw(u){const a={};if(E(u,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const f=E(u,["fileUri"]);f!=null&&M(a,["fileUri"],f);const y=E(u,["mimeType"]);return y!=null&&M(a,["mimeType"],y),a}function xw(u){const a={},f=E(u,["id"]);f!=null&&M(a,["id"],f);const y=E(u,["args"]);y!=null&&M(a,["args"],y);const T=E(u,["name"]);if(T!=null&&M(a,["name"],T),E(u,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(E(u,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return a}function bw(u){const a={},f=E(u,["allowedFunctionNames"]);f!=null&&M(a,["allowedFunctionNames"],f);const y=E(u,["mode"]);if(y!=null&&M(a,["mode"],y),E(u,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return a}function ww(u){const a={},f=E(u,["description"]);f!=null&&M(a,["description"],f);const y=E(u,["name"]);y!=null&&M(a,["name"],y);const T=E(u,["parameters"]);T!=null&&M(a,["parameters"],T);const I=E(u,["parametersJsonSchema"]);I!=null&&M(a,["parametersJsonSchema"],I);const S=E(u,["response"]);S!=null&&M(a,["response"],S);const c=E(u,["responseJsonSchema"]);if(c!=null&&M(a,["responseJsonSchema"],c),E(u,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return a}function Tw(u,a){const f={},y=E(a,["name"]);return y!=null&&M(f,["_url","name"],Ec(u,y)),f}function Sw(u,a){const f={},y=E(a,["name"]);return y!=null&&M(f,["_url","name"],Ec(u,y)),f}function Ew(u){const a={};if(E(u,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const f=E(u,["enableWidget"]);return f!=null&&M(a,["enableWidget"],f),a}function Cw(u){const a={};if(E(u,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(E(u,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const f=E(u,["timeRangeFilter"]);return f!=null&&M(a,["timeRangeFilter"],f),a}function Aw(u,a){const f={},y=E(u,["pageSize"]);a!==void 0&&y!=null&&M(a,["_query","pageSize"],y);const T=E(u,["pageToken"]);return a!==void 0&&T!=null&&M(a,["_query","pageToken"],T),f}function Mw(u,a){const f={},y=E(u,["pageSize"]);a!==void 0&&y!=null&&M(a,["_query","pageSize"],y);const T=E(u,["pageToken"]);return a!==void 0&&T!=null&&M(a,["_query","pageToken"],T),f}function Iw(u){const a={},f=E(u,["config"]);return f!=null&&Aw(f,a),a}function Rw(u){const a={},f=E(u,["config"]);return f!=null&&Mw(f,a),a}function Pw(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["nextPageToken"]);y!=null&&M(a,["nextPageToken"],y);const T=E(u,["cachedContents"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>S)),M(a,["cachedContents"],I)}return a}function Dw(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["nextPageToken"]);y!=null&&M(a,["nextPageToken"],y);const T=E(u,["cachedContents"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>S)),M(a,["cachedContents"],I)}return a}function zw(u){const a={},f=E(u,["mediaResolution"]);f!=null&&M(a,["mediaResolution"],f);const y=E(u,["codeExecutionResult"]);y!=null&&M(a,["codeExecutionResult"],y);const T=E(u,["executableCode"]);T!=null&&M(a,["executableCode"],T);const I=E(u,["fileData"]);I!=null&&M(a,["fileData"],vw(I));const S=E(u,["functionCall"]);S!=null&&M(a,["functionCall"],xw(S));const c=E(u,["functionResponse"]);c!=null&&M(a,["functionResponse"],c);const F=E(u,["inlineData"]);F!=null&&M(a,["inlineData"],cw(F));const k=E(u,["text"]);k!=null&&M(a,["text"],k);const G=E(u,["thought"]);G!=null&&M(a,["thought"],G);const K=E(u,["thoughtSignature"]);K!=null&&M(a,["thoughtSignature"],K);const ee=E(u,["videoMetadata"]);return ee!=null&&M(a,["videoMetadata"],ee),a}function Lw(u){const a={},f=E(u,["retrievalConfig"]);f!=null&&M(a,["retrievalConfig"],f);const y=E(u,["functionCallingConfig"]);return y!=null&&M(a,["functionCallingConfig"],bw(y)),a}function Nw(u){const a={};if(E(u,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const f=E(u,["computerUse"]);f!=null&&M(a,["computerUse"],f);const y=E(u,["fileSearch"]);y!=null&&M(a,["fileSearch"],y);const T=E(u,["codeExecution"]);if(T!=null&&M(a,["codeExecution"],T),E(u,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const I=E(u,["functionDeclarations"]);if(I!=null){let G=I;Array.isArray(G)&&(G=G.map(K=>K)),M(a,["functionDeclarations"],G)}const S=E(u,["googleMaps"]);S!=null&&M(a,["googleMaps"],Ew(S));const c=E(u,["googleSearch"]);c!=null&&M(a,["googleSearch"],Cw(c));const F=E(u,["googleSearchRetrieval"]);F!=null&&M(a,["googleSearchRetrieval"],F);const k=E(u,["urlContext"]);return k!=null&&M(a,["urlContext"],k),a}function kw(u){const a={},f=E(u,["retrieval"]);f!=null&&M(a,["retrieval"],f);const y=E(u,["computerUse"]);if(y!=null&&M(a,["computerUse"],y),E(u,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const T=E(u,["codeExecution"]);T!=null&&M(a,["codeExecution"],T);const I=E(u,["enterpriseWebSearch"]);I!=null&&M(a,["enterpriseWebSearch"],I);const S=E(u,["functionDeclarations"]);if(S!=null){let K=S;Array.isArray(K)&&(K=K.map(ee=>ww(ee))),M(a,["functionDeclarations"],K)}const c=E(u,["googleMaps"]);c!=null&&M(a,["googleMaps"],c);const F=E(u,["googleSearch"]);F!=null&&M(a,["googleSearch"],F);const k=E(u,["googleSearchRetrieval"]);k!=null&&M(a,["googleSearchRetrieval"],k);const G=E(u,["urlContext"]);return G!=null&&M(a,["urlContext"],G),a}function Fw(u,a){const f={},y=E(u,["ttl"]);a!==void 0&&y!=null&&M(a,["ttl"],y);const T=E(u,["expireTime"]);return a!==void 0&&T!=null&&M(a,["expireTime"],T),f}function Bw(u,a){const f={},y=E(u,["ttl"]);a!==void 0&&y!=null&&M(a,["ttl"],y);const T=E(u,["expireTime"]);return a!==void 0&&T!=null&&M(a,["expireTime"],T),f}function Ow(u,a){const f={},y=E(a,["name"]);y!=null&&M(f,["_url","name"],Ec(u,y));const T=E(a,["config"]);return T!=null&&Fw(T,f),f}function Uw(u,a){const f={},y=E(a,["name"]);y!=null&&M(f,["_url","name"],Ec(u,y));const T=E(a,["config"]);return T!=null&&Bw(T,f),f}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Vw extends Sc{constructor(a){super(),this.apiClient=a,this.list=async(f={})=>new Od(Tc.PAGED_ITEM_CACHED_CONTENTS,y=>this.listInternal(y),await this.listInternal(f),f)}async create(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=pw(this.apiClient,a);return c=Pt("cachedContents",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json()),S.then(G=>G)}else{const k=fw(this.apiClient,a);return c=Pt("cachedContents",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json()),S.then(G=>G)}}async get(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=Sw(this.apiClient,a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json()),S.then(G=>G)}else{const k=Tw(this.apiClient,a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json()),S.then(G=>G)}}async delete(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=gw(this.apiClient,a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"DELETE",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=yw(G),ee=new D0;return Object.assign(ee,K),ee})}else{const k=mw(this.apiClient,a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"DELETE",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=_w(G),ee=new D0;return Object.assign(ee,K),ee})}}async update(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=Uw(this.apiClient,a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"PATCH",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json()),S.then(G=>G)}else{const k=Ow(this.apiClient,a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"PATCH",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json()),S.then(G=>G)}}async listInternal(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=Rw(a);return c=Pt("cachedContents",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=Dw(G),ee=new z0;return Object.assign(ee,K),ee})}else{const k=Iw(a);return c=Pt("cachedContents",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=Pw(G),ee=new z0;return Object.assign(ee,K),ee})}}}function qg(u,a){var f={};for(var y in u)Object.prototype.hasOwnProperty.call(u,y)&&a.indexOf(y)<0&&(f[y]=u[y]);if(u!=null&&typeof Object.getOwnPropertySymbols=="function")for(var T=0,y=Object.getOwnPropertySymbols(u);T<y.length;T++)a.indexOf(y[T])<0&&Object.prototype.propertyIsEnumerable.call(u,y[T])&&(f[y[T]]=u[y[T]]);return f}function U0(u){var a=typeof Symbol=="function"&&Symbol.iterator,f=a&&u[a],y=0;if(f)return f.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&y>=u.length&&(u=void 0),{value:u&&u[y++],done:!u}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")}function dn(u){return this instanceof dn?(this.v=u,this):new dn(u)}function Pl(u,a,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var y=f.apply(u,a||[]),T,I=[];return T=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",S),T[Symbol.asyncIterator]=function(){return this},T;function S(ye){return function(Le){return Promise.resolve(Le).then(ye,K)}}function c(ye,Le){y[ye]&&(T[ye]=function(Ne){return new Promise(function(se,Ye){I.push([ye,Ne,se,Ye])>1||F(ye,Ne)})},Le&&(T[ye]=Le(T[ye])))}function F(ye,Le){try{k(y[ye](Le))}catch(Ne){ee(I[0][3],Ne)}}function k(ye){ye.value instanceof dn?Promise.resolve(ye.value.v).then(G,K):ee(I[0][2],ye)}function G(ye){F("next",ye)}function K(ye){F("throw",ye)}function ee(ye,Le){ye(Le),I.shift(),I.length&&F(I[0][0],I[0][1])}}function Dl(u){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=u[Symbol.asyncIterator],f;return a?a.call(u):(u=typeof U0=="function"?U0(u):u[Symbol.iterator](),f={},y("next"),y("throw"),y("return"),f[Symbol.asyncIterator]=function(){return this},f);function y(I){f[I]=u[I]&&function(S){return new Promise(function(c,F){S=u[I](S),T(c,F,S.done,S.value)})}}function T(I,S,c,F){Promise.resolve(F).then(function(k){I({value:k,done:c})},S)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Gw(u){var a;if(u.candidates==null||u.candidates.length===0)return!1;const f=(a=u.candidates[0])===null||a===void 0?void 0:a.content;return f===void 0?!1:wv(f)}function wv(u){if(u.parts===void 0||u.parts.length===0)return!1;for(const a of u.parts)if(a===void 0||Object.keys(a).length===0)return!1;return!0}function qw(u){if(u.length!==0){for(const a of u)if(a.role!=="user"&&a.role!=="model")throw new Error(`Role must be user or model, but got ${a.role}.`)}}function V0(u){if(u===void 0||u.length===0)return[];const a=[],f=u.length;let y=0;for(;y<f;)if(u[y].role==="user")a.push(u[y]),y++;else{const T=[];let I=!0;for(;y<f&&u[y].role==="model";)T.push(u[y]),I&&!wv(u[y])&&(I=!1),y++;I?a.push(...T):a.pop()}return a}class Hw{constructor(a,f){this.modelsModule=a,this.apiClient=f}create(a){return new Zw(this.apiClient,this.modelsModule,a.model,a.config,structuredClone(a.history))}}class Zw{constructor(a,f,y,T={},I=[]){this.apiClient=a,this.modelsModule=f,this.model=y,this.config=T,this.history=I,this.sendPromise=Promise.resolve(),qw(I)}async sendMessage(a){var f;await this.sendPromise;const y=qo(a.message),T=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(y),config:(f=a.config)!==null&&f!==void 0?f:this.config});return this.sendPromise=(async()=>{var I,S,c;const F=await T,k=(S=(I=F.candidates)===null||I===void 0?void 0:I[0])===null||S===void 0?void 0:S.content,G=F.automaticFunctionCallingHistory,K=this.getHistory(!0).length;let ee=[];G!=null&&(ee=(c=G.slice(K))!==null&&c!==void 0?c:[]);const ye=k?[k]:[];this.recordHistory(y,ye,ee)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),T}async sendMessageStream(a){var f;await this.sendPromise;const y=qo(a.message),T=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(y),config:(f=a.config)!==null&&f!==void 0?f:this.config});this.sendPromise=T.then(()=>{}).catch(()=>{});const I=await T;return this.processStreamResponse(I,y)}getHistory(a=!1){const f=a?V0(this.history):this.history;return structuredClone(f)}processStreamResponse(a,f){return Pl(this,arguments,function*(){var T,I,S,c,F,k;const G=[];try{for(var K=!0,ee=Dl(a),ye;ye=yield dn(ee.next()),T=ye.done,!T;K=!0){c=ye.value,K=!1;const Le=c;if(Gw(Le)){const Ne=(k=(F=Le.candidates)===null||F===void 0?void 0:F[0])===null||k===void 0?void 0:k.content;Ne!==void 0&&G.push(Ne)}yield yield dn(Le)}}catch(Le){I={error:Le}}finally{try{!K&&!T&&(S=ee.return)&&(yield dn(S.call(ee)))}finally{if(I)throw I.error}}this.recordHistory(f,G)})}recordHistory(a,f,y){let T=[];f.length>0&&f.every(I=>I.role!==void 0)?T=f:T.push({role:"model",parts:[]}),y&&y.length>0?this.history.push(...V0(y)):this.history.push(a),this.history.push(...T)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Am extends Error{constructor(a){super(a.message),this.name="ApiError",this.status=a.status,Object.setPrototypeOf(this,Am.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $w(u){const a={},f=E(u,["file"]);return f!=null&&M(a,["file"],f),a}function jw(u){const a={},f=E(u,["sdkHttpResponse"]);return f!=null&&M(a,["sdkHttpResponse"],f),a}function Yw(u){const a={},f=E(u,["name"]);return f!=null&&M(a,["_url","file"],mv(f)),a}function Xw(u){const a={},f=E(u,["sdkHttpResponse"]);return f!=null&&M(a,["sdkHttpResponse"],f),a}function Jw(u){const a={},f=E(u,["name"]);return f!=null&&M(a,["_url","file"],mv(f)),a}function Ww(u){const a={},f=E(u,["uris"]);return f!=null&&M(a,["uris"],f),a}function Kw(u,a){const f={},y=E(u,["pageSize"]);a!==void 0&&y!=null&&M(a,["_query","pageSize"],y);const T=E(u,["pageToken"]);return a!==void 0&&T!=null&&M(a,["_query","pageToken"],T),f}function Qw(u){const a={},f=E(u,["config"]);return f!=null&&Kw(f,a),a}function eT(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["nextPageToken"]);y!=null&&M(a,["nextPageToken"],y);const T=E(u,["files"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>S)),M(a,["files"],I)}return a}function tT(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["files"]);if(y!=null){let T=y;Array.isArray(T)&&(T=T.map(I=>I)),M(a,["files"],T)}return a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class nT extends Sc{constructor(a){super(),this.apiClient=a,this.list=async(f={})=>new Od(Tc.PAGED_ITEM_FILES,y=>this.listInternal(y),await this.listInternal(f),f)}async upload(a){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(a.file,a.config).then(f=>f)}async download(a){await this.apiClient.downloadFile(a)}async registerFiles(a){throw new Error("registerFiles is only supported in Node.js environments.")}async _registerFiles(a){return this.registerFilesInternal(a)}async listInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Qw(a);return I=Pt("files",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json().then(k=>{const G=k;return G.sdkHttpResponse={headers:F.headers},G})),T.then(F=>{const k=eT(F),G=new i1;return Object.assign(G,k),G})}}async createInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=$w(a);return I=Pt("upload/v1beta/files",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>{const k=jw(F),G=new r1;return Object.assign(G,k),G})}}async get(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Jw(a);return I=Pt("files/{file}",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>F)}}async delete(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Yw(a);return I=Pt("files/{file}",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json().then(k=>{const G=k;return G.sdkHttpResponse={headers:F.headers},G})),T.then(F=>{const k=Xw(F),G=new o1;return Object.assign(G,k),G})}}async registerFilesInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=Ww(a);return I=Pt("files:register",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>{const k=tT(F),G=new s1;return Object.assign(G,k),G})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Og(u){const a={},f=E(u,["data"]);if(f!=null&&M(a,["data"],f),E(u,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const y=E(u,["mimeType"]);return y!=null&&M(a,["mimeType"],y),a}function iT(u){const a={},f=E(u,["parts"]);if(f!=null){let T=f;Array.isArray(T)&&(T=T.map(I=>vT(I))),M(a,["parts"],T)}const y=E(u,["role"]);return y!=null&&M(a,["role"],y),a}function rT(u){const a={};if(E(u,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const f=E(u,["fileUri"]);f!=null&&M(a,["fileUri"],f);const y=E(u,["mimeType"]);return y!=null&&M(a,["mimeType"],y),a}function oT(u){const a={},f=E(u,["id"]);f!=null&&M(a,["id"],f);const y=E(u,["args"]);y!=null&&M(a,["args"],y);const T=E(u,["name"]);if(T!=null&&M(a,["name"],T),E(u,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(E(u,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return a}function sT(u){const a={},f=E(u,["description"]);f!=null&&M(a,["description"],f);const y=E(u,["name"]);y!=null&&M(a,["name"],y);const T=E(u,["parameters"]);T!=null&&M(a,["parameters"],T);const I=E(u,["parametersJsonSchema"]);I!=null&&M(a,["parametersJsonSchema"],I);const S=E(u,["response"]);S!=null&&M(a,["response"],S);const c=E(u,["responseJsonSchema"]);if(c!=null&&M(a,["responseJsonSchema"],c),E(u,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return a}function aT(u){const a={},f=E(u,["modelSelectionConfig"]);f!=null&&M(a,["modelConfig"],f);const y=E(u,["responseJsonSchema"]);y!=null&&M(a,["responseJsonSchema"],y);const T=E(u,["audioTimestamp"]);T!=null&&M(a,["audioTimestamp"],T);const I=E(u,["candidateCount"]);I!=null&&M(a,["candidateCount"],I);const S=E(u,["enableAffectiveDialog"]);S!=null&&M(a,["enableAffectiveDialog"],S);const c=E(u,["frequencyPenalty"]);c!=null&&M(a,["frequencyPenalty"],c);const F=E(u,["logprobs"]);F!=null&&M(a,["logprobs"],F);const k=E(u,["maxOutputTokens"]);k!=null&&M(a,["maxOutputTokens"],k);const G=E(u,["mediaResolution"]);G!=null&&M(a,["mediaResolution"],G);const K=E(u,["presencePenalty"]);K!=null&&M(a,["presencePenalty"],K);const ee=E(u,["responseLogprobs"]);ee!=null&&M(a,["responseLogprobs"],ee);const ye=E(u,["responseMimeType"]);ye!=null&&M(a,["responseMimeType"],ye);const Le=E(u,["responseModalities"]);Le!=null&&M(a,["responseModalities"],Le);const Ne=E(u,["responseSchema"]);Ne!=null&&M(a,["responseSchema"],Ne);const se=E(u,["routingConfig"]);se!=null&&M(a,["routingConfig"],se);const Ye=E(u,["seed"]);Ye!=null&&M(a,["seed"],Ye);const st=E(u,["speechConfig"]);st!=null&&M(a,["speechConfig"],st);const We=E(u,["stopSequences"]);We!=null&&M(a,["stopSequences"],We);const gt=E(u,["temperature"]);gt!=null&&M(a,["temperature"],gt);const nt=E(u,["thinkingConfig"]);nt!=null&&M(a,["thinkingConfig"],nt);const zt=E(u,["topK"]);zt!=null&&M(a,["topK"],zt);const _t=E(u,["topP"]);if(_t!=null&&M(a,["topP"],_t),E(u,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return a}function lT(u){const a={};if(E(u,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const f=E(u,["enableWidget"]);return f!=null&&M(a,["enableWidget"],f),a}function uT(u){const a={};if(E(u,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(E(u,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const f=E(u,["timeRangeFilter"]);return f!=null&&M(a,["timeRangeFilter"],f),a}function cT(u,a){const f={},y=E(u,["generationConfig"]);a!==void 0&&y!=null&&M(a,["setup","generationConfig"],y);const T=E(u,["responseModalities"]);a!==void 0&&T!=null&&M(a,["setup","generationConfig","responseModalities"],T);const I=E(u,["temperature"]);a!==void 0&&I!=null&&M(a,["setup","generationConfig","temperature"],I);const S=E(u,["topP"]);a!==void 0&&S!=null&&M(a,["setup","generationConfig","topP"],S);const c=E(u,["topK"]);a!==void 0&&c!=null&&M(a,["setup","generationConfig","topK"],c);const F=E(u,["maxOutputTokens"]);a!==void 0&&F!=null&&M(a,["setup","generationConfig","maxOutputTokens"],F);const k=E(u,["mediaResolution"]);a!==void 0&&k!=null&&M(a,["setup","generationConfig","mediaResolution"],k);const G=E(u,["seed"]);a!==void 0&&G!=null&&M(a,["setup","generationConfig","seed"],G);const K=E(u,["speechConfig"]);a!==void 0&&K!=null&&M(a,["setup","generationConfig","speechConfig"],X_(K));const ee=E(u,["thinkingConfig"]);a!==void 0&&ee!=null&&M(a,["setup","generationConfig","thinkingConfig"],ee);const ye=E(u,["enableAffectiveDialog"]);a!==void 0&&ye!=null&&M(a,["setup","generationConfig","enableAffectiveDialog"],ye);const Le=E(u,["systemInstruction"]);a!==void 0&&Le!=null&&M(a,["setup","systemInstruction"],iT(qo(Le)));const Ne=E(u,["tools"]);if(a!==void 0&&Ne!=null){let zt=pp(Ne);Array.isArray(zt)&&(zt=zt.map(_t=>bT(fp(_t)))),M(a,["setup","tools"],zt)}const se=E(u,["sessionResumption"]);a!==void 0&&se!=null&&M(a,["setup","sessionResumption"],xT(se));const Ye=E(u,["inputAudioTranscription"]);a!==void 0&&Ye!=null&&M(a,["setup","inputAudioTranscription"],Ye);const st=E(u,["outputAudioTranscription"]);a!==void 0&&st!=null&&M(a,["setup","outputAudioTranscription"],st);const We=E(u,["realtimeInputConfig"]);a!==void 0&&We!=null&&M(a,["setup","realtimeInputConfig"],We);const gt=E(u,["contextWindowCompression"]);a!==void 0&&gt!=null&&M(a,["setup","contextWindowCompression"],gt);const nt=E(u,["proactivity"]);if(a!==void 0&&nt!=null&&M(a,["setup","proactivity"],nt),E(u,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return f}function hT(u,a){const f={},y=E(u,["generationConfig"]);a!==void 0&&y!=null&&M(a,["setup","generationConfig"],aT(y));const T=E(u,["responseModalities"]);a!==void 0&&T!=null&&M(a,["setup","generationConfig","responseModalities"],T);const I=E(u,["temperature"]);a!==void 0&&I!=null&&M(a,["setup","generationConfig","temperature"],I);const S=E(u,["topP"]);a!==void 0&&S!=null&&M(a,["setup","generationConfig","topP"],S);const c=E(u,["topK"]);a!==void 0&&c!=null&&M(a,["setup","generationConfig","topK"],c);const F=E(u,["maxOutputTokens"]);a!==void 0&&F!=null&&M(a,["setup","generationConfig","maxOutputTokens"],F);const k=E(u,["mediaResolution"]);a!==void 0&&k!=null&&M(a,["setup","generationConfig","mediaResolution"],k);const G=E(u,["seed"]);a!==void 0&&G!=null&&M(a,["setup","generationConfig","seed"],G);const K=E(u,["speechConfig"]);a!==void 0&&K!=null&&M(a,["setup","generationConfig","speechConfig"],X_(K));const ee=E(u,["thinkingConfig"]);a!==void 0&&ee!=null&&M(a,["setup","generationConfig","thinkingConfig"],ee);const ye=E(u,["enableAffectiveDialog"]);a!==void 0&&ye!=null&&M(a,["setup","generationConfig","enableAffectiveDialog"],ye);const Le=E(u,["systemInstruction"]);a!==void 0&&Le!=null&&M(a,["setup","systemInstruction"],qo(Le));const Ne=E(u,["tools"]);if(a!==void 0&&Ne!=null){let _t=pp(Ne);Array.isArray(_t)&&(_t=_t.map(Ut=>wT(fp(Ut)))),M(a,["setup","tools"],_t)}const se=E(u,["sessionResumption"]);a!==void 0&&se!=null&&M(a,["setup","sessionResumption"],se);const Ye=E(u,["inputAudioTranscription"]);a!==void 0&&Ye!=null&&M(a,["setup","inputAudioTranscription"],Ye);const st=E(u,["outputAudioTranscription"]);a!==void 0&&st!=null&&M(a,["setup","outputAudioTranscription"],st);const We=E(u,["realtimeInputConfig"]);a!==void 0&&We!=null&&M(a,["setup","realtimeInputConfig"],We);const gt=E(u,["contextWindowCompression"]);a!==void 0&&gt!=null&&M(a,["setup","contextWindowCompression"],gt);const nt=E(u,["proactivity"]);a!==void 0&&nt!=null&&M(a,["setup","proactivity"],nt);const zt=E(u,["explicitVadSignal"]);return a!==void 0&&zt!=null&&M(a,["setup","explicitVadSignal"],zt),f}function dT(u,a){const f={},y=E(a,["model"]);y!=null&&M(f,["setup","model"],ni(u,y));const T=E(a,["config"]);return T!=null&&M(f,["config"],cT(T,f)),f}function fT(u,a){const f={},y=E(a,["model"]);y!=null&&M(f,["setup","model"],ni(u,y));const T=E(a,["config"]);return T!=null&&M(f,["config"],hT(T,f)),f}function pT(u){const a={},f=E(u,["musicGenerationConfig"]);return f!=null&&M(a,["musicGenerationConfig"],f),a}function mT(u){const a={},f=E(u,["weightedPrompts"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(T=>T)),M(a,["weightedPrompts"],y)}return a}function gT(u){const a={},f=E(u,["media"]);if(f!=null){let k=cv(f);Array.isArray(k)&&(k=k.map(G=>Og(G))),M(a,["mediaChunks"],k)}const y=E(u,["audio"]);y!=null&&M(a,["audio"],Og(dv(y)));const T=E(u,["audioStreamEnd"]);T!=null&&M(a,["audioStreamEnd"],T);const I=E(u,["video"]);I!=null&&M(a,["video"],Og(hv(I)));const S=E(u,["text"]);S!=null&&M(a,["text"],S);const c=E(u,["activityStart"]);c!=null&&M(a,["activityStart"],c);const F=E(u,["activityEnd"]);return F!=null&&M(a,["activityEnd"],F),a}function _T(u){const a={},f=E(u,["media"]);if(f!=null){let k=cv(f);Array.isArray(k)&&(k=k.map(G=>G)),M(a,["mediaChunks"],k)}const y=E(u,["audio"]);y!=null&&M(a,["audio"],dv(y));const T=E(u,["audioStreamEnd"]);T!=null&&M(a,["audioStreamEnd"],T);const I=E(u,["video"]);I!=null&&M(a,["video"],hv(I));const S=E(u,["text"]);S!=null&&M(a,["text"],S);const c=E(u,["activityStart"]);c!=null&&M(a,["activityStart"],c);const F=E(u,["activityEnd"]);return F!=null&&M(a,["activityEnd"],F),a}function yT(u){const a={},f=E(u,["setupComplete"]);f!=null&&M(a,["setupComplete"],f);const y=E(u,["serverContent"]);y!=null&&M(a,["serverContent"],y);const T=E(u,["toolCall"]);T!=null&&M(a,["toolCall"],T);const I=E(u,["toolCallCancellation"]);I!=null&&M(a,["toolCallCancellation"],I);const S=E(u,["usageMetadata"]);S!=null&&M(a,["usageMetadata"],TT(S));const c=E(u,["goAway"]);c!=null&&M(a,["goAway"],c);const F=E(u,["sessionResumptionUpdate"]);F!=null&&M(a,["sessionResumptionUpdate"],F);const k=E(u,["voiceActivityDetectionSignal"]);k!=null&&M(a,["voiceActivityDetectionSignal"],k);const G=E(u,["voiceActivity"]);return G!=null&&M(a,["voiceActivity"],ST(G)),a}function vT(u){const a={},f=E(u,["mediaResolution"]);f!=null&&M(a,["mediaResolution"],f);const y=E(u,["codeExecutionResult"]);y!=null&&M(a,["codeExecutionResult"],y);const T=E(u,["executableCode"]);T!=null&&M(a,["executableCode"],T);const I=E(u,["fileData"]);I!=null&&M(a,["fileData"],rT(I));const S=E(u,["functionCall"]);S!=null&&M(a,["functionCall"],oT(S));const c=E(u,["functionResponse"]);c!=null&&M(a,["functionResponse"],c);const F=E(u,["inlineData"]);F!=null&&M(a,["inlineData"],Og(F));const k=E(u,["text"]);k!=null&&M(a,["text"],k);const G=E(u,["thought"]);G!=null&&M(a,["thought"],G);const K=E(u,["thoughtSignature"]);K!=null&&M(a,["thoughtSignature"],K);const ee=E(u,["videoMetadata"]);return ee!=null&&M(a,["videoMetadata"],ee),a}function xT(u){const a={},f=E(u,["handle"]);if(f!=null&&M(a,["handle"],f),E(u,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return a}function bT(u){const a={};if(E(u,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const f=E(u,["computerUse"]);f!=null&&M(a,["computerUse"],f);const y=E(u,["fileSearch"]);y!=null&&M(a,["fileSearch"],y);const T=E(u,["codeExecution"]);if(T!=null&&M(a,["codeExecution"],T),E(u,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const I=E(u,["functionDeclarations"]);if(I!=null){let G=I;Array.isArray(G)&&(G=G.map(K=>K)),M(a,["functionDeclarations"],G)}const S=E(u,["googleMaps"]);S!=null&&M(a,["googleMaps"],lT(S));const c=E(u,["googleSearch"]);c!=null&&M(a,["googleSearch"],uT(c));const F=E(u,["googleSearchRetrieval"]);F!=null&&M(a,["googleSearchRetrieval"],F);const k=E(u,["urlContext"]);return k!=null&&M(a,["urlContext"],k),a}function wT(u){const a={},f=E(u,["retrieval"]);f!=null&&M(a,["retrieval"],f);const y=E(u,["computerUse"]);if(y!=null&&M(a,["computerUse"],y),E(u,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const T=E(u,["codeExecution"]);T!=null&&M(a,["codeExecution"],T);const I=E(u,["enterpriseWebSearch"]);I!=null&&M(a,["enterpriseWebSearch"],I);const S=E(u,["functionDeclarations"]);if(S!=null){let K=S;Array.isArray(K)&&(K=K.map(ee=>sT(ee))),M(a,["functionDeclarations"],K)}const c=E(u,["googleMaps"]);c!=null&&M(a,["googleMaps"],c);const F=E(u,["googleSearch"]);F!=null&&M(a,["googleSearch"],F);const k=E(u,["googleSearchRetrieval"]);k!=null&&M(a,["googleSearchRetrieval"],k);const G=E(u,["urlContext"]);return G!=null&&M(a,["urlContext"],G),a}function TT(u){const a={},f=E(u,["promptTokenCount"]);f!=null&&M(a,["promptTokenCount"],f);const y=E(u,["cachedContentTokenCount"]);y!=null&&M(a,["cachedContentTokenCount"],y);const T=E(u,["candidatesTokenCount"]);T!=null&&M(a,["responseTokenCount"],T);const I=E(u,["toolUsePromptTokenCount"]);I!=null&&M(a,["toolUsePromptTokenCount"],I);const S=E(u,["thoughtsTokenCount"]);S!=null&&M(a,["thoughtsTokenCount"],S);const c=E(u,["totalTokenCount"]);c!=null&&M(a,["totalTokenCount"],c);const F=E(u,["promptTokensDetails"]);if(F!=null){let ye=F;Array.isArray(ye)&&(ye=ye.map(Le=>Le)),M(a,["promptTokensDetails"],ye)}const k=E(u,["cacheTokensDetails"]);if(k!=null){let ye=k;Array.isArray(ye)&&(ye=ye.map(Le=>Le)),M(a,["cacheTokensDetails"],ye)}const G=E(u,["candidatesTokensDetails"]);if(G!=null){let ye=G;Array.isArray(ye)&&(ye=ye.map(Le=>Le)),M(a,["responseTokensDetails"],ye)}const K=E(u,["toolUsePromptTokensDetails"]);if(K!=null){let ye=K;Array.isArray(ye)&&(ye=ye.map(Le=>Le)),M(a,["toolUsePromptTokensDetails"],ye)}const ee=E(u,["trafficType"]);return ee!=null&&M(a,["trafficType"],ee),a}function ST(u){const a={},f=E(u,["type"]);return f!=null&&M(a,["voiceActivityType"],f),a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ET(u,a){const f={},y=E(u,["data"]);if(y!=null&&M(f,["data"],y),E(u,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const T=E(u,["mimeType"]);return T!=null&&M(f,["mimeType"],T),f}function CT(u,a){const f={},y=E(u,["content"]);y!=null&&M(f,["content"],y);const T=E(u,["citationMetadata"]);T!=null&&M(f,["citationMetadata"],AT(T));const I=E(u,["tokenCount"]);I!=null&&M(f,["tokenCount"],I);const S=E(u,["finishReason"]);S!=null&&M(f,["finishReason"],S);const c=E(u,["avgLogprobs"]);c!=null&&M(f,["avgLogprobs"],c);const F=E(u,["groundingMetadata"]);F!=null&&M(f,["groundingMetadata"],F);const k=E(u,["index"]);k!=null&&M(f,["index"],k);const G=E(u,["logprobsResult"]);G!=null&&M(f,["logprobsResult"],G);const K=E(u,["safetyRatings"]);if(K!=null){let ye=K;Array.isArray(ye)&&(ye=ye.map(Le=>Le)),M(f,["safetyRatings"],ye)}const ee=E(u,["urlContextMetadata"]);return ee!=null&&M(f,["urlContextMetadata"],ee),f}function AT(u,a){const f={},y=E(u,["citationSources"]);if(y!=null){let T=y;Array.isArray(T)&&(T=T.map(I=>I)),M(f,["citations"],T)}return f}function MT(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["contents"]);if(I!=null){let S=Ua(I);Array.isArray(S)&&(S=S.map(c=>c)),M(y,["contents"],S)}return y}function IT(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["tokensInfo"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>S)),M(f,["tokensInfo"],I)}return f}function RT(u,a){const f={},y=E(u,["values"]);y!=null&&M(f,["values"],y);const T=E(u,["statistics"]);return T!=null&&M(f,["statistics"],PT(T)),f}function PT(u,a){const f={},y=E(u,["truncated"]);y!=null&&M(f,["truncated"],y);const T=E(u,["token_count"]);return T!=null&&M(f,["tokenCount"],T),f}function $g(u,a){const f={},y=E(u,["parts"]);if(y!=null){let I=y;Array.isArray(I)&&(I=I.map(S=>US(S))),M(f,["parts"],I)}const T=E(u,["role"]);return T!=null&&M(f,["role"],T),f}function DT(u,a){const f={},y=E(u,["controlType"]);y!=null&&M(f,["controlType"],y);const T=E(u,["enableControlImageComputation"]);return T!=null&&M(f,["computeControl"],T),f}function zT(u,a){const f={};if(E(u,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(E(u,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(E(u,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return f}function LT(u,a,f){const y={},T=E(u,["systemInstruction"]);a!==void 0&&T!=null&&M(a,["systemInstruction"],qo(T));const I=E(u,["tools"]);if(a!==void 0&&I!=null){let c=I;Array.isArray(c)&&(c=c.map(F=>Cv(F))),M(a,["tools"],c)}const S=E(u,["generationConfig"]);return a!==void 0&&S!=null&&M(a,["generationConfig"],ES(S)),y}function NT(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["contents"]);if(I!=null){let c=Ua(I);Array.isArray(c)&&(c=c.map(F=>$g(F))),M(y,["contents"],c)}const S=E(a,["config"]);return S!=null&&zT(S),y}function kT(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["contents"]);if(I!=null){let c=Ua(I);Array.isArray(c)&&(c=c.map(F=>F)),M(y,["contents"],c)}const S=E(a,["config"]);return S!=null&&LT(S,y),y}function FT(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["totalTokens"]);T!=null&&M(f,["totalTokens"],T);const I=E(u,["cachedContentTokenCount"]);return I!=null&&M(f,["cachedContentTokenCount"],I),f}function BT(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["totalTokens"]);return T!=null&&M(f,["totalTokens"],T),f}function OT(u,a,f){const y={},T=E(a,["model"]);return T!=null&&M(y,["_url","name"],ni(u,T)),y}function UT(u,a,f){const y={},T=E(a,["model"]);return T!=null&&M(y,["_url","name"],ni(u,T)),y}function VT(u,a){const f={},y=E(u,["sdkHttpResponse"]);return y!=null&&M(f,["sdkHttpResponse"],y),f}function GT(u,a){const f={},y=E(u,["sdkHttpResponse"]);return y!=null&&M(f,["sdkHttpResponse"],y),f}function qT(u,a,f){const y={},T=E(u,["outputGcsUri"]);a!==void 0&&T!=null&&M(a,["parameters","storageUri"],T);const I=E(u,["negativePrompt"]);a!==void 0&&I!=null&&M(a,["parameters","negativePrompt"],I);const S=E(u,["numberOfImages"]);a!==void 0&&S!=null&&M(a,["parameters","sampleCount"],S);const c=E(u,["aspectRatio"]);a!==void 0&&c!=null&&M(a,["parameters","aspectRatio"],c);const F=E(u,["guidanceScale"]);a!==void 0&&F!=null&&M(a,["parameters","guidanceScale"],F);const k=E(u,["seed"]);a!==void 0&&k!=null&&M(a,["parameters","seed"],k);const G=E(u,["safetyFilterLevel"]);a!==void 0&&G!=null&&M(a,["parameters","safetySetting"],G);const K=E(u,["personGeneration"]);a!==void 0&&K!=null&&M(a,["parameters","personGeneration"],K);const ee=E(u,["includeSafetyAttributes"]);a!==void 0&&ee!=null&&M(a,["parameters","includeSafetyAttributes"],ee);const ye=E(u,["includeRaiReason"]);a!==void 0&&ye!=null&&M(a,["parameters","includeRaiReason"],ye);const Le=E(u,["language"]);a!==void 0&&Le!=null&&M(a,["parameters","language"],Le);const Ne=E(u,["outputMimeType"]);a!==void 0&&Ne!=null&&M(a,["parameters","outputOptions","mimeType"],Ne);const se=E(u,["outputCompressionQuality"]);a!==void 0&&se!=null&&M(a,["parameters","outputOptions","compressionQuality"],se);const Ye=E(u,["addWatermark"]);a!==void 0&&Ye!=null&&M(a,["parameters","addWatermark"],Ye);const st=E(u,["labels"]);a!==void 0&&st!=null&&M(a,["labels"],st);const We=E(u,["editMode"]);a!==void 0&&We!=null&&M(a,["parameters","editMode"],We);const gt=E(u,["baseSteps"]);return a!==void 0&&gt!=null&&M(a,["parameters","editConfig","baseSteps"],gt),y}function HT(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["prompt"]);I!=null&&M(y,["instances[0]","prompt"],I);const S=E(a,["referenceImages"]);if(S!=null){let F=S;Array.isArray(F)&&(F=F.map(k=>$S(k))),M(y,["instances[0]","referenceImages"],F)}const c=E(a,["config"]);return c!=null&&qT(c,y),y}function ZT(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["predictions"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>jg(S))),M(f,["generatedImages"],I)}return f}function $T(u,a,f){const y={},T=E(u,["taskType"]);a!==void 0&&T!=null&&M(a,["requests[]","taskType"],T);const I=E(u,["title"]);a!==void 0&&I!=null&&M(a,["requests[]","title"],I);const S=E(u,["outputDimensionality"]);if(a!==void 0&&S!=null&&M(a,["requests[]","outputDimensionality"],S),E(u,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(E(u,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return y}function jT(u,a,f){const y={},T=E(u,["taskType"]);a!==void 0&&T!=null&&M(a,["instances[]","task_type"],T);const I=E(u,["title"]);a!==void 0&&I!=null&&M(a,["instances[]","title"],I);const S=E(u,["outputDimensionality"]);a!==void 0&&S!=null&&M(a,["parameters","outputDimensionality"],S);const c=E(u,["mimeType"]);a!==void 0&&c!=null&&M(a,["instances[]","mimeType"],c);const F=E(u,["autoTruncate"]);return a!==void 0&&F!=null&&M(a,["parameters","autoTruncate"],F),y}function YT(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["contents"]);if(I!=null){let F=$_(u,I);Array.isArray(F)&&(F=F.map(k=>k)),M(y,["requests[]","content"],F)}const S=E(a,["config"]);S!=null&&$T(S,y);const c=E(a,["model"]);return c!==void 0&&M(y,["requests[]","model"],ni(u,c)),y}function XT(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["contents"]);if(I!=null){let c=$_(u,I);Array.isArray(c)&&(c=c.map(F=>F)),M(y,["instances[]","content"],c)}const S=E(a,["config"]);return S!=null&&jT(S,y),y}function JT(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["embeddings"]);if(T!=null){let S=T;Array.isArray(S)&&(S=S.map(c=>c)),M(f,["embeddings"],S)}const I=E(u,["metadata"]);return I!=null&&M(f,["metadata"],I),f}function WT(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["predictions[]","embeddings"]);if(T!=null){let S=T;Array.isArray(S)&&(S=S.map(c=>RT(c))),M(f,["embeddings"],S)}const I=E(u,["metadata"]);return I!=null&&M(f,["metadata"],I),f}function KT(u,a){const f={},y=E(u,["endpoint"]);y!=null&&M(f,["name"],y);const T=E(u,["deployedModelId"]);return T!=null&&M(f,["deployedModelId"],T),f}function QT(u,a){const f={};if(E(u,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const y=E(u,["fileUri"]);y!=null&&M(f,["fileUri"],y);const T=E(u,["mimeType"]);return T!=null&&M(f,["mimeType"],T),f}function eS(u,a){const f={},y=E(u,["id"]);y!=null&&M(f,["id"],y);const T=E(u,["args"]);T!=null&&M(f,["args"],T);const I=E(u,["name"]);if(I!=null&&M(f,["name"],I),E(u,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(E(u,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return f}function tS(u,a){const f={},y=E(u,["allowedFunctionNames"]);y!=null&&M(f,["allowedFunctionNames"],y);const T=E(u,["mode"]);if(T!=null&&M(f,["mode"],T),E(u,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return f}function nS(u,a){const f={},y=E(u,["description"]);y!=null&&M(f,["description"],y);const T=E(u,["name"]);T!=null&&M(f,["name"],T);const I=E(u,["parameters"]);I!=null&&M(f,["parameters"],I);const S=E(u,["parametersJsonSchema"]);S!=null&&M(f,["parametersJsonSchema"],S);const c=E(u,["response"]);c!=null&&M(f,["response"],c);const F=E(u,["responseJsonSchema"]);if(F!=null&&M(f,["responseJsonSchema"],F),E(u,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return f}function iS(u,a,f,y){const T={},I=E(a,["systemInstruction"]);f!==void 0&&I!=null&&M(f,["systemInstruction"],$g(qo(I)));const S=E(a,["temperature"]);S!=null&&M(T,["temperature"],S);const c=E(a,["topP"]);c!=null&&M(T,["topP"],c);const F=E(a,["topK"]);F!=null&&M(T,["topK"],F);const k=E(a,["candidateCount"]);k!=null&&M(T,["candidateCount"],k);const G=E(a,["maxOutputTokens"]);G!=null&&M(T,["maxOutputTokens"],G);const K=E(a,["stopSequences"]);K!=null&&M(T,["stopSequences"],K);const ee=E(a,["responseLogprobs"]);ee!=null&&M(T,["responseLogprobs"],ee);const ye=E(a,["logprobs"]);ye!=null&&M(T,["logprobs"],ye);const Le=E(a,["presencePenalty"]);Le!=null&&M(T,["presencePenalty"],Le);const Ne=E(a,["frequencyPenalty"]);Ne!=null&&M(T,["frequencyPenalty"],Ne);const se=E(a,["seed"]);se!=null&&M(T,["seed"],se);const Ye=E(a,["responseMimeType"]);Ye!=null&&M(T,["responseMimeType"],Ye);const st=E(a,["responseSchema"]);st!=null&&M(T,["responseSchema"],j_(st));const We=E(a,["responseJsonSchema"]);if(We!=null&&M(T,["responseJsonSchema"],We),E(a,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(E(a,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const gt=E(a,["safetySettings"]);if(f!==void 0&&gt!=null){let kn=gt;Array.isArray(kn)&&(kn=kn.map(si=>jS(si))),M(f,["safetySettings"],kn)}const nt=E(a,["tools"]);if(f!==void 0&&nt!=null){let kn=pp(nt);Array.isArray(kn)&&(kn=kn.map(si=>eE(fp(si)))),M(f,["tools"],kn)}const zt=E(a,["toolConfig"]);if(f!==void 0&&zt!=null&&M(f,["toolConfig"],QS(zt)),E(a,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const _t=E(a,["cachedContent"]);f!==void 0&&_t!=null&&M(f,["cachedContent"],Ec(u,_t));const Ut=E(a,["responseModalities"]);Ut!=null&&M(T,["responseModalities"],Ut);const At=E(a,["mediaResolution"]);At!=null&&M(T,["mediaResolution"],At);const Xt=E(a,["speechConfig"]);if(Xt!=null&&M(T,["speechConfig"],Y_(Xt)),E(a,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const tn=E(a,["thinkingConfig"]);tn!=null&&M(T,["thinkingConfig"],tn);const an=E(a,["imageConfig"]);an!=null&&M(T,["imageConfig"],RS(an));const An=E(a,["enableEnhancedCivicAnswers"]);if(An!=null&&M(T,["enableEnhancedCivicAnswers"],An),E(a,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return T}function rS(u,a,f,y){const T={},I=E(a,["systemInstruction"]);f!==void 0&&I!=null&&M(f,["systemInstruction"],qo(I));const S=E(a,["temperature"]);S!=null&&M(T,["temperature"],S);const c=E(a,["topP"]);c!=null&&M(T,["topP"],c);const F=E(a,["topK"]);F!=null&&M(T,["topK"],F);const k=E(a,["candidateCount"]);k!=null&&M(T,["candidateCount"],k);const G=E(a,["maxOutputTokens"]);G!=null&&M(T,["maxOutputTokens"],G);const K=E(a,["stopSequences"]);K!=null&&M(T,["stopSequences"],K);const ee=E(a,["responseLogprobs"]);ee!=null&&M(T,["responseLogprobs"],ee);const ye=E(a,["logprobs"]);ye!=null&&M(T,["logprobs"],ye);const Le=E(a,["presencePenalty"]);Le!=null&&M(T,["presencePenalty"],Le);const Ne=E(a,["frequencyPenalty"]);Ne!=null&&M(T,["frequencyPenalty"],Ne);const se=E(a,["seed"]);se!=null&&M(T,["seed"],se);const Ye=E(a,["responseMimeType"]);Ye!=null&&M(T,["responseMimeType"],Ye);const st=E(a,["responseSchema"]);st!=null&&M(T,["responseSchema"],j_(st));const We=E(a,["responseJsonSchema"]);We!=null&&M(T,["responseJsonSchema"],We);const gt=E(a,["routingConfig"]);gt!=null&&M(T,["routingConfig"],gt);const nt=E(a,["modelSelectionConfig"]);nt!=null&&M(T,["modelConfig"],nt);const zt=E(a,["safetySettings"]);if(f!==void 0&&zt!=null){let Dt=zt;Array.isArray(Dt)&&(Dt=Dt.map(Lt=>Lt)),M(f,["safetySettings"],Dt)}const _t=E(a,["tools"]);if(f!==void 0&&_t!=null){let Dt=pp(_t);Array.isArray(Dt)&&(Dt=Dt.map(Lt=>Cv(fp(Lt)))),M(f,["tools"],Dt)}const Ut=E(a,["toolConfig"]);f!==void 0&&Ut!=null&&M(f,["toolConfig"],Ut);const At=E(a,["labels"]);f!==void 0&&At!=null&&M(f,["labels"],At);const Xt=E(a,["cachedContent"]);f!==void 0&&Xt!=null&&M(f,["cachedContent"],Ec(u,Xt));const tn=E(a,["responseModalities"]);tn!=null&&M(T,["responseModalities"],tn);const an=E(a,["mediaResolution"]);an!=null&&M(T,["mediaResolution"],an);const An=E(a,["speechConfig"]);An!=null&&M(T,["speechConfig"],Y_(An));const kn=E(a,["audioTimestamp"]);kn!=null&&M(T,["audioTimestamp"],kn);const si=E(a,["thinkingConfig"]);si!=null&&M(T,["thinkingConfig"],si);const Qe=E(a,["imageConfig"]);if(Qe!=null&&M(T,["imageConfig"],PS(Qe)),E(a,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");const ft=E(a,["modelArmorConfig"]);return f!==void 0&&ft!=null&&M(f,["modelArmorConfig"],ft),T}function G0(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["contents"]);if(I!=null){let c=Ua(I);Array.isArray(c)&&(c=c.map(F=>$g(F))),M(y,["contents"],c)}const S=E(a,["config"]);return S!=null&&M(y,["generationConfig"],iS(u,S,y)),y}function q0(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["contents"]);if(I!=null){let c=Ua(I);Array.isArray(c)&&(c=c.map(F=>F)),M(y,["contents"],c)}const S=E(a,["config"]);return S!=null&&M(y,["generationConfig"],rS(u,S,y)),y}function H0(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["candidates"]);if(T!=null){let k=T;Array.isArray(k)&&(k=k.map(G=>CT(G))),M(f,["candidates"],k)}const I=E(u,["modelVersion"]);I!=null&&M(f,["modelVersion"],I);const S=E(u,["promptFeedback"]);S!=null&&M(f,["promptFeedback"],S);const c=E(u,["responseId"]);c!=null&&M(f,["responseId"],c);const F=E(u,["usageMetadata"]);return F!=null&&M(f,["usageMetadata"],F),f}function Z0(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["candidates"]);if(T!=null){let G=T;Array.isArray(G)&&(G=G.map(K=>K)),M(f,["candidates"],G)}const I=E(u,["createTime"]);I!=null&&M(f,["createTime"],I);const S=E(u,["modelVersion"]);S!=null&&M(f,["modelVersion"],S);const c=E(u,["promptFeedback"]);c!=null&&M(f,["promptFeedback"],c);const F=E(u,["responseId"]);F!=null&&M(f,["responseId"],F);const k=E(u,["usageMetadata"]);return k!=null&&M(f,["usageMetadata"],k),f}function oS(u,a,f){const y={};if(E(u,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(E(u,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const T=E(u,["numberOfImages"]);a!==void 0&&T!=null&&M(a,["parameters","sampleCount"],T);const I=E(u,["aspectRatio"]);a!==void 0&&I!=null&&M(a,["parameters","aspectRatio"],I);const S=E(u,["guidanceScale"]);if(a!==void 0&&S!=null&&M(a,["parameters","guidanceScale"],S),E(u,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=E(u,["safetyFilterLevel"]);a!==void 0&&c!=null&&M(a,["parameters","safetySetting"],c);const F=E(u,["personGeneration"]);a!==void 0&&F!=null&&M(a,["parameters","personGeneration"],F);const k=E(u,["includeSafetyAttributes"]);a!==void 0&&k!=null&&M(a,["parameters","includeSafetyAttributes"],k);const G=E(u,["includeRaiReason"]);a!==void 0&&G!=null&&M(a,["parameters","includeRaiReason"],G);const K=E(u,["language"]);a!==void 0&&K!=null&&M(a,["parameters","language"],K);const ee=E(u,["outputMimeType"]);a!==void 0&&ee!=null&&M(a,["parameters","outputOptions","mimeType"],ee);const ye=E(u,["outputCompressionQuality"]);if(a!==void 0&&ye!=null&&M(a,["parameters","outputOptions","compressionQuality"],ye),E(u,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(E(u,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const Le=E(u,["imageSize"]);if(a!==void 0&&Le!=null&&M(a,["parameters","sampleImageSize"],Le),E(u,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return y}function sS(u,a,f){const y={},T=E(u,["outputGcsUri"]);a!==void 0&&T!=null&&M(a,["parameters","storageUri"],T);const I=E(u,["negativePrompt"]);a!==void 0&&I!=null&&M(a,["parameters","negativePrompt"],I);const S=E(u,["numberOfImages"]);a!==void 0&&S!=null&&M(a,["parameters","sampleCount"],S);const c=E(u,["aspectRatio"]);a!==void 0&&c!=null&&M(a,["parameters","aspectRatio"],c);const F=E(u,["guidanceScale"]);a!==void 0&&F!=null&&M(a,["parameters","guidanceScale"],F);const k=E(u,["seed"]);a!==void 0&&k!=null&&M(a,["parameters","seed"],k);const G=E(u,["safetyFilterLevel"]);a!==void 0&&G!=null&&M(a,["parameters","safetySetting"],G);const K=E(u,["personGeneration"]);a!==void 0&&K!=null&&M(a,["parameters","personGeneration"],K);const ee=E(u,["includeSafetyAttributes"]);a!==void 0&&ee!=null&&M(a,["parameters","includeSafetyAttributes"],ee);const ye=E(u,["includeRaiReason"]);a!==void 0&&ye!=null&&M(a,["parameters","includeRaiReason"],ye);const Le=E(u,["language"]);a!==void 0&&Le!=null&&M(a,["parameters","language"],Le);const Ne=E(u,["outputMimeType"]);a!==void 0&&Ne!=null&&M(a,["parameters","outputOptions","mimeType"],Ne);const se=E(u,["outputCompressionQuality"]);a!==void 0&&se!=null&&M(a,["parameters","outputOptions","compressionQuality"],se);const Ye=E(u,["addWatermark"]);a!==void 0&&Ye!=null&&M(a,["parameters","addWatermark"],Ye);const st=E(u,["labels"]);a!==void 0&&st!=null&&M(a,["labels"],st);const We=E(u,["imageSize"]);a!==void 0&&We!=null&&M(a,["parameters","sampleImageSize"],We);const gt=E(u,["enhancePrompt"]);return a!==void 0&&gt!=null&&M(a,["parameters","enhancePrompt"],gt),y}function aS(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["prompt"]);I!=null&&M(y,["instances[0]","prompt"],I);const S=E(a,["config"]);return S!=null&&oS(S,y),y}function lS(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["prompt"]);I!=null&&M(y,["instances[0]","prompt"],I);const S=E(a,["config"]);return S!=null&&sS(S,y),y}function uS(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["predictions"]);if(T!=null){let S=T;Array.isArray(S)&&(S=S.map(c=>bS(c))),M(f,["generatedImages"],S)}const I=E(u,["positivePromptSafetyAttributes"]);return I!=null&&M(f,["positivePromptSafetyAttributes"],Sv(I)),f}function cS(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["predictions"]);if(T!=null){let S=T;Array.isArray(S)&&(S=S.map(c=>jg(c))),M(f,["generatedImages"],S)}const I=E(u,["positivePromptSafetyAttributes"]);return I!=null&&M(f,["positivePromptSafetyAttributes"],Ev(I)),f}function hS(u,a,f){const y={},T=E(u,["numberOfVideos"]);if(a!==void 0&&T!=null&&M(a,["parameters","sampleCount"],T),E(u,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(E(u,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const I=E(u,["durationSeconds"]);if(a!==void 0&&I!=null&&M(a,["parameters","durationSeconds"],I),E(u,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const S=E(u,["aspectRatio"]);a!==void 0&&S!=null&&M(a,["parameters","aspectRatio"],S);const c=E(u,["resolution"]);a!==void 0&&c!=null&&M(a,["parameters","resolution"],c);const F=E(u,["personGeneration"]);if(a!==void 0&&F!=null&&M(a,["parameters","personGeneration"],F),E(u,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const k=E(u,["negativePrompt"]);a!==void 0&&k!=null&&M(a,["parameters","negativePrompt"],k);const G=E(u,["enhancePrompt"]);if(a!==void 0&&G!=null&&M(a,["parameters","enhancePrompt"],G),E(u,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const K=E(u,["lastFrame"]);a!==void 0&&K!=null&&M(a,["instances[0]","lastFrame"],Yg(K));const ee=E(u,["referenceImages"]);if(a!==void 0&&ee!=null){let ye=ee;Array.isArray(ye)&&(ye=ye.map(Le=>fE(Le))),M(a,["instances[0]","referenceImages"],ye)}if(E(u,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(E(u,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return y}function dS(u,a,f){const y={},T=E(u,["numberOfVideos"]);a!==void 0&&T!=null&&M(a,["parameters","sampleCount"],T);const I=E(u,["outputGcsUri"]);a!==void 0&&I!=null&&M(a,["parameters","storageUri"],I);const S=E(u,["fps"]);a!==void 0&&S!=null&&M(a,["parameters","fps"],S);const c=E(u,["durationSeconds"]);a!==void 0&&c!=null&&M(a,["parameters","durationSeconds"],c);const F=E(u,["seed"]);a!==void 0&&F!=null&&M(a,["parameters","seed"],F);const k=E(u,["aspectRatio"]);a!==void 0&&k!=null&&M(a,["parameters","aspectRatio"],k);const G=E(u,["resolution"]);a!==void 0&&G!=null&&M(a,["parameters","resolution"],G);const K=E(u,["personGeneration"]);a!==void 0&&K!=null&&M(a,["parameters","personGeneration"],K);const ee=E(u,["pubsubTopic"]);a!==void 0&&ee!=null&&M(a,["parameters","pubsubTopic"],ee);const ye=E(u,["negativePrompt"]);a!==void 0&&ye!=null&&M(a,["parameters","negativePrompt"],ye);const Le=E(u,["enhancePrompt"]);a!==void 0&&Le!=null&&M(a,["parameters","enhancePrompt"],Le);const Ne=E(u,["generateAudio"]);a!==void 0&&Ne!=null&&M(a,["parameters","generateAudio"],Ne);const se=E(u,["lastFrame"]);a!==void 0&&se!=null&&M(a,["instances[0]","lastFrame"],zl(se));const Ye=E(u,["referenceImages"]);if(a!==void 0&&Ye!=null){let gt=Ye;Array.isArray(gt)&&(gt=gt.map(nt=>pE(nt))),M(a,["instances[0]","referenceImages"],gt)}const st=E(u,["mask"]);a!==void 0&&st!=null&&M(a,["instances[0]","mask"],dE(st));const We=E(u,["compressionQuality"]);return a!==void 0&&We!=null&&M(a,["parameters","compressionQuality"],We),y}function fS(u,a){const f={},y=E(u,["name"]);y!=null&&M(f,["name"],y);const T=E(u,["metadata"]);T!=null&&M(f,["metadata"],T);const I=E(u,["done"]);I!=null&&M(f,["done"],I);const S=E(u,["error"]);S!=null&&M(f,["error"],S);const c=E(u,["response","generateVideoResponse"]);return c!=null&&M(f,["response"],_S(c)),f}function pS(u,a){const f={},y=E(u,["name"]);y!=null&&M(f,["name"],y);const T=E(u,["metadata"]);T!=null&&M(f,["metadata"],T);const I=E(u,["done"]);I!=null&&M(f,["done"],I);const S=E(u,["error"]);S!=null&&M(f,["error"],S);const c=E(u,["response"]);return c!=null&&M(f,["response"],yS(c)),f}function mS(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["prompt"]);I!=null&&M(y,["instances[0]","prompt"],I);const S=E(a,["image"]);S!=null&&M(y,["instances[0]","image"],Yg(S));const c=E(a,["video"]);c!=null&&M(y,["instances[0]","video"],Av(c));const F=E(a,["source"]);F!=null&&vS(F,y);const k=E(a,["config"]);return k!=null&&hS(k,y),y}function gS(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["prompt"]);I!=null&&M(y,["instances[0]","prompt"],I);const S=E(a,["image"]);S!=null&&M(y,["instances[0]","image"],zl(S));const c=E(a,["video"]);c!=null&&M(y,["instances[0]","video"],Mv(c));const F=E(a,["source"]);F!=null&&xS(F,y);const k=E(a,["config"]);return k!=null&&dS(k,y),y}function _S(u,a){const f={},y=E(u,["generatedSamples"]);if(y!=null){let S=y;Array.isArray(S)&&(S=S.map(c=>TS(c))),M(f,["generatedVideos"],S)}const T=E(u,["raiMediaFilteredCount"]);T!=null&&M(f,["raiMediaFilteredCount"],T);const I=E(u,["raiMediaFilteredReasons"]);return I!=null&&M(f,["raiMediaFilteredReasons"],I),f}function yS(u,a){const f={},y=E(u,["videos"]);if(y!=null){let S=y;Array.isArray(S)&&(S=S.map(c=>SS(c))),M(f,["generatedVideos"],S)}const T=E(u,["raiMediaFilteredCount"]);T!=null&&M(f,["raiMediaFilteredCount"],T);const I=E(u,["raiMediaFilteredReasons"]);return I!=null&&M(f,["raiMediaFilteredReasons"],I),f}function vS(u,a,f){const y={},T=E(u,["prompt"]);a!==void 0&&T!=null&&M(a,["instances[0]","prompt"],T);const I=E(u,["image"]);a!==void 0&&I!=null&&M(a,["instances[0]","image"],Yg(I));const S=E(u,["video"]);return a!==void 0&&S!=null&&M(a,["instances[0]","video"],Av(S)),y}function xS(u,a,f){const y={},T=E(u,["prompt"]);a!==void 0&&T!=null&&M(a,["instances[0]","prompt"],T);const I=E(u,["image"]);a!==void 0&&I!=null&&M(a,["instances[0]","image"],zl(I));const S=E(u,["video"]);return a!==void 0&&S!=null&&M(a,["instances[0]","video"],Mv(S)),y}function bS(u,a){const f={},y=E(u,["_self"]);y!=null&&M(f,["image"],DS(y));const T=E(u,["raiFilteredReason"]);T!=null&&M(f,["raiFilteredReason"],T);const I=E(u,["_self"]);return I!=null&&M(f,["safetyAttributes"],Sv(I)),f}function jg(u,a){const f={},y=E(u,["_self"]);y!=null&&M(f,["image"],Tv(y));const T=E(u,["raiFilteredReason"]);T!=null&&M(f,["raiFilteredReason"],T);const I=E(u,["_self"]);I!=null&&M(f,["safetyAttributes"],Ev(I));const S=E(u,["prompt"]);return S!=null&&M(f,["enhancedPrompt"],S),f}function wS(u,a){const f={},y=E(u,["_self"]);y!=null&&M(f,["mask"],Tv(y));const T=E(u,["labels"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>S)),M(f,["labels"],I)}return f}function TS(u,a){const f={},y=E(u,["video"]);return y!=null&&M(f,["video"],cE(y)),f}function SS(u,a){const f={},y=E(u,["_self"]);return y!=null&&M(f,["video"],hE(y)),f}function ES(u,a){const f={},y=E(u,["modelSelectionConfig"]);y!=null&&M(f,["modelConfig"],y);const T=E(u,["responseJsonSchema"]);T!=null&&M(f,["responseJsonSchema"],T);const I=E(u,["audioTimestamp"]);I!=null&&M(f,["audioTimestamp"],I);const S=E(u,["candidateCount"]);S!=null&&M(f,["candidateCount"],S);const c=E(u,["enableAffectiveDialog"]);c!=null&&M(f,["enableAffectiveDialog"],c);const F=E(u,["frequencyPenalty"]);F!=null&&M(f,["frequencyPenalty"],F);const k=E(u,["logprobs"]);k!=null&&M(f,["logprobs"],k);const G=E(u,["maxOutputTokens"]);G!=null&&M(f,["maxOutputTokens"],G);const K=E(u,["mediaResolution"]);K!=null&&M(f,["mediaResolution"],K);const ee=E(u,["presencePenalty"]);ee!=null&&M(f,["presencePenalty"],ee);const ye=E(u,["responseLogprobs"]);ye!=null&&M(f,["responseLogprobs"],ye);const Le=E(u,["responseMimeType"]);Le!=null&&M(f,["responseMimeType"],Le);const Ne=E(u,["responseModalities"]);Ne!=null&&M(f,["responseModalities"],Ne);const se=E(u,["responseSchema"]);se!=null&&M(f,["responseSchema"],se);const Ye=E(u,["routingConfig"]);Ye!=null&&M(f,["routingConfig"],Ye);const st=E(u,["seed"]);st!=null&&M(f,["seed"],st);const We=E(u,["speechConfig"]);We!=null&&M(f,["speechConfig"],We);const gt=E(u,["stopSequences"]);gt!=null&&M(f,["stopSequences"],gt);const nt=E(u,["temperature"]);nt!=null&&M(f,["temperature"],nt);const zt=E(u,["thinkingConfig"]);zt!=null&&M(f,["thinkingConfig"],zt);const _t=E(u,["topK"]);_t!=null&&M(f,["topK"],_t);const Ut=E(u,["topP"]);if(Ut!=null&&M(f,["topP"],Ut),E(u,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return f}function CS(u,a,f){const y={},T=E(a,["model"]);return T!=null&&M(y,["_url","name"],ni(u,T)),y}function AS(u,a,f){const y={},T=E(a,["model"]);return T!=null&&M(y,["_url","name"],ni(u,T)),y}function MS(u,a){const f={};if(E(u,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const y=E(u,["enableWidget"]);return y!=null&&M(f,["enableWidget"],y),f}function IS(u,a){const f={};if(E(u,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(E(u,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const y=E(u,["timeRangeFilter"]);return y!=null&&M(f,["timeRangeFilter"],y),f}function RS(u,a){const f={},y=E(u,["aspectRatio"]);y!=null&&M(f,["aspectRatio"],y);const T=E(u,["imageSize"]);if(T!=null&&M(f,["imageSize"],T),E(u,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(E(u,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(E(u,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return f}function PS(u,a){const f={},y=E(u,["aspectRatio"]);y!=null&&M(f,["aspectRatio"],y);const T=E(u,["imageSize"]);T!=null&&M(f,["imageSize"],T);const I=E(u,["personGeneration"]);I!=null&&M(f,["personGeneration"],I);const S=E(u,["outputMimeType"]);S!=null&&M(f,["imageOutputOptions","mimeType"],S);const c=E(u,["outputCompressionQuality"]);return c!=null&&M(f,["imageOutputOptions","compressionQuality"],c),f}function DS(u,a){const f={},y=E(u,["bytesBase64Encoded"]);y!=null&&M(f,["imageBytes"],Ch(y));const T=E(u,["mimeType"]);return T!=null&&M(f,["mimeType"],T),f}function Tv(u,a){const f={},y=E(u,["gcsUri"]);y!=null&&M(f,["gcsUri"],y);const T=E(u,["bytesBase64Encoded"]);T!=null&&M(f,["imageBytes"],Ch(T));const I=E(u,["mimeType"]);return I!=null&&M(f,["mimeType"],I),f}function Yg(u,a){const f={};if(E(u,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const y=E(u,["imageBytes"]);y!=null&&M(f,["bytesBase64Encoded"],Ch(y));const T=E(u,["mimeType"]);return T!=null&&M(f,["mimeType"],T),f}function zl(u,a){const f={},y=E(u,["gcsUri"]);y!=null&&M(f,["gcsUri"],y);const T=E(u,["imageBytes"]);T!=null&&M(f,["bytesBase64Encoded"],Ch(T));const I=E(u,["mimeType"]);return I!=null&&M(f,["mimeType"],I),f}function zS(u,a,f,y){const T={},I=E(a,["pageSize"]);f!==void 0&&I!=null&&M(f,["_query","pageSize"],I);const S=E(a,["pageToken"]);f!==void 0&&S!=null&&M(f,["_query","pageToken"],S);const c=E(a,["filter"]);f!==void 0&&c!=null&&M(f,["_query","filter"],c);const F=E(a,["queryBase"]);return f!==void 0&&F!=null&&M(f,["_url","models_url"],gv(u,F)),T}function LS(u,a,f,y){const T={},I=E(a,["pageSize"]);f!==void 0&&I!=null&&M(f,["_query","pageSize"],I);const S=E(a,["pageToken"]);f!==void 0&&S!=null&&M(f,["_query","pageToken"],S);const c=E(a,["filter"]);f!==void 0&&c!=null&&M(f,["_query","filter"],c);const F=E(a,["queryBase"]);return f!==void 0&&F!=null&&M(f,["_url","models_url"],gv(u,F)),T}function NS(u,a,f){const y={},T=E(a,["config"]);return T!=null&&zS(u,T,y),y}function kS(u,a,f){const y={},T=E(a,["config"]);return T!=null&&LS(u,T,y),y}function FS(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["nextPageToken"]);T!=null&&M(f,["nextPageToken"],T);const I=E(u,["_self"]);if(I!=null){let S=_v(I);Array.isArray(S)&&(S=S.map(c=>z_(c))),M(f,["models"],S)}return f}function BS(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["nextPageToken"]);T!=null&&M(f,["nextPageToken"],T);const I=E(u,["_self"]);if(I!=null){let S=_v(I);Array.isArray(S)&&(S=S.map(c=>L_(c))),M(f,["models"],S)}return f}function OS(u,a){const f={},y=E(u,["maskMode"]);y!=null&&M(f,["maskMode"],y);const T=E(u,["segmentationClasses"]);T!=null&&M(f,["maskClasses"],T);const I=E(u,["maskDilation"]);return I!=null&&M(f,["dilation"],I),f}function z_(u,a){const f={},y=E(u,["name"]);y!=null&&M(f,["name"],y);const T=E(u,["displayName"]);T!=null&&M(f,["displayName"],T);const I=E(u,["description"]);I!=null&&M(f,["description"],I);const S=E(u,["version"]);S!=null&&M(f,["version"],S);const c=E(u,["_self"]);c!=null&&M(f,["tunedModelInfo"],tE(c));const F=E(u,["inputTokenLimit"]);F!=null&&M(f,["inputTokenLimit"],F);const k=E(u,["outputTokenLimit"]);k!=null&&M(f,["outputTokenLimit"],k);const G=E(u,["supportedGenerationMethods"]);G!=null&&M(f,["supportedActions"],G);const K=E(u,["temperature"]);K!=null&&M(f,["temperature"],K);const ee=E(u,["maxTemperature"]);ee!=null&&M(f,["maxTemperature"],ee);const ye=E(u,["topP"]);ye!=null&&M(f,["topP"],ye);const Le=E(u,["topK"]);Le!=null&&M(f,["topK"],Le);const Ne=E(u,["thinking"]);return Ne!=null&&M(f,["thinking"],Ne),f}function L_(u,a){const f={},y=E(u,["name"]);y!=null&&M(f,["name"],y);const T=E(u,["displayName"]);T!=null&&M(f,["displayName"],T);const I=E(u,["description"]);I!=null&&M(f,["description"],I);const S=E(u,["versionId"]);S!=null&&M(f,["version"],S);const c=E(u,["deployedModels"]);if(c!=null){let ee=c;Array.isArray(ee)&&(ee=ee.map(ye=>KT(ye))),M(f,["endpoints"],ee)}const F=E(u,["labels"]);F!=null&&M(f,["labels"],F);const k=E(u,["_self"]);k!=null&&M(f,["tunedModelInfo"],nE(k));const G=E(u,["defaultCheckpointId"]);G!=null&&M(f,["defaultCheckpointId"],G);const K=E(u,["checkpoints"]);if(K!=null){let ee=K;Array.isArray(ee)&&(ee=ee.map(ye=>ye)),M(f,["checkpoints"],ee)}return f}function US(u,a){const f={},y=E(u,["mediaResolution"]);y!=null&&M(f,["mediaResolution"],y);const T=E(u,["codeExecutionResult"]);T!=null&&M(f,["codeExecutionResult"],T);const I=E(u,["executableCode"]);I!=null&&M(f,["executableCode"],I);const S=E(u,["fileData"]);S!=null&&M(f,["fileData"],QT(S));const c=E(u,["functionCall"]);c!=null&&M(f,["functionCall"],eS(c));const F=E(u,["functionResponse"]);F!=null&&M(f,["functionResponse"],F);const k=E(u,["inlineData"]);k!=null&&M(f,["inlineData"],ET(k));const G=E(u,["text"]);G!=null&&M(f,["text"],G);const K=E(u,["thought"]);K!=null&&M(f,["thought"],K);const ee=E(u,["thoughtSignature"]);ee!=null&&M(f,["thoughtSignature"],ee);const ye=E(u,["videoMetadata"]);return ye!=null&&M(f,["videoMetadata"],ye),f}function VS(u,a){const f={},y=E(u,["productImage"]);return y!=null&&M(f,["image"],zl(y)),f}function GS(u,a,f){const y={},T=E(u,["numberOfImages"]);a!==void 0&&T!=null&&M(a,["parameters","sampleCount"],T);const I=E(u,["baseSteps"]);a!==void 0&&I!=null&&M(a,["parameters","baseSteps"],I);const S=E(u,["outputGcsUri"]);a!==void 0&&S!=null&&M(a,["parameters","storageUri"],S);const c=E(u,["seed"]);a!==void 0&&c!=null&&M(a,["parameters","seed"],c);const F=E(u,["safetyFilterLevel"]);a!==void 0&&F!=null&&M(a,["parameters","safetySetting"],F);const k=E(u,["personGeneration"]);a!==void 0&&k!=null&&M(a,["parameters","personGeneration"],k);const G=E(u,["addWatermark"]);a!==void 0&&G!=null&&M(a,["parameters","addWatermark"],G);const K=E(u,["outputMimeType"]);a!==void 0&&K!=null&&M(a,["parameters","outputOptions","mimeType"],K);const ee=E(u,["outputCompressionQuality"]);a!==void 0&&ee!=null&&M(a,["parameters","outputOptions","compressionQuality"],ee);const ye=E(u,["enhancePrompt"]);a!==void 0&&ye!=null&&M(a,["parameters","enhancePrompt"],ye);const Le=E(u,["labels"]);return a!==void 0&&Le!=null&&M(a,["labels"],Le),y}function qS(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["source"]);I!=null&&ZS(I,y);const S=E(a,["config"]);return S!=null&&GS(S,y),y}function HS(u,a){const f={},y=E(u,["predictions"]);if(y!=null){let T=y;Array.isArray(T)&&(T=T.map(I=>jg(I))),M(f,["generatedImages"],T)}return f}function ZS(u,a,f){const y={},T=E(u,["prompt"]);a!==void 0&&T!=null&&M(a,["instances[0]","prompt"],T);const I=E(u,["personImage"]);a!==void 0&&I!=null&&M(a,["instances[0]","personImage","image"],zl(I));const S=E(u,["productImages"]);if(a!==void 0&&S!=null){let c=S;Array.isArray(c)&&(c=c.map(F=>VS(F))),M(a,["instances[0]","productImages"],c)}return y}function $S(u,a){const f={},y=E(u,["referenceImage"]);y!=null&&M(f,["referenceImage"],zl(y));const T=E(u,["referenceId"]);T!=null&&M(f,["referenceId"],T);const I=E(u,["referenceType"]);I!=null&&M(f,["referenceType"],I);const S=E(u,["maskImageConfig"]);S!=null&&M(f,["maskImageConfig"],OS(S));const c=E(u,["controlImageConfig"]);c!=null&&M(f,["controlImageConfig"],DT(c));const F=E(u,["styleImageConfig"]);F!=null&&M(f,["styleImageConfig"],F);const k=E(u,["subjectImageConfig"]);return k!=null&&M(f,["subjectImageConfig"],k),f}function Sv(u,a){const f={},y=E(u,["safetyAttributes","categories"]);y!=null&&M(f,["categories"],y);const T=E(u,["safetyAttributes","scores"]);T!=null&&M(f,["scores"],T);const I=E(u,["contentType"]);return I!=null&&M(f,["contentType"],I),f}function Ev(u,a){const f={},y=E(u,["safetyAttributes","categories"]);y!=null&&M(f,["categories"],y);const T=E(u,["safetyAttributes","scores"]);T!=null&&M(f,["scores"],T);const I=E(u,["contentType"]);return I!=null&&M(f,["contentType"],I),f}function jS(u,a){const f={},y=E(u,["category"]);if(y!=null&&M(f,["category"],y),E(u,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const T=E(u,["threshold"]);return T!=null&&M(f,["threshold"],T),f}function YS(u,a){const f={},y=E(u,["image"]);return y!=null&&M(f,["image"],zl(y)),f}function XS(u,a,f){const y={},T=E(u,["mode"]);a!==void 0&&T!=null&&M(a,["parameters","mode"],T);const I=E(u,["maxPredictions"]);a!==void 0&&I!=null&&M(a,["parameters","maxPredictions"],I);const S=E(u,["confidenceThreshold"]);a!==void 0&&S!=null&&M(a,["parameters","confidenceThreshold"],S);const c=E(u,["maskDilation"]);a!==void 0&&c!=null&&M(a,["parameters","maskDilation"],c);const F=E(u,["binaryColorThreshold"]);a!==void 0&&F!=null&&M(a,["parameters","binaryColorThreshold"],F);const k=E(u,["labels"]);return a!==void 0&&k!=null&&M(a,["labels"],k),y}function JS(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["source"]);I!=null&&KS(I,y);const S=E(a,["config"]);return S!=null&&XS(S,y),y}function WS(u,a){const f={},y=E(u,["predictions"]);if(y!=null){let T=y;Array.isArray(T)&&(T=T.map(I=>wS(I))),M(f,["generatedMasks"],T)}return f}function KS(u,a,f){const y={},T=E(u,["prompt"]);a!==void 0&&T!=null&&M(a,["instances[0]","prompt"],T);const I=E(u,["image"]);a!==void 0&&I!=null&&M(a,["instances[0]","image"],zl(I));const S=E(u,["scribbleImage"]);return a!==void 0&&S!=null&&M(a,["instances[0]","scribble"],YS(S)),y}function QS(u,a){const f={},y=E(u,["retrievalConfig"]);y!=null&&M(f,["retrievalConfig"],y);const T=E(u,["functionCallingConfig"]);return T!=null&&M(f,["functionCallingConfig"],tS(T)),f}function eE(u,a){const f={};if(E(u,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const y=E(u,["computerUse"]);y!=null&&M(f,["computerUse"],y);const T=E(u,["fileSearch"]);T!=null&&M(f,["fileSearch"],T);const I=E(u,["codeExecution"]);if(I!=null&&M(f,["codeExecution"],I),E(u,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const S=E(u,["functionDeclarations"]);if(S!=null){let K=S;Array.isArray(K)&&(K=K.map(ee=>ee)),M(f,["functionDeclarations"],K)}const c=E(u,["googleMaps"]);c!=null&&M(f,["googleMaps"],MS(c));const F=E(u,["googleSearch"]);F!=null&&M(f,["googleSearch"],IS(F));const k=E(u,["googleSearchRetrieval"]);k!=null&&M(f,["googleSearchRetrieval"],k);const G=E(u,["urlContext"]);return G!=null&&M(f,["urlContext"],G),f}function Cv(u,a){const f={},y=E(u,["retrieval"]);y!=null&&M(f,["retrieval"],y);const T=E(u,["computerUse"]);if(T!=null&&M(f,["computerUse"],T),E(u,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const I=E(u,["codeExecution"]);I!=null&&M(f,["codeExecution"],I);const S=E(u,["enterpriseWebSearch"]);S!=null&&M(f,["enterpriseWebSearch"],S);const c=E(u,["functionDeclarations"]);if(c!=null){let ee=c;Array.isArray(ee)&&(ee=ee.map(ye=>nS(ye))),M(f,["functionDeclarations"],ee)}const F=E(u,["googleMaps"]);F!=null&&M(f,["googleMaps"],F);const k=E(u,["googleSearch"]);k!=null&&M(f,["googleSearch"],k);const G=E(u,["googleSearchRetrieval"]);G!=null&&M(f,["googleSearchRetrieval"],G);const K=E(u,["urlContext"]);return K!=null&&M(f,["urlContext"],K),f}function tE(u,a){const f={},y=E(u,["baseModel"]);y!=null&&M(f,["baseModel"],y);const T=E(u,["createTime"]);T!=null&&M(f,["createTime"],T);const I=E(u,["updateTime"]);return I!=null&&M(f,["updateTime"],I),f}function nE(u,a){const f={},y=E(u,["labels","google-vertex-llm-tuning-base-model-id"]);y!=null&&M(f,["baseModel"],y);const T=E(u,["createTime"]);T!=null&&M(f,["createTime"],T);const I=E(u,["updateTime"]);return I!=null&&M(f,["updateTime"],I),f}function iE(u,a,f){const y={},T=E(u,["displayName"]);a!==void 0&&T!=null&&M(a,["displayName"],T);const I=E(u,["description"]);a!==void 0&&I!=null&&M(a,["description"],I);const S=E(u,["defaultCheckpointId"]);return a!==void 0&&S!=null&&M(a,["defaultCheckpointId"],S),y}function rE(u,a,f){const y={},T=E(u,["displayName"]);a!==void 0&&T!=null&&M(a,["displayName"],T);const I=E(u,["description"]);a!==void 0&&I!=null&&M(a,["description"],I);const S=E(u,["defaultCheckpointId"]);return a!==void 0&&S!=null&&M(a,["defaultCheckpointId"],S),y}function oE(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","name"],ni(u,T));const I=E(a,["config"]);return I!=null&&iE(I,y),y}function sE(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["config"]);return I!=null&&rE(I,y),y}function aE(u,a,f){const y={},T=E(u,["outputGcsUri"]);a!==void 0&&T!=null&&M(a,["parameters","storageUri"],T);const I=E(u,["safetyFilterLevel"]);a!==void 0&&I!=null&&M(a,["parameters","safetySetting"],I);const S=E(u,["personGeneration"]);a!==void 0&&S!=null&&M(a,["parameters","personGeneration"],S);const c=E(u,["includeRaiReason"]);a!==void 0&&c!=null&&M(a,["parameters","includeRaiReason"],c);const F=E(u,["outputMimeType"]);a!==void 0&&F!=null&&M(a,["parameters","outputOptions","mimeType"],F);const k=E(u,["outputCompressionQuality"]);a!==void 0&&k!=null&&M(a,["parameters","outputOptions","compressionQuality"],k);const G=E(u,["enhanceInputImage"]);a!==void 0&&G!=null&&M(a,["parameters","upscaleConfig","enhanceInputImage"],G);const K=E(u,["imagePreservationFactor"]);a!==void 0&&K!=null&&M(a,["parameters","upscaleConfig","imagePreservationFactor"],K);const ee=E(u,["labels"]);a!==void 0&&ee!=null&&M(a,["labels"],ee);const ye=E(u,["numberOfImages"]);a!==void 0&&ye!=null&&M(a,["parameters","sampleCount"],ye);const Le=E(u,["mode"]);return a!==void 0&&Le!=null&&M(a,["parameters","mode"],Le),y}function lE(u,a,f){const y={},T=E(a,["model"]);T!=null&&M(y,["_url","model"],ni(u,T));const I=E(a,["image"]);I!=null&&M(y,["instances[0]","image"],zl(I));const S=E(a,["upscaleFactor"]);S!=null&&M(y,["parameters","upscaleConfig","upscaleFactor"],S);const c=E(a,["config"]);return c!=null&&aE(c,y),y}function uE(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["predictions"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>jg(S))),M(f,["generatedImages"],I)}return f}function cE(u,a){const f={},y=E(u,["uri"]);y!=null&&M(f,["uri"],y);const T=E(u,["encodedVideo"]);T!=null&&M(f,["videoBytes"],Ch(T));const I=E(u,["encoding"]);return I!=null&&M(f,["mimeType"],I),f}function hE(u,a){const f={},y=E(u,["gcsUri"]);y!=null&&M(f,["uri"],y);const T=E(u,["bytesBase64Encoded"]);T!=null&&M(f,["videoBytes"],Ch(T));const I=E(u,["mimeType"]);return I!=null&&M(f,["mimeType"],I),f}function dE(u,a){const f={},y=E(u,["image"]);y!=null&&M(f,["_self"],zl(y));const T=E(u,["maskMode"]);return T!=null&&M(f,["maskMode"],T),f}function fE(u,a){const f={},y=E(u,["image"]);y!=null&&M(f,["image"],Yg(y));const T=E(u,["referenceType"]);return T!=null&&M(f,["referenceType"],T),f}function pE(u,a){const f={},y=E(u,["image"]);y!=null&&M(f,["image"],zl(y));const T=E(u,["referenceType"]);return T!=null&&M(f,["referenceType"],T),f}function Av(u,a){const f={},y=E(u,["uri"]);y!=null&&M(f,["uri"],y);const T=E(u,["videoBytes"]);T!=null&&M(f,["encodedVideo"],Ch(T));const I=E(u,["mimeType"]);return I!=null&&M(f,["encoding"],I),f}function Mv(u,a){const f={},y=E(u,["uri"]);y!=null&&M(f,["gcsUri"],y);const T=E(u,["videoBytes"]);T!=null&&M(f,["bytesBase64Encoded"],Ch(T));const I=E(u,["mimeType"]);return I!=null&&M(f,["mimeType"],I),f}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mE(u,a){const f={},y=E(u,["displayName"]);return a!==void 0&&y!=null&&M(a,["displayName"],y),f}function gE(u){const a={},f=E(u,["config"]);return f!=null&&mE(f,a),a}function _E(u,a){const f={},y=E(u,["force"]);return a!==void 0&&y!=null&&M(a,["_query","force"],y),f}function yE(u){const a={},f=E(u,["name"]);f!=null&&M(a,["_url","name"],f);const y=E(u,["config"]);return y!=null&&_E(y,a),a}function vE(u){const a={},f=E(u,["name"]);return f!=null&&M(a,["_url","name"],f),a}function xE(u,a){const f={},y=E(u,["customMetadata"]);if(a!==void 0&&y!=null){let I=y;Array.isArray(I)&&(I=I.map(S=>S)),M(a,["customMetadata"],I)}const T=E(u,["chunkingConfig"]);return a!==void 0&&T!=null&&M(a,["chunkingConfig"],T),f}function bE(u){const a={},f=E(u,["name"]);f!=null&&M(a,["name"],f);const y=E(u,["metadata"]);y!=null&&M(a,["metadata"],y);const T=E(u,["done"]);T!=null&&M(a,["done"],T);const I=E(u,["error"]);I!=null&&M(a,["error"],I);const S=E(u,["response"]);return S!=null&&M(a,["response"],TE(S)),a}function wE(u){const a={},f=E(u,["fileSearchStoreName"]);f!=null&&M(a,["_url","file_search_store_name"],f);const y=E(u,["fileName"]);y!=null&&M(a,["fileName"],y);const T=E(u,["config"]);return T!=null&&xE(T,a),a}function TE(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["parent"]);y!=null&&M(a,["parent"],y);const T=E(u,["documentName"]);return T!=null&&M(a,["documentName"],T),a}function SE(u,a){const f={},y=E(u,["pageSize"]);a!==void 0&&y!=null&&M(a,["_query","pageSize"],y);const T=E(u,["pageToken"]);return a!==void 0&&T!=null&&M(a,["_query","pageToken"],T),f}function EE(u){const a={},f=E(u,["config"]);return f!=null&&SE(f,a),a}function CE(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["nextPageToken"]);y!=null&&M(a,["nextPageToken"],y);const T=E(u,["fileSearchStores"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>S)),M(a,["fileSearchStores"],I)}return a}function Iv(u,a){const f={},y=E(u,["mimeType"]);a!==void 0&&y!=null&&M(a,["mimeType"],y);const T=E(u,["displayName"]);a!==void 0&&T!=null&&M(a,["displayName"],T);const I=E(u,["customMetadata"]);if(a!==void 0&&I!=null){let c=I;Array.isArray(c)&&(c=c.map(F=>F)),M(a,["customMetadata"],c)}const S=E(u,["chunkingConfig"]);return a!==void 0&&S!=null&&M(a,["chunkingConfig"],S),f}function AE(u){const a={},f=E(u,["fileSearchStoreName"]);f!=null&&M(a,["_url","file_search_store_name"],f);const y=E(u,["config"]);return y!=null&&Iv(y,a),a}function ME(u){const a={},f=E(u,["sdkHttpResponse"]);return f!=null&&M(a,["sdkHttpResponse"],f),a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const IE="Content-Type",RE="X-Server-Timeout",PE="User-Agent",N_="x-goog-api-client",DE="1.40.0",zE=`google-genai-sdk/${DE}`,LE="v1beta1",NE="v1beta";class kE{constructor(a){var f,y,T;this.clientOptions=Object.assign({},a),this.customBaseUrl=(f=a.httpOptions)===null||f===void 0?void 0:f.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));const I={};if(this.clientOptions.vertexai){if(!this.clientOptions.location&&!this.clientOptions.apiKey&&!this.customBaseUrl&&(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw new Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");const c=a.project&&a.location||!!a.apiKey;this.customBaseUrl&&!c?(I.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||this.clientOptions.location==="global"?I.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(I.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),I.apiVersion=(y=this.clientOptions.apiVersion)!==null&&y!==void 0?y:LE}else{if(!this.clientOptions.apiKey)throw new Am({message:"API key must be set when using the Gemini API.",status:403});I.apiVersion=(T=this.clientOptions.apiVersion)!==null&&T!==void 0?T:NE,I.baseUrl="https://generativelanguage.googleapis.com/"}I.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=I,a.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(I,a.httpOptions))}isVertexAI(){var a;return(a=this.clientOptions.vertexai)!==null&&a!==void 0?a:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){const a=new Headers;return await this.clientOptions.auth.addAuthHeaders(a),a}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(a){if(!a||a.baseUrl===void 0||a.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const y=[a.baseUrl.endsWith("/")?a.baseUrl.slice(0,-1):a.baseUrl];return a.apiVersion&&a.apiVersion!==""&&y.push(a.apiVersion),y.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const a=this.getBaseUrl(),f=new URL(a);return f.protocol=f.protocol=="http:"?"ws":"wss",f.toString()}setBaseUrl(a){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=a;else throw new Error("HTTP options are not correctly set.")}constructUrl(a,f,y){const T=[this.getRequestUrlInternal(f)];return y&&T.push(this.getBaseResourcePath()),a!==""&&T.push(a),new URL(`${T.join("/")}`)}shouldPrependVertexProjectPath(a,f){return!(f.baseUrl&&f.baseUrlResourceScope===I_.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||a.path.startsWith("projects/")||a.httpMethod==="GET"&&a.path.startsWith("publishers/google/models"))}async request(a){let f=this.clientOptions.httpOptions;a.httpOptions&&(f=this.patchHttpOptions(this.clientOptions.httpOptions,a.httpOptions));const y=this.shouldPrependVertexProjectPath(a,f),T=this.constructUrl(a.path,f,y);if(a.queryParams)for(const[S,c]of Object.entries(a.queryParams))T.searchParams.append(S,String(c));let I={};if(a.httpMethod==="GET"){if(a.body&&a.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else I.body=a.body;return I=await this.includeExtraHttpOptionsToRequestInit(I,f,T.toString(),a.abortSignal),this.unaryApiCall(T,I,a.httpMethod)}patchHttpOptions(a,f){const y=JSON.parse(JSON.stringify(a));for(const[T,I]of Object.entries(f))typeof I=="object"?y[T]=Object.assign(Object.assign({},y[T]),I):I!==void 0&&(y[T]=I);return y}async requestStream(a){let f=this.clientOptions.httpOptions;a.httpOptions&&(f=this.patchHttpOptions(this.clientOptions.httpOptions,a.httpOptions));const y=this.shouldPrependVertexProjectPath(a,f),T=this.constructUrl(a.path,f,y);(!T.searchParams.has("alt")||T.searchParams.get("alt")!=="sse")&&T.searchParams.set("alt","sse");let I={};return I.body=a.body,I=await this.includeExtraHttpOptionsToRequestInit(I,f,T.toString(),a.abortSignal),this.streamApiCall(T,I,a.httpMethod)}async includeExtraHttpOptionsToRequestInit(a,f,y,T){if(f&&f.timeout||T){const I=new AbortController,S=I.signal;if(f.timeout&&(f==null?void 0:f.timeout)>0){const c=setTimeout(()=>I.abort(),f.timeout);c&&typeof c.unref=="function"&&c.unref()}T&&T.addEventListener("abort",()=>{I.abort()}),a.signal=S}return f&&f.extraBody!==null&&FE(a,f.extraBody),a.headers=await this.getHeadersInternal(f,y),a}async unaryApiCall(a,f,y){return this.apiCall(a.toString(),Object.assign(Object.assign({},f),{method:y})).then(async T=>(await $0(T),new R_(T))).catch(T=>{throw T instanceof Error?T:new Error(JSON.stringify(T))})}async streamApiCall(a,f,y){return this.apiCall(a.toString(),Object.assign(Object.assign({},f),{method:y})).then(async T=>(await $0(T),this.processStreamResponse(T))).catch(T=>{throw T instanceof Error?T:new Error(JSON.stringify(T))})}processStreamResponse(a){return Pl(this,arguments,function*(){var y;const T=(y=a==null?void 0:a.body)===null||y===void 0?void 0:y.getReader(),I=new TextDecoder("utf-8");if(!T)throw new Error("Response body is empty");try{let S="";const c="data:",F=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:k,value:G}=yield dn(T.read());if(k){if(S.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const K=I.decode(G,{stream:!0});try{const Le=JSON.parse(K);if("error"in Le){const Ne=JSON.parse(JSON.stringify(Le.error)),se=Ne.status,Ye=Ne.code,st=`got status: ${se}. ${JSON.stringify(Le)}`;if(Ye>=400&&Ye<600)throw new Am({message:st,status:Ye})}}catch(Le){if(Le.name==="ApiError")throw Le}S+=K;let ee=-1,ye=0;for(;;){ee=-1,ye=0;for(const se of F){const Ye=S.indexOf(se);Ye!==-1&&(ee===-1||Ye<ee)&&(ee=Ye,ye=se.length)}if(ee===-1)break;const Le=S.substring(0,ee);S=S.substring(ee+ye);const Ne=Le.trim();if(Ne.startsWith(c)){const se=Ne.substring(c.length).trim();try{const Ye=new Response(se,{headers:a==null?void 0:a.headers,status:a==null?void 0:a.status,statusText:a==null?void 0:a.statusText});yield yield dn(new R_(Ye))}catch(Ye){throw new Error(`exception parsing stream chunk ${se}. ${Ye}`)}}}}}finally{T.releaseLock()}})}async apiCall(a,f){return fetch(a,f).catch(y=>{throw new Error(`exception ${y} sending request`)})}getDefaultHeaders(){const a={},f=zE+" "+this.clientOptions.userAgentExtra;return a[PE]=f,a[N_]=f,a[IE]="application/json",a}async getHeadersInternal(a,f){const y=new Headers;if(a&&a.headers){for(const[T,I]of Object.entries(a.headers))y.append(T,I);a.timeout&&a.timeout>0&&y.append(RE,String(Math.ceil(a.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(y,f),y}getFileName(a){var f;let y="";return typeof a=="string"&&(y=a.replace(/[/\\]+$/,""),y=(f=y.split(/[/\\]/).pop())!==null&&f!==void 0?f:""),y}async uploadFile(a,f){var y;const T={};f!=null&&(T.mimeType=f.mimeType,T.name=f.name,T.displayName=f.displayName),T.name&&!T.name.startsWith("files/")&&(T.name=`files/${T.name}`);const I=this.clientOptions.uploader,S=await I.stat(a);T.sizeBytes=String(S.size);const c=(y=f==null?void 0:f.mimeType)!==null&&y!==void 0?y:S.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");T.mimeType=c;const F={file:T},k=this.getFileName(a),G=Pt("upload/v1beta/files",F._url),K=await this.fetchUploadUrl(G,T.sizeBytes,T.mimeType,k,F,f==null?void 0:f.httpOptions);return I.upload(a,K,this)}async uploadFileToFileSearchStore(a,f,y){var T;const I=this.clientOptions.uploader,S=await I.stat(f),c=String(S.size),F=(T=y==null?void 0:y.mimeType)!==null&&T!==void 0?T:S.type;if(F===void 0||F==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const k=`upload/v1beta/${a}:uploadToFileSearchStore`,G=this.getFileName(f),K={};y!=null&&Iv(y,K);const ee=await this.fetchUploadUrl(k,c,F,G,K,y==null?void 0:y.httpOptions);return I.uploadToFileSearchStore(f,ee,this)}async downloadFile(a){await this.clientOptions.downloader.download(a,this)}async fetchUploadUrl(a,f,y,T,I,S){var c;let F={};S?F=S:F={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${f}`,"X-Goog-Upload-Header-Content-Type":`${y}`},T?{"X-Goog-Upload-File-Name":T}:{})};const k=await this.request({path:a,body:JSON.stringify(I),httpMethod:"POST",httpOptions:F});if(!k||!(k!=null&&k.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const G=(c=k==null?void 0:k.headers)===null||c===void 0?void 0:c["x-goog-upload-url"];if(G===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return G}}async function $0(u){var a;if(u===void 0)throw new Error("response is undefined");if(!u.ok){const f=u.status;let y;!((a=u.headers.get("content-type"))===null||a===void 0)&&a.includes("application/json")?y=await u.json():y={error:{message:await u.text(),code:u.status,status:u.statusText}};const T=JSON.stringify(y);throw f>=400&&f<600?new Am({message:T,status:f}):new Error(T)}}function FE(u,a){if(!a||Object.keys(a).length===0)return;if(u.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let f={};if(typeof u.body=="string"&&u.body.length>0)try{const I=JSON.parse(u.body);if(typeof I=="object"&&I!==null&&!Array.isArray(I))f=I;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function y(I,S){const c=Object.assign({},I);for(const F in S)if(Object.prototype.hasOwnProperty.call(S,F)){const k=S[F],G=c[F];k&&typeof k=="object"&&!Array.isArray(k)&&G&&typeof G=="object"&&!Array.isArray(G)?c[F]=y(G,k):(G&&k&&typeof G!=typeof k&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${F}". Original type: ${typeof G}, New type: ${typeof k}. Overwriting.`),c[F]=k)}return c}const T=y(f,a);u.body=JSON.stringify(T)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const BE="mcp_used/unknown";let OE=!1;function Rv(u){for(const a of u)if(UE(a)||typeof a=="object"&&"inputSchema"in a)return!0;return OE}function Pv(u){var a;const f=(a=u[N_])!==null&&a!==void 0?a:"";u[N_]=(f+` ${BE}`).trimStart()}function UE(u){return u!==null&&typeof u=="object"&&u instanceof J_}function VE(u){return Pl(this,arguments,function*(f,y=100){let T,I=0;for(;I<y;){const S=yield dn(f.listTools({cursor:T}));for(const c of S.tools)yield yield dn(c),I++;if(!S.nextCursor)break;T=S.nextCursor}})}class J_{constructor(a=[],f){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=a,this.config=f}static create(a,f){return new J_(a,f)}async initialize(){var a,f,y,T;if(this.mcpTools.length>0)return;const I={},S=[];for(const G of this.mcpClients)try{for(var c=!0,F=(f=void 0,Dl(VE(G))),k;k=await F.next(),a=k.done,!a;c=!0){T=k.value,c=!1;const K=T;S.push(K);const ee=K.name;if(I[ee])throw new Error(`Duplicate function name ${ee} found in MCP tools. Please ensure function names are unique.`);I[ee]=G}}catch(K){f={error:K}}finally{try{!c&&!a&&(y=F.return)&&await y.call(F)}finally{if(f)throw f.error}}this.mcpTools=S,this.functionNameToMcpClient=I}async tool(){return await this.initialize(),g1(this.mcpTools,this.config)}async callTool(a){await this.initialize();const f=[];for(const y of a)if(y.name in this.functionNameToMcpClient){const T=this.functionNameToMcpClient[y.name];let I;this.config.timeout&&(I={timeout:this.config.timeout});const S=await T.callTool({name:y.name,arguments:y.args},void 0,I);f.push({functionResponse:{name:y.name,response:S.isError?{error:S}:S}})}return f}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function GE(u,a,f){const y=new l1;let T;f.data instanceof Blob?T=JSON.parse(await f.data.text()):T=JSON.parse(f.data),Object.assign(y,T),a(y)}class qE{constructor(a,f,y){this.apiClient=a,this.auth=f,this.webSocketFactory=y}async connect(a){var f,y;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const T=this.apiClient.getWebsocketBaseUrl(),I=this.apiClient.getApiVersion(),S=$E(this.apiClient.getDefaultHeaders()),c=this.apiClient.getApiKey(),F=`${T}/ws/google.ai.generativelanguage.${I}.GenerativeService.BidiGenerateMusic?key=${c}`;let k=()=>{};const G=new Promise(We=>{k=We}),K=a.callbacks,ee=function(){k({})},ye=this.apiClient,Le={onopen:ee,onmessage:We=>{GE(ye,K.onmessage,We)},onerror:(f=K==null?void 0:K.onerror)!==null&&f!==void 0?f:function(We){},onclose:(y=K==null?void 0:K.onclose)!==null&&y!==void 0?y:function(We){}},Ne=this.webSocketFactory.create(F,ZE(S),Le);Ne.connect(),await G;const st={setup:{model:ni(this.apiClient,a.model)}};return Ne.send(JSON.stringify(st)),new HE(Ne,this.apiClient)}}class HE{constructor(a,f){this.conn=a,this.apiClient=f}async setWeightedPrompts(a){if(!a.weightedPrompts||Object.keys(a.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const f=mT(a);this.conn.send(JSON.stringify({clientContent:f}))}async setMusicGenerationConfig(a){a.musicGenerationConfig||(a.musicGenerationConfig={});const f=pT(a);this.conn.send(JSON.stringify(f))}sendPlaybackControl(a){const f={playbackControl:a};this.conn.send(JSON.stringify(f))}play(){this.sendPlaybackControl(up.PLAY)}pause(){this.sendPlaybackControl(up.PAUSE)}stop(){this.sendPlaybackControl(up.STOP)}resetContext(){this.sendPlaybackControl(up.RESET_CONTEXT)}close(){this.conn.close()}}function ZE(u){const a={};return u.forEach((f,y)=>{a[y]=f}),a}function $E(u){const a=new Headers;for(const[f,y]of Object.entries(u))a.append(f,y);return a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const jE="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function YE(u,a,f){const y=new a1;let T;f.data instanceof Blob?T=await f.data.text():f.data instanceof ArrayBuffer?T=new TextDecoder().decode(f.data):T=f.data;const I=JSON.parse(T);if(u.isVertexAI()){const S=yT(I);Object.assign(y,S)}else Object.assign(y,I);a(y)}class XE{constructor(a,f,y){this.apiClient=a,this.auth=f,this.webSocketFactory=y,this.music=new qE(this.apiClient,this.auth,this.webSocketFactory)}async connect(a){var f,y,T,I,S,c;if(a.config&&a.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const F=this.apiClient.getWebsocketBaseUrl(),k=this.apiClient.getApiVersion();let G;const K=this.apiClient.getHeaders();a.config&&a.config.tools&&Rv(a.config.tools)&&Pv(K);const ee=QE(K);if(this.apiClient.isVertexAI()){const At=this.apiClient.getProject(),Xt=this.apiClient.getLocation(),tn=this.apiClient.getApiKey(),an=!!At&&!!Xt||!!tn;this.apiClient.getCustomBaseUrl()&&!an?G=F:(G=`${F}/ws/google.cloud.aiplatform.${k}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(ee,G))}else{const At=this.apiClient.getApiKey();let Xt="BidiGenerateContent",tn="key";At!=null&&At.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),k!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),Xt="BidiGenerateContentConstrained",tn="access_token"),G=`${F}/ws/google.ai.generativelanguage.${k}.GenerativeService.${Xt}?${tn}=${At}`}let ye=()=>{};const Le=new Promise(At=>{ye=At}),Ne=a.callbacks,se=function(){var At;(At=Ne==null?void 0:Ne.onopen)===null||At===void 0||At.call(Ne),ye({})},Ye=this.apiClient,st={onopen:se,onmessage:At=>{YE(Ye,Ne.onmessage,At)},onerror:(f=Ne==null?void 0:Ne.onerror)!==null&&f!==void 0?f:function(At){},onclose:(y=Ne==null?void 0:Ne.onclose)!==null&&y!==void 0?y:function(At){}},We=this.webSocketFactory.create(G,KE(ee),st);We.connect(),await Le;let gt=ni(this.apiClient,a.model);if(this.apiClient.isVertexAI()&&gt.startsWith("publishers/")){const At=this.apiClient.getProject(),Xt=this.apiClient.getLocation();At&&Xt&&(gt=`projects/${At}/locations/${Xt}/`+gt)}let nt={};this.apiClient.isVertexAI()&&((T=a.config)===null||T===void 0?void 0:T.responseModalities)===void 0&&(a.config===void 0?a.config={responseModalities:[Ug.AUDIO]}:a.config.responseModalities=[Ug.AUDIO]),!((I=a.config)===null||I===void 0)&&I.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const zt=(c=(S=a.config)===null||S===void 0?void 0:S.tools)!==null&&c!==void 0?c:[],_t=[];for(const At of zt)if(this.isCallableTool(At)){const Xt=At;_t.push(await Xt.tool())}else _t.push(At);_t.length>0&&(a.config.tools=_t);const Ut={model:gt,config:a.config,callbacks:a.callbacks};return this.apiClient.isVertexAI()?nt=fT(this.apiClient,Ut):nt=dT(this.apiClient,Ut),delete nt.config,We.send(JSON.stringify(nt)),new WE(We,this.apiClient)}isCallableTool(a){return"callTool"in a&&typeof a.callTool=="function"}}const JE={turnComplete:!0};class WE{constructor(a,f){this.conn=a,this.apiClient=f}tLiveClientContent(a,f){if(f.turns!==null&&f.turns!==void 0){let y=[];try{y=Ua(f.turns),a.isVertexAI()||(y=y.map(T=>$g(T)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof f.turns}'`)}return{clientContent:{turns:y,turnComplete:f.turnComplete}}}return{clientContent:{turnComplete:f.turnComplete}}}tLiveClienttToolResponse(a,f){let y=[];if(f.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(f.functionResponses)?y=f.functionResponses:y=[f.functionResponses],y.length===0)throw new Error("functionResponses is required.");for(const I of y){if(typeof I!="object"||I===null||!("name"in I)||!("response"in I))throw new Error(`Could not parse function response, type '${typeof I}'.`);if(!a.isVertexAI()&&!("id"in I))throw new Error(jE)}return{toolResponse:{functionResponses:y}}}sendClientContent(a){a=Object.assign(Object.assign({},JE),a);const f=this.tLiveClientContent(this.apiClient,a);this.conn.send(JSON.stringify(f))}sendRealtimeInput(a){let f={};this.apiClient.isVertexAI()?f={realtimeInput:_T(a)}:f={realtimeInput:gT(a)},this.conn.send(JSON.stringify(f))}sendToolResponse(a){if(a.functionResponses==null)throw new Error("Tool response parameters are required.");const f=this.tLiveClienttToolResponse(this.apiClient,a);this.conn.send(JSON.stringify(f))}close(){this.conn.close()}}function KE(u){const a={};return u.forEach((f,y)=>{a[y]=f}),a}function QE(u){const a=new Headers;for(const[f,y]of Object.entries(u))a.append(f,y);return a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const j0=10;function Y0(u){var a,f,y;if(!((a=u==null?void 0:u.automaticFunctionCalling)===null||a===void 0)&&a.disable)return!0;let T=!1;for(const S of(f=u==null?void 0:u.tools)!==null&&f!==void 0?f:[])if(dp(S)){T=!0;break}if(!T)return!0;const I=(y=u==null?void 0:u.automaticFunctionCalling)===null||y===void 0?void 0:y.maximumRemoteCalls;return I&&(I<0||!Number.isInteger(I))||I==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",I),!0):!1}function dp(u){return"callTool"in u&&typeof u.callTool=="function"}function e2(u){var a,f,y;return(y=(f=(a=u.config)===null||a===void 0?void 0:a.tools)===null||f===void 0?void 0:f.some(T=>dp(T)))!==null&&y!==void 0?y:!1}function X0(u){var a;const f=[];return!((a=u==null?void 0:u.config)===null||a===void 0)&&a.tools&&u.config.tools.forEach((y,T)=>{if(dp(y))return;const I=y;I.functionDeclarations&&I.functionDeclarations.length>0&&f.push(T)}),f}function J0(u){var a;return!(!((a=u==null?void 0:u.automaticFunctionCalling)===null||a===void 0)&&a.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class t2 extends Sc{constructor(a){super(),this.apiClient=a,this.generateContent=async f=>{var y,T,I,S,c;const F=await this.processParamsMaybeAddMcpUsage(f);if(this.maybeMoveToResponseJsonSchem(f),!e2(f)||Y0(f.config))return await this.generateContentInternal(F);const k=X0(f);if(k.length>0){const Ne=k.map(se=>`tools[${se}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${Ne}.`)}let G,K;const ee=Ua(F.contents),ye=(I=(T=(y=F.config)===null||y===void 0?void 0:y.automaticFunctionCalling)===null||T===void 0?void 0:T.maximumRemoteCalls)!==null&&I!==void 0?I:j0;let Le=0;for(;Le<ye&&(G=await this.generateContentInternal(F),!(!G.functionCalls||G.functionCalls.length===0));){const Ne=G.candidates[0].content,se=[];for(const Ye of(c=(S=f.config)===null||S===void 0?void 0:S.tools)!==null&&c!==void 0?c:[])if(dp(Ye)){const We=await Ye.callTool(G.functionCalls);se.push(...We)}Le++,K={role:"user",parts:se},F.contents=Ua(F.contents),F.contents.push(Ne),F.contents.push(K),J0(F.config)&&(ee.push(Ne),ee.push(K))}return J0(F.config)&&(G.automaticFunctionCallingHistory=ee),G},this.generateContentStream=async f=>{var y,T,I,S,c;if(this.maybeMoveToResponseJsonSchem(f),Y0(f.config)){const K=await this.processParamsMaybeAddMcpUsage(f);return await this.generateContentStreamInternal(K)}const F=X0(f);if(F.length>0){const K=F.map(ee=>`tools[${ee}]`).join(", ");throw new Error(`Incompatible tools found at ${K}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const k=(I=(T=(y=f==null?void 0:f.config)===null||y===void 0?void 0:y.toolConfig)===null||T===void 0?void 0:T.functionCallingConfig)===null||I===void 0?void 0:I.streamFunctionCallArguments,G=(c=(S=f==null?void 0:f.config)===null||S===void 0?void 0:S.automaticFunctionCalling)===null||c===void 0?void 0:c.disable;if(k&&!G)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(f)},this.generateImages=async f=>await this.generateImagesInternal(f).then(y=>{var T;let I;const S=[];if(y!=null&&y.generatedImages)for(const F of y.generatedImages)F&&(F!=null&&F.safetyAttributes)&&((T=F==null?void 0:F.safetyAttributes)===null||T===void 0?void 0:T.contentType)==="Positive Prompt"?I=F==null?void 0:F.safetyAttributes:S.push(F);let c;return I?c={generatedImages:S,positivePromptSafetyAttributes:I,sdkHttpResponse:y.sdkHttpResponse}:c={generatedImages:S,sdkHttpResponse:y.sdkHttpResponse},c}),this.list=async f=>{var y;const S={config:Object.assign(Object.assign({},{queryBase:!0}),f==null?void 0:f.config)};if(this.apiClient.isVertexAI()&&!S.config.queryBase){if(!((y=S.config)===null||y===void 0)&&y.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");S.config.filter="labels.tune-type:*"}return new Od(Tc.PAGED_ITEM_MODELS,c=>this.listInternal(c),await this.listInternal(S),S)},this.editImage=async f=>{const y={model:f.model,prompt:f.prompt,referenceImages:[],config:f.config};return f.referenceImages&&f.referenceImages&&(y.referenceImages=f.referenceImages.map(T=>T.toReferenceImageAPI())),await this.editImageInternal(y)},this.upscaleImage=async f=>{let y={numberOfImages:1,mode:"upscale"};f.config&&(y=Object.assign(Object.assign({},y),f.config));const T={model:f.model,image:f.image,upscaleFactor:f.upscaleFactor,config:y};return await this.upscaleImageInternal(T)},this.generateVideos=async f=>{var y,T,I,S,c,F;if((f.prompt||f.image||f.video)&&f.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((y=f.video)===null||y===void 0)&&y.uri&&(!((T=f.video)===null||T===void 0)&&T.videoBytes)?f.video={uri:f.video.uri,mimeType:f.video.mimeType}:!((S=(I=f.source)===null||I===void 0?void 0:I.video)===null||S===void 0)&&S.uri&&(!((F=(c=f.source)===null||c===void 0?void 0:c.video)===null||F===void 0)&&F.videoBytes)&&(f.source.video={uri:f.source.video.uri,mimeType:f.source.video.mimeType})),await this.generateVideosInternal(f)}}maybeMoveToResponseJsonSchem(a){a.config&&a.config.responseSchema&&(a.config.responseJsonSchema||Object.keys(a.config.responseSchema).includes("$schema")&&(a.config.responseJsonSchema=a.config.responseSchema,delete a.config.responseSchema))}async processParamsMaybeAddMcpUsage(a){var f,y,T;const I=(f=a.config)===null||f===void 0?void 0:f.tools;if(!I)return a;const S=await Promise.all(I.map(async F=>dp(F)?await F.tool():F)),c={model:a.model,contents:a.contents,config:Object.assign(Object.assign({},a.config),{tools:S})};if(c.config.tools=S,a.config&&a.config.tools&&Rv(a.config.tools)){const F=(T=(y=a.config.httpOptions)===null||y===void 0?void 0:y.headers)!==null&&T!==void 0?T:{};let k=Object.assign({},F);Object.keys(k).length===0&&(k=this.apiClient.getDefaultHeaders()),Pv(k),c.config.httpOptions=Object.assign(Object.assign({},a.config.httpOptions),{headers:k})}return c}async initAfcToolsMap(a){var f,y,T;const I=new Map;for(const S of(y=(f=a.config)===null||f===void 0?void 0:f.tools)!==null&&y!==void 0?y:[])if(dp(S)){const c=S,F=await c.tool();for(const k of(T=F.functionDeclarations)!==null&&T!==void 0?T:[]){if(!k.name)throw new Error("Function declaration name is required.");if(I.has(k.name))throw new Error(`Duplicate tool declaration name: ${k.name}`);I.set(k.name,c)}}return I}async processAfcStream(a){var f,y,T;const I=(T=(y=(f=a.config)===null||f===void 0?void 0:f.automaticFunctionCalling)===null||y===void 0?void 0:y.maximumRemoteCalls)!==null&&T!==void 0?T:j0;let S=!1,c=0;const F=await this.initAfcToolsMap(a);return(function(k,G,K){return Pl(this,arguments,function*(){for(var ee,ye,Le,Ne,se,Ye;c<I;){S&&(c++,S=!1);const nt=yield dn(k.processParamsMaybeAddMcpUsage(K)),zt=yield dn(k.generateContentStreamInternal(nt)),_t=[],Ut=[];try{for(var st=!0,We=(ye=void 0,Dl(zt)),gt;gt=yield dn(We.next()),ee=gt.done,!ee;st=!0){Ne=gt.value,st=!1;const At=Ne;if(yield yield dn(At),At.candidates&&(!((se=At.candidates[0])===null||se===void 0)&&se.content)){Ut.push(At.candidates[0].content);for(const Xt of(Ye=At.candidates[0].content.parts)!==null&&Ye!==void 0?Ye:[])if(c<I&&Xt.functionCall){if(!Xt.functionCall.name)throw new Error("Function call name was not returned by the model.");if(G.has(Xt.functionCall.name)){const tn=yield dn(G.get(Xt.functionCall.name).callTool([Xt.functionCall]));_t.push(...tn)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${G.keys()}, mising tool: ${Xt.functionCall.name}`)}}}}catch(At){ye={error:At}}finally{try{!st&&!ee&&(Le=We.return)&&(yield dn(Le.call(We)))}finally{if(ye)throw ye.error}}if(_t.length>0){S=!0;const At=new Sm;At.candidates=[{content:{role:"user",parts:_t}}],yield yield dn(At);const Xt=[];Xt.push(...Ut),Xt.push({role:"user",parts:_t});const tn=Ua(K.contents).concat(Xt);K.contents=tn}else break}})})(this,F,a)}async generateContentInternal(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=q0(this.apiClient,a);return c=Pt("{model}:generateContent",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=Z0(G),ee=new Sm;return Object.assign(ee,K),ee})}else{const k=G0(this.apiClient,a);return c=Pt("{model}:generateContent",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=H0(G),ee=new Sm;return Object.assign(ee,K),ee})}}async generateContentStreamInternal(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=q0(this.apiClient,a);return c=Pt("{model}:streamGenerateContent?alt=sse",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.requestStream({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}),S.then(function(K){return Pl(this,arguments,function*(){var ee,ye,Le,Ne;try{for(var se=!0,Ye=Dl(K),st;st=yield dn(Ye.next()),ee=st.done,!ee;se=!0){Ne=st.value,se=!1;const We=Ne,gt=Z0(yield dn(We.json()),a);gt.sdkHttpResponse={headers:We.headers};const nt=new Sm;Object.assign(nt,gt),yield yield dn(nt)}}catch(We){ye={error:We}}finally{try{!se&&!ee&&(Le=Ye.return)&&(yield dn(Le.call(Ye)))}finally{if(ye)throw ye.error}}})})}else{const k=G0(this.apiClient,a);return c=Pt("{model}:streamGenerateContent?alt=sse",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.requestStream({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}),S.then(function(K){return Pl(this,arguments,function*(){var ee,ye,Le,Ne;try{for(var se=!0,Ye=Dl(K),st;st=yield dn(Ye.next()),ee=st.done,!ee;se=!0){Ne=st.value,se=!1;const We=Ne,gt=H0(yield dn(We.json()),a);gt.sdkHttpResponse={headers:We.headers};const nt=new Sm;Object.assign(nt,gt),yield yield dn(nt)}}catch(We){ye={error:We}}finally{try{!se&&!ee&&(Le=Ye.return)&&(yield dn(Le.call(Ye)))}finally{if(ye)throw ye.error}}})})}}async embedContent(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=XT(this.apiClient,a);return c=Pt("{model}:predict",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=WT(G),ee=new E0;return Object.assign(ee,K),ee})}else{const k=YT(this.apiClient,a);return c=Pt("{model}:batchEmbedContents",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=JT(G),ee=new E0;return Object.assign(ee,K),ee})}}async generateImagesInternal(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=lS(this.apiClient,a);return c=Pt("{model}:predict",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=cS(G),ee=new C0;return Object.assign(ee,K),ee})}else{const k=aS(this.apiClient,a);return c=Pt("{model}:predict",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=uS(G),ee=new C0;return Object.assign(ee,K),ee})}}async editImageInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI()){const c=HT(this.apiClient,a);return I=Pt("{model}:predict",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json().then(k=>{const G=k;return G.sdkHttpResponse={headers:F.headers},G})),T.then(F=>{const k=ZT(F),G=new Xb;return Object.assign(G,k),G})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI()){const c=lE(this.apiClient,a);return I=Pt("{model}:predict",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json().then(k=>{const G=k;return G.sdkHttpResponse={headers:F.headers},G})),T.then(F=>{const k=uE(F),G=new Jb;return Object.assign(G,k),G})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI()){const c=qS(this.apiClient,a);return I=Pt("{model}:predict",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>{const k=HS(F),G=new Wb;return Object.assign(G,k),G})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI()){const c=JS(this.apiClient,a);return I=Pt("{model}:predict",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>{const k=WS(F),G=new Kb;return Object.assign(G,k),G})}else throw new Error("This method is only supported by the Vertex AI.")}async get(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=AS(this.apiClient,a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json()),S.then(G=>L_(G))}else{const k=CS(this.apiClient,a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json()),S.then(G=>z_(G))}}async listInternal(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=kS(this.apiClient,a);return c=Pt("{models_url}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=BS(G),ee=new A0;return Object.assign(ee,K),ee})}else{const k=NS(this.apiClient,a);return c=Pt("{models_url}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=FS(G),ee=new A0;return Object.assign(ee,K),ee})}}async update(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=sE(this.apiClient,a);return c=Pt("{model}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"PATCH",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json()),S.then(G=>L_(G))}else{const k=oE(this.apiClient,a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"PATCH",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json()),S.then(G=>z_(G))}}async delete(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=UT(this.apiClient,a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"DELETE",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=GT(G),ee=new M0;return Object.assign(ee,K),ee})}else{const k=OT(this.apiClient,a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"DELETE",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=VT(G),ee=new M0;return Object.assign(ee,K),ee})}}async countTokens(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=kT(this.apiClient,a);return c=Pt("{model}:countTokens",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=BT(G),ee=new I0;return Object.assign(ee,K),ee})}else{const k=NT(this.apiClient,a);return c=Pt("{model}:countTokens",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=FT(G),ee=new I0;return Object.assign(ee,K),ee})}}async computeTokens(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI()){const c=MT(this.apiClient,a);return I=Pt("{model}:computeTokens",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json().then(k=>{const G=k;return G.sdkHttpResponse={headers:F.headers},G})),T.then(F=>{const k=IT(F),G=new Qb;return Object.assign(G,k),G})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=gS(this.apiClient,a);return c=Pt("{model}:predictLongRunning",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json()),S.then(G=>{const K=pS(G),ee=new Vg;return Object.assign(ee,K),ee})}else{const k=mS(this.apiClient,a);return c=Pt("{model}:predictLongRunning",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json()),S.then(G=>{const K=fS(G),ee=new Vg;return Object.assign(ee,K),ee})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class n2 extends Sc{constructor(a){super(),this.apiClient=a}async getVideosOperation(a){const f=a.operation,y=a.config;if(f.name===void 0||f.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const T=f.name.split("/operations/")[0];let I;y&&"httpOptions"in y&&(I=y.httpOptions);const S=await this.fetchPredictVideosOperationInternal({operationName:f.name,resourceName:T,config:{httpOptions:I}});return f._fromAPIResponse({apiResponse:S,_isVertexAI:!0})}else{const T=await this.getVideosOperationInternal({operationName:f.name,config:y});return f._fromAPIResponse({apiResponse:T,_isVertexAI:!1})}}async get(a){const f=a.operation,y=a.config;if(f.name===void 0||f.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const T=f.name.split("/operations/")[0];let I;y&&"httpOptions"in y&&(I=y.httpOptions);const S=await this.fetchPredictVideosOperationInternal({operationName:f.name,resourceName:T,config:{httpOptions:I}});return f._fromAPIResponse({apiResponse:S,_isVertexAI:!0})}else{const T=await this.getVideosOperationInternal({operationName:f.name,config:y});return f._fromAPIResponse({apiResponse:T,_isVertexAI:!1})}}async getVideosOperationInternal(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=qb(a);return c=Pt("{operationName}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json()),S}else{const k=Gb(a);return c=Pt("{operationName}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json()),S}}async fetchPredictVideosOperationInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI()){const c=Nb(a);return I=Pt("{resourceName}:fetchPredictOperation",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function i2(u){const a={},f=E(u,["data"]);if(f!=null&&M(a,["data"],f),E(u,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const y=E(u,["mimeType"]);return y!=null&&M(a,["mimeType"],y),a}function r2(u){const a={},f=E(u,["parts"]);if(f!=null){let T=f;Array.isArray(T)&&(T=T.map(I=>f2(I))),M(a,["parts"],T)}const y=E(u,["role"]);return y!=null&&M(a,["role"],y),a}function o2(u,a,f){const y={},T=E(a,["expireTime"]);f!==void 0&&T!=null&&M(f,["expireTime"],T);const I=E(a,["newSessionExpireTime"]);f!==void 0&&I!=null&&M(f,["newSessionExpireTime"],I);const S=E(a,["uses"]);f!==void 0&&S!=null&&M(f,["uses"],S);const c=E(a,["liveConnectConstraints"]);f!==void 0&&c!=null&&M(f,["bidiGenerateContentSetup"],d2(u,c));const F=E(a,["lockAdditionalFields"]);return f!==void 0&&F!=null&&M(f,["fieldMask"],F),y}function s2(u,a){const f={},y=E(a,["config"]);return y!=null&&M(f,["config"],o2(u,y,f)),f}function a2(u){const a={};if(E(u,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const f=E(u,["fileUri"]);f!=null&&M(a,["fileUri"],f);const y=E(u,["mimeType"]);return y!=null&&M(a,["mimeType"],y),a}function l2(u){const a={},f=E(u,["id"]);f!=null&&M(a,["id"],f);const y=E(u,["args"]);y!=null&&M(a,["args"],y);const T=E(u,["name"]);if(T!=null&&M(a,["name"],T),E(u,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(E(u,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return a}function u2(u){const a={};if(E(u,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const f=E(u,["enableWidget"]);return f!=null&&M(a,["enableWidget"],f),a}function c2(u){const a={};if(E(u,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(E(u,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const f=E(u,["timeRangeFilter"]);return f!=null&&M(a,["timeRangeFilter"],f),a}function h2(u,a){const f={},y=E(u,["generationConfig"]);a!==void 0&&y!=null&&M(a,["setup","generationConfig"],y);const T=E(u,["responseModalities"]);a!==void 0&&T!=null&&M(a,["setup","generationConfig","responseModalities"],T);const I=E(u,["temperature"]);a!==void 0&&I!=null&&M(a,["setup","generationConfig","temperature"],I);const S=E(u,["topP"]);a!==void 0&&S!=null&&M(a,["setup","generationConfig","topP"],S);const c=E(u,["topK"]);a!==void 0&&c!=null&&M(a,["setup","generationConfig","topK"],c);const F=E(u,["maxOutputTokens"]);a!==void 0&&F!=null&&M(a,["setup","generationConfig","maxOutputTokens"],F);const k=E(u,["mediaResolution"]);a!==void 0&&k!=null&&M(a,["setup","generationConfig","mediaResolution"],k);const G=E(u,["seed"]);a!==void 0&&G!=null&&M(a,["setup","generationConfig","seed"],G);const K=E(u,["speechConfig"]);a!==void 0&&K!=null&&M(a,["setup","generationConfig","speechConfig"],X_(K));const ee=E(u,["thinkingConfig"]);a!==void 0&&ee!=null&&M(a,["setup","generationConfig","thinkingConfig"],ee);const ye=E(u,["enableAffectiveDialog"]);a!==void 0&&ye!=null&&M(a,["setup","generationConfig","enableAffectiveDialog"],ye);const Le=E(u,["systemInstruction"]);a!==void 0&&Le!=null&&M(a,["setup","systemInstruction"],r2(qo(Le)));const Ne=E(u,["tools"]);if(a!==void 0&&Ne!=null){let zt=pp(Ne);Array.isArray(zt)&&(zt=zt.map(_t=>m2(fp(_t)))),M(a,["setup","tools"],zt)}const se=E(u,["sessionResumption"]);a!==void 0&&se!=null&&M(a,["setup","sessionResumption"],p2(se));const Ye=E(u,["inputAudioTranscription"]);a!==void 0&&Ye!=null&&M(a,["setup","inputAudioTranscription"],Ye);const st=E(u,["outputAudioTranscription"]);a!==void 0&&st!=null&&M(a,["setup","outputAudioTranscription"],st);const We=E(u,["realtimeInputConfig"]);a!==void 0&&We!=null&&M(a,["setup","realtimeInputConfig"],We);const gt=E(u,["contextWindowCompression"]);a!==void 0&&gt!=null&&M(a,["setup","contextWindowCompression"],gt);const nt=E(u,["proactivity"]);if(a!==void 0&&nt!=null&&M(a,["setup","proactivity"],nt),E(u,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return f}function d2(u,a){const f={},y=E(a,["model"]);y!=null&&M(f,["setup","model"],ni(u,y));const T=E(a,["config"]);return T!=null&&M(f,["config"],h2(T,f)),f}function f2(u){const a={},f=E(u,["mediaResolution"]);f!=null&&M(a,["mediaResolution"],f);const y=E(u,["codeExecutionResult"]);y!=null&&M(a,["codeExecutionResult"],y);const T=E(u,["executableCode"]);T!=null&&M(a,["executableCode"],T);const I=E(u,["fileData"]);I!=null&&M(a,["fileData"],a2(I));const S=E(u,["functionCall"]);S!=null&&M(a,["functionCall"],l2(S));const c=E(u,["functionResponse"]);c!=null&&M(a,["functionResponse"],c);const F=E(u,["inlineData"]);F!=null&&M(a,["inlineData"],i2(F));const k=E(u,["text"]);k!=null&&M(a,["text"],k);const G=E(u,["thought"]);G!=null&&M(a,["thought"],G);const K=E(u,["thoughtSignature"]);K!=null&&M(a,["thoughtSignature"],K);const ee=E(u,["videoMetadata"]);return ee!=null&&M(a,["videoMetadata"],ee),a}function p2(u){const a={},f=E(u,["handle"]);if(f!=null&&M(a,["handle"],f),E(u,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return a}function m2(u){const a={};if(E(u,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const f=E(u,["computerUse"]);f!=null&&M(a,["computerUse"],f);const y=E(u,["fileSearch"]);y!=null&&M(a,["fileSearch"],y);const T=E(u,["codeExecution"]);if(T!=null&&M(a,["codeExecution"],T),E(u,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const I=E(u,["functionDeclarations"]);if(I!=null){let G=I;Array.isArray(G)&&(G=G.map(K=>K)),M(a,["functionDeclarations"],G)}const S=E(u,["googleMaps"]);S!=null&&M(a,["googleMaps"],u2(S));const c=E(u,["googleSearch"]);c!=null&&M(a,["googleSearch"],c2(c));const F=E(u,["googleSearchRetrieval"]);F!=null&&M(a,["googleSearchRetrieval"],F);const k=E(u,["urlContext"]);return k!=null&&M(a,["urlContext"],k),a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function g2(u){const a=[];for(const f in u)if(Object.prototype.hasOwnProperty.call(u,f)){const y=u[f];if(typeof y=="object"&&y!=null&&Object.keys(y).length>0){const T=Object.keys(y).map(I=>`${f}.${I}`);a.push(...T)}else a.push(f)}return a.join(",")}function _2(u,a){let f=null;const y=u.bidiGenerateContentSetup;if(typeof y=="object"&&y!==null&&"setup"in y){const I=y.setup;typeof I=="object"&&I!==null?(u.bidiGenerateContentSetup=I,f=I):delete u.bidiGenerateContentSetup}else y!==void 0&&delete u.bidiGenerateContentSetup;const T=u.fieldMask;if(f){const I=g2(f);if(Array.isArray(a==null?void 0:a.lockAdditionalFields)&&(a==null?void 0:a.lockAdditionalFields.length)===0)I?u.fieldMask=I:delete u.fieldMask;else if(a!=null&&a.lockAdditionalFields&&a.lockAdditionalFields.length>0&&T!==null&&Array.isArray(T)&&T.length>0){const S=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let c=[];T.length>0&&(c=T.map(k=>S.includes(k)?`generationConfig.${k}`:k));const F=[];I&&F.push(I),c.length>0&&F.push(...c),F.length>0?u.fieldMask=F.join(","):delete u.fieldMask}else delete u.fieldMask}else T!==null&&Array.isArray(T)&&T.length>0?u.fieldMask=T.join(","):delete u.fieldMask;return u}class y2 extends Sc{constructor(a){super(),this.apiClient=a}async create(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const c=s2(this.apiClient,a);I=Pt("auth_tokens",c._url),S=c._query,delete c.config,delete c._url,delete c._query;const F=_2(c,a.config);return T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(F),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(k=>k.json()),T.then(k=>k)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function v2(u,a){const f={},y=E(u,["force"]);return a!==void 0&&y!=null&&M(a,["_query","force"],y),f}function x2(u){const a={},f=E(u,["name"]);f!=null&&M(a,["_url","name"],f);const y=E(u,["config"]);return y!=null&&v2(y,a),a}function b2(u){const a={},f=E(u,["name"]);return f!=null&&M(a,["_url","name"],f),a}function w2(u,a){const f={},y=E(u,["pageSize"]);a!==void 0&&y!=null&&M(a,["_query","pageSize"],y);const T=E(u,["pageToken"]);return a!==void 0&&T!=null&&M(a,["_query","pageToken"],T),f}function T2(u){const a={},f=E(u,["parent"]);f!=null&&M(a,["_url","parent"],f);const y=E(u,["config"]);return y!=null&&w2(y,a),a}function S2(u){const a={},f=E(u,["sdkHttpResponse"]);f!=null&&M(a,["sdkHttpResponse"],f);const y=E(u,["nextPageToken"]);y!=null&&M(a,["nextPageToken"],y);const T=E(u,["documents"]);if(T!=null){let I=T;Array.isArray(I)&&(I=I.map(S=>S)),M(a,["documents"],I)}return a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class E2 extends Sc{constructor(a){super(),this.apiClient=a,this.list=async f=>new Od(Tc.PAGED_ITEM_DOCUMENTS,y=>this.listInternal({parent:f.parent,config:y.config}),await this.listInternal(f),f)}async get(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=b2(a);return I=Pt("{name}",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>F)}}async delete(a){var f,y;let T="",I={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const S=x2(a);T=Pt("{name}",S._url),I=S._query,delete S._url,delete S._query,await this.apiClient.request({path:T,queryParams:I,body:JSON.stringify(S),httpMethod:"DELETE",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal})}}async listInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=T2(a);return I=Pt("{parent}/documents",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>{const k=S2(F),G=new e1;return Object.assign(G,k),G})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class C2 extends Sc{constructor(a,f=new E2(a)){super(),this.apiClient=a,this.documents=f,this.list=async(y={})=>new Od(Tc.PAGED_ITEM_FILE_SEARCH_STORES,T=>this.listInternal(T),await this.listInternal(y),y)}async uploadToFileSearchStore(a){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(a.fileSearchStoreName,a.file,a.config)}async create(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=gE(a);return I=Pt("fileSearchStores",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>F)}}async get(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=vE(a);return I=Pt("{name}",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>F)}}async delete(a){var f,y;let T="",I={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const S=yE(a);T=Pt("{name}",S._url),I=S._query,delete S._url,delete S._query,await this.apiClient.request({path:T,queryParams:I,body:JSON.stringify(S),httpMethod:"DELETE",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal})}}async listInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=EE(a);return I=Pt("fileSearchStores",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>{const k=CE(F),G=new t1;return Object.assign(G,k),G})}}async uploadToFileSearchStoreInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=AE(a);return I=Pt("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>{const k=ME(F),G=new n1;return Object.assign(G,k),G})}}async importFile(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=wE(a);return I=Pt("{file_search_store_name}:importFile",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json()),T.then(F=>{const k=bE(F),G=new H_;return Object.assign(G,k),G})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Dv=function(){const{crypto:u}=globalThis;if(u!=null&&u.randomUUID)return Dv=u.randomUUID.bind(u),u.randomUUID();const a=new Uint8Array(1),f=u?()=>u.getRandomValues(a)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,y=>(+y^f()&15>>+y/4).toString(16))};const A2=()=>Dv();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function k_(u){return typeof u=="object"&&u!==null&&("name"in u&&u.name==="AbortError"||"message"in u&&String(u.message).includes("FetchRequestCanceledException"))}const F_=u=>{if(u instanceof Error)return u;if(typeof u=="object"&&u!==null){try{if(Object.prototype.toString.call(u)==="[object Error]"){const a=new Error(u.message,u.cause?{cause:u.cause}:{});return u.stack&&(a.stack=u.stack),u.cause&&!a.cause&&(a.cause=u.cause),u.name&&(a.name=u.name),a}}catch{}try{return new Error(JSON.stringify(u))}catch{}}return new Error(u)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Va extends Error{}class us extends Va{constructor(a,f,y,T){super(`${us.makeMessage(a,f,y)}`),this.status=a,this.headers=T,this.error=f}static makeMessage(a,f,y){const T=f!=null&&f.message?typeof f.message=="string"?f.message:JSON.stringify(f.message):f?JSON.stringify(f):y;return a&&T?`${a} ${T}`:a?`${a} status code (no body)`:T||"(no status code or body)"}static generate(a,f,y,T){if(!a||!T)return new Xg({message:y,cause:F_(f)});const I=f;return a===400?new Lv(a,I,y,T):a===401?new Nv(a,I,y,T):a===403?new kv(a,I,y,T):a===404?new Fv(a,I,y,T):a===409?new Bv(a,I,y,T):a===422?new Ov(a,I,y,T):a===429?new Uv(a,I,y,T):a>=500?new Vv(a,I,y,T):new us(a,I,y,T)}}class B_ extends us{constructor({message:a}={}){super(void 0,void 0,a||"Request was aborted.",void 0)}}class Xg extends us{constructor({message:a,cause:f}){super(void 0,void 0,a||"Connection error.",void 0),f&&(this.cause=f)}}class zv extends Xg{constructor({message:a}={}){super({message:a??"Request timed out."})}}class Lv extends us{}class Nv extends us{}class kv extends us{}class Fv extends us{}class Bv extends us{}class Ov extends us{}class Uv extends us{}class Vv extends us{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const M2=/^[a-z][a-z0-9+.-]*:/i,I2=u=>M2.test(u);let O_=u=>(O_=Array.isArray,O_(u));const R2=O_;let P2=R2;const W0=P2;function D2(u){if(!u)return!0;for(const a in u)return!1;return!0}function z2(u,a){return Object.prototype.hasOwnProperty.call(u,a)}const L2=(u,a)=>{if(typeof a!="number"||!Number.isInteger(a))throw new Va(`${u} must be an integer`);if(a<0)throw new Va(`${u} must be a positive integer`);return a},N2=u=>{try{return JSON.parse(u)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const k2=u=>new Promise(a=>setTimeout(a,u));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const lp="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function F2(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const B2=()=>{var u,a,f,y,T;const I=F2();if(I==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":lp,"X-Stainless-OS":Q0(Deno.build.os),"X-Stainless-Arch":K0(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(a=(u=Deno.version)===null||u===void 0?void 0:u.deno)!==null&&a!==void 0?a:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":lp,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(I==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":lp,"X-Stainless-OS":Q0((f=globalThis.process.platform)!==null&&f!==void 0?f:"unknown"),"X-Stainless-Arch":K0((y=globalThis.process.arch)!==null&&y!==void 0?y:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(T=globalThis.process.version)!==null&&T!==void 0?T:"unknown"};const S=O2();return S?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":lp,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${S.browser}`,"X-Stainless-Runtime-Version":S.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":lp,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function O2(){if(typeof navigator>"u"||!navigator)return null;const u=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:a,pattern:f}of u){const y=f.exec(navigator.userAgent);if(y){const T=y[1]||0,I=y[2]||0,S=y[3]||0;return{browser:a,version:`${T}.${I}.${S}`}}}return null}const K0=u=>u==="x32"?"x32":u==="x86_64"||u==="x64"?"x64":u==="arm"?"arm":u==="aarch64"||u==="arm64"?"arm64":u?`other:${u}`:"unknown",Q0=u=>(u=u.toLowerCase(),u.includes("ios")?"iOS":u==="android"?"Android":u==="darwin"?"MacOS":u==="win32"?"Windows":u==="freebsd"?"FreeBSD":u==="openbsd"?"OpenBSD":u==="linux"?"Linux":u?`Other:${u}`:"Unknown");let Rg;const U2=()=>Rg??(Rg=B2());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function V2(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Gv(...u){const a=globalThis.ReadableStream;if(typeof a>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new a(...u)}function G2(u){let a=Symbol.asyncIterator in u?u[Symbol.asyncIterator]():u[Symbol.iterator]();return Gv({start(){},async pull(f){const{done:y,value:T}=await a.next();y?f.close():f.enqueue(T)},async cancel(){var f;await((f=a.return)===null||f===void 0?void 0:f.call(a))}})}function qv(u){if(u[Symbol.asyncIterator])return u;const a=u.getReader();return{async next(){try{const f=await a.read();return f!=null&&f.done&&a.releaseLock(),f}catch(f){throw a.releaseLock(),f}},async return(){const f=a.cancel();return a.releaseLock(),await f,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function q2(u){var a,f;if(u===null||typeof u!="object")return;if(u[Symbol.asyncIterator]){await((f=(a=u[Symbol.asyncIterator]()).return)===null||f===void 0?void 0:f.call(a));return}const y=u.getReader(),T=y.cancel();y.releaseLock(),await T}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const H2=({headers:u,body:a})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(a)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Hv=()=>{var u;if(typeof File>"u"){const{process:a}=globalThis,f=typeof((u=a==null?void 0:a.versions)===null||u===void 0?void 0:u.node)=="string"&&parseInt(a.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(f?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function w_(u,a,f){return Hv(),new File(u,a??"unknown_file",f)}function Z2(u){return(typeof u=="object"&&u!==null&&("name"in u&&u.name&&String(u.name)||"url"in u&&u.url&&String(u.url)||"filename"in u&&u.filename&&String(u.filename)||"path"in u&&u.path&&String(u.path))||"").split(/[\\/]/).pop()||void 0}const $2=u=>u!=null&&typeof u=="object"&&typeof u[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Zv=u=>u!=null&&typeof u=="object"&&typeof u.size=="number"&&typeof u.type=="string"&&typeof u.text=="function"&&typeof u.slice=="function"&&typeof u.arrayBuffer=="function",j2=u=>u!=null&&typeof u=="object"&&typeof u.name=="string"&&typeof u.lastModified=="number"&&Zv(u),Y2=u=>u!=null&&typeof u=="object"&&typeof u.url=="string"&&typeof u.blob=="function";async function X2(u,a,f){if(Hv(),u=await u,j2(u))return u instanceof File?u:w_([await u.arrayBuffer()],u.name);if(Y2(u)){const T=await u.blob();return a||(a=new URL(u.url).pathname.split(/[\\/]/).pop()),w_(await U_(T),a,f)}const y=await U_(u);if(a||(a=Z2(u)),!(f!=null&&f.type)){const T=y.find(I=>typeof I=="object"&&"type"in I&&I.type);typeof T=="string"&&(f=Object.assign(Object.assign({},f),{type:T}))}return w_(y,a,f)}async function U_(u){var a,f,y,T,I;let S=[];if(typeof u=="string"||ArrayBuffer.isView(u)||u instanceof ArrayBuffer)S.push(u);else if(Zv(u))S.push(u instanceof Blob?u:await u.arrayBuffer());else if($2(u))try{for(var c=!0,F=Dl(u),k;k=await F.next(),a=k.done,!a;c=!0){T=k.value,c=!1;const G=T;S.push(...await U_(G))}}catch(G){f={error:G}}finally{try{!c&&!a&&(y=F.return)&&await y.call(F)}finally{if(f)throw f.error}}else{const G=(I=u==null?void 0:u.constructor)===null||I===void 0?void 0:I.name;throw new Error(`Unexpected data type: ${typeof u}${G?`; constructor: ${G}`:""}${J2(u)}`)}return S}function J2(u){return typeof u!="object"||u===null?"":`; props: [${Object.getOwnPropertyNames(u).map(f=>`"${f}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $v{constructor(a){this._client=a}}$v._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function jv(u){return u.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const ev=Object.freeze(Object.create(null)),W2=(u=jv)=>(function(f,...y){if(f.length===1)return f[0];let T=!1;const I=[],S=f.reduce((G,K,ee)=>{var ye,Le,Ne;/[?#]/.test(K)&&(T=!0);const se=y[ee];let Ye=(T?encodeURIComponent:u)(""+se);return ee!==y.length&&(se==null||typeof se=="object"&&se.toString===((Ne=Object.getPrototypeOf((Le=Object.getPrototypeOf((ye=se.hasOwnProperty)!==null&&ye!==void 0?ye:ev))!==null&&Le!==void 0?Le:ev))===null||Ne===void 0?void 0:Ne.toString))&&(Ye=se+"",I.push({start:G.length+K.length,length:Ye.length,error:`Value of type ${Object.prototype.toString.call(se).slice(8,-1)} is not a valid path parameter`})),G+K+(ee===y.length?"":Ye)},""),c=S.split(/[?#]/,1)[0],F=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let k;for(;(k=F.exec(c))!==null;)I.push({start:k.index,length:k[0].length,error:`Value "${k[0]}" can't be safely passed as a path parameter`});if(I.sort((G,K)=>G.start-K.start),I.length>0){let G=0;const K=I.reduce((ee,ye)=>{const Le=" ".repeat(ye.start-G),Ne="^".repeat(ye.length);return G=ye.start+ye.length,ee+Le+Ne},"");throw new Va(`Path parameters result in path with invalid segments:
${I.map(ee=>ee.error).join(`
`)}
${S}
${K}`)}return S}),Pg=W2(jv);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Yv extends $v{create(a,f){var y;const{api_version:T=this._client.apiVersion}=a,I=qg(a,["api_version"]);if("model"in I&&"agent_config"in I)throw new Va("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in I&&"generation_config"in I)throw new Va("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Pg`/${T}/interactions`,Object.assign(Object.assign({body:I},f),{stream:(y=a.stream)!==null&&y!==void 0?y:!1}))}delete(a,f={},y){const{api_version:T=this._client.apiVersion}=f??{};return this._client.delete(Pg`/${T}/interactions/${a}`,y)}cancel(a,f={},y){const{api_version:T=this._client.apiVersion}=f??{};return this._client.post(Pg`/${T}/interactions/${a}/cancel`,y)}get(a,f={},y){var T;const I=f??{},{api_version:S=this._client.apiVersion}=I,c=qg(I,["api_version"]);return this._client.get(Pg`/${S}/interactions/${a}`,Object.assign(Object.assign({query:c},y),{stream:(T=f==null?void 0:f.stream)!==null&&T!==void 0?T:!1}))}}Yv._key=Object.freeze(["interactions"]);class Xv extends Yv{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function K2(u){let a=0;for(const T of u)a+=T.length;const f=new Uint8Array(a);let y=0;for(const T of u)f.set(T,y),y+=T.length;return f}let Dg;function W_(u){let a;return(Dg??(a=new globalThis.TextEncoder,Dg=a.encode.bind(a)))(u)}let zg;function tv(u){let a;return(zg??(a=new globalThis.TextDecoder,zg=a.decode.bind(a)))(u)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Jg{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(a){if(a==null)return[];const f=a instanceof ArrayBuffer?new Uint8Array(a):typeof a=="string"?W_(a):a;this.buffer=K2([this.buffer,f]);const y=[];let T;for(;(T=Q2(this.buffer,this.carriageReturnIndex))!=null;){if(T.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=T.index;continue}if(this.carriageReturnIndex!=null&&(T.index!==this.carriageReturnIndex+1||T.carriage)){y.push(tv(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const I=this.carriageReturnIndex!==null?T.preceding-1:T.preceding,S=tv(this.buffer.subarray(0,I));y.push(S),this.buffer=this.buffer.subarray(T.index),this.carriageReturnIndex=null}return y}flush(){return this.buffer.length?this.decode(`
`):[]}}Jg.NEWLINE_CHARS=new Set([`
`,"\r"]);Jg.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Q2(u,a){for(let T=a??0;T<u.length;T++){if(u[T]===10)return{preceding:T,index:T+1,carriage:!1};if(u[T]===13)return{preceding:T,index:T+1,carriage:!0}}return null}function eC(u){for(let y=0;y<u.length-1;y++){if(u[y]===10&&u[y+1]===10||u[y]===13&&u[y+1]===13)return y+2;if(u[y]===13&&u[y+1]===10&&y+3<u.length&&u[y+2]===13&&u[y+3]===10)return y+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Hg={off:0,error:200,warn:300,info:400,debug:500},nv=(u,a,f)=>{if(u){if(z2(Hg,u))return u;ls(f).warn(`${a} was set to ${JSON.stringify(u)}, expected one of ${JSON.stringify(Object.keys(Hg))}`)}};function Cm(){}function Lg(u,a,f){return!a||Hg[u]>Hg[f]?Cm:a[u].bind(a)}const tC={error:Cm,warn:Cm,info:Cm,debug:Cm};let iv=new WeakMap;function ls(u){var a;const f=u.logger,y=(a=u.logLevel)!==null&&a!==void 0?a:"off";if(!f)return tC;const T=iv.get(f);if(T&&T[0]===y)return T[1];const I={error:Lg("error",f,y),warn:Lg("warn",f,y),info:Lg("info",f,y),debug:Lg("debug",f,y)};return iv.set(f,[y,I]),I}const Bd=u=>(u.options&&(u.options=Object.assign({},u.options),delete u.options.headers),u.headers&&(u.headers=Object.fromEntries((u.headers instanceof Headers?[...u.headers]:Object.entries(u.headers)).map(([a,f])=>[a,a.toLowerCase()==="x-goog-api-key"||a.toLowerCase()==="authorization"||a.toLowerCase()==="cookie"||a.toLowerCase()==="set-cookie"?"***":f]))),"retryOfRequestLogID"in u&&(u.retryOfRequestLogID&&(u.retryOf=u.retryOfRequestLogID),delete u.retryOfRequestLogID),u);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cp{constructor(a,f,y){this.iterator=a,this.controller=f,this.client=y}static fromSSEResponse(a,f,y){let T=!1;const I=y?ls(y):console;function S(){return Pl(this,arguments,function*(){var F,k,G,K;if(T)throw new Va("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");T=!0;let ee=!1;try{try{for(var ye=!0,Le=Dl(nC(a,f)),Ne;Ne=yield dn(Le.next()),F=Ne.done,!F;ye=!0){K=Ne.value,ye=!1;const se=K;if(!ee)if(se.data.startsWith("[DONE]")){ee=!0;continue}else try{yield yield dn(JSON.parse(se.data))}catch(Ye){throw I.error("Could not parse message into JSON:",se.data),I.error("From chunk:",se.raw),Ye}}}catch(se){k={error:se}}finally{try{!ye&&!F&&(G=Le.return)&&(yield dn(G.call(Le)))}finally{if(k)throw k.error}}ee=!0}catch(se){if(k_(se))return yield dn(void 0);throw se}finally{ee||f.abort()}})}return new cp(S,f,y)}static fromReadableStream(a,f,y){let T=!1;function I(){return Pl(this,arguments,function*(){var F,k,G,K;const ee=new Jg,ye=qv(a);try{for(var Le=!0,Ne=Dl(ye),se;se=yield dn(Ne.next()),F=se.done,!F;Le=!0){K=se.value,Le=!1;const Ye=K;for(const st of ee.decode(Ye))yield yield dn(st)}}catch(Ye){k={error:Ye}}finally{try{!Le&&!F&&(G=Ne.return)&&(yield dn(G.call(Ne)))}finally{if(k)throw k.error}}for(const Ye of ee.flush())yield yield dn(Ye)})}function S(){return Pl(this,arguments,function*(){var F,k,G,K;if(T)throw new Va("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");T=!0;let ee=!1;try{try{for(var ye=!0,Le=Dl(I()),Ne;Ne=yield dn(Le.next()),F=Ne.done,!F;ye=!0){K=Ne.value,ye=!1;const se=K;ee||se&&(yield yield dn(JSON.parse(se)))}}catch(se){k={error:se}}finally{try{!ye&&!F&&(G=Le.return)&&(yield dn(G.call(Le)))}finally{if(k)throw k.error}}ee=!0}catch(se){if(k_(se))return yield dn(void 0);throw se}finally{ee||f.abort()}})}return new cp(S,f,y)}[Symbol.asyncIterator](){return this.iterator()}tee(){const a=[],f=[],y=this.iterator(),T=I=>({next:()=>{if(I.length===0){const S=y.next();a.push(S),f.push(S)}return I.shift()}});return[new cp(()=>T(a),this.controller,this.client),new cp(()=>T(f),this.controller,this.client)]}toReadableStream(){const a=this;let f;return Gv({async start(){f=a[Symbol.asyncIterator]()},async pull(y){try{const{value:T,done:I}=await f.next();if(I)return y.close();const S=W_(JSON.stringify(T)+`
`);y.enqueue(S)}catch(T){y.error(T)}},async cancel(){var y;await((y=f.return)===null||y===void 0?void 0:y.call(f))}})}}function nC(u,a){return Pl(this,arguments,function*(){var y,T,I,S;if(!u.body)throw a.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Va("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Va("Attempted to iterate over a response with no body");const c=new rC,F=new Jg,k=qv(u.body);try{for(var G=!0,K=Dl(iC(k)),ee;ee=yield dn(K.next()),y=ee.done,!y;G=!0){S=ee.value,G=!1;const ye=S;for(const Le of F.decode(ye)){const Ne=c.decode(Le);Ne&&(yield yield dn(Ne))}}}catch(ye){T={error:ye}}finally{try{!G&&!y&&(I=K.return)&&(yield dn(I.call(K)))}finally{if(T)throw T.error}}for(const ye of F.flush()){const Le=c.decode(ye);Le&&(yield yield dn(Le))}})}function iC(u){return Pl(this,arguments,function*(){var f,y,T,I;let S=new Uint8Array;try{for(var c=!0,F=Dl(u),k;k=yield dn(F.next()),f=k.done,!f;c=!0){I=k.value,c=!1;const G=I;if(G==null)continue;const K=G instanceof ArrayBuffer?new Uint8Array(G):typeof G=="string"?W_(G):G;let ee=new Uint8Array(S.length+K.length);ee.set(S),ee.set(K,S.length),S=ee;let ye;for(;(ye=eC(S))!==-1;)yield yield dn(S.slice(0,ye)),S=S.slice(ye)}}catch(G){y={error:G}}finally{try{!c&&!f&&(T=F.return)&&(yield dn(T.call(F)))}finally{if(y)throw y.error}}S.length>0&&(yield yield dn(S))})}class rC{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(a){if(a.endsWith("\r")&&(a=a.substring(0,a.length-1)),!a){if(!this.event&&!this.data.length)return null;const I={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],I}if(this.chunks.push(a),a.startsWith(":"))return null;let[f,y,T]=oC(a,":");return T.startsWith(" ")&&(T=T.substring(1)),f==="event"?this.event=T:f==="data"&&this.data.push(T),null}}function oC(u,a){const f=u.indexOf(a);return f!==-1?[u.substring(0,f),a,u.substring(f+a.length)]:[u,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function sC(u,a){const{response:f,requestLogID:y,retryOfRequestLogID:T,startTime:I}=a,S=await(async()=>{var c;if(a.options.stream)return ls(u).debug("response",f.status,f.url,f.headers,f.body),a.options.__streamClass?a.options.__streamClass.fromSSEResponse(f,a.controller,u):cp.fromSSEResponse(f,a.controller,u);if(f.status===204)return null;if(a.options.__binaryResponse)return f;const F=f.headers.get("content-type"),k=(c=F==null?void 0:F.split(";")[0])===null||c===void 0?void 0:c.trim();return(k==null?void 0:k.includes("application/json"))||(k==null?void 0:k.endsWith("+json"))?f.headers.get("content-length")==="0"?void 0:await f.json():await f.text()})();return ls(u).debug(`[${y}] response parsed`,Bd({retryOfRequestLogID:T,url:f.url,status:f.status,body:S,durationMs:Date.now()-I})),S}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class K_ extends Promise{constructor(a,f,y=sC){super(T=>{T(null)}),this.responsePromise=f,this.parseResponse=y,this.client=a}_thenUnwrap(a){return new K_(this.client,this.responsePromise,async(f,y)=>a(await this.parseResponse(f,y),y))}asResponse(){return this.responsePromise.then(a=>a.response)}async withResponse(){const[a,f]=await Promise.all([this.parse(),this.asResponse()]);return{data:a,response:f}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(a=>this.parseResponse(this.client,a))),this.parsedPromise}then(a,f){return this.parse().then(a,f)}catch(a){return this.parse().catch(a)}finally(a){return this.parse().finally(a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Jv=Symbol("brand.privateNullableHeaders");function*aC(u){if(!u)return;if(Jv in u){const{values:y,nulls:T}=u;yield*y.entries();for(const I of T)yield[I,null];return}let a=!1,f;u instanceof Headers?f=u.entries():W0(u)?f=u:(a=!0,f=Object.entries(u??{}));for(let y of f){const T=y[0];if(typeof T!="string")throw new TypeError("expected header name to be a string");const I=W0(y[1])?y[1]:[y[1]];let S=!1;for(const c of I)c!==void 0&&(a&&!S&&(S=!0,yield[T,null]),yield[T,c])}}const Em=u=>{const a=new Headers,f=new Set;for(const y of u){const T=new Set;for(const[I,S]of aC(y)){const c=I.toLowerCase();T.has(c)||(a.delete(I),T.add(c)),S===null?(a.delete(I),f.add(c)):(a.append(I,S),f.delete(c))}}return{[Jv]:!0,values:a,nulls:f}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const T_=u=>{var a,f,y,T,I,S;if(typeof globalThis.process<"u")return(y=(f=(a=Ib)===null||a===void 0?void 0:a[u])===null||f===void 0?void 0:f.trim())!==null&&y!==void 0?y:void 0;if(typeof globalThis.Deno<"u")return(S=(I=(T=globalThis.Deno.env)===null||T===void 0?void 0:T.get)===null||I===void 0?void 0:I.call(T,u))===null||S===void 0?void 0:S.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Wv;class Wg{constructor(a){var f,y,T,I,S,c,F,{baseURL:k=T_("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:G=(f=T_("GEMINI_API_KEY"))!==null&&f!==void 0?f:null,apiVersion:K="v1beta"}=a,ee=qg(a,["baseURL","apiKey","apiVersion"]);const ye=Object.assign(Object.assign({apiKey:G,apiVersion:K},ee),{baseURL:k||"https://generativelanguage.googleapis.com"});this.baseURL=ye.baseURL,this.timeout=(y=ye.timeout)!==null&&y!==void 0?y:Wg.DEFAULT_TIMEOUT,this.logger=(T=ye.logger)!==null&&T!==void 0?T:console;const Le="warn";this.logLevel=Le,this.logLevel=(S=(I=nv(ye.logLevel,"ClientOptions.logLevel",this))!==null&&I!==void 0?I:nv(T_("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&S!==void 0?S:Le,this.fetchOptions=ye.fetchOptions,this.maxRetries=(c=ye.maxRetries)!==null&&c!==void 0?c:2,this.fetch=(F=ye.fetch)!==null&&F!==void 0?F:V2(),this.encoder=H2,this._options=ye,this.apiKey=G,this.apiVersion=K,this.clientAdapter=ye.clientAdapter}withOptions(a){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),a))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:a,nulls:f}){if(!(a.has("authorization")||a.has("x-goog-api-key"))&&!(this.apiKey&&a.get("x-goog-api-key"))&&!f.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(a){const f=Em([a.headers]);if(!(f.values.has("authorization")||f.values.has("x-goog-api-key"))){if(this.apiKey)return Em([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return Em([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(a){return Object.entries(a).filter(([f,y])=>typeof y<"u").map(([f,y])=>{if(typeof y=="string"||typeof y=="number"||typeof y=="boolean")return`${encodeURIComponent(f)}=${encodeURIComponent(y)}`;if(y===null)return`${encodeURIComponent(f)}=`;throw new Va(`Cannot stringify type ${typeof y}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${lp}`}defaultIdempotencyKey(){return`stainless-node-retry-${A2()}`}makeStatusError(a,f,y,T){return us.generate(a,f,y,T)}buildURL(a,f,y){const T=!this.baseURLOverridden()&&y||this.baseURL,I=I2(a)?new URL(a):new URL(T+(T.endsWith("/")&&a.startsWith("/")?a.slice(1):a)),S=this.defaultQuery();return D2(S)||(f=Object.assign(Object.assign({},S),f)),typeof f=="object"&&f&&!Array.isArray(f)&&(I.search=this.stringifyQuery(f)),I.toString()}async prepareOptions(a){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!a.path.startsWith(`/${this.apiVersion}/projects/`)){const f=a.path.slice(this.apiVersion.length+1);a.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${f}`}}async prepareRequest(a,{url:f,options:y}){}get(a,f){return this.methodRequest("get",a,f)}post(a,f){return this.methodRequest("post",a,f)}patch(a,f){return this.methodRequest("patch",a,f)}put(a,f){return this.methodRequest("put",a,f)}delete(a,f){return this.methodRequest("delete",a,f)}methodRequest(a,f,y){return this.request(Promise.resolve(y).then(T=>Object.assign({method:a,path:f},T)))}request(a,f=null){return new K_(this,this.makeRequest(a,f,void 0))}async makeRequest(a,f,y){var T,I,S;const c=await a,F=(T=c.maxRetries)!==null&&T!==void 0?T:this.maxRetries;f==null&&(f=F),await this.prepareOptions(c);const{req:k,url:G,timeout:K}=await this.buildRequest(c,{retryCount:F-f});await this.prepareRequest(k,{url:G,options:c});const ee="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),ye=y===void 0?"":`, retryOf: ${y}`,Le=Date.now();if(ls(this).debug(`[${ee}] sending request`,Bd({retryOfRequestLogID:y,method:c.method,url:G,options:c,headers:k.headers})),!((I=c.signal)===null||I===void 0)&&I.aborted)throw new B_;const Ne=new AbortController,se=await this.fetchWithTimeout(G,k,K,Ne).catch(F_),Ye=Date.now();if(se instanceof globalThis.Error){const We=`retrying, ${f} attempts remaining`;if(!((S=c.signal)===null||S===void 0)&&S.aborted)throw new B_;const gt=k_(se)||/timed? ?out/i.test(String(se)+("cause"in se?String(se.cause):""));if(f)return ls(this).info(`[${ee}] connection ${gt?"timed out":"failed"} - ${We}`),ls(this).debug(`[${ee}] connection ${gt?"timed out":"failed"} (${We})`,Bd({retryOfRequestLogID:y,url:G,durationMs:Ye-Le,message:se.message})),this.retryRequest(c,f,y??ee);throw ls(this).info(`[${ee}] connection ${gt?"timed out":"failed"} - error; no more retries left`),ls(this).debug(`[${ee}] connection ${gt?"timed out":"failed"} (error; no more retries left)`,Bd({retryOfRequestLogID:y,url:G,durationMs:Ye-Le,message:se.message})),gt?new zv:new Xg({cause:se})}const st=`[${ee}${ye}] ${k.method} ${G} ${se.ok?"succeeded":"failed"} with status ${se.status} in ${Ye-Le}ms`;if(!se.ok){const We=await this.shouldRetry(se);if(f&&We){const At=`retrying, ${f} attempts remaining`;return await q2(se.body),ls(this).info(`${st} - ${At}`),ls(this).debug(`[${ee}] response error (${At})`,Bd({retryOfRequestLogID:y,url:se.url,status:se.status,headers:se.headers,durationMs:Ye-Le})),this.retryRequest(c,f,y??ee,se.headers)}const gt=We?"error; no more retries left":"error; not retryable";ls(this).info(`${st} - ${gt}`);const nt=await se.text().catch(At=>F_(At).message),zt=N2(nt),_t=zt?void 0:nt;throw ls(this).debug(`[${ee}] response error (${gt})`,Bd({retryOfRequestLogID:y,url:se.url,status:se.status,headers:se.headers,message:_t,durationMs:Date.now()-Le})),this.makeStatusError(se.status,zt,_t,se.headers)}return ls(this).info(st),ls(this).debug(`[${ee}] response start`,Bd({retryOfRequestLogID:y,url:se.url,status:se.status,headers:se.headers,durationMs:Ye-Le})),{response:se,options:c,controller:Ne,requestLogID:ee,retryOfRequestLogID:y,startTime:Le}}async fetchWithTimeout(a,f,y,T){const I=f||{},{signal:S,method:c}=I,F=qg(I,["signal","method"]),k=T.abort.bind(T);S&&S.addEventListener("abort",k,{once:!0});const G=setTimeout(k,y),K=globalThis.ReadableStream&&F.body instanceof globalThis.ReadableStream||typeof F.body=="object"&&F.body!==null&&Symbol.asyncIterator in F.body,ee=Object.assign(Object.assign(Object.assign({signal:T.signal},K?{duplex:"half"}:{}),{method:"GET"}),F);c&&(ee.method=c.toUpperCase());try{return await this.fetch.call(void 0,a,ee)}finally{clearTimeout(G)}}async shouldRetry(a){const f=a.headers.get("x-should-retry");return f==="true"?!0:f==="false"?!1:a.status===408||a.status===409||a.status===429||a.status>=500}async retryRequest(a,f,y,T){var I;let S;const c=T==null?void 0:T.get("retry-after-ms");if(c){const k=parseFloat(c);Number.isNaN(k)||(S=k)}const F=T==null?void 0:T.get("retry-after");if(F&&!S){const k=parseFloat(F);Number.isNaN(k)?S=Date.parse(F)-Date.now():S=k*1e3}if(!(S&&0<=S&&S<60*1e3)){const k=(I=a.maxRetries)!==null&&I!==void 0?I:this.maxRetries;S=this.calculateDefaultRetryTimeoutMillis(f,k)}return await k2(S),this.makeRequest(a,f-1,y)}calculateDefaultRetryTimeoutMillis(a,f){const I=f-a,S=Math.min(.5*Math.pow(2,I),8),c=1-Math.random()*.25;return S*c*1e3}async buildRequest(a,{retryCount:f=0}={}){var y,T,I;const S=Object.assign({},a),{method:c,path:F,query:k,defaultBaseURL:G}=S,K=this.buildURL(F,k,G);"timeout"in S&&L2("timeout",S.timeout),S.timeout=(y=S.timeout)!==null&&y!==void 0?y:this.timeout;const{bodyHeaders:ee,body:ye}=this.buildBody({options:S}),Le=await this.buildHeaders({options:a,method:c,bodyHeaders:ee,retryCount:f});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:c,headers:Le},S.signal&&{signal:S.signal}),globalThis.ReadableStream&&ye instanceof globalThis.ReadableStream&&{duplex:"half"}),ye&&{body:ye}),(T=this.fetchOptions)!==null&&T!==void 0?T:{}),(I=S.fetchOptions)!==null&&I!==void 0?I:{}),url:K,timeout:S.timeout}}async buildHeaders({options:a,method:f,bodyHeaders:y,retryCount:T}){let I={};this.idempotencyHeader&&f!=="get"&&(a.idempotencyKey||(a.idempotencyKey=this.defaultIdempotencyKey()),I[this.idempotencyHeader]=a.idempotencyKey);const S=await this.authHeaders(a);let c=Em([I,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(T)},a.timeout?{"X-Stainless-Timeout":String(Math.trunc(a.timeout/1e3))}:{}),U2()),this._options.defaultHeaders,y,a.headers,S]);return this.validateHeaders(c),c.values}buildBody({options:{body:a,headers:f}}){if(!a)return{bodyHeaders:void 0,body:void 0};const y=Em([f]);return ArrayBuffer.isView(a)||a instanceof ArrayBuffer||a instanceof DataView||typeof a=="string"&&y.values.has("content-type")||globalThis.Blob&&a instanceof globalThis.Blob||a instanceof FormData||a instanceof URLSearchParams||globalThis.ReadableStream&&a instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:a}:typeof a=="object"&&(Symbol.asyncIterator in a||Symbol.iterator in a&&"next"in a&&typeof a.next=="function")?{bodyHeaders:void 0,body:G2(a)}:this.encoder({body:a,headers:y})}}Wg.DEFAULT_TIMEOUT=6e4;class no extends Wg{constructor(){super(...arguments),this.interactions=new Xv(this)}}Wv=no;no.GeminiNextGenAPIClient=Wv;no.GeminiNextGenAPIClientError=Va;no.APIError=us;no.APIConnectionError=Xg;no.APIConnectionTimeoutError=zv;no.APIUserAbortError=B_;no.NotFoundError=Fv;no.ConflictError=Bv;no.RateLimitError=Uv;no.BadRequestError=Lv;no.AuthenticationError=Nv;no.InternalServerError=Vv;no.PermissionDeniedError=kv;no.UnprocessableEntityError=Ov;no.toFile=X2;no.Interactions=Xv;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function lC(u,a){const f={},y=E(u,["name"]);return y!=null&&M(f,["_url","name"],y),f}function uC(u,a){const f={},y=E(u,["name"]);return y!=null&&M(f,["_url","name"],y),f}function cC(u,a){const f={},y=E(u,["sdkHttpResponse"]);return y!=null&&M(f,["sdkHttpResponse"],y),f}function hC(u,a){const f={},y=E(u,["sdkHttpResponse"]);return y!=null&&M(f,["sdkHttpResponse"],y),f}function dC(u,a,f){const y={};if(E(u,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const T=E(u,["tunedModelDisplayName"]);if(a!==void 0&&T!=null&&M(a,["displayName"],T),E(u,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const I=E(u,["epochCount"]);a!==void 0&&I!=null&&M(a,["tuningTask","hyperparameters","epochCount"],I);const S=E(u,["learningRateMultiplier"]);if(S!=null&&M(y,["tuningTask","hyperparameters","learningRateMultiplier"],S),E(u,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(E(u,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(E(u,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");if(E(u,["tuningMode"])!==void 0)throw new Error("tuningMode parameter is not supported in Gemini API.");if(E(u,["customBaseModel"])!==void 0)throw new Error("customBaseModel parameter is not supported in Gemini API.");const c=E(u,["batchSize"]);a!==void 0&&c!=null&&M(a,["tuningTask","hyperparameters","batchSize"],c);const F=E(u,["learningRate"]);if(a!==void 0&&F!=null&&M(a,["tuningTask","hyperparameters","learningRate"],F),E(u,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(E(u,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");if(E(u,["baseTeacherModel"])!==void 0)throw new Error("baseTeacherModel parameter is not supported in Gemini API.");if(E(u,["tunedTeacherModelSource"])!==void 0)throw new Error("tunedTeacherModelSource parameter is not supported in Gemini API.");if(E(u,["sftLossWeightMultiplier"])!==void 0)throw new Error("sftLossWeightMultiplier parameter is not supported in Gemini API.");if(E(u,["outputUri"])!==void 0)throw new Error("outputUri parameter is not supported in Gemini API.");return y}function fC(u,a,f){const y={};let T=E(f,["config","method"]);if(T===void 0&&(T="SUPERVISED_FINE_TUNING"),T==="SUPERVISED_FINE_TUNING"){const nt=E(u,["validationDataset"]);a!==void 0&&nt!=null&&M(a,["supervisedTuningSpec"],S_(nt))}else if(T==="PREFERENCE_TUNING"){const nt=E(u,["validationDataset"]);a!==void 0&&nt!=null&&M(a,["preferenceOptimizationSpec"],S_(nt))}else if(T==="DISTILLATION"){const nt=E(u,["validationDataset"]);a!==void 0&&nt!=null&&M(a,["distillationSpec"],S_(nt))}const I=E(u,["tunedModelDisplayName"]);a!==void 0&&I!=null&&M(a,["tunedModelDisplayName"],I);const S=E(u,["description"]);a!==void 0&&S!=null&&M(a,["description"],S);let c=E(f,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const nt=E(u,["epochCount"]);a!==void 0&&nt!=null&&M(a,["supervisedTuningSpec","hyperParameters","epochCount"],nt)}else if(c==="PREFERENCE_TUNING"){const nt=E(u,["epochCount"]);a!==void 0&&nt!=null&&M(a,["preferenceOptimizationSpec","hyperParameters","epochCount"],nt)}else if(c==="DISTILLATION"){const nt=E(u,["epochCount"]);a!==void 0&&nt!=null&&M(a,["distillationSpec","hyperParameters","epochCount"],nt)}let F=E(f,["config","method"]);if(F===void 0&&(F="SUPERVISED_FINE_TUNING"),F==="SUPERVISED_FINE_TUNING"){const nt=E(u,["learningRateMultiplier"]);a!==void 0&&nt!=null&&M(a,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],nt)}else if(F==="PREFERENCE_TUNING"){const nt=E(u,["learningRateMultiplier"]);a!==void 0&&nt!=null&&M(a,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],nt)}else if(F==="DISTILLATION"){const nt=E(u,["learningRateMultiplier"]);a!==void 0&&nt!=null&&M(a,["distillationSpec","hyperParameters","learningRateMultiplier"],nt)}let k=E(f,["config","method"]);if(k===void 0&&(k="SUPERVISED_FINE_TUNING"),k==="SUPERVISED_FINE_TUNING"){const nt=E(u,["exportLastCheckpointOnly"]);a!==void 0&&nt!=null&&M(a,["supervisedTuningSpec","exportLastCheckpointOnly"],nt)}else if(k==="PREFERENCE_TUNING"){const nt=E(u,["exportLastCheckpointOnly"]);a!==void 0&&nt!=null&&M(a,["preferenceOptimizationSpec","exportLastCheckpointOnly"],nt)}else if(k==="DISTILLATION"){const nt=E(u,["exportLastCheckpointOnly"]);a!==void 0&&nt!=null&&M(a,["distillationSpec","exportLastCheckpointOnly"],nt)}let G=E(f,["config","method"]);if(G===void 0&&(G="SUPERVISED_FINE_TUNING"),G==="SUPERVISED_FINE_TUNING"){const nt=E(u,["adapterSize"]);a!==void 0&&nt!=null&&M(a,["supervisedTuningSpec","hyperParameters","adapterSize"],nt)}else if(G==="PREFERENCE_TUNING"){const nt=E(u,["adapterSize"]);a!==void 0&&nt!=null&&M(a,["preferenceOptimizationSpec","hyperParameters","adapterSize"],nt)}else if(G==="DISTILLATION"){const nt=E(u,["adapterSize"]);a!==void 0&&nt!=null&&M(a,["distillationSpec","hyperParameters","adapterSize"],nt)}let K=E(f,["config","method"]);if(K===void 0&&(K="SUPERVISED_FINE_TUNING"),K==="SUPERVISED_FINE_TUNING"){const nt=E(u,["tuningMode"]);a!==void 0&&nt!=null&&M(a,["supervisedTuningSpec","tuningMode"],nt)}const ee=E(u,["customBaseModel"]);a!==void 0&&ee!=null&&M(a,["customBaseModel"],ee);let ye=E(f,["config","method"]);if(ye===void 0&&(ye="SUPERVISED_FINE_TUNING"),ye==="SUPERVISED_FINE_TUNING"){const nt=E(u,["batchSize"]);a!==void 0&&nt!=null&&M(a,["supervisedTuningSpec","hyperParameters","batchSize"],nt)}let Le=E(f,["config","method"]);if(Le===void 0&&(Le="SUPERVISED_FINE_TUNING"),Le==="SUPERVISED_FINE_TUNING"){const nt=E(u,["learningRate"]);a!==void 0&&nt!=null&&M(a,["supervisedTuningSpec","hyperParameters","learningRate"],nt)}const Ne=E(u,["labels"]);a!==void 0&&Ne!=null&&M(a,["labels"],Ne);const se=E(u,["beta"]);a!==void 0&&se!=null&&M(a,["preferenceOptimizationSpec","hyperParameters","beta"],se);const Ye=E(u,["baseTeacherModel"]);a!==void 0&&Ye!=null&&M(a,["distillationSpec","baseTeacherModel"],Ye);const st=E(u,["tunedTeacherModelSource"]);a!==void 0&&st!=null&&M(a,["distillationSpec","tunedTeacherModelSource"],st);const We=E(u,["sftLossWeightMultiplier"]);a!==void 0&&We!=null&&M(a,["distillationSpec","hyperParameters","sftLossWeightMultiplier"],We);const gt=E(u,["outputUri"]);return a!==void 0&&gt!=null&&M(a,["outputUri"],gt),y}function pC(u,a){const f={},y=E(u,["baseModel"]);y!=null&&M(f,["baseModel"],y);const T=E(u,["preTunedModel"]);T!=null&&M(f,["preTunedModel"],T);const I=E(u,["trainingDataset"]);I!=null&&EC(I);const S=E(u,["config"]);return S!=null&&dC(S,f),f}function mC(u,a){const f={},y=E(u,["baseModel"]);y!=null&&M(f,["baseModel"],y);const T=E(u,["preTunedModel"]);T!=null&&M(f,["preTunedModel"],T);const I=E(u,["trainingDataset"]);I!=null&&CC(I,f,a);const S=E(u,["config"]);return S!=null&&fC(S,f,a),f}function gC(u,a){const f={},y=E(u,["name"]);return y!=null&&M(f,["_url","name"],y),f}function _C(u,a){const f={},y=E(u,["name"]);return y!=null&&M(f,["_url","name"],y),f}function yC(u,a,f){const y={},T=E(u,["pageSize"]);a!==void 0&&T!=null&&M(a,["_query","pageSize"],T);const I=E(u,["pageToken"]);a!==void 0&&I!=null&&M(a,["_query","pageToken"],I);const S=E(u,["filter"]);return a!==void 0&&S!=null&&M(a,["_query","filter"],S),y}function vC(u,a,f){const y={},T=E(u,["pageSize"]);a!==void 0&&T!=null&&M(a,["_query","pageSize"],T);const I=E(u,["pageToken"]);a!==void 0&&I!=null&&M(a,["_query","pageToken"],I);const S=E(u,["filter"]);return a!==void 0&&S!=null&&M(a,["_query","filter"],S),y}function xC(u,a){const f={},y=E(u,["config"]);return y!=null&&yC(y,f),f}function bC(u,a){const f={},y=E(u,["config"]);return y!=null&&vC(y,f),f}function wC(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["nextPageToken"]);T!=null&&M(f,["nextPageToken"],T);const I=E(u,["tunedModels"]);if(I!=null){let S=I;Array.isArray(S)&&(S=S.map(c=>Kv(c))),M(f,["tuningJobs"],S)}return f}function TC(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["nextPageToken"]);T!=null&&M(f,["nextPageToken"],T);const I=E(u,["tuningJobs"]);if(I!=null){let S=I;Array.isArray(S)&&(S=S.map(c=>V_(c))),M(f,["tuningJobs"],S)}return f}function SC(u,a){const f={},y=E(u,["name"]);y!=null&&M(f,["model"],y);const T=E(u,["name"]);return T!=null&&M(f,["endpoint"],T),f}function EC(u,a){const f={};if(E(u,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(E(u,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const y=E(u,["examples"]);if(y!=null){let T=y;Array.isArray(T)&&(T=T.map(I=>I)),M(f,["examples","examples"],T)}return f}function CC(u,a,f){const y={};let T=E(f,["config","method"]);if(T===void 0&&(T="SUPERVISED_FINE_TUNING"),T==="SUPERVISED_FINE_TUNING"){const S=E(u,["gcsUri"]);a!==void 0&&S!=null&&M(a,["supervisedTuningSpec","trainingDatasetUri"],S)}else if(T==="PREFERENCE_TUNING"){const S=E(u,["gcsUri"]);a!==void 0&&S!=null&&M(a,["preferenceOptimizationSpec","trainingDatasetUri"],S)}else if(T==="DISTILLATION"){const S=E(u,["gcsUri"]);a!==void 0&&S!=null&&M(a,["distillationSpec","promptDatasetUri"],S)}let I=E(f,["config","method"]);if(I===void 0&&(I="SUPERVISED_FINE_TUNING"),I==="SUPERVISED_FINE_TUNING"){const S=E(u,["vertexDatasetResource"]);a!==void 0&&S!=null&&M(a,["supervisedTuningSpec","trainingDatasetUri"],S)}else if(I==="PREFERENCE_TUNING"){const S=E(u,["vertexDatasetResource"]);a!==void 0&&S!=null&&M(a,["preferenceOptimizationSpec","trainingDatasetUri"],S)}else if(I==="DISTILLATION"){const S=E(u,["vertexDatasetResource"]);a!==void 0&&S!=null&&M(a,["distillationSpec","promptDatasetUri"],S)}if(E(u,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return y}function Kv(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["name"]);T!=null&&M(f,["name"],T);const I=E(u,["state"]);I!=null&&M(f,["state"],pv(I));const S=E(u,["createTime"]);S!=null&&M(f,["createTime"],S);const c=E(u,["tuningTask","startTime"]);c!=null&&M(f,["startTime"],c);const F=E(u,["tuningTask","completeTime"]);F!=null&&M(f,["endTime"],F);const k=E(u,["updateTime"]);k!=null&&M(f,["updateTime"],k);const G=E(u,["description"]);G!=null&&M(f,["description"],G);const K=E(u,["baseModel"]);K!=null&&M(f,["baseModel"],K);const ee=E(u,["_self"]);return ee!=null&&M(f,["tunedModel"],SC(ee)),f}function V_(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["name"]);T!=null&&M(f,["name"],T);const I=E(u,["state"]);I!=null&&M(f,["state"],pv(I));const S=E(u,["createTime"]);S!=null&&M(f,["createTime"],S);const c=E(u,["startTime"]);c!=null&&M(f,["startTime"],c);const F=E(u,["endTime"]);F!=null&&M(f,["endTime"],F);const k=E(u,["updateTime"]);k!=null&&M(f,["updateTime"],k);const G=E(u,["error"]);G!=null&&M(f,["error"],G);const K=E(u,["description"]);K!=null&&M(f,["description"],K);const ee=E(u,["baseModel"]);ee!=null&&M(f,["baseModel"],ee);const ye=E(u,["tunedModel"]);ye!=null&&M(f,["tunedModel"],ye);const Le=E(u,["preTunedModel"]);Le!=null&&M(f,["preTunedModel"],Le);const Ne=E(u,["supervisedTuningSpec"]);Ne!=null&&M(f,["supervisedTuningSpec"],Ne);const se=E(u,["preferenceOptimizationSpec"]);se!=null&&M(f,["preferenceOptimizationSpec"],se);const Ye=E(u,["distillationSpec"]);Ye!=null&&M(f,["distillationSpec"],Ye);const st=E(u,["tuningDataStats"]);st!=null&&M(f,["tuningDataStats"],st);const We=E(u,["encryptionSpec"]);We!=null&&M(f,["encryptionSpec"],We);const gt=E(u,["partnerModelTuningSpec"]);gt!=null&&M(f,["partnerModelTuningSpec"],gt);const nt=E(u,["customBaseModel"]);nt!=null&&M(f,["customBaseModel"],nt);const zt=E(u,["experiment"]);zt!=null&&M(f,["experiment"],zt);const _t=E(u,["labels"]);_t!=null&&M(f,["labels"],_t);const Ut=E(u,["outputUri"]);Ut!=null&&M(f,["outputUri"],Ut);const At=E(u,["pipelineJob"]);At!=null&&M(f,["pipelineJob"],At);const Xt=E(u,["serviceAccount"]);Xt!=null&&M(f,["serviceAccount"],Xt);const tn=E(u,["tunedModelDisplayName"]);tn!=null&&M(f,["tunedModelDisplayName"],tn);const an=E(u,["veoTuningSpec"]);return an!=null&&M(f,["veoTuningSpec"],an),f}function AC(u,a){const f={},y=E(u,["sdkHttpResponse"]);y!=null&&M(f,["sdkHttpResponse"],y);const T=E(u,["name"]);T!=null&&M(f,["name"],T);const I=E(u,["metadata"]);I!=null&&M(f,["metadata"],I);const S=E(u,["done"]);S!=null&&M(f,["done"],S);const c=E(u,["error"]);return c!=null&&M(f,["error"],c),f}function S_(u,a){const f={},y=E(u,["gcsUri"]);y!=null&&M(f,["validationDatasetUri"],y);const T=E(u,["vertexDatasetResource"]);return T!=null&&M(f,["validationDatasetUri"],T),f}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class MC extends Sc{constructor(a){super(),this.apiClient=a,this.list=async(f={})=>new Od(Tc.PAGED_ITEM_TUNING_JOBS,y=>this.listInternal(y),await this.listInternal(f),f),this.get=async f=>await this.getInternal(f),this.tune=async f=>{var y;if(this.apiClient.isVertexAI())if(f.baseModel.startsWith("projects/")){const T={tunedModelName:f.baseModel};!((y=f.config)===null||y===void 0)&&y.preTunedModelCheckpointId&&(T.checkpointId=f.config.preTunedModelCheckpointId);const I=Object.assign(Object.assign({},f),{preTunedModel:T});return I.baseModel=void 0,await this.tuneInternal(I)}else{const T=Object.assign({},f);return await this.tuneInternal(T)}else{const T=Object.assign({},f),I=await this.tuneMldevInternal(T);let S="";return I.metadata!==void 0&&I.metadata.tunedModel!==void 0?S=I.metadata.tunedModel:I.name!==void 0&&I.name.includes("/operations/")&&(S=I.name.split("/operations/")[0]),{name:S,state:M_.JOB_STATE_QUEUED}}}}async getInternal(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=_C(a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>V_(G))}else{const k=gC(a);return c=Pt("{name}",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>Kv(G))}}async listInternal(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=bC(a);return c=Pt("tuningJobs",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=TC(G),ee=new R0;return Object.assign(ee,K),ee})}else{const k=xC(a);return c=Pt("tunedModels",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"GET",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=wC(G),ee=new R0;return Object.assign(ee,K),ee})}}async cancel(a){var f,y,T,I;let S,c="",F={};if(this.apiClient.isVertexAI()){const k=uC(a);return c=Pt("{name}:cancel",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=hC(G),ee=new P0;return Object.assign(ee,K),ee})}else{const k=lC(a);return c=Pt("{name}:cancel",k._url),F=k._query,delete k._url,delete k._query,S=this.apiClient.request({path:c,queryParams:F,body:JSON.stringify(k),httpMethod:"POST",httpOptions:(T=a.config)===null||T===void 0?void 0:T.httpOptions,abortSignal:(I=a.config)===null||I===void 0?void 0:I.abortSignal}).then(G=>G.json().then(K=>{const ee=K;return ee.sdkHttpResponse={headers:G.headers},ee})),S.then(G=>{const K=cC(G),ee=new P0;return Object.assign(ee,K),ee})}}async tuneInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI()){const c=mC(a,a);return I=Pt("tuningJobs",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json().then(k=>{const G=k;return G.sdkHttpResponse={headers:F.headers},G})),T.then(F=>V_(F))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(a){var f,y;let T,I="",S={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=pC(a);return I=Pt("tunedModels",c._url),S=c._query,delete c._url,delete c._query,T=this.apiClient.request({path:I,queryParams:S,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(f=a.config)===null||f===void 0?void 0:f.httpOptions,abortSignal:(y=a.config)===null||y===void 0?void 0:y.abortSignal}).then(F=>F.json().then(k=>{const G=k;return G.sdkHttpResponse={headers:F.headers},G})),T.then(F=>AC(F))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class IC{async download(a,f){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const RC=1024*1024*8,PC=3,DC=1e3,zC=2,Zg="x-goog-upload-status";async function LC(u,a,f){var y;const T=await Qv(u,a,f),I=await(T==null?void 0:T.json());if(((y=T==null?void 0:T.headers)===null||y===void 0?void 0:y[Zg])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return I.file}async function NC(u,a,f){var y;const T=await Qv(u,a,f),I=await(T==null?void 0:T.json());if(((y=T==null?void 0:T.headers)===null||y===void 0?void 0:y[Zg])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const S=lv(I),c=new Z_;return Object.assign(c,S),c}async function Qv(u,a,f){var y,T;let I=0,S=0,c=new R_(new Response),F="upload";for(I=u.size;S<I;){const k=Math.min(RC,I-S),G=u.slice(S,S+k);S+k>=I&&(F+=", finalize");let K=0,ee=DC;for(;K<PC&&(c=await f.request({path:"",body:G,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:a,headers:{"X-Goog-Upload-Command":F,"X-Goog-Upload-Offset":String(S),"Content-Length":String(k)}}}),!(!((y=c==null?void 0:c.headers)===null||y===void 0)&&y[Zg]));)K++,await FC(ee),ee=ee*zC;if(S+=k,((T=c==null?void 0:c.headers)===null||T===void 0?void 0:T[Zg])!=="active")break;if(I<=S)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return c}async function kC(u){return{size:u.size,type:u.type}}function FC(u){return new Promise(a=>setTimeout(a,u))}class BC{async upload(a,f,y){if(typeof a=="string")throw new Error("File path is not supported in browser uploader.");return await LC(a,f,y)}async uploadToFileSearchStore(a,f,y){if(typeof a=="string")throw new Error("File path is not supported in browser uploader.");return await NC(a,f,y)}async stat(a){if(typeof a=="string")throw new Error("File path is not supported in browser uploader.");return await kC(a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class OC{create(a,f,y){return new UC(a,f,y)}}class UC{constructor(a,f,y){this.url=a,this.headers=f,this.callbacks=y}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(a){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(a)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const rv="x-goog-api-key";class VC{constructor(a){this.apiKey=a}async addAuthHeaders(a,f){if(a.get(rv)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");a.append(rv,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const GC="gl-node/";class ex{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const a=this.httpOptions;a!=null&&a.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const f=new no({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:a==null?void 0:a.timeout});return this._interactions=f.interactions,this._interactions}constructor(a){var f;if(a.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(a.project||a.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(f=a.vertexai)!==null&&f!==void 0?f:!1,this.apiKey=a.apiKey;const y=zb(a.httpOptions,a.vertexai,void 0,void 0);y&&(a.httpOptions?a.httpOptions.baseUrl=y:a.httpOptions={baseUrl:y}),this.apiVersion=a.apiVersion,this.httpOptions=a.httpOptions;const T=new VC(this.apiKey);this.apiClient=new kE({auth:T,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:GC+"web",uploader:new BC,downloader:new IC}),this.models=new t2(this.apiClient),this.live=new XE(this.apiClient,T,new OC),this.batches=new uw(this.apiClient),this.chats=new Hw(this.models,this.apiClient),this.caches=new Vw(this.apiClient),this.files=new nT(this.apiClient),this.operations=new n2(this.apiClient),this.authTokens=new y2(this.apiClient),this.tunings=new MC(this.apiClient),this.fileSearchStores=new C2(this.apiClient)}}async function tx(u,a=3,f=3e3){let y;for(let T=0;T<a;T++)try{return await u()}catch(I){y=I;const S=JSON.stringify(I).toUpperCase();if(((I==null?void 0:I.status)===429||(I==null?void 0:I.code)===429||S.includes("429")||S.includes("QUOTA"))&&T<a-1){const F=f*Math.pow(2,T);await new Promise(k=>setTimeout(k,F));continue}throw I}throw y}const qC=`
 (Twin-City OS) Google Maps  Google Search 

# 
1.  Google Maps Grounding 
2.  7  Agent 

#  (Agent Cluster)
- [AlphaChicago Safety Sentinel]: 3D
- [Spatial Architect]: 3D
- [Community Reputation Steward]: /
- [Merchant Pulse]: 
- [Tenant Concierge]: 
- [Infrastructure Janitor]: Wi-Fi
- [Settlement Mediator]: 

# 

-  Google Maps 
-  Agent
- [Agent]: ...
-  <internal_thought> 
`,HC=async u=>{var f,y,T;const a=new ex({apiKey:"PLACEHOLDER_API_KEY"});try{const I=await tx(()=>a.models.generateContent({model:"gemini-2.5-flash",contents:u,config:{systemInstruction:qC,temperature:.7,tools:[{googleMaps:{}},{googleSearch:{}}],toolConfig:{retrievalConfig:{latLng:{latitude:Su.lat,longitude:Su.lng}}}}}));return{text:I.text||"Neural connection established, but no data received.",grounding:((T=(y=(f=I.candidates)==null?void 0:f[0])==null?void 0:y.groundingMetadata)==null?void 0:T.groundingChunks)||[]}}catch(I){return console.error("Gemini API Error:",I),{text:"WARNING: Neural link unstable. Communication with the city agents has been interrupted.",grounding:[]}}},ZC=async u=>{const a=new ex({apiKey:"PLACEHOLDER_API_KEY"});try{const y=((await tx(()=>a.models.generateContent({model:"gemini-3-flash-preview",contents:`Analyze this prompt and return ONLY the most relevant Agent ID: SAFETY_SENTINEL, SPATIAL_ARCHITECT, REPUTATION_STEWARD, MERCHANT_PULSE, TENANT_CONCIERGE, INFRA_JANITOR, SETTLEMENT_MEDIATOR. 
        Prompt: "${u}"`,config:{temperature:0}}))).text||"").trim().toUpperCase();return y.includes("SAFETY")?pn.SAFETY_SENTINEL:y.includes("SPATIAL")||y.includes("ARCHITECT")?pn.SPATIAL_ARCHITECT:y.includes("REPUTATION")||y.includes("CREDIT")?pn.REPUTATION_STEWARD:y.includes("MERCHANT")||y.includes("PULSE")?pn.MERCHANT_PULSE:y.includes("TENANT")||y.includes("CONCIERGE")?pn.TENANT_CONCIERGE:y.includes("INFRA")||y.includes("JANITOR")?pn.INFRA_JANITOR:y.includes("SETTLEMENT")||y.includes("MEDIATOR")?pn.SETTLEMENT_MEDIATOR:pn.CITY_CORE}catch{return pn.CITY_CORE}},$C="https://api.dify.ai/v1/chat-messages",jC="app-6aG838IxXLdSFQT5pkNxgFXx",YC="https://api.dify.ai/v1/chat-messages",XC="app-app-eJf7ei2wfBj8S6tkMn5HgkBA",JC="AIzaSyCqNCADvhoq7tiIjLMPG8Avv2FNnkkJYHk",WC=async(u,a,f)=>{try{const y=await fetch(f,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:{},query:u,response_mode:"blocking",user:"twin-city-user"})});return y.ok?await y.json():null}catch(y){return console.error("Dify Fetch Error:",y),null}},KC=async(u,a,f)=>{try{const y=await fetch(f,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:{query:u},response_mode:"blocking",user:"twin-city-user"})});return y.ok?await y.json():null}catch(y){return console.error("Dify Workflow Fetch Error:",y),null}},QC=async u=>{try{const a=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(u)}&key=${JC}`;return await(await fetch(a)).json()}catch(a){return console.error("Geo API Error:",a),{results:[]}}},eA=[{email:"alex.landlord@gmail.com",name:"Alex Rivera",role:"Landlord",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Alex",eigenCreditScore:842},{email:"maria.merchant@gmail.com",name:"Maria Chen",role:"Merchant",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Maria",eigenCreditScore:915},{email:"tom.tenant@gmail.com",name:"Tom Jenkins",role:"Tenant",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Tom",eigenCreditScore:788}],tA=[{agentId:pn.SAFETY_SENTINEL,text:""},{agentId:pn.INFRA_JANITOR,text:"Wacker Dr "},{agentId:pn.CITY_CORE,text:"Loop  100% "}],nA=()=>{const[u,a]=Tn.useState({id:"",name:"",email:"",avatar:"",isAuthenticated:!1}),[f,y]=Tn.useState("LOGIN"),[T,I]=Tn.useState("HOME"),[S,c]=Tn.useState(pn.CITY_CORE),[F,k]=Tn.useState([]),[G,K]=Tn.useState(!1),[ee,ye]=Tn.useState("NONE"),[Le,Ne]=Tn.useState([]),[se,Ye]=Tn.useState([]),[st,We]=Tn.useState(!1),[gt,nt]=Tn.useState([]),[zt,_t]=Tn.useState(!1),[Ut,At]=Tn.useState(null),[Xt,tn]=Tn.useState(!1),[an,An]=Tn.useState(!1),[kn,si]=Tn.useState(null),[Qe,ft]=Tn.useState("WELCOME"),[Dt,Lt]=Tn.useState(0);Tn.useEffect(()=>{if(f==="SIMULATION"){const Nt=[{id:"test-point-001",lat:Su.lat,lng:Su.lng,label:"Loop Center",type:"SEARCH_RESULT"},{id:"test-point-002",lat:Su.lat+.002,lng:Su.lng+.002,label:"Millennium Park",type:"SEARCH_RESULT"},{id:"test-point-003",lat:Su.lat-.001,lng:Su.lng+.003,label:"Art Institute",type:"SEARCH_RESULT"}];console.log("Adding test points:",Nt),Ye(Nt)}},[f]);const yn=["Contacting Google Authentication SDK...","Retrieving user_email and access_token...","Initializing Digital Twin Identity...","Generating Base-compatible Embedded Wallet...","Binding Google Identity to Neural DID...","Finalizing Slashable Security Value: 12.5 ETH"];Tn.useEffect(()=>{if(f==="HANDSHAKE")if(Dt<yn.length){const Nt=setTimeout(()=>Lt(gn=>gn+1),600);return()=>clearTimeout(Nt)}else setTimeout(()=>y("SIMULATION"),800)},[f,Dt]),Tn.useEffect(()=>{if(f==="SIMULATION"&&F.length===0){const Nt=setTimeout(()=>{const gn={id:"welcome-001",sender:pn.CITY_CORE,text:`${u.name} Neo-Chicago Core Loop 

 ${u.role}  Loop `,timestamp:new Date};k([gn]),nt(tA.map(ei=>({...ei,id:Math.random().toString(),time:"00:00:01"}))),c(pn.CITY_CORE)},1e3);return()=>clearTimeout(Nt)}},[f,F.length,u.name,u.role]),Tn.useEffect(()=>{if(f!=="SIMULATION")return;const Nt=setInterval(()=>{const gn=[{agentId:pn.SAFETY_SENTINEL,text:"Safety Patrol Node 04: "},{agentId:pn.INFRA_JANITOR,text:"WiFi  #88A  5G "},{agentId:pn.REPUTATION_STEWARD,text:"#Lease-9902"},{agentId:pn.MERCHANT_PULSE,text:"Millennium Park Traffic Index 88%"},{agentId:pn.CITY_CORE,text:" Loop "}],bn={...gn[Math.floor(Math.random()*gn.length)],id:Date.now().toString(),time:new Date().toLocaleTimeString([],{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})};nt(Pi=>[bn,...Pi].slice(0,30))},5e3);return()=>clearInterval(Nt)},[f]);const Me=Nt=>{a({...Nt,id:`usr-${Date.now()}`,isAuthenticated:!0,did:`did:twin:usr:${Nt.name.toLowerCase().replace(" ","-")}`,embeddedWallet:`0x${Math.random().toString(16).slice(2,42)}`,eigenCreditScore:Nt.eigenCreditScore||750,slashableValue:"12.5 ETH"}),y("HANDSHAKE")},at=()=>{a({id:"",name:"",email:"",avatar:"",isAuthenticated:!1}),y("LOGIN"),k([]),Lt(0),ft("WELCOME"),Ne([]),Ye([]),_t(!1)},Et=async Nt=>{const gn={id:Date.now().toString(),sender:"USER",text:Nt,timestamp:new Date};k(ei=>[...ei,gn]),K(!0);try{const ei=await WC(Nt,jC,$C);let bn=null;if(ei&&ei.answer)try{const un=ei.answer.replace(/```json\n?|```/g,"").trim();bn=JSON.parse(un)}catch(un){console.warn("JSON Parse Error",un)}if(bn&&bn.intent==="Area_Search"){const un=bn.keywords;console.log(`Searching for: ${un}`);const ar=await QC(un);if(ar.results&&ar.results.length>0){const wo=ar.results[0].geometry.location,Ho=Number(wo.lat),Dr=Number(wo.lng),io=[{id:`geo-${Date.now()}-1`,lat:Ho,lng:Dr,label:`${un}`,type:"SEARCH_RESULT"},{id:`geo-${Date.now()}-2`,lat:Ho+.0015,lng:Dr+.0015,label:`${un} (Hotspot)`,type:"SEARCH_RESULT"}];console.log("Search points created:",io),Ye(Di=>{const Sr=[...Di,...io];return console.log("Updated groundedPoints:",Sr),Sr});const Bs={id:Date.now().toString(),sender:pn.SPATIAL_ARCHITECT,text:`[Spatial Architect]:  (Confidence: ${bn.confidence})

 Google GeoAPI  "${un}" 
 2 `,timestamp:new Date,metadata:{grounding:io}};k(Di=>[...Di,Bs]),c(pn.SPATIAL_ARCHITECT),K(!1);return}}if(Qe==="WELCOME"&&(Nt.includes("")||Nt.includes("rent")||Nt.includes("apartment"))){ft("PREFERENCES");const un={id:Date.now().toString(),sender:pn.CITY_CORE,text:`[Neo-Chicago Core]: 
1.  Safety Sentinel 
2.  Merchant Pulse `,timestamp:new Date};setTimeout(()=>{k(ar=>[...ar,un]),K(!1)},1e3);return}const Pi=await ZC(Nt);c(Pi);const{text:er,grounding:wn}=await HC(Nt);(wn==null?void 0:wn.length)>0&&Ye(un=>[...un,...wn]);const ji=er.replace(/<internal_thought>[\s\S]*?<\/internal_thought>/g,"").trim(),sr={id:Date.now().toString(),sender:Pi,text:ji,timestamp:new Date,metadata:{grounding:wn}};k(un=>[...un,sr])}catch(ei){console.error(ei),k(bn=>[...bn,{id:Date.now().toString(),sender:pn.CITY_CORE,text:"",timestamp:new Date}])}finally{K(!1)}},Rt=Nt=>{Ne([Nt.id]),At(Nt),tn(!0),st&&We(!1)},$t=async()=>{var ei,bn,Pi;const Nt={id:Ut.id,label:Ut.label||Ut.name,lat:Ut.lat||((ei=Ut.coordinates)==null?void 0:ei.lat),lng:Ut.lng||((bn=Ut.coordinates)==null?void 0:bn.lng),type:Ut.type||"unknown",category:Ut.category,address:Ut.address},gn=`: ${JSON.stringify(Nt)}`;K(!0);try{const er=await KC(gn,XC,YC),wn={id:Date.now().toString(),sender:pn.SPATIAL_ARCHITECT,text:`[Spatial Architect]:  "${Nt.label}" 

...`,timestamp:new Date,metadata:{difyResponse:(er==null?void 0:er.answer)||((Pi=er==null?void 0:er.outputs)==null?void 0:Pi.result)||"...",lumalabsUrl:"https://lumalabs.ai/capture/0fd66136-b18e-4389-a99c-092acaeeb1d4"}};k(ji=>[...ji,wn]),si(er),An(!0)}catch(er){console.error("Dify API Error:",er),k(wn=>[...wn,{id:Date.now().toString(),sender:pn.CITY_CORE,text:"",timestamp:new Date}])}finally{K(!1)}},Vt=()=>{tn(!1)},mn=({isOpen:Nt,onClose:gn,lumalabsUrl:ei,difyData:bn})=>{var wn;if(!Nt)return null;const er=(ji=>{let sr=ji.replace("/capture/","/embed/");const ar=sr.includes("?")?"&":"?";return`${sr}${ar}mode=sparkles&background=%23ffffff&color=%23000000&showTitle=true&loadBg=true&logoPosition=bottom-left&infoPosition=bottom-right&cinematicVideo=false&showMenu=false`})(ei);return _e.jsx("div",{className:"fixed inset-0 z-[300] bg-black/80 backdrop-blur-xl flex items-center justify-center p-4 animate-in fade-in duration-300",children:_e.jsxs("div",{className:"glass-panel w-full max-w-6xl h-[85vh] rounded-[2rem] border border-white/10 overflow-hidden relative shadow-2xl shadow-blue-900/20",children:[_e.jsx("button",{onClick:gn,className:"absolute top-6 right-6 z-20 w-10 h-10 bg-black/50 hover:bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center transition-all border border-white/10",children:_e.jsx(C_,{className:"text-white",size:20})}),_e.jsx("div",{className:"absolute top-0 left-0 right-0 h-16 bg-gradient-to-b from-black/80 to-transparent flex items-center px-8 z-10 pointer-events-none",children:_e.jsxs("div",{className:"flex items-center gap-3",children:[_e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center backdrop-blur-sm border border-blue-500/30",children:_e.jsx(E_,{className:"text-blue-400",size:16})}),_e.jsx("span",{className:"text-white/90 font-mono text-sm tracking-wider",children:"NEURAL_SPATIAL_RECONSTRUCTION // LUMA_AI"})]})}),_e.jsx("div",{className:"w-full h-full bg-[#050505]",children:_e.jsx("iframe",{src:er,className:"w-full h-full",frameBorder:"0",title:"Luma Labs 3D Embed",style:{border:"none"},allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; xr-spatial-tracking",allowFullScreen:!0})}),bn&&_e.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-10 p-6 pointer-events-none",children:_e.jsxs("div",{className:"glass-panel p-6 rounded-2xl border border-white/10 w-full max-w-2xl mx-auto backdrop-blur-xl bg-black/40 pointer-events-auto transition-all hover:bg-black/60",children:[_e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-xs text-blue-400 font-bold uppercase tracking-widest",children:[_e.jsx(Ng,{size:12}),_e.jsx("span",{children:"Dify Agent Analysis"})]}),_e.jsx("div",{className:"text-white/80 text-sm font-mono leading-relaxed max-h-32 overflow-y-auto pr-2 custom-scrollbar",children:typeof bn=="string"?bn:(bn==null?void 0:bn.answer)||((wn=bn==null?void 0:bn.outputs)==null?void 0:wn.result)||JSON.stringify(bn,null,2)})]})})]})})};return f==="LOGIN"?_e.jsxs("div",{className:"fixed inset-0 z-[100] bg-[#020617] flex items-center justify-center p-6 overflow-hidden",children:[_e.jsx("div",{className:"absolute top-[-20%] left-[-10%] w-[600px] h-[600px] bg-blue-600/20 rounded-full blur-[120px] pointer-events-none mix-blend-screen"}),_e.jsx("div",{className:"absolute bottom-[-20%] right-[-10%] w-[600px] h-[600px] bg-purple-600/20 rounded-full blur-[120px] pointer-events-none mix-blend-screen"}),_e.jsxs("div",{className:"max-w-md w-full glass-panel rounded-[3rem] p-12 text-center border border-white/10 shadow-[0_0_80px_rgba(0,0,0,0.5)] relative overflow-hidden z-10",children:[_e.jsxs("div",{className:"w-24 h-24 bg-blue-600 rounded-[2rem] flex items-center justify-center mx-auto mb-10 relative shadow-xl shadow-blue-500/30 group",children:[_e.jsx("div",{className:"absolute inset-0 bg-blue-400 rounded-[2rem] blur opacity-0 group-hover:opacity-40 transition-opacity duration-500"}),_e.jsx(Ng,{size:48,className:"text-white relative z-10"})]}),_e.jsx("h2",{className:"text-4xl font-black mb-3 text-white uppercase italic tracking-tighter",children:"Twin-City OS"}),_e.jsx("p",{className:"text-white/40 mb-12 text-sm font-mono",children:"Neural Urban Digital Twin Interface v2.0"}),_e.jsx("div",{className:"space-y-4",children:eA.map(Nt=>_e.jsxs("button",{onClick:()=>Me(Nt),className:"w-full p-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-white/20 hover:scale-[1.02] transition-all text-white flex items-center gap-5 group",children:[_e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden border-2 border-white/10 group-hover:border-blue-400 transition-colors",children:_e.jsx("img",{src:Nt.avatar,className:"w-full h-full",alt:Nt.name})}),_e.jsxs("div",{className:"text-left",children:[_e.jsx("span",{className:"font-bold block text-lg",children:Nt.name}),_e.jsx("span",{className:"text-xs text-white/40 uppercase tracking-widest",children:Nt.role})]}),_e.jsx(Vx,{className:"ml-auto text-white/20 group-hover:text-white group-hover:translate-x-1 transition-all"})]},Nt.email))})]})]}):f==="HANDSHAKE"?_e.jsxs("div",{className:"fixed inset-0 bg-[#020617] text-white flex flex-col items-center justify-center font-mono z-[200]",children:[_e.jsx("div",{className:"w-64 h-1 bg-white/10 rounded-full overflow-hidden mb-8",children:_e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300 ease-out",style:{width:`${Dt/yn.length*100}%`}})}),_e.jsx("div",{className:"h-8 flex items-center justify-center",children:_e.jsx("span",{className:"animate-pulse text-blue-400",children:yn[Dt]||"System Ready"})})]}):_e.jsxs("div",{className:"h-screen w-screen relative bg-[#020617] overflow-hidden flex",children:[_e.jsxs("nav",{className:"w-20 h-full z-[80] glass-panel border-r border-white/10 flex flex-col items-center py-8 gap-10",children:[_e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center shadow-2xl shadow-blue-500/30 mb-4",children:_e.jsx(Ng,{size:24,className:"text-white"})}),_e.jsxs("div",{className:"flex flex-col gap-6",children:[_e.jsx("button",{onClick:()=>I("HOME"),className:`w-12 h-12 rounded-2xl flex items-center justify-center transition-all ${T==="HOME"?"bg-blue-600 text-white shadow-lg shadow-blue-500/20":"text-white/20 hover:text-white hover:bg-white/5"}`,children:_e.jsx(ib,{size:22})}),_e.jsx("button",{onClick:()=>I("SYSTEM"),className:`w-12 h-12 rounded-2xl flex items-center justify-center transition-all ${T==="SYSTEM"?"bg-purple-600 text-white shadow-lg shadow-purple-500/20":"text-white/20 hover:text-white hover:bg-white/5"}`,children:_e.jsx($x,{size:22})}),_e.jsx("button",{onClick:()=>I("COMMUNITY"),className:`w-12 h-12 rounded-2xl flex items-center justify-center transition-all ${T==="COMMUNITY"?"bg-emerald-600 text-white shadow-lg shadow-emerald-500/20":"text-white/20 hover:text-white hover:bg-white/5"}`,children:_e.jsx(fb,{size:22})})]}),_e.jsxs("div",{className:"mt-auto flex flex-col gap-6 items-center",children:[_e.jsx("button",{onClick:()=>_t(!0),className:"w-12 h-12 rounded-2xl overflow-hidden border-2 border-white/10 hover:border-white/50 transition-all",children:_e.jsx("img",{src:u.avatar,className:"w-full h-full object-cover"})}),_e.jsx("button",{onClick:at,className:"text-white/20 hover:text-red-400 transition-colors",children:_e.jsx(Ty,{size:20})})]})]}),_e.jsxs("main",{className:"flex-1 relative flex flex-col overflow-hidden",children:[T==="HOME"&&_e.jsxs("div",{className:"absolute inset-0 z-0 animate-in fade-in duration-500",children:[_e.jsx(Ab,{onBuildingClick:Rt,overlayType:ee,highlightedIds:Le,groundedPoints:se}),_e.jsx("div",{className:"absolute top-8 left-8 right-8 z-40 flex justify-between pointer-events-none",children:_e.jsx("div",{className:"glass-panel p-5 rounded-[2rem] border border-white/10 flex items-center gap-6 pointer-events-auto shadow-2xl backdrop-blur-xl",children:_e.jsxs("div",{className:"flex flex-col",children:[_e.jsx("span",{className:"text-[10px] font-black tracking-[0.3em] text-blue-400 uppercase mb-1",children:"Status"}),_e.jsxs("div",{className:"flex items-center gap-2",children:[_e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),_e.jsx("span",{className:"text-sm font-bold text-white",children:"Neural_Grid_Active"})]})]})})}),_e.jsx("div",{className:`absolute bottom-8 left-8 transition-all duration-700 z-50 glass-panel shadow-[0_0_100px_rgba(0,0,0,0.5)] flex flex-col border border-white/10 overflow-hidden backdrop-blur-xl ${st?"w-24 h-24 rounded-[2.5rem]":"w-[480px] h-[640px] rounded-[3rem]"}`,children:_e.jsx(Sb,{messages:F,onSendMessage:Et,activeAgent:S,isTyping:G,isCollapsed:st,onToggleCollapse:()=>We(!st)})})]}),T==="SYSTEM"&&_e.jsx("div",{className:"text-white p-10 flex items-center justify-center h-full text-2xl font-mono text-white/20",children:"System Dashboard Placeholder"}),T==="COMMUNITY"&&_e.jsx("div",{className:"text-white p-10 flex items-center justify-center h-full text-2xl font-mono text-white/20",children:"Community Feed Placeholder"})]}),zt&&_e.jsx("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-6 bg-black/70 backdrop-blur-md animate-in fade-in duration-200",children:_e.jsxs("div",{className:"glass-panel border border-white/10 p-10 rounded-[3rem] text-white relative max-w-md w-full shadow-2xl",children:[_e.jsx("button",{onClick:()=>_t(!1),className:"absolute top-6 right-6 p-2 hover:bg-white/10 rounded-full transition-colors",children:_e.jsx(C_,{size:20})}),_e.jsxs("div",{className:"flex flex-col items-center text-center",children:[_e.jsx("div",{className:"w-24 h-24 rounded-full overflow-hidden border-4 border-blue-500/20 mb-6",children:_e.jsx("img",{src:u.avatar,className:"w-full h-full object-cover"})}),_e.jsx("h2",{className:"text-2xl font-bold mb-2",children:u.name}),_e.jsx("div",{className:"bg-white/5 px-4 py-2 rounded-lg border border-white/5 mb-8",children:_e.jsx("p",{className:"font-mono text-blue-400 text-xs break-all",children:u.did})}),_e.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full mb-8",children:[_e.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5",children:[_e.jsx("span",{className:"text-xs text-white/40 uppercase block mb-1",children:"Credit Score"}),_e.jsx("span",{className:"text-2xl font-bold text-emerald-400",children:u.eigenCreditScore})]}),_e.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5",children:[_e.jsx("span",{className:"text-xs text-white/40 uppercase block mb-1",children:"Stake"}),_e.jsx("span",{className:"text-xl font-bold text-purple-400",children:u.slashableValue})]})]}),_e.jsxs("button",{onClick:at,className:"px-6 py-4 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-2xl w-full font-bold transition-colors flex items-center justify-center gap-2",children:[_e.jsx(Ty,{size:18}),"Disconnect Neural Link"]})]})]})}),_e.jsx(Mb,{point:Ut,isOpen:Xt,onClose:()=>tn(!1),onViewDetails:$t,onCancel:Vt}),_e.jsx(mn,{isOpen:an,onClose:()=>An(!1),lumalabsUrl:"https://lumalabs.ai/capture/0fd66136-b18e-4389-a99c-092acaeeb1d4",difyData:kn}),_e.jsx("style",{children:`
        .glass-panel { background: rgba(10, 10, 10, 0.6); backdrop-filter: blur(16px); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 2px; }
      `})]})},nx=document.getElementById("root");if(!nx)throw new Error("Could not find root element to mount to");const iA=Rx.createRoot(nx);iA.render(_e.jsx(wx.StrictMode,{children:_e.jsx(nA,{})}));
